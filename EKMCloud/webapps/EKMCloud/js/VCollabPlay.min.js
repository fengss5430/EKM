/*! VCollabWeb - v2017 R1 Version 1.1.117.1225 -  2017-12-27, 2:25:16 PM */
function VCTPlay(){function a(a,e){b(),h=new CAXViewer;var f=null,g=d("Debug"),p=d("GUI");""!=p&&(h.IsURLGUIQStringExists=!0),p="false"!=p;var q=document.getElementById("divCaxViewer"),r={container:q,gui:p};"true"==g&&h.enableDebug(),h.init(r),i=new CAXViewer.MouseControls,i.init(q,h),k=c(),k&&(j=new CAXViewer.TouchControls,j.init(q,h)),n&&h.setNWJSEnvironment(),0==m?e?h.loadFile(a,f):h.loadURL(a,f):(h.setNWJSEnvironment(),h.loadBufferData(a,o));var s={};s.gradientcolor1="#9F9FFF",s.gradientcolor2="#FFFFFF",h.setBackground(CAXViewer.BGMode.GRADIENT,s),l&&h.updateGUI(l)}function b(){i&&(i.clear(),delete i),i=null,j&&(j.clear(),delete j),j=null,h&&(h.deleteOBJ(),delete h),h=null}function c(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0}function d(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}function e(){if("undefined"!=typeof Storage){var a=localStorage.getItem("appVersion"),b=!1;if(null==a||void 0==a)localStorage.setItem("appVersion",CAXViewer.VERSION),b=!0;else{var c=g(CAXViewer.VERSION),d=g(a);d<c&&(localStorage.setItem("appVersion",CAXViewer.VERSION),b=!0)}var c=g(CAXViewer.VERSION),e=new Date,h=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),0,0),i=(h-c)/1e3/60/60,j=24*CAXViewer.showUpdateMsgDays;i<j&&1==b&&f()}else CAXViewer.warn("Local Storage is not supported in this browser.")}function f(){var a="VCollabWeb has been updated";a=a+"<br><br><a style='color:Red' href = '"+CAXViewer.changeLogFile+"' target='_blank'>Change Log</a>",$.alert({title:CAXViewer.AppName,useBootstrap:!1,theme:"light",boxWidth:"30%",containerFluid:!0,content:a})}function g(a){try{var b=parseInt("20"+a.split(".")[2].substring(1)),c="",d="";if(4==a.split(".")[3].length?(d=a.split(".")[3].substring(2),c=a.split(".")[3].substring(0,2)):(d=parseInt(a.split(".")[3].substring(1)),c=parseInt(a.split(".")[3].substring(0,1))),d&&c&&b)return Date.UTC(b,c-1,d,0,0,0,0)}catch(a){CAXViewer.error(a)}return null}var h=null,i=null,j=null,k=!1,l=null,m=!1,n=!1,o="Choose File",p=document.getElementById("VCTFileOpen");return p&&p.addEventListener("change",function(b){var c=p.files,d=(c.length,c[0]);d&&a(d,!0),this.value=null}),$.ajax({url:"others/config.json",dataType:"json",async:!0,success:function(a){a&&(null!=a.pastVersionLink&&(CAXViewer.pastVersionLink=a.pastVersionLink),null!=a.thirdPartyLibrariesLink&&void 0!=a.thirdPartyLibrariesLink&&(CAXViewer.thirdPartyLibrariesLink=a.thirdPartyLibrariesLink),null!=a.showUpdateMsgDays&&(CAXViewer.showUpdateMsgDays=a.showUpdateMsgDays),null!=a.changeLogFile&&(CAXViewer.changeLogFile=a.changeLogFile),null!=a.releaseNotesFile&&(CAXViewer.releaseNotesFile=a.releaseNotesFile),h&&(h.updateGUI(a.gui),l=a.gui))}}).done(function(){CAXViewer.log("Configuration file loaded successfully")}).fail(function(a,b,c){var d=b+", "+c;CAXViewer.error("Error in loading Configuration file \n"+d)}).always(function(){e()}),{clear:function(){return b(),!0},loadFile:function(b){if(b&&""!=b)a(b);else{var c=d("file");a(""!==c?c:null)}return!0},loadArgFile:function(b,c){return m=!0,o=b,a(c),m=!1,!0},loadLocalFile:function(b){a(b,!0)},refreshViewer:function(){h.refreshViewer()},initNWJSEnv:function(){return n=!0,h&&h.setNWJSEnvironment(),!0}}}var pick_vertex_shader="//pick_vertex_shader \nattribute vec3 position;  //the color of the point \nuniform mat4 pMatrixUniform; \nuniform mat4 mvMatrixUniform; \nvoid main(void) { //pre-built function \nvec4 vPosWorldSpace = mvMatrixUniform * vec4(position, 1.0); \ngl_Position = pMatrixUniform * vPosWorldSpace; \n} \n",pick_fragment_shader="uniform highp vec3 pickColor; \nvoid main(void) { \ngl_FragColor = vec4( pickColor, 1.0); \ngl_FragColor.w = 1.0; \n} \n",light_vertex_shader="//light_vertex_shader \nconst mat4 ScaleMatrix = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0); \nattribute vec3 position;  //the position of the point \nattribute vec3 normal;  //the normal of the point \nattribute vec3 color; //the color of the point \nvarying vec3 vNormal;  //the vnormal of the point \nvarying vec4 vPos;  //the vposition of the point \nvarying vec3 vColor; \nuniform mat4 pMatrixUniform; \nuniform mat4 mvMatrixUniform; \nuniform mat4 mNormalMatrixUniform; \nuniform vec3 objectColor; \nuniform vec3 userColor; \nuniform highp float usecolor; \nuniform highp float usetexture; \nuniform highp vec4 ClipPlane1; \nuniform highp vec4 ClipPlane2; \nuniform bool ClipPlane1_State; \nuniform bool ClipPlane2_State; \nuniform highp mat4 mInverseMVMatrix; \n  // not required so not useduniform highp vec3 ClipEdgeColor; \nattribute vec2 uv; \nvarying vec2 _uv; \nvarying vec2 local_uv; \nuniform int IsAnimationOn; \nuniform highp float frameFactor; \nattribute vec3 targetFrame; \nattribute vec3 NormaltargetFrame; \nattribute vec2 UVtargetFrame; \nattribute vec3 realResult; \nattribute vec3 imaginaryResult; \nuniform vec3 scaleFactor; \nuniform float UVminoffset; \nvoid main(void) { //pre-built function \ngl_PointSize = 3.0; \nvec4 vPosWorldSpace; \nvec3 transformedNormal; \nlocal_uv = uv; \nif(IsAnimationOn == 0) { //NoAnimation // targetFrame is usedfor defomation with scaling \nvec3 vnewposition = position  +  ((targetFrame - position) * scaleFactor) ; \nvPosWorldSpace = mvMatrixUniform * vec4(vnewposition, 1.0); \nvec3 vnewNormal= normal  +  ((NormaltargetFrame - normal) *  scaleFactor) ; \nvnewNormal = normalize(vnewNormal); \ntransformedNormal = (mNormalMatrixUniform * vec4(vnewNormal, 0.0)).xyz; \n//if(uv.x <= UVminoffset) \n//local_uv.x = UVminoffset; \n//if(uv.x >= (1.0 - UVminoffset) ) \n//local_uv.x = 1.0 - UVminoffset; \n} \nelse if(IsAnimationOn == 1){  //linear or eigen\nvec3 vnewposition = position  +  ((targetFrame - position) * frameFactor * scaleFactor) ; \nvPosWorldSpace = mvMatrixUniform * vec4(vnewposition, 1.0); \nvec3 vnewNormal= normal  +  ((NormaltargetFrame - normal) * frameFactor * scaleFactor) ; \nvnewNormal = normalize(vnewNormal); \ntransformedNormal = (mNormalMatrixUniform * vec4(vnewNormal, 0.0)).xyz; \nif(uv.x > 0.0 && uv.x < 1.0 ) \nlocal_uv.x = UVminoffset + ((uv.x - UVminoffset) * abs(frameFactor))  ; \n} \nelse if(IsAnimationOn == 2){  //Eigen_vector_complex \nvec3 vnewposition = position; \nvnewposition.x = position.x  + ( ( (realResult.x * cos(frameFactor)) - (imaginaryResult.x *sin(frameFactor)) ) * scaleFactor.x); \nvnewposition.y = position.y  + ( ( (realResult.y * cos(frameFactor)) - (imaginaryResult.y *sin(frameFactor)) ) * scaleFactor.y); \nvnewposition.z = position.z  + ( ( (realResult.z * cos(frameFactor)) - (imaginaryResult.z *sin(frameFactor)) ) * scaleFactor.z); \nvec3 vnewNormal = normal; \n//vnewNormal.x = vnewNormal.x  + ( (realResult.x * cos(frameFactor)) - (imaginaryResult.x *sin(frameFactor)) ); \n//vnewNormal.y = vnewNormal.y  + ( (realResult.y * cos(frameFactor)) - (imaginaryResult.y *sin(frameFactor)) ); \n//vnewNormal.z = vnewNormal.z  + ( (realResult.z * cos(frameFactor)) - (imaginaryResult.z *sin(frameFactor)) ); \nvPosWorldSpace = mvMatrixUniform * vec4(vnewposition, 1.0); \nvnewNormal = normalize(vnewNormal); \ntransformedNormal = (mNormalMatrixUniform * vec4(vnewNormal, 0.0)).xyz; \n} \nelse if(IsAnimationOn == 3){  //TRANSIENT \nvec3 vnewposition = position  +  ((targetFrame - position) * scaleFactor) ; \nvPosWorldSpace = mvMatrixUniform * vec4(vnewposition, 1.0); \ntransformedNormal = (mNormalMatrixUniform * vec4(NormaltargetFrame, 0.0)).xyz; \nlocal_uv = uv; \n} \nelse if(IsAnimationOn == 30){  //No Animation \nvec3 vnewposition = position; \nvPosWorldSpace = mvMatrixUniform * vec4(vnewposition, 1.0); \ntransformedNormal = (mNormalMatrixUniform * vec4(normal, 0.0)).xyz; \nlocal_uv = uv; \n} \ngl_Position = pMatrixUniform * vPosWorldSpace; \nvPos = vPosWorldSpace; \nvNormal = transformedNormal; \n_uv =  local_uv; \nvec3 localColor = objectColor; \nif(usecolor > 0.0) \n{ \nif(usecolor==2.0) \nlocalColor = userColor; \nelse \nlocalColor = color; \n} \n vColor =  localColor;\n} \n",light_fragment_shader="varying highp vec3 vNormal; \nvarying highp vec3 vColor; \nvarying highp vec4 vPos; \nuniform highp vec3 vLightDir; \nuniform highp vec3 ambientColor; \nuniform highp vec3 diffuseColor; \nuniform highp vec3 specularColor; \nuniform highp vec3 emissiveColor; \nuniform highp float shininess; \nuniform highp float transparency; \nuniform highp float ambientIntensity; \nuniform sampler2D caeTexture; \nvarying highp vec2 _uv; \nuniform highp mat4 pMatrixUniform; \nuniform highp mat4 mvMatrixUniform; \nuniform highp mat4 mNormalMatrixUniform; \nuniform highp float usetexture; \nuniform highp float uselighting; \nuniform highp float isSelected; \nuniform highp float usetransparency; \nuniform highp float usecolor; \nuniform highp vec4 ClipPlane1; \nuniform highp vec4 ClipPlane2; \nuniform bool ClipPlane1_State; \nuniform bool ClipPlane2_State; \nuniform highp mat4 mInverseMVMatrix; \nuniform highp float sectionEdgeThickness; \nuniform highp vec3 ClipEdgeColor; \nvoid main(void) { \n//highp vec4  vLightDirNew = pMatrixUniform * vec4(vLightDir, 1.0); \nhighp vec3 nlightDir = normalize(vLightDir); \nhighp vec3 nnormal = normalize(vNormal); \nif (!gl_FrontFacing) nnormal = -nnormal;        \nhighp float diffuse = 1.0; \nhighp float SpecularFactor = 0.0; \nif (uselighting > 0.0) { \ndiffuse = dot(nlightDir, nnormal); \nif(usetexture > 0.0) \ndiffuse = diffuse + 0.2;  \nif (diffuse > 0.0) \n{ \nhighp vec3 VertexToEye = -normalize(vPos.xyz); \nhighp vec3 LightReflect = normalize(reflect(nlightDir, nnormal)); \nSpecularFactor = max(0.0, dot(VertexToEye, LightReflect)); \n} \ndiffuse = clamp(diffuse, 0.0, 1.0); \nSpecularFactor = pow(SpecularFactor, shininess); \n} \nhighp vec3 diffColor = (1.0 - usetexture) * diffuseColor.xyz + usetexture * texture2D(caeTexture, _uv).xyz; \n//http://stackoverflow.com/questions/22628186/glclipplane-is-there-an-equivalent-in-webgl \nif(ClipPlane1_State) { \n//if(dot( vec4(Original_Position_for_clipping , 1.0) ,ClipPlane1 ) < 0.0) { \nif(dot(vPos ,  ClipPlane1 ) < 0.0) { \ndiscard; \n}  \n}  \nif(ClipPlane2_State) { \nif(dot(vPos ,  ClipPlane2 ) < 0.0) { \ndiscard; \n}  \n}  \ngl_FragColor = vec4( ambientColor*ambientIntensity + emissiveColor +diffuse*diffColor + SpecularFactor * specularColor, 1.0); \ngl_FragColor.w = 1.0; \nif (isSelected > 0.0)  \ngl_FragColor.xyz = gl_FragColor.xyz * 0.4 + 0.6 * vec3(1.0, 0.6, 0.0); \nif (usetransparency > 0.0) {\ngl_FragColor = vec4((diffuse ) * diffColor * 0.5, 1.0); \ngl_FragColor.w = transparency;  \n}  \nif(usecolor > 0.0) \ngl_FragColor.xyz = vec3(vColor); \nif(ClipPlane1_State) { \nif(dot(vPos ,  ClipPlane1 ) < sectionEdgeThickness) { \ngl_FragColor = vec4(ClipEdgeColor,1.0); //vec4(1.0, 1.0 , 0.0, 1.0); \n}  \n}  \nif(ClipPlane2_State) { \nif(dot(vPos ,  ClipPlane2 ) < sectionEdgeThickness) { \ngl_FragColor = vec4(ClipEdgeColor,1.0); //vec4(1.0, 0.0 , 0.0, 1.0); \n}  \n}  \n} \n",light_vertex_shader_v3="//light_vertex_shader \nconst mat4 ScaleMatrix = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0); \nattribute vec3 position;  //the position of the point \nattribute vec3 normal;  //the normal of the point \nattribute vec3 color; //the color of the point \nvarying vec3 vNormal;  //the vnormal of the point \nvarying vec4 vPos;  //the vposition of the point \nvarying vec3 vColor; \nuniform mat4 pMatrixUniform; \nuniform mat4 mvMatrixUniform; \nuniform mat4 mNormalMatrixUniform; \nuniform vec3 objectColor; \nuniform vec3 userColor; \nuniform highp float usecolor; \nuniform highp float usetexture; \nuniform highp vec4 ClipPlane1; \nuniform highp vec4 ClipPlane2; \nuniform bool ClipPlane1_State; \nuniform bool ClipPlane2_State; \nuniform highp mat4 mInverseMVMatrix; \n // not required so not useduniform highp vec3 ClipEdgeColor; \nattribute vec2 uv; \nvarying vec2 _uv; \nvarying vec2 local_uv; \nuniform int IsAnimationOn; \nuniform highp float frameFactor; \nattribute vec3 targetFrame; \nattribute vec3 NormaltargetFrame; \nattribute vec2 UVtargetFrame; \nattribute vec3 realResult; \nattribute vec3 imaginaryResult; \nuniform vec3 scaleFactor; \nuniform vec3 transientPivotVector; \nuniform float UVminoffset; \nvoid main(void) { //pre-built function \ngl_PointSize = 3.0; \nvec4 vPosWorldSpace; \nvec3 transformedNormal; \nlocal_uv = uv; \nif(IsAnimationOn == 0) { //NoAnimation // targetFrame is usedfor defomation with scaling \nvec3 vnewposition = position  +  ((targetFrame) * scaleFactor) ; \nvPosWorldSpace = mvMatrixUniform * vec4(vnewposition, 1.0); \nvec3 vnewNormal= NormaltargetFrame ; \nvnewNormal = normalize(vnewNormal); \ntransformedNormal = (mNormalMatrixUniform * vec4(vnewNormal, 0.0)).xyz; \n//if(uv.x <= UVminoffset) \n//local_uv.x = UVminoffset; \n//if(uv.x >= (1.0 - UVminoffset) ) \n//local_uv.x = 1.0 - UVminoffset; \n} \nelse if(IsAnimationOn == 1){  //linear or eigen\nvec3 vnewposition = position  +  ((targetFrame) * frameFactor * scaleFactor) ; \nvPosWorldSpace = mvMatrixUniform * vec4(vnewposition, 1.0); \nvec3 vnewNormal= normal  +  ((NormaltargetFrame - normal) * frameFactor ) ; \nvnewNormal = normalize(vnewNormal); \ntransformedNormal = (mNormalMatrixUniform * vec4(vnewNormal, 0.0)).xyz; \nif(uv.x > 0.0 && uv.x < 1.0 ) \nlocal_uv.x = UVminoffset + ((uv.x - UVminoffset) * abs(frameFactor))  ; \n} \nelse if(IsAnimationOn == 2){  //Eigen_vector_complex \nvec3 vnewposition = position; \nvnewposition.x = position.x  + ( ( (realResult.x * cos(frameFactor)) - (imaginaryResult.x *sin(frameFactor)) ) * scaleFactor.x); \nvnewposition.y = position.y  + ( ( (realResult.y * cos(frameFactor)) - (imaginaryResult.y *sin(frameFactor)) ) * scaleFactor.y); \nvnewposition.z = position.z  + ( ( (realResult.z * cos(frameFactor)) - (imaginaryResult.z *sin(frameFactor)) ) * scaleFactor.z); \nvec3 vnewNormal = normal; \n//vnewNormal.x = vnewNormal.x  + ( (realResult.x * cos(frameFactor)) - (imaginaryResult.x *sin(frameFactor)) ); \n//vnewNormal.y = vnewNormal.y  + ( (realResult.y * cos(frameFactor)) - (imaginaryResult.y *sin(frameFactor)) ); \n//vnewNormal.z = vnewNormal.z  + ( (realResult.z * cos(frameFactor)) - (imaginaryResult.z *sin(frameFactor)) ); \nvPosWorldSpace = mvMatrixUniform * vec4(vnewposition, 1.0); \nvnewNormal = normalize(vnewNormal); \ntransformedNormal = (mNormalMatrixUniform * vec4(vnewNormal, 0.0)).xyz; \n} \nelse if(IsAnimationOn == 3){  //TRANSIENT \nvec3 vnewposition = position  +  ((targetFrame - transientPivotVector) * scaleFactor) ; \nvPosWorldSpace = mvMatrixUniform * vec4(vnewposition, 1.0); \ntransformedNormal = (mNormalMatrixUniform * vec4(NormaltargetFrame, 0.0)).xyz; \nlocal_uv = uv; \n} \nelse if(IsAnimationOn == 30){  //No Animation \nvec3 vnewposition = position; \nvPosWorldSpace = mvMatrixUniform * vec4(vnewposition, 1.0); \ntransformedNormal = (mNormalMatrixUniform * vec4(normal, 0.0)).xyz; \nlocal_uv = uv; \n} \ngl_Position = pMatrixUniform * vPosWorldSpace; \nvPos = vPosWorldSpace; \nvNormal = transformedNormal; \n_uv =  local_uv; \nvec3 localColor = objectColor; \nif(usecolor > 0.0) \n{ \nif(usecolor==2.0) \nlocalColor = userColor; \nelse \nlocalColor = color; \n} \n vColor =  localColor;\n} \n",light_fragment_shader_v3="varying highp vec3 vNormal; \nvarying highp vec3 vColor; \nvarying highp vec4 vPos; \nuniform highp vec3 vLightDir; \nuniform highp vec3 ambientColor; \nuniform highp vec3 diffuseColor; \nuniform highp vec3 specularColor; \nuniform highp vec3 emissiveColor; \nuniform highp float shininess; \nuniform highp float transparency; \nuniform highp float ambientIntensity; \nuniform sampler2D caeTexture; \nvarying highp vec2 _uv; \nuniform highp mat4 pMatrixUniform; \nuniform highp mat4 mvMatrixUniform; \nuniform highp mat4 mNormalMatrixUniform; \nuniform highp float usetexture; \nuniform highp float uselighting; \nuniform highp float isSelected; \nuniform highp float usetransparency; \nuniform highp float usecolor; \nuniform highp vec4 ClipPlane1; \nuniform highp vec4 ClipPlane2; \nuniform bool ClipPlane1_State; \nuniform bool ClipPlane2_State; \nuniform highp mat4 mInverseMVMatrix; \nuniform highp float sectionEdgeThickness; \nuniform highp vec3 ClipEdgeColor; \nvoid main(void) { \n//highp vec4  vLightDirNew = pMatrixUniform * vec4(vLightDir, 1.0); \nhighp vec3 nlightDir = normalize(vLightDir); \nhighp vec3 nnormal = normalize(vNormal); \nif (!gl_FrontFacing) nnormal = -nnormal;        \nhighp float diffuse = 1.0; \nhighp float SpecularFactor = 0.0; \nif (uselighting > 0.0) { \ndiffuse = dot(nlightDir, nnormal); \nif(usetexture > 0.0) \ndiffuse = diffuse + 0.2;  \nif (diffuse > 0.0) \n{ \nhighp vec3 VertexToEye = -normalize(vPos.xyz); \nhighp vec3 LightReflect = normalize(reflect(nlightDir, nnormal)); \nSpecularFactor = max(0.0, dot(VertexToEye, LightReflect)); \n} \ndiffuse = clamp(diffuse, 0.0, 1.0); \nSpecularFactor = pow(SpecularFactor, shininess); \n} \nhighp vec3 diffColor = (1.0 - usetexture) * diffuseColor.xyz + usetexture * texture2D(caeTexture, _uv).xyz; \n//http://stackoverflow.com/questions/22628186/glclipplane-is-there-an-equivalent-in-webgl \nif(ClipPlane1_State) { \n//if(dot( vec4(Original_Position_for_clipping , 1.0) ,ClipPlane1 ) < 0.0) { \nif(dot(vPos ,   ClipPlane1 ) < 0.0) { \ndiscard; \n}  \n}  \nif(ClipPlane2_State) { \nif(dot(vPos ,   ClipPlane2 ) < 0.0) { \ndiscard; \n}  \n}  \ngl_FragColor = vec4( ambientColor*ambientIntensity + emissiveColor +diffuse*diffColor + SpecularFactor * specularColor, 1.0); \ngl_FragColor.w = 1.0; \nif (isSelected > 0.0)  \ngl_FragColor.xyz = gl_FragColor.xyz * 0.4 + 0.6 * vec3(1.0, 0.6, 0.0); \nif (usetransparency > 0.0) {\ngl_FragColor = vec4((diffuse ) * diffColor * 0.5, 1.0); \ngl_FragColor.w = transparency;  \n}  \nif(usecolor > 0.0) \ngl_FragColor.xyz = vec3(vColor); \nif(ClipPlane1_State) { \nif(dot(vPos ,   ClipPlane1 ) < sectionEdgeThickness) { \ngl_FragColor = vec4(ClipEdgeColor,1.0);//vec4(1.0, 0.0 , 0.0, 1.0); \n}  \n}  \nif(ClipPlane2_State) { \nif(dot(vPos ,   ClipPlane2 ) < sectionEdgeThickness) { \ngl_FragColor = vec4(ClipEdgeColor,1.0);// vec4(1.0, 0.0 , 0.0, 1.0); \n}  \n}  \n} \n",label_vertex_shader="//label_vertex_shader \nattribute vec3 position; \nuniform mat4 pMatrixUniform; \nuniform mat4 mvMatrixUniform; \nattribute vec3 color; \nvarying vec3 vColor; \nuniform vec3 userColor; \nuniform highp float usecolor; \nvoid main(void) { \ngl_PointSize = 5.0; \ngl_Position = pMatrixUniform * mvMatrixUniform * vec4(position, 1.0); \nif(usecolor>0.0) \nvColor = userColor; \nelse \nvColor = color; \n//vColor = color; \n} \n",label_fragment_shader="precision mediump float; \nvarying vec3 vColor; \nvoid main(void) { \n//gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0); \ngl_FragColor = vec4(vColor, 1.0); \n} \n",section_vertex_shader="//section_vertex_shader \nattribute vec3 position; \nuniform mat4 pMatrixUniform; \nuniform mat4 mvMatrixUniform; \nuniform vec3 userColor; \nuniform float usetransparency; \nuniform float transparency; \nvoid main(void) { \ngl_Position = pMatrixUniform * mvMatrixUniform * vec4(position, 1.0); \n} \n",section_fragment_shader="precision highp float; \nuniform vec3 userColor; \nuniform float usetransparency; \nuniform float transparency; \nvoid main(void) { \n//gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0); \ngl_FragColor = vec4(userColor, 1.0); \nif (usetransparency > 0.0) \ngl_FragColor.w = transparency; //usetransparency;  \n} \n",CAXViewer=function(){function a(){b();var a=D.get3DCanvas();if(L){var c=L.labelArray;if(c&&c.length>0){var d=0;for(d=0;d<c.length;d++){var e=c[d];if(e.getLabelType()==L.type[0]&&1==e.getIsRelativePosition()){var f=e.getRelativePosition(),g=f[0],h=f[1],i=G.getAbsolutePosition(g,h,a);e.changePosition([i[0],i[1]])}}}}if(N){var j=N.XYPlotArray;if(j&&j.length>0){var d=0;for(d=0;d<j.length;d++){var k=j[d];if(1==k.getIsRelativePosition()){var l=a.offsetWidth,m=a.offsetHeight,f=k.getRelativePosition(),g=f[0],h=f[1],n=G.getAbsolutePositionv2(g,h,l,m),o=[];o[0]=n[0],o[1]=parseFloat(n[1]),k.changePosition([o[0],o[1]]);var p=k.getRelativeSize();g=p[0],h=p[1];var q=G.getAbsolutePositionv2(g,h,l,m);k.changeSize([q[0],q[1]])}}}}O&&O.updateCtrl(),P&&P.viewerResized()}function b(){var a=D.get3DCanvas(),b=D.get2DCanvas(),c=D.getlabelContainer();a.style.height=R.offsetHeight-CAXViewer.ViewerTopOffset+"px",b.style.height=R.offsetHeight-CAXViewer.ViewerTopOffset+"px",c.style.height=R.offsetHeight-CAXViewer.ViewerTopOffset+"px"}function c(){var a=D.get3DCanvas(),b=D.get2DCanvas(),c=D.getlabelContainer();a.style.top=CAXViewer.ViewerTopOffset+"px",b.style.top=CAXViewer.ViewerTopOffset+"px",c.style.top=CAXViewer.ViewerTopOffset+"px"}function d(){var b=!1;G.isFullScreenEnable()?($("#divCaxViewer").removeClass("divCaxViewer"),$("#divCaxViewer").addClass("divCaxViewer_FULL"),b=!1):($("#divCaxViewer").removeClass("divCaxViewer_FULL"),$("#divCaxViewer").addClass("divCaxViewer"),b=!0),setTimeout(function(){a()},300),O&&O.updateCtrl()}function e(){G.isInsideIframe()&&f()&&g()}function f(){var a=window.navigator.standalone,b=window.navigator.userAgent.toLowerCase(),c=/safari/.test(b),d=/iphone|ipod|ipad/.test(b);if(d){if(!a&&c)return!0;if(a&&!c)return!0;if(!a&&!c)return!0}return!1}function g(){if(""==window.name)return void CAXViewer.error("FullScreen is not supported");try{var a=parent.document.getElementById(window.name);if(a)if(0==D.iphoneViewerMaximized){var b=parent.document.body,c=parent.document.documentElement,d=Math.max(b.scrollHeight,b.offsetHeight,c.clientHeight,c.scrollHeight,c.offsetHeight),e=Math.max(b.scrollWidth,b.offsetWidth,c.clientWidth,c.scrollWidth,c.offsetWidth);d=c.clientHeight,a.width=e,a.height=d,a.style.width=e+"px",a.style.height="100vh",a.style.position="absolute",a.style.top=0,a.style.left=0,D.iphoneViewerMaximized=!0,P&&P.setIsFullScreen(D.iphoneViewerMaximized)}else{var c=parent.document.documentElement,f=Q.height*c.clientHeight;a.width=Q.width,a.height=f,a.style.width=Q.width+"px",a.style.height=f+"px",a.style.position="absolute",a.style.top=Q.topPos+"px",a.style.left=Q.leftPos+"px",D.iphoneViewerMaximized=!1,P&&P.setIsFullScreen(D.iphoneViewerMaximized)}}catch(a){CAXViewer.error("FullScreen is not supported")}}function h(){CAXViewer.error("FullScreen is not supported in this browser")}function k(a,b){U=b,D.updateStatus("");try{var c=G.convertArrayBuffertoString(a);c=c.replace(/\t/g,"&emsp;");var d=JSON&&JSON.parse(c)||$.parseJSON(c);if(CAXViewer.log(d),H.setViewPointApplied(!0),1==d.isCurrentDisplay)return void l(d,b);if(P){P.updateDisplayModeIndex("");var e=parseFloat(1);P.updateCAEAnimation(!1,0,e,"No Animation")}if(I.clearSymbolPlot(),I.stopAnimation(null,!1),I.resetAnimation(),D.updateLegendSelectionIcon(!1),D.setLegendVisibility(!1),D.refreshMenuIcon(),L&&L.deleteAllLabels(),N&&N.deleteAll(),H.hideAllLegend(),!d.ViewerState)return;var f=(d.ViewPathName,d.ViewPointName,d.ViewPointVersion,d.ViewerState);if(f){var g=f.Position,h=f.Orientation,i=f.OrthoCameraWndWidth,j=f.OrthoCameraWndHeight,k=f.ViewPortWidth,w=f.ViewPortHeight;H.resetOrthoProjectionZoomFactor(),H.resetRotation(),H.setTranslation([g[0],-g[1],g[2]]),H.rotate(h[3],[h[0],h[1],h[2]],0),H.updateNearFarPlane(),H.resetZoomFactor();D.get3DCanvas();H.setOrthoWindowWidth(i),H.setOrthoWindowHeight(j)}if(!f.StateCaptured)return;var z=d.MiscState;if(z){var A=z.Background;p(A,b);var B=z.OrthoProjection;1==B?H.setOrthoCamera(!0):H.setOrthoCamera(!1),z.UndeformedMeshColor&&I.setUndeformedMeshColor(null,z.UndeformedMeshColor),z.ShadedMeshColor&&I.setShadedMeshColor(null,z.ShadedMeshColor);var C=!1,E=!1,F=1,J=[0,0,0],K=35;void 0!==z.bFeatureEdges&&(C=z.bFeatureEdges),void 0!==z.bFeatureEdgeDetatchGeometry&&(E=z.bFeatureEdgeDetatchGeometry),void 0!==z.iFeatureEdgeLineWidth&&(F=z.iFeatureEdgeLineWidth),void 0!==z.FeatureEdgeColor&&(J=z.FeatureEdgeColor),void 0!==z.iCreaseAngle&&(K=z.iCreaseAngle),I.setFeatureEdge(null,C,E,F,J,K),void 0!==z.DrawAxis&&H.setDrawAxis(z.DrawAxis)}var O=d.ModelList;if(O){for(var Q=0;Q<O.length;Q++){var R=O[Q],S=R.ModelName,T=R.CEAState,V=R.ModelState,W=R.CAELegendState,X=R.CAEAnimationState,Y=R.SymbolPlotMgrState;D.resetSupplementalTransformations(S),I.removeAllTempNode(S),m(S,V.PickandMoveNodesState),V.TransformState&&n(S,V.TransformState),o(S,V.PartState),I.setViewPointResultName(S,""),I.setViewPointInstanceName(S,""),I.setViewPointDerivedName(S,""),T?(1==T.bPivotDeformation?I.setTransientPivotAnimation(S,!0):I.setTransientPivotAnimation(S,!1),I.setScaleFactor(S,T.ScaleFactor,!1),T.bUndeformedMesh&&D.setUndeformedMesh(T.bUndeformedMesh,S),null!==T.iUndformedMeshMode&&void 0!==T.iUndformedMeshMode&&I.setUndeformedMeshType(S,T.iUndformedMeshMode),I.setViewPointResultInfo(S,T.ResultName,T.InstanceName,T.DerivedName,T.isTransientResult),I.setDeformation(T.bDeform,S,!1),I.applyCAEResultInfo(S,T.ResultName,T.InstanceName,T.DerivedName,T.isTransientResult,!1),I.changeTexture(S,T.PixelTexture,T.bReversedLegend),I.updateUndeformedMesh(S),""==T.ResultName?(D.DisableLegendIcon(!0),D.enableCAEAnimationIcon(!1)):(D.DisableLegendIcon(!1),D.enableCAEAnimationIcon(!0))):I.updateBoundingBox(S),W?I.applyLegendstate(S,W,T.bReversedLegend):I.hideLegend(S),X&&x(S,X,T),Y&&y(S,Y)}I.updateBoundingBox()}v(d.XYPlot,k,w);var Z=d.LabelState,_=Z.LabelVersion;if(null!=_&&void 0!=_||(_=0),Z){s(Z["2DLabels"],k,w,_),s(Z["2DTabels"],k,w,_);var aa=mat4.create();mat4.identity(aa),mat4.translate(aa,[g.x*R.normalizedScale,g.y*R.normalizedScale,-g.z*R.normalizedScale]),mat4.rotate(aa,G.degToRad(h.angle),[h.x,h.y,h.z]),q(Z.ProbeTable,aa,_),r(Z.ProbeXYPlot,aa,k,w,_),t(Z["3DLabels"],aa,"ANNOTATION",_),t(Z["3DMINMAXLabels"],aa,"MINMAX",_),u(Z["3DDistanceLabels"],aa,"DISTANCE",_),u(Z["3DArcLabels"],aa,"ARC",_),u(Z["3DEdgeLabels"],aa,"EDGE",_),u(Z["3DFaceLabels"],aa,"FACE",_)}M.disableSectionPlain1(),M.disableSectionPlain2();var ba=d.SectionState;if(ba){var ca=ba.IsSectionEnabled;null!=ba.Section1&&"undefined"!=ba.Section1&&1==ca&&(M.enableSectionPlain1(),M.setSectionPlain1(ba.Section1),M.setSection1PlaneVisibility(ba.Section1PlaneVisiblity),null!=ba.Section2&&"undefined"!=ba.Section2&&(M.enableSectionPlain2(),M.setSectionPlain2(ba.Section2),M.setSection2PlaneVisibility(ba.Section1PlaneVisiblity)))}}catch(a){CAXViewer.log(a),CAXViewer.error("Error in Data")}}function l(a,b){try{if(P){P.updateDisplayModeIndex("");var c=parseFloat(1);P.updateCAEAnimation(!1,0,c,"No Animation")}if(I.clearSymbolPlot(),I.stopAnimation(null,!1),I.resetAnimation(),D.updateLegendSelectionIcon(!1),D.setLegendVisibility(!1),D.refreshMenuIcon(),L&&L.deleteAllLabels(),N&&N.deleteAll(),H.hideAllLegend(),!a.ViewerState)return;D.enableCAEAnimationIcon(!1);var d=(a.ViewPathName,a.ViewPointName,a.ViewPointVersion,a.ViewerState);if(d){var e=d.Position,f=d.Orientation,g=d.OrthoCameraWndWidth,h=d.OrthoCameraWndHeight,i=d.ViewPortWidth,j=d.ViewPortHeight;H.resetOrthoProjectionZoomFactor(),H.resetRotation(),H.setTranslation([e[0],-e[1],e[2]]),H.rotate(f[3],[f[0],f[1],f[2]],0),H.updateNearFarPlane(),H.resetZoomFactor();D.get3DCanvas();H.setOrthoWindowWidth(g),H.setOrthoWindowHeight(h)}if(!d.StateCaptured)return;var k=a.MiscState;if(k){var l=k.Background;p(l,b);var w=k.OrthoProjection;1==w?H.setOrthoCamera(!0):H.setOrthoCamera(!1),k.UndeformedMeshColor&&I.setUndeformedMeshColor(null,k.UndeformedMeshColor),k.ShadedMeshColor&&I.setShadedMeshColor(null,k.ShadedMeshColor);var x=!1,z=!1,A=1,B=[0,0,0],C=35;k.bFeatureEdges&&(x=x),k.bFeatureEdgeDetatchGeometry&&(z=z),k.iFeatureEdgeLineWidth&&(A=A),k.FeatureEdgeColor&&(B=B),k.iCreaseAngle&&(C=C),I.setFeatureEdge(null,x,z,A,B,C)}var E=a.ModelList;if(E){for(var F=0;F<E.length;F++){var J=E[F],K=J.ModelName,O=J.CEAState,Q=J.ModelState,R=J.CAELegendState,S=(J.CAEAnimationState,J.SymbolPlotMgrState);D.resetSupplementalTransformations(K),I.removeAllTempNode(K),m(K,Q.PickandMoveNodesState),Q.TransformState&&n(K,Q.TransformState),o(K,Q.PartState),I.setViewPointResultName(K,""),I.setViewPointInstanceName(K,""),I.setViewPointDerivedName(K,""),O?(I.updateUndeformedMesh(K),D.setUndeformedMesh(!1,K),I.setScaleFactor(K,[0,0,0],!1)):I.updateBoundingBox(K),R?I.applyLegendstate(K,R,O.bReversedLegend):I.hideLegend(K),S&&y(K,S)}I.updateBoundingBox()}v(a.XYPlot,i,j);var T=a.LabelState,U=T.LabelVersion;if(null!=U&&void 0!=U||(U=0),T){s(T["2DLabels"],i,j,U),s(T["2DTabels"],i,j,U);var V=mat4.create();mat4.identity(V),mat4.translate(V,[e.x*J.normalizedScale,e.y*J.normalizedScale,-e.z*J.normalizedScale]),mat4.rotate(V,G.degToRad(f.angle),[f.x,f.y,f.z]),q(T.ProbeTable,V,U),r(T.ProbeXYPlot,V,i,j,U),t(T["3DLabels"],V,"ANNOTATION",U),t(T["3DMINMAXLabels"],V,"MINMAX",U),u(T["3DDistanceLabels"],V,"DISTANCE",U),u(T["3DArcLabels"],V,"ARC",U),u(T["3DEdgeLabels"],V,"EDGE",U),u(T["3DFaceLabels"],V,"FACE",U)}M.disableSectionPlain1(),M.disableSectionPlain2();var W=a.SectionState;if(W){var X=W.IsSectionEnabled;null!=W.Section1&&"undefined"!=W.Section1&&1==X&&(M.enableSectionPlain1(),M.setSectionPlain1(W.Section1),M.setSection1PlaneVisibility(W.Section1PlaneVisiblity),null!=W.Section2&&"undefined"!=W.Section2&&(M.enableSectionPlain2(),M.setSectionPlain2(W.Section2),M.setSection2PlaneVisibility(W.Section1PlaneVisiblity)))}}catch(a){CAXViewer.log(a),CAXViewer.error("Error in Data")}}function m(a,b){if(!(b.length<=0)){var c=0;for(c=0;c<b.length;c++){var d=b[c],e=d.translation,f=d.rotation;if(1==d.NodeType){var g=I.getPartForPartNameAndKey(a,d.Part,d.key);g&&(I.applyTranslationToPart(a,g,[e[0],e[1],e[2]]),I.applyRotationToPart(a,g,f[3],[f[0],f[1],f[2]]))}else if(0==d.NodeType){var h=d.Part.replace("_TempNode",""),i=I.getNodeforNodeName(a,h);i&&I.addTempNode(a,i,d)}}}}function n(a,b){if(!(b.length<=0)){var c=0;for(c=0;c<b.length;c++){b[c];I.applyNodeTransform(a,b[c])}}}function o(a,b){if(!(b.length<=0)){var c=0;for(c=0;c<b.length;c++){var d=b[c];I.setViewPartData(a,d.Name,d)}}}function p(a,b){var c={},d=CAXViewer.BGMode.PLAIN,e=a.Mode;if("0"==e)d=CAXViewer.BGMode.PLAIN,c.plainColor=G.rgbToHex(parseInt(255*a.Color[0]),parseInt(255*a.Color[1]),parseInt(255*a.Color[2])),D.setBackground(d,c);else if("1"==e)d=CAXViewer.BGMode.GRADIENT,c.gradientcolor1=G.rgbToHex(parseInt(255*a.TopColor[0]),parseInt(255*a.TopColor[1]),parseInt(255*a.TopColor[2])),c.gradientcolor2=G.rgbToHex(parseInt(255*a.BottomColor[0]),parseInt(255*a.BottomColor[1]),parseInt(255*a.BottomColor[2])),D.setBackground(d,c);else if("2"==e){var f=CAXViewer.textureMode.Center;if(d=CAXViewer.BGMode.TEXTURE,"0"==a.TextureMode&&(f=CAXViewer.textureMode.Center),"1"==a.TextureMode&&(f=CAXViewer.textureMode.Stretch),"2"==a.TextureMode&&(f=CAXViewer.textureMode.Tile),c.TextureMode=f,E){var g={Operation:CAXViewer.serverOperations.getFileImage,Data:a.TexturePath};E.send(JSON.stringify(g),function(a){if(a.byteLength>10){var b=new Uint8Array(a),e=new Blob([b],{type:"image/png"}),f=window.URL||window.webkitURL,g=f.createObjectURL(e);c.bgTexture=g,D.setBackground(d,c)}})}if(0==D.getUseStreaming()){var h=K.getViewPointBGImage(b);if(h.byteLength>10){var i=new Uint8Array(h),j=new Blob([i],{type:"image/png"}),k=window.URL||window.webkitURL,l=k.createObjectURL(j);c.bgTexture=l,D.setBackground(d,c)}}}}function q(a,b,c){for(var d=0;d<a.length;d++){var e={};e.message=a[d].Message,void 0!=a[d].isVisible&&null!=a[d].isVisible&&(e.isVisible=a[d].isVisible);var f={};f.Point3D=a[d].AttachedPosition,f.PointIndex=a[d].PositionIndex,f.partName=a[d].PartName,f.partkey=a[d].Key,f.modelName=a[d].ModelName;var g=a[d].LabelPosition,h=D.getNewLabel();h.customData.labelPosition=g,h.customData.LabelUndeformedPosition=a[d].LabelUndeformedPosition,h.customData.LabeldeformedPosition=a[d].LabeldeformedPosition,h.customData.LabelRealResult=a[d].LabelRealResult,h.customData.LabelImaginaryResult=a[d].LabelImaginaryResult,1==a[d].bIsMultiPartTable&&(h.customData.bIsMultiPartTable=!0,h.customData.multiPartTableInfo=a[d].multiPartTableInfo),h.ID=a[d].ID,h.create(e,"3DLABEL",f),h.version=c;var i=D.getlabelContainer();h.addTo(i),h.setisSnapVertex(!0);var j=D.getLabelManager();
h.setLabelSubType(j.subTypeFor3DLabel[2]),j.labelArray.push(h)}}function r(a,b,c,d,e){var f=0;for(f=0;f<a.length;f++){var g={};g.message=a[f].Message,void 0!=a[f].isVisible&&null!=a[f].isVisible&&(g.isVisible=a[f].isVisible);var h={};h.Point3D=a[f].AttachedPosition,h.PointIndex=a[f].PositionIndex,h.partName=a[f].PartName,h.partkey=a[f].Key,h.modelName=a[f].ModelName;var i=a[f].LabelPosition,j=D.getNewLabel();j.customData.labelPosition=i,j.customData.LabelUndeformedPosition=a[f].LabelUndeformedPosition,j.customData.LabeldeformedPosition=a[f].LabeldeformedPosition,j.customData.LabelRealResult=a[f].LabelRealResult,j.customData.LabelImaginaryResult=a[f].LabelImaginaryResult,j.ID=a[f].ID,j.create(g,"3DLABEL",h),j.version=e;var k=D.getlabelContainer();j.addTo(k),j.setisSnapVertex(!0);var l=D.getLabelManager();j.setLabelSubType(l.subTypeFor3DLabel[2]),l.labelArray.push(j);var m=a[f].PlotData,n=m.xmax,o=m.xmin,p=m.ymax,q=m.ymin,r=m.xPrecision,s=m.yPrecision,t=(parseInt(m.xmajorUnits),parseInt(m.ymajorUnits),parseInt(m.iXGrids)),u=parseInt(m.iYGrids),v={datasets:[{label:"My First dataset",fillColor:"rgba(0,0,255,0.2)",strokeColor:"rgba(0,0,255,1)",pointHighlightFill:"#5C26FF",pointHighlightStroke:"rgba(38,255,255,1)",markerShape:"square",pointDotRadius:2,pointColor:"rgba(0,0,255,1)",pointStrokeWidth:1,pointStrokeColor:"#000000",data:m.curveDataArray[0].y,xPos:m.curveDataArray[0].x}]};v.labels=[];var w=1;t>10&&(w=t<=20?2:t<=50?5:t<=100?10:20);for(var x=(n-o)/w,y=0;y<x+1;y++){var z=o+y*w;v.labels.push(Number(z).toFixed(r))}var A=CAXViewer.ChartJSOptionsCustom2;A.scaleOverride=!0;var B=p-q;A.scaleSteps=Number(u),A.scaleStepWidth=Number(B/u),A.scaleStartValue=parseFloat(q),A.graphMax=Number(p),A.graphMin=Number(q),A.scaleLabel="<%=(value.toFixed("+s+")).toString()%>",A.scaleGridLineWidth=1,A.scaleLineWidth=1,A.scaleGridLineColor="black",A.scaleLineColor="black",A.showYAxisMin=!0;var C="xyPlot_"+a[f].ID;if(null!=c&&null!=c){var E=D.get3DCanvas(),F=E.width,G=E.height,H=document.getElementById(C);H.width=H.width/c*F,H.height=H.height/d*G}var I=document.getElementById(C).getContext("2d"),J=new Chart(I).Line(v,A);j.customData.chartObject=J}}function s(a,b,c,d){if(null!=a&&void 0!=a&&!(a.length<=0))for(var e=D.get3DCanvas(),f=0;f<a.length;f++){var g={};1==a[f].IsRelative&&(a[f].Position[0]=a[f].Position[0]/b*e.width,a[f].Position[1]=a[f].Position[1]/c*e.height),g.message=G.decode_utf8(a[f].Text),g.position=[a[f].Position[0],a[f].Position[1]],a[f].Font&&(g.fontFace=a[f].Font),void 0!=a[f].isVisible&&null!=a[f].isVisible&&(g.isVisible=a[f].isVisible),a[f].FontSize&&(g.fontSize=a[f].FontSize),a[f].Color&&(g.fontColor=G.rgbToHex(parseInt(255*a[f].Color[0]),parseInt(255*a[f].Color[1]),parseInt(255*a[f].Color[2]))),1==a[f].BgVisible?g.isBGVisible=a[f].BgVisible:g.isBGVisible=!1,1==a[f].BorderVisible?g.isBorderVisible=a[f].BorderVisible:g.isBorderVisible=!1,a[f].BgColor&&(g.backgroundColor=G.rgbToHex(parseInt(255*a[f].BgColor[0]),parseInt(255*a[f].BgColor[1]),parseInt(255*a[f].BgColor[2]))),a[f].BorderColor&&(g.borderColor=G.rgbToHex(parseInt(255*a[f].BorderColor[0]),parseInt(255*a[f].BorderColor[1]),parseInt(255*a[f].BorderColor[2])));var h=D.getNewLabel();h.ID=a[f].ID,h.create(g,"2DLABEL"),h.version=d;var i=D.getlabelContainer();h.addTo(i),h.setisSnapVertex(!1),h.setIsRelativePosition(a[f].IsRelative),h.setRelativePosition(G.getRelativePosition(a[f].Position[0],a[f].Position[1],e)),L.labelArray.push(h);var j=h.getRelativePosition(),k=j[0],l=j[1],m=G.getAbsolutePosition(k,l,e);h.changePosition([m[0],m[1]])}}function t(a,b,c,d){if(!(a.length<=0))for(var e=(D.get3DCanvas(),0);e<a.length;e++){var f={};f.message=G.decode_utf8(a[e].Text),a[e].Font&&(f.fontFace=a[e].Font),a[e].FontSize&&(f.fontSize=a[e].FontSize),a[e].Color&&(f.fontColor=G.rgbToHex(parseInt(255*a[e].Color[0]),parseInt(255*a[e].Color[1]),parseInt(255*a[e].Color[2]))),void 0!=a[e].isVisible&&null!=a[e].isVisible&&(f.isVisible=a[e].isVisible),a[e].BgColor&&(f.backgroundColor=G.rgbToHex(parseInt(255*a[e].BgColor[0]),parseInt(255*a[e].BgColor[1]),parseInt(255*a[e].BgColor[2]))),a[e].BorderColor&&(f.borderColor=G.rgbToHex(parseInt(255*a[e].BorderColor[0]),parseInt(255*a[e].BorderColor[1]),parseInt(255*a[e].BorderColor[2])));var g={};g.Point3D=a[e].AttachedPosition,g.PointIndex=a[e].PositionIndex,g.partName=a[e].PartName,g.partkey=a[e].Key,g.modelName=a[e].ModelName;var h=a[e].LabelPosition,i=D.getNewLabel();i.customData.labelPosition=h,i.customData.LabelUndeformedPosition=a[e].LabelUndeformedPosition,i.customData.LabeldeformedPosition=a[e].LabeldeformedPosition,i.customData.LabelRealResult=a[e].LabelRealResult,i.customData.LabelImaginaryResult=a[e].LabelImaginaryResult,i.ID=a[e].ID,i.create(f,"3DLABEL",g),i.version=d;var j=D.getlabelContainer();i.addTo(j),null!=a[e].PositionIndex&&"undefined"!=a[e].PositionIndex?i.setisSnapVertex(!0):i.setisSnapVertex(!1),null!=a[e].LabelUndeformedPosition&&void 0!=a[e].LabelUndeformedPosition||i.setisSnapVertex(!0);var k=D.getLabelManager();"MINMAX"==c?i.setLabelSubType(k.subTypeFor3DLabel[1]):i.setLabelSubType(k.subTypeFor3DLabel[0]),k.labelArray.push(i)}}function u(a,b,c,d){if(!(a.length<=0))for(var e=(D.get3DCanvas(),0);e<a.length;e++){var f={};f.message=G.decode_utf8(a[e].Text),a[e].Font&&(f.fontFace=a[e].Font),a[e].FontSize&&(f.fontSize=a[e].FontSize),a[e].Color&&(f.fontColor=G.rgbToHex(parseInt(255*a[e].Color[0]),parseInt(255*a[e].Color[1]),parseInt(255*a[e].Color[2]))),void 0!=a[e].isVisible&&null!=a[e].isVisible&&(f.isVisible=a[e].isVisible),a[e].BgColor&&(f.backgroundColor=G.rgbToHex(parseInt(255*a[e].BgColor[0]),parseInt(255*a[e].BgColor[1]),parseInt(255*a[e].BgColor[2]))),a[e].BorderColor&&(f.borderColor=G.rgbToHex(parseInt(255*a[e].BorderColor[0]),parseInt(255*a[e].BorderColor[1]),parseInt(255*a[e].BorderColor[2])));var g={};g.Point3D=a[e].AttachedPosition;var h=a[e].LabelPosition,i=D.getNewLabel();i.customData.labelPosition=h,i.ID=a[e].ID,i.create(f,"3DLABEL",g),i.version=d;var j=D.getlabelContainer();i.addTo(j),i.setisSnapVertex(!1);var k=D.getLabelManager();"DISTANCE"==c?(i.customData["DISTANCE-Points"]=a[e].Points,i.setLabelSubType(k.subTypeFor3DLabel[3])):"ARC"==c?(i.customData["ARC-ArcPoints"]=a[e].ArcPoints,i.customData["ARC-ArcCenter"]=a[e].ArcCenter,i.customData["ARC-Points"]=a[e].Points,i.setLabelSubType(k.subTypeFor3DLabel[4])):"EDGE"==c?(i.customData["EDGE-Points"]=a[e].Points,i.setLabelSubType(k.subTypeFor3DLabel[5])):"FACE"==c&&(i.customData["FACE-Points"]=a[e].Points,i.setLabelSubType(k.subTypeFor3DLabel[6])),k.labelArray.push(i)}}function v(a,b,c){if(!(a.length<=0)){var d=0,e=0;for(d=0;d<a.length;d++){var f=a[d].curveDataArray,g={};for(g.labels=[],g.datasets=[],e=0;e<f.length;e++){if(e<10)var h=G.rgbToHex(CAXViewer.XYPlotColor[e][0],CAXViewer.XYPlotColor[e][1],CAXViewer.XYPlotColor[e][2]);else var h="rgb("+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+")";var i={fillColor:h,strokeColor:h,pointColor:h,pointStrokeColor:"#000000",pointHighlightFill:"#5C26FF",pointHighlightStroke:"rgba(38,255,255,1)",markerShape:"square",pointDotRadius:2,pointDotStrokeWidth:0,label:a[d].curveNameArray[e],title:a[d].curveNameArray[e],datasetStrokeStyle:"solid",data:f[e].y,xPos:f[e].x};g.datasets.push(i)}var j=a[d].xmax,k=a[d].xmin,l=a[d].xmajorUnits,m=a[d].xPrecision,n=a[d].yPrecision,o=(j-k)/l+1,p=0;for(p=0;p<o;p++){var q=k+p*l;(q>1e3||q<.001)&&0!=q||l<.01?g.labels.push(Number(q).toExponential(m)):g.labels.push(Number(q).toFixed(m))}for(e=0;e<g.datasets.length;e++){for(var r=[],s=0;s<g.datasets[e].xPos.length;s++){var q=g.datasets[e].xPos[s];(q>1e3||q<.001)&&0!=q||l<.01?r.push(Number(q).toExponential(m)):r.push(Number(q).toFixed(m))}g.datasets[e].xPos=r}var t={};if(null!=b&&null!=c){var u=D.get3DCanvas(),v=u.width,w=u.height;t.height=a[d].Dimension[3]/c*w,t.width=a[d].Dimension[2]/b*v,a[d].Dimension[0]=a[d].Dimension[0]/b*v,a[d].Dimension[1]=a[d].Dimension[1]/c*w,t.position=[a[d].Dimension[0],a[d].Dimension[1]]}else t.height=a[d].Dimension[3],t.width=a[d].Dimension[2],t.position=[a[d].Dimension[0],a[d].Dimension[1]];var x=D.getXYPlot();x.create(t);var y=D.getlabelContainer();x.addTo(y);var z=CAXViewer.ChartJSOptionsCustom1;if(a[d].BGColor&&a[d].BGColor.length>=3){var A=parseInt(255*a[d].BGColor[0]),B=parseInt(255*a[d].BGColor[1]),C=parseInt(255*a[d].BGColor[2]);z.canvasBackgroundColor="rgba("+A+","+B+","+C+",1.0)"}z.graphTitle=a[d].titleArray[0],z.xAxisLabel=a[d].titleArray[1],z.yAxisLabel=a[d].titleArray[2],z.scaleOverride=!0;for(var E=Number(a[d].ymin),F=0;E<Number(a[d].ymax);)E+=Number(a[d].ymajorUnits),F+=1;z.scaleSteps=F,z.scaleStepWidth=Number(a[d].ymajorUnits),z.scaleStartValue=Number(a[d].ymin),z.graphMax=Number(a[d].ymax),a[d].ymajorUnits>1e3||a[d].ymajorUnits<.001?z.scaleLabel="<%=(value.toExponential("+n+")).toString()%>":z.scaleLabel="<%=(value.toFixed("+n+")).toString()%>",x.setLineChartDataSet(g),x.setChartJSOptions(z),x.initXYPLot();var v=(D.get3DCanvas(),u.width),w=u.height;x.setIsRelativePosition(!0),x.setRelativePosition(G.getRelativePositionv2(a[d].Dimension[0],a[d].Dimension[1],v,w)),x.setRelativeSize(G.getRelativePositionv2(t.width,t.height,v,w)),N.XYPlotArray.push(x)}}}function w(a){var b="No Animation";switch(a){case 0:b="Linear";break;case 1:b="Transient";break;case 2:break;case 3:b="Eigen Vector";break;case 5:b="Eigen Vector Complex"}return b}function x(a,b,c){if(c&&(I.setScaleFactor(a,c.ScaleFactor,!1),null!=c.fNormalizeFactor&&void 0!=c.fNormalizeFactor&&c.fNormalizeFactor>0&&I.setNormalizeFactor(c.fNormalizeFactor,a),null!=c.fComplexAngle&&void 0!=c.fComplexAngle&&I.setComplexAngle(c.fComplexAngle,a)),c&&b){var d=b.iAnimationType;if(I.setFrameDelay(b.iDelaymsecs,a),void 0!==b.bHarmonic&&I.setAnimationHarmonic(a,b.bHarmonic),void 0!==b.bSwing&&I.setAnimationSwing(a,b.bSwing),I.setAnimationReversePlay(a,!1),P){var e=parseFloat(c.ScaleFactor[0]);P.updateCAEAnimation(b.bAnimation,b.iDelaymsecs,e,w(d))}}if(c&&1==b.bAnimation&&(I.setViewPointResultName(a,c.ResultName),I.setViewPointInstanceName(a,c.InstanceName),I.setViewPointDerivedName(a,c.DerivedName)),b)switch(d){case 0:I.setAnimationType(a,CAXViewer.CAEAnimationType.LINEAR),I.setFrames(a,b.iLinearAnimationNoOfFrames),1==b.bAnimation&&D.startAnimation(a);break;case 1:I.setAnimationType(a,CAXViewer.CAEAnimationType.TRANSIENT),I.setFrames(a,b.iLinearAnimationNoOfFrames),1==b.bAnimation&&D.startAnimation(a);break;case 2:CAXViewer.log("Result Animation is not supported"),I.setAnimationType(a,CAXViewer.CAEAnimationType.LINEAR),I.setFrames(a,b.iLinearAnimationNoOfFrames),1==b.bAnimation&&D.startAnimation(a);break;case 3:I.setAnimationType(a,CAXViewer.CAEAnimationType.EIGEN_VECTOR),I.setFrames(a,b.iEigenAnimationNoOfFrames),1==b.bAnimation&&D.startAnimation(a);break;case 5:if(I.setAnimationType(a,CAXViewer.CAEAnimationType.EIGEN_VECTOR_COMPLEX),I.setFrames(a,b.iEigenAnimationNoOfFrames),1==b.bAnimation){var f=!0,g=b.DeformResultName;g==I.getDeformResultName(a)?f=!1:(I.setDeformResultName(a,g),f=!0),I.setIsDeformResultNameChanged(a,f),D.startAnimation(a)}}}function y(a,b){var c=I.getModelByName(a);if(null==c||void 0==c)return void CAXViewer.log("Invalid Model");if(c.symbolPlotManager?c.symbolPlotManager.clearAll():c.symbolPlotManager=new CAXViewer.symbolPlotManager(D),b){c.symbolPlotManager.iVersion=b.iVersion,c.symbolPlotManager.sCurPlotName=b.sCurPlotName;for(var d=0;d<b.SymbolPlotArray.length;d++){var e=b.SymbolPlotArray[d],f=new CAXViewer.symbolPlot(D);f.iVersion=e.iVersion,f.SymbolPlotName=e.SymbolPlotName,f.bDraw=e.bDraw,f.iSymbolVectorType=e.iSymbolVectorType,f.iShapeType=e.iShapeType,f.iViewMode=e.iViewMode,f.sResult=e.sResult,f.sDerived=e.sDerived,f.sInstance=e.sInstance,f.sComplexComp=e.sComplexComp,f.fComplexAngle=e.fComplexAngle,f.fLengthSF=e.fLengthSF,f.fWidthSF=e.fWidthSF,f.colorArray=e.colorArray,f.SymbolPlotNodeStateArray=[];for(var g=0;g<e.SymbolPlotNodeStateArray.length;g++)for(var h=e.SymbolPlotNodeStateArray[g],i=h.SymbolPlotNodeName,j=0;j<h.SymbolPlotNodeState.length;j++){var k=h.SymbolPlotNodeState[j],l=new CAXViewer.SymbolPlotNodeState;l.SymbolPlotNodeStateGrpName=i,l.DirVector=k.DirVector,k.vertexNormal&&(l.vertexNormal=k.vertexNormal),l.UndeformedPosition=k.UndeformedPosition,k.deformedPosition?l.deformedPosition=k.deformedPosition:l.deformedPosition=k.UndeformedPosition,k.RealResult&&(l.RealResult=k.RealResult),k.ImaginaryResult&&(l.ImaginaryResult=k.ImaginaryResult),l.sPartName=k.sPartName,l.iVersion=k.iVersion,l.sModelName=k.sModelName,l.iSymbolPlotDrawType=k.iSymbolDrawType,f.SymbolPlotNodeStateArray.push(l)}f.createBuffers(),c.symbolPlotManager.symbolPlotArray.push(f)}}}function z(a){var b=setTimeout(function(){return 0!=D.isModelLoaded()?void(null!=a&&(clearTimeout(b),A(),a())):void z(a)},500);ea.push(b)}function A(){for(var a=ea.length-1;a>=0;a--)clearTimeout(ea[a])}function B(){P&&P.updateFileName(aa);var a=D.getViewPathList();if(a){for(var b=0;b<a.length;b++)if(a[b]){var c=D.getViewPointList(null,a[b]);if(c.length>0&&c[0]){var d=a[0].Name,e=c[0].Name,f=c[0].key;D.getViewPointData(function(a){},d,e,f),P&&(P.updateViewPointSelection(),P.setSelectedViewPathKey(a[b].key),P.setSelectedViewPointKey(c[0].key));break}}}else D.enableCAEAnimationIcon(!1);c&&c.length>1?(null==O&&(O=D.getBottomCtrl()),O&&(O.disableEnableLeft(!1),O.disableEnableRight(!0))):(null==O&&(O=D.getBottomCtrl()),O&&(O.disableEnableLeft(!1),O.disableEnableRight(!1))),null!=a&&void 0!=a&&void 0!=c||(O&&(O.showLeftArrow(!1),O.showRightArrow(!1)),D.enableVPIcon(!1))}function C(a){return null!==a&&void 0!==a&&""!==a}var D=this;CAXViewer.DEBUG=!1;var E=null,F=null,G=null,H=null,I=null,J=null,K=null,L=null,M=null,N=null,O=null,P=null;this.IsURLGUIQStringExists=!1;var Q={topPos:null,leftPos:null,width:null,height:null},R=null,S=null,T=null;this.getCanvasBGMode=function(){return S},this.getBGData=function(){return T};var U=null,V=null;this.getviewPathObject=function(){return V};var W=null;this.getviewPointObject=function(){return W};var X=!0;this.getUseStreaming=function(){return X};var Y=null;this.sentMenuObject=function(a){Y=a};var Z=null;this.setVPCtrl=function(a){Z=a},this.showVPFullControl=function(a){Z&&Z.showFullControl(a)},this.isVPFullCtrlVisible=function(){if(Z)return Z.isFullCtrlVisible()},this.previousViewPoint=function(){var a=null,b=null;if(U){for(var c=D.getViewPathList(),d=0;d<c.length;d++)if(U.viewPathName==c[d].Name){var e={};e.itemName=c[d].Name,e.key=c[d].key;for(var f=D.getViewPointList(null,e),g=0;g<f.length;g++)if(f[g].key==U.viewPointKey){if(g>0){var h=f[g-1];D.getViewPointData(null,U.viewPathName,h.Name,h.key),a=c[d].key,b=f[g-1].key,g-1>0?O.disableEnableLeft(!0):O.disableEnableLeft(!1),O.disableEnableRight(!0)}break}if(null!=a)break}a&&b&&P&&(P.setSelectedViewPathKey(a),P.setSelectedViewPointKey(b))}},this.nextViewPoint=function(){var a=null,b=null;if(U){for(var c=D.getViewPathList(),d=0;d<c.length;d++)if(U.viewPathName==c[d].Name){var e={};e.itemName=c[d].Name,e.key=c[d].key;for(var f=D.getViewPointList(null,e),g=0;g<f.length;g++)if(f[g].key==U.viewPointKey){if(g<f.length-1){var h=f[g+1];D.getViewPointData(null,U.viewPathName,h.Name,h.key),a=c[d].key,b=f[g+1].key,g+1<f.length-1?O.disableEnableRight(!0):O.disableEnableRight(!1),O.disableEnableLeft(!0)}break}if(null!=a)break}a&&b&&P&&(P.setSelectedViewPathKey(a),P.setSelectedViewPointKey(b))}},this.loadSpecificViewPoint=function(a,b){var c=null,d=null,e=D.getViewPathList();if(e){for(var f=0;f<e.length;f++)if(a==e[f].key){var g={};g.itemName=e[f].Name,g.key=e[f].key;for(var h=D.getViewPointList(null,g),i=0;i<h.length;i++)if(h[i].key==b){var j=h[i];D.getViewPointData(null,g,j.Name,j.key),c=e[f].key,d=h[i].key,i<h.length-1?O.disableEnableRight(!0):O.disableEnableRight(!1),i>0?O.disableEnableLeft(!0):O.disableEnableLeft(!1);break}if(null!=c)break}c&&d&&P&&(P.setSelectedViewPathKey(c),P.setSelectedViewPointKey(d))}};var _="Loading Model...";this.getTitleName=function(){return _},this.setTitleName=function(a){_=a,null!=Y&&Y.SetModelName(a)};var aa="NoName";this.getContainer=function(){return R},this.getWebSocket=function(){return E},this.getCompression=function(){return F},this.getUtility=function(){return G},this.getWebgl=function(){return H},this.getModelManager=function(){return I},this.getLoader=function(){return J},this.getMCAXloader=function(){return K},this.getLabelManager=function(){return L},this.getNewLabel=function(){var a=new CAXViewer.Label(D);return a},this.getXYPlot=function(){var a=new CAXViewer.XYPlot(D);return a},this.getSectionManager=function(){return M},this.getXYPlotManager=function(){return N},this.getBottomCtrl=function(){return O},this.get3DCanvas=function(){return G.getElementInsideContainer(R.id,"cvs3DRenderer")},this.get2DCanvas=function(){return G.getElementInsideContainer(R.id,"cvs2DRenderer")},this.getlabelContainer=function(){return G.getElementInsideContainer(R.id,"divLabelRenderer")},this.getspanStatus=function(){if(G)return G.getElementInsideContainer(R.id,"spanStatus")},this.updateStatus=function(a){var b=D.getspanStatus();b&&(b.innerHTML=a)},this.clearStatus=function(){var a=D.getspanStatus();a&&(a.innerHTML="")};var ba=CAXViewer.mouseOpertaionList.DEFAULT_TOOL;this.setMouseOperation=function(a){ba=a},this.getMouseOperation=function(){return ba},this.isModelLoaded=function(){return!!(I&&I.getModelCount()>0)},this.init=function(c){if(G=new CAXViewer.UtilityFunctions(D),F=new CAXViewer.CompressionFunctions,R=null,!c)return void CAXViewer.error("Invalid Parameter");if(X=void 0!=c.useStreaming&&c.useStreaming,R=c.container,""==R||null==R||void 0==R)return void CAXViewer.error("container is Invalid");var e=G.getElementInsideContainer(R.id,"cvs3DRenderer");e&&R.removeChild(e),e=document.createElement("canvas"),e.id="cvs3DRenderer",e.className="cvs3DRenderer",R.appendChild(e);var g=G.getElementInsideContainer(R.id,"cvs2DRenderer");g&&R.removeChild(g),g=document.createElement("canvas"),g.id="cvs2DRenderer",g.className="cvs2DRenderer",R.appendChild(g);var i=G.getElementInsideContainer(R.id,"divLabelRenderer");i&&R.removeChild(i),i=document.createElement("div"),i.id="divLabelRenderer",i.className="divLabelRenderer",R.appendChild(i);var j=G.getElementInsideContainer(R.id,"spanStatus");if(j&&R.removeChild(j),j=document.createElement("span"),j.id="spanStatus",j.className="spanStatus",R.appendChild(j),c.gui?(P=new CAXViewer.GUI,P.init(D),b()):(e.style.top="0px",g.style.top="0px",i.style.top="0px",CAXViewer.ViewerTopOffset=0),L=new CAXViewer.LableManager(D),I=new CAXViewer.ModelManager(D),H=new CAXViewer.WEBGL(R,D),M=new CAXViewer.SectionManager(D),N=new CAXViewer.XYPlotManager(D),O=new CAXViewer.bottomCtrl(D),O.init(),0==X&&(K=new CAXViewer.MCAXLoader(D)),R&&(R.oncontextmenu=function(a){return a.preventDefault(),!1}),document.addEventListener("fullscreenChange",d),document.addEventListener("webkitfullscreenchange",d),document.addEventListener("mozfullscreenchange",d),document.addEventListener("MSFullscreenChange",d),document.addEventListener("fullscreenError",h),document.addEventListener("webkitfullscreenError",h),document.addEventListener("mozfullscreenError",h),document.addEventListener("MSfullscreenError",h),R.addEventListener("mousedown",D.onMouseDownEvent),R.addEventListener("touchstart",D.onTouchStartEvent),G.isInsideIframe()&&f())try{var k=parent.document.getElementById(window.name);if(k){var l=parent.document.documentElement,m=$(k).height()/l.clientHeight;Q.width=$(k).width(),Q.height=m,Q.topPos=$(k).offset().top,Q.leftPos=$(k).offset().left}}catch(a){CAXViewer.error("FullScreen is not supported")}addResizeListener(R,a),jconfirm.defaults={title:CAXViewer.AppName,useBootstrap:!1,theme:"light",container:R,boxWidth:"30%",containerFluid:!0},z(B)},this.refreshViewer=function(){a()},this.loadFile=function(a,b){null!=a&&void 0!=a&&(aa=a.name,b&&(aa=b),0==X&&K.loadFile(a))},this.loadURL=function(a,b){null!=a&&void 0!=a&&(aa=a.substring(a.lastIndexOf("/")+1,a.length),b&&(aa=b),0==X&&K.loadURL(a))},this.loadBufferData=function(a,b){null!=a&&void 0!=a&&(b&&(aa=b),K.loadBufferData(a))},this.setNWJSEnvironment=function(){CAXViewer.NWJSEnvironment=!0},this.loadAllParts=function(a){I.loadAllParts(a)},this.loadSelectedParts=function(){I.loadSelectedParts()},this.unloadAllParts=function(){I.unLoadAllParts()},this.unLoadSelectedParts=function(){I.unLoadSelectedParts()},this.deleteModel=function(a){I.deleteModel(a)},this.setTexture=function(a,b){I.setTexture(a,b)},this.setReverseTexture=function(a,b){I.setReverseTexture(a)},this.setLegendVisibility=function(a,b){H.setLegendVisibility(a,b)},this.toggleLegendVisibility=function(){H.toggleLegendVisibility()},this.setFullScreenMode=function(a){var b=R;a?b.requestFullscreen?b.requestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullscreen?b.webkitRequestFullscreen():b.msRequestFullscreen&&b.msRequestFullscreen():document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),e()},this.iphoneViewerMaximized=!1,this.setDisplayMode=function(a,b){"shaded"==a?I.setDisplayMode(CAXViewer.displayModes.shaded):"shadedMesh"==a?I.setDisplayMode(CAXViewer.displayModes.shadedMesh):"wire"==a?I.setDisplayMode(CAXViewer.displayModes.wire):"hiddenLine"==a?I.setDisplayMode(CAXViewer.displayModes.hiddenLine):"point"==a?I.setDisplayMode(CAXViewer.displayModes.point):"transparent"==a&&I.setDisplayMode(CAXViewer.displayModes.transparent)},this.getAllPartNames=function(a){var b=[];return b=I.getAllPartNames(a)},this.setPartVisible=function(a,b,c){I.setPartVisible(a,b,c)},this.performSelection=function(a,b){H.performSelection(a,b)},this.isLocalTransformRequired=function(a){return 0},this.setDeformation=function(a,b){var c=!0;I.setDeformation(a,b,c)},this.setBackground=function(a,b){S=a,T=b;var c=D.get3DCanvas();S==CAXViewer.BGMode.PLAIN?c.style.background=T.plainColor:S==CAXViewer.BGMode.GRADIENT?c.style.background="linear-gradient("+T.gradientcolor1+", "+T.gradientcolor2+")":S==CAXViewer.BGMode.TEXTURE&&(c.style.background="url("+T.bgTexture+")",T.TextureMode==CAXViewer.textureMode.Tile?c.style.backgroundRepeat="repeat":T.TextureMode==CAXViewer.textureMode.Center?(c.style.backgroundRepeat="no-repeat",c.style.backgroundPosition="center"):T.TextureMode==CAXViewer.textureMode.Stretch&&(c.style.backgroundSize="100% 100%"))},this.saveAsImage=function(a,b){var c=null,d=null;null!=b&&"undefined"!=b||(b="Image.png"),d=b,"png"==a?c="image/png":"jpg"==a||"jpeg"==a?c="image/jpeg":"bmp"==a?c="image/bmp":(CAXViewer.warn(a+" is not supported in this browser."),c="image/png",d=b.split(".")[0]+".png");var e=D.get3DCanvas(),f=D.get2DCanvas(),g=($("#"+e.id).css("background-color"),e.width),h=e.height,i=document.createElement("canvas");i.id="MergedCanvas",i.width=g,i.height=h;var j=i.getContext("2d");if(null!=S){if(S==CAXViewer.BGMode.PLAIN)j.fillStyle=T.plainColor,j.rect(0,0,g,h),j.fill();else if(S==CAXViewer.BGMode.GRADIENT){var k=j.createLinearGradient(0,0,0,h);k.addColorStop(0,T.gradientcolor1),k.addColorStop(1,T.gradientcolor2),j.fillStyle=k,j.rect(0,0,g,h),j.fill()}else if(S==CAXViewer.BGMode.TEXTURE){j.fillStyle="#FFFFFF",j.rect(0,0,g,h),j.fill();var l=document.createElement("img");if(l.src=T.bgTexture,T.TextureMode==CAXViewer.textureMode.Tile){var m=j.createPattern(l,"repeat");j.fillStyle=m,j.fillRect(0,0,g,h)}else T.TextureMode==CAXViewer.textureMode.Center?j.drawImage(l,g/2-l.width/2,h/2-l.height/2):T.TextureMode==CAXViewer.textureMode.Stretch&&j.drawImage(l,0,0,l.width,l.height,0,0,g,h)}}else j.fillStyle="#FFFFFF",j.rect(0,0,g,h),j.fill();j.drawImage(e,0,0,e.width,e.height,0,0,g,h),j.drawImage(f,0,0,f.width,f.height,0,0,g,h);var n=D.getlabelContainer();html2canvas(n).then(function(a){j.drawImage(a,0,0,a.width,a.height,0,0,g,h);var b=i.toDataURL(c,1),e=null;"image/bmp"==c&&(e=ca.toBlob(i),b=URL.createObjectURL(e)),1==CAXViewer.NWJSEnvironment&&fs?G.saveToDiskNWJS(b,d,c):G.saveToDisk(b,d,c,e),i=null})};var ca={toArrayBuffer:function(a){function b(a){q.setUint16(r,a,!0),r+=2}function c(a){q.setUint32(r,a,!0),r+=4}var d,e,f,g,h=a.width,i=a.height,j=4*h,k=a.getContext("2d").getImageData(0,0,h,i),l=new Uint32Array(k.data.buffer),m=4*Math.floor((32*h+31)/32),n=m*i,o=122+n,p=new ArrayBuffer(o),q=new DataView(p),r=0,s=0,t=0;for(b(19778),c(o),r+=4,c(122),c(108),c(h),c(-i>>>0),b(1),b(32),c(3),c(n),c(2835),c(2835),r+=8,c(16711680),c(65280),c(255),c(4278190080),c(1466527264);s<i;){for(e=122+s*m,d=0;d<j;)g=l[t++],f=g>>>24,q.setUint32(e+d,g<<8|f),d+=4;s++}return p},toBlob:function(a){return new Blob([this.toArrayBuffer(a)],{type:"image/bmp"})},toDataURL:function(a){for(var b=new Uint8Array(this.toArrayBuffer(a)),c="",d=0,e=b.length;d<e;)c+=String.fromCharCode(b[d++]);return"data:image/bmp;base64,"+btoa(c)}};this.getTreeData=function(){return I.getTreeData()},this.addLabel=function(a){D.setMouseOperation(CAXViewer.mouseOpertaionList.LABELADD_TOOL);jQuery.extend(!0,{},a)},this.setUndeformedMesh=function(a,b){1==a?I.enableUnDeformedMesh(b):I.disableUnDeformedMesh(b)},this.getCAEResultList=function(a){if(E){var b={Operation:CAXViewer.serverOperations.getCAEResultList,Data:""};E.send(JSON.stringify(b),function(b){var c=G.convertArrayBuffertoString(b),d=JSON&&JSON.parse(c)||$.parseJSON(c);a(d)})}},this.getCAEInstanceList=function(a,b,c){if(E){var d={Operation:CAXViewer.serverOperations.getCAEInstanceList,Data:b};E.send(JSON.stringify(d),function(a){var b=G.convertArrayBuffertoString(a),d=JSON&&JSON.parse(b)||$.parseJSON(b);c(d)})}if(0==D.getUseStreaming()){var e=K.getCAEInstanceList(a);if("Error"!=e&&""!=e)try{var f=JSON&&JSON.parse(e)||$.parseJSON(e);c(f)}catch(a){CAXViewer.log(a),CAXViewer.error("Error in CAE Instance List Json Message")}else{var f=[];c(f)}}},this.getCAEDerivedResultList=function(a,b){if(E){var c={Operation:CAXViewer.serverOperations.getCAEDerivedResultList,Data:a};E.send(JSON.stringify(c),function(a){var c=G.convertArrayBuffertoString(a),d=JSON&&JSON.parse(c)||$.parseJSON(c);b(d)})}},this.getCAEInstanceandDerivedList=function(a,b){if(E){var c={Operation:CAXViewer.serverOperations.getCAEInstanceandDerivedList,Data:a};E.send(JSON.stringify(c),function(a){var c=G.convertArrayBuffertoString(a),d=JSON&&JSON.parse(c)||$.parseJSON(c);b(d)})}},this.getCAEResult=function(a,b,c,d){var e={};if(e.Results=a,e.Instance=b,e.DerivedResults=c,E){var f={Operation:CAXViewer.serverOperations.getCAEResult,Data:JSON.stringify(e)};E.send(JSON.stringify(f),function(a){var b=G.convertArrayBuffertoString(a),c=JSON&&JSON.parse(b)||$.parseJSON(b);d(c)})}},this.applyCAEResult=function(a){model.updateCAEResult(a)},this.getandApplyCAEResult=function(a,b,c){var d={};if(d.Results=a,d.Instance=b,d.DerivedResults=c,E){var e={Operation:CAXViewer.serverOperations.getCAEResult,Data:JSON.stringify(d)};E.send(JSON.stringify(e),function(a){var b=G.convertArrayBuffertoString(a),c=JSON&&JSON.parse(b)||$.parseJSON(b);D.applyCAEResult(c)})}},this.setCAEResult=function(a,b,c){model.setCAEResult(a,b,c)},this.HasViewPointAnimation=function(a,b){for(i=0;i<V.length;i++)if(V[i].Name==a)for(j=0;j<V[i].ViewPoint.length;j++)if(V[i].ViewPoint[j].Name==b&&1==V[i].ViewPoint[j].IsCAEAnimationON)return!0;return!1},this.getViewPathList=function(a){if(E){var b={Operation:CAXViewer.serverOperations.getViewPathList,Data:""};E.send(JSON.stringify(b),function(b){var c=G.convertArrayBuffertoString(b);try{V=JSON&&JSON.parse(c)||$.parseJSON(c),CAXViewer.log(V),a(V)}catch(a){CAXViewer.log(a),CAXViewer.error("Error in View Path List Json Message")}})}if(0==D.getUseStreaming()){var c=K.getViewPathList();c=G.decode_utf8(c),c=c.replace("\\","\\\\");try{if(V=JSON&&JSON.parse(c)||$.parseJSON(c),!a)return V;a(V)}catch(a){CAXViewer.log(a),CAXViewer.error("Error in View Path List Json Message")}}},this.getViewPointList=function(a,b){if(null==b||""==b)return void CAXViewer.error("Invalid view Path");if(null==V||0==V.length)return void CAXViewer.error("Call getViewPathList before calling this function");if(E){var c={Operation:CAXViewer.serverOperations.getViewPointList,Data:JSON.stringify(b)};E.send(JSON.stringify(c),function(c){var d=G.convertArrayBuffertoString(c);if(d==CAXViewer.serverMessage.Error)return CAXViewer.log(d),void CAXViewer.error("Error in View Point List Json Message");try{var e=JSON&&JSON.parse(d)||$.parseJSON(d);b.ViewPoint=e,a(e)}catch(a){CAXViewer.log(a),CAXViewer.error("Error in View Point List Json Message")}})}if(0==D.getUseStreaming()){var d=K.getViewPointList(b);if(d=G.decode_utf8(d),d=d.replace("\\","\\\\"),d==CAXViewer.serverMessage.Error)return CAXViewer.log(json),void CAXViewer.error("Error in View Point List Json Message");try{if(W=JSON&&JSON.parse(d)||$.parseJSON(d),b.ViewPoint=W,!a)return W;a(W)}catch(a){CAXViewer.log(a),CAXViewer.error("Error in View Path List Json Message")}}},this.getViewPointImage=function(a,b,c,d){if(null!=c&&"undefined"!=c||(c=800),null!=d&&"undefined"!=d||(d=600),null==b.key||""==b.key)return void CAXViewer.error("Invalid view Point");var e={};if(e.Name=b.Name||"",e.key=b.key,e.imgWidth=c,e.imgHeight=d,E){var f={Operation:CAXViewer.serverOperations.getViewPointImage,Data:JSON.stringify(e)};E.send(JSON.stringify(f),function(b){try{if(b.byteLength>10){var c=new Uint8Array(b),d=new Blob([c],{type:"image/png"}),e=window.URL||window.webkitURL,f=e.createObjectURL(d);a(f)}else CAXViewer.error("Error in getting image Data")}catch(a){CAXViewer.log(a),CAXViewer.error("Error in getting image Data")}})}if(0==D.getUseStreaming()){var g=K.getViewPointImage(e);if(null==g)return null;try{if(g.byteLength>10){var h=new Uint8Array(g),i=new Blob([h],{type:"image/png"}),j=window.URL||window.webkitURL,k=j.createObjectURL(i);if(!a)return k;a(k)}else CAXViewer.error("Error in getting image Data")}catch(a){CAXViewer.log(a),CAXViewer.error("Error in getting image Data")}}},this.getViewPointData=function(a,b,c,d,e,f){var g=D.get3DCanvas();if(null!=e&&"undefined"!=e||(e=g.width),null!=f&&"undefined"!=f||(f=g.height),null==b||""==b)return void CAXViewer.error("Invalid view Path Name");if(null==c||""==c)return void CAXViewer.error("Invalid view Point Name");if(null==d||""==d)return void CAXViewer.error("Invalid view Point Key");var h={};if(h.viewPathName=b,h.viewpointName=c,h.viewPointKey=d,h.Width=e,h.Height=f,E){var i={Operation:CAXViewer.serverOperations.getViewPointData,Data:JSON.stringify(h)};D.updateStatus("Downloading viewpoint data");E.send(JSON.stringify(i),function(a){k(a,h)})}if(0==D.getUseStreaming()){var j=K.getViewPointData(h);k(j,h)}},this.startAnimation=function(a){I.startAnimation(a)},this.stopAnimation=function(a){I.stopAnimation(a)},this.pauseAnimation=function(a){I.pauseAnimation(a)},this.forwardAnimation=function(a){I.forwardAnimation(a)},this.backwardAnimation=function(a){I.backwardAnimation(a)},this.setFrameDelay=function(a,b){I.setFrameDelay(a,b)},this.toggleAnimation=function(){var a=I.getIsAnimationON();a?I.stopAnimation():I.startAnimation()},this.isAnimationOn=function(){return I.getIsAnimationON()},this.isAnimationPaused=function(){return I.getIsAnimationPaused()},this.getCAEInstanceImageArray=function(){return model.getCAEInstanceImageArray()},this.setScaleFactor=function(a,b){var c=!0;a instanceof Array?I.setScaleFactor(b,a,c):I.setScaleFactor(b,[a,a,a],c)},this.updateCAEAnimationType=function(a){P&&null!=a&&P.updateCAEAnimationType(w(a))};var da=[];this.setSyncObjectArray=function(a){da=a},this.zoomIn=function(a){H.zoomIn(a);for(var b=0;b<da.length;b++)da[b].zoomIn(a)},this.pointZoomIn=function(a,b,c){H.pointZoomIn(a,b,c)},this.zoomOut=function(a){H.zoomOut(a);for(var b=0;b<da.length;b++)da[b].zoomOut(a)},this.pointZoomOut=function(a,b,c){H.pointZoomOut(a,b,c)},this.zoomByValue=function(a){H.zoomByValue(a)},this.setMinimumZoomLevel=function(a){H.setMinimumZoomLevel(a)},this.setMaximumZoomLevel=function(a){H.setMaximumZoomLevel(a)},this.setZoomSensitivity=function(a){H.setZoomSensitivity(a)},this.resetZoom=function(){H.resetZoom()},this.resetZoomFactor=function(){
H.resetZoomFactor();for(var a=0;a<da.length;a++)da[a].resetZoomFactor()},this.pan=function(a,b,c){c||(c=0),H.pan(a,b,c)},this.panByValue=function(a,b,c){c||(c=0),H.panByValue(a,b,c)},this.resetPan=function(a){a||(a=0),H.resetPan(a)},this.setPanSensitivity=function(a){H.setPanSensitivity(a)},this.mouseRotation=function(a,b,c,d,e){e||(e=0);var f=H.getRotationAngleAndNormalizedCameraCoordAxis(a,b,c,d);f.angle&&f.axis_in_camera_coord&&H.mouseRotate(f.angle,f.axis_in_camera_coord,e);for(var g=0;g<da.length;g++){var h=da[g].getWebgl(),i=h.getRotationAngleAndNormalizedCameraCoordAxis(a,b,c,d);i.angle&&i.axis_in_camera_coord&&h.mouseRotate(i.angle,i.axis_in_camera_coord,e)}},this.mousePanRotation=function(a,b,c,d,e){H.mousePanRotate(a,b,c,d,e);for(var f=0;f<da.length;f++){var g=da[f].getWebgl();g.mousePanRotate(a,b,c,d,e)}},this.rotate=function(a,b,c){c||(c=0),H.rotate(a,b,c)},this.setRotationSensitivity=function(a){H.setRotationSensitivity(a)},this.resetRotation=function(a){a||(a=0),H.resetRotation(a)},this.resetSupplementalTransformations=function(a){I.resetSupplementalTransformations(a)},this.resetView=function(){H.resetView(),D.resetSupplementalTransformations()},this.fitView=function(){H.fitView()},this.resetViewPoint=function(){null==U?D.resetView():D.getViewPointData(null,U.viewPathName,U.viewpointName,U.viewPointKey),H.resetZoomFactor()},this.refreshMenuIcon=function(){null!=Y&&Y.refreshAnimationIcon()},this.enableAnimationIcon=function(){null!=Y&&Y.enableAnimationIcon()},this.disableAnimationIcon=function(){null!=Y&&Y.disableAnimationIcon()},this.changeAnimationIcon=function(a){null!=Y&&Y.changeAnimationIcon(a)},this.getSection1State=function(){return M.getSection1State()},this.getSection2State=function(){return M.getSection2State()},this.deleteOBJ=function(){removeResizeListener(R,function(){}),H.stopAnimationLoop(),H.clear(),H.deleteAllLegend(),I.freeAllModel(),K&&K.clear(),P&&P.clear();var a=G.getElementInsideContainer(R.id,"cvs3DRenderer");a&&R.removeChild(a);var b=G.getElementInsideContainer(R.id,"cvs2DRenderer");b&&R.removeChild(b);var c=G.getElementInsideContainer(R.id,"divLabelRenderer");c&&R.removeChild(c);var e=G.getElementInsideContainer(R.id,"spanStatus");e&&R.removeChild(e);var f=G.getElementInsideContainer(R.id,"divBottomCtrl");f&&R.removeChild(f),G&&G.clear(),E=null,F=null,G=null,H=null,J=null,K=null,L=null,M=null,N=null,O&&(O.clear(),O=null),document.removeEventListener("fullscreenChange",d),document.removeEventListener("webkitfullscreenchange",d),document.removeEventListener("mozfullscreenchange",d),document.removeEventListener("MSFullscreenChange",d)},this.enableDebug=function(){CAXViewer.DEBUG=!0},this.disableDebug=function(){CAXViewer.DEBUG=!1},this.getAllModelNames=function(){return I.getAllModelNames()},this.getIsRendering=function(){return I.getIsRendering()},this.getModelOriginalCenter=function(){return I.getModelOriginalCenter()};var ea=[];this.enableCAEAnimationIcon=function(a){P&&P.updateCAEAnimationIcon(a)},this.enableFrameInfoIcon=function(a){P&&P.updateFrameInfoIcon(a)},this.DisableLegendIcon=function(a){P&&P.UpdateLegendIcon(a)},this.enableVPIcon=function(a){P&&P.updateVPIcon(a)},this.updateLegendSelectionIcon=function(a){P&&P.updateLegendSelectionIcon(a)},this.disableBottomCtrl=function(){null==O&&(O=D.getBottomCtrl()),O&&(O.disableEnableLeft(!1),O.disableEnableRight(!1))},this.onMouseDownEvent=function(a){P&&P.onMouseDownEvent(a)},this.onTouchStartEvent=function(a){P&&P.onMouseDownEvent(a)},this.setZoomType=function(a){H.setZoomType(a)},this.getFileVersion=function(){return K?K.getFileVersion():0},this.updateShaderProgram=function(){var a=H.getLightShader_v3();M&&M.setShader(a)},this.showAllLabels=function(){L&&L.showAllLabels()},this.hideAllLabels=function(){L&&L.hideAllLabels()},this.invertVisibility=function(){L&&L.invertVisibility()},this.getFrameInfoStrings=function(){var a="",b=I.getFrameInfo(null);a+="<div id='divFrameContainer' class='divFrameContainer'>";for(var c=0;c<b.length;c++){var d=b[c];a=a+"<font size='2'> "+d.modelName+" </font><br/>",a+="<div style='border: 1px rgba(255, 255, 255, 0.30) solid'>";var e=d.textArray;if(e.length>0){a+=e[e.length-1];for(var f=e.length-2;f>=0;f--)a=a+"<br/>"+e[f]}a+="</div>"}return a+="</div>"},this.getModels=function(){return I.getModels()},this.hideFileOpenBar=function(a){P&&P.hideFileOpenBar(a)},this.hideGUI=function(){P&&(P.clear(),P=null,CAXViewer.ViewerTopOffset=0,b(),c())},this.showGUI=function(){null==P&&void 0==P&&(P=new CAXViewer.GUI,P.init(D),CAXViewer.ViewerTopOffset=CAXViewer.TopOffset,b(),c())},this.updateGUI=function(a){a&&(C(a.showFileOpen)&&(0!=a.showFileOpen?D.hideFileOpenBar(!1):D.hideFileOpenBar(!0)),C(a.showGUI)&&0==D.IsURLGUIQStringExists&&(0!=a.showGUI?D.showGUI():D.hideGUI()),C(a.filterMenuIcons)&&C(a.menuIcons)&&a.filterMenuIcons===!0&&"object"==typeof a.menuIcons&&P&&P.updateGUIIcon(a.menuIcons))}};CAXViewer.AppName="VCollabWeb",CAXViewer.VERSION="2017 R1 Version 1.1.117.1225",CAXViewer.lessGUI=!1,CAXViewer.DEBUG=!1,CAXViewer.DevOps=!1,CAXViewer.NWJSEnvironment=!1,CAXViewer.pastVersionLink="",CAXViewer.showUpdateMsgDays=0,CAXViewer.changeLogFile="",CAXViewer.releaseNotesFile="",CAXViewer.thirdPartyLibrariesLink="",CAXViewer.TopOffset=40,CAXViewer.ViewerTopOffset=CAXViewer.TopOffset,"undefined"!=CAXViewer.filePath&&null!=CAXViewer.filePath||(CAXViewer.filePath=""),CAXViewer.SVGfilePath=CAXViewer.filePath+"svgs/",CAXViewer.selectedShadow={Soft_Shadows:["Soft Shadows",0],Hard_Shadows:["Hard Shadows",1],Shadows_Off:["Shadows Off",2]},CAXViewer.BGMode={PLAIN:"PLAIN",GRADIENT:"GRADIENT",TEXTURE:"TEXTURE"},CAXViewer.textureMode={Tile:"Tile",Center:"Center",Stretch:"Stretch"},CAXViewer.displayModes={shaded:0,shadedMesh:1,wire:2,point:3,hiddenLine:4,transparent:5},CAXViewer.mouseOpertaionList={SELECT_TOOL:"SELECT TOOL",MOVE_TOOL:"MOVE TOOL",DEFAULT_TOOL:"DEFAULT TOOL",LABELADD_TOOL:"LABELADD TOOL",LABELMOVE_TOOL:"LABELMOVE TOOL",LABELHIDE_TOOL:"LABELHIDE TOOL",LABELDELETE_TOOL:"LABELDELETE TOOL"},CAXViewer.serverOperations={loadModel:"loadModel",loadModelFromURL:"loadModelFromURL",getTree:"getTree",getPart:"getPart",getCAEDeformMesh:"getCAEDeformMesh",getCAEResultList:"getCAEResultList",getCAEInstanceList:"getCAEInstanceList",getCAEDerivedResultList:"getCAEDerivedResultList",getCAEInstanceandDerivedList:"getCAEInstanceandDerivedList",getCAEResult:"getCAEResult",getViewPathList:"getViewPathList",getViewPointList:"getViewPointList",getViewPointImage:"getViewPointImage",getViewPointData:"getViewPointData",getFileImage:"getFileImage",getVerticesAsUShort:"getVerticesAsUShort",getNormalAsByte:"getNormalAsByte",getTextureAsByte:"getTextureAsByte",getMeshIndex:"getMeshIndex",getPolygonWireFrameIndex:"getPolygonWireFrameIndex",getUndeformMeshVerticesAsUShort:"getUndeformMeshVerticesAsUShort",getUndeformMeshIndex:"getUndeformMeshIndex",setCAEDeformMesh:"setCAEDeformMesh",getTempBoundingBoxMinMax:"getTempBoundingBoxMinMax",setCAEResult:"setCAEResult",getCAEInfo:"getCAEInfo",getRealResult:"getRealResult",getImaginaryResult:"getImaginaryResult",getMetaResult:"getMetaResult",clearResultMap:"clearResultMap",updateNormal:"updateNormal",getAnimationCAEInfo:"getAnimationCAEInfo",getImage:"getImage",getAnimationLabels:"getAnimationLabels"},CAXViewer.serverMessage={LoadError:"Error in loading",LoadSuccess:"Load OK",Error:"Error",LicError:"License not available"},CAXViewer.dependencyFiles=[{filename:"depJs/pako.js",filetype:"js",load:!1},{filename:"depJs/glMatrix-0.9.5.min.js",filetype:"js",load:!1}],CAXViewer.ChartJSOptionsAll={scaleOverlay:!0,scaleOverride:!1,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:!0,scaleLabel:"<%=value%>",scaleFontFamily:"'Arial'",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,bezierCurve:!1,pointDot:!0,pointDotRadius:3,pointDotStrokeWidth:1,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,animation:!1,animationSteps:60,animationEasing:"easeOutQuart",onAnimationComplete:null,canvasBorders:!0,canvasBordersWidth:3,canvasBordersColor:"black",yAxisLeft:!0,yAxisRight:!1,yAxisLabel:"Y axis",yAxisFontFamily:"'Arial'",yAxisFontSize:14,yAxisFontStyle:"bold",yAxisFontColor:"#666",xAxisLabel:"X axis",xAxisFontFamily:"'Arial'",xAxisFontSize:14,xAxisFontStyle:"bold",xAxisFontColor:"#666",yAxisUnit:"cm",yAxisUnitFontFamily:"'Arial'",yAxisUnitFontSize:12,yAxisUnitFontStyle:"bold",yAxisUnitFontColor:"#666",graphTitle:"Graph Name",graphTitleFontFamily:"'Arial'",graphTitleFontSize:18,graphTitleFontStyle:"bold",graphTitleFontColor:"#666",graphSubTitle:"Graph Sub Name",graphSubTitleFontFamily:"'Arial'",graphSubTitleFontSize:14,graphSubTitleFontStyle:"normal",graphSubTitleFontColor:"#666",footNote:"This is a footer text",footNoteFontFamily:"'Arial'",footNoteFontSize:12,footNoteFontStyle:"normal",footNoteFontColor:"#666",legend:!0,legendFontFamily:"'Arial'",legendFontSize:12,legendFontStyle:"bold",legendFontColor:"#666",legendBlockSize:10,legendBorders:!0,legendBordersWidth:1,legendBordersColor:"#666",graphMin:"DEFAULT",graphMax:"DEFAULT",inGraphDataShow:!1,annotateDisplay:!1,animationByDataset:!0,responsive:!0,responsiveMaxHeight:600,responsiveMaxWidth:800,maintainAspectRatio:!0,crossText:["VCollab"],crossTextAngle:[-45],crossTextFontSize:[50],crossTextPosX:[0],savePng:!0,savePngBackgroundColor:"white",xAxisSpaceOver:0,xAxisSpaceUnder:0,xAxisLabelSpaceAfter:0,xAxisLabelSpaceBefore:0},CAXViewer.ChartJSOptionsCustom1={inGraphDataShow:!1,datasetFill:!1,maintainAspectRatio:!1,yAxisMinimumInterval:2.4,graphMin:"DEFAULT",graphMax:"DEFAULT",scaleXGridLinesStep:1,scaleYGridLinesStep:1,canvasBackgroundColor:"rgba(1,0,0,0.0)",graphMaximized:!0,scaleLineColor:"rgba(0,0,0,1)",scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,0.5)",scaleGridLineWidth:1,scaleLabel:"<%=value%>",scaleTickSizeRight:3,scaleTickSizeLeft:3,scaleTickSizeBottom:3,scaleTickSizeTop:3,scaleFontSize:10,canvasBorders:!0,canvasBordersWidth:1,canvasBordersColor:"black",graphTitle:"Graph Title",graphTitleFontFamily:"'Arial'",graphTitleFontSize:10,graphTitleFontStyle:"bold",graphTitleFontColor:"#666",graphSubTitle:"",graphSubTitleFontFamily:"'Arial'",graphSubTitleFontSize:10,graphSubTitleFontStyle:"normal",graphSubTitleFontColor:"#666",footNote:"",footNoteFontFamily:"'Arial'",footNoteFontSize:8,footNoteFontStyle:"bold",footNoteFontColor:"#666",legend:!0,legendFontFamily:"'Arial'",legendFontSize:10,legendFontStyle:"normal",legendFontColor:"#666",legendBlockSize:10,legendBorders:!0,legendBordersWidth:1,legendBordersColors:"#666",legendPosX:4,legendPosY:1,legendYPadding:0,maxLegendCols:1,showSingleValue:!0,yAxisLeft:!0,yAxisRight:!1,xAxisBottom:!0,xAxisTop:!1,yAxisLabel:"Y Axis Label",yAxisFontFamily:"'Arial'",yAxisFontSize:10,yAxisFontStyle:"normal",yAxisFontColor:"#666",xAxisLabel:"pX Axis Label",xAxisFontFamily:"'Arial'",xAxisFontSize:10,xAxisFontStyle:"normal",xAxisFontColor:"#666",yAxisUnit:"",yAxisUnitFontFamily:"'Arial'",yAxisUnitFontSize:8,yAxisUnitFontStyle:"normal",yAxisUnitFontColor:"#666",spaceTop:0,spaceBottom:0,spaceLeft:0,spaceRight:0,annotateDisplay:!0,annotateLabel:"<%=v1%> <br> x: <%=v2%> <br> y: <%=v3%>",annotateFontSize:8,annotateFunction:"mousemove",annotateRelocate:!0,logarithmic:!1,rotateLabels:"smart",xAxisSpaceOver:0,xAxisSpaceUnder:0,xAxisLabelSpaceAfter:0,xAxisLabelSpaceBefore:0,legendBordersSpaceBefore:0,legendBordersSpaceAfter:0,footNoteSpaceBefore:0,footNoteSpaceAfter:0,startAngle:0,dynamicDisplay:!1,animation:!1,bezierCurve:!1},CAXViewer.ChartJSOptionsCustom2={inGraphDataShow:!1,datasetFill:!1,maintainAspectRatio:!1,scaleLabel:"<%=value%>",scaleTickSizeRight:5,scaleTickSizeLeft:5,scaleTickSizeBottom:5,scaleTickSizeTop:1,scaleFontSize:10,canvasBorders:!1,canvasBordersWidth:1,canvasBordersColor:"black",legend:!1,legendFontFamily:"'Arial'",legendFontSize:12,legendFontStyle:"normal",legendFontColor:"#666",legendBlockSize:15,legendBorders:!0,legendBordersWidth:1,legendBordersColors:"#666",yAxisLeft:!0,yAxisRight:!1,xAxisBottom:!0,xAxisTop:!1,annotateLabel:"x: <%=v2%> \n y: <%=v3%>",annotateFontSize:10,annotateFunction:"mousemove",spaceTop:0,spaceBottom:0,spaceLeft:0,spaceRight:0,logarithmic:!1,showYAxisMin:!0,rotateLabels:"smart",xAxisSpaceOver:0,xAxisSpaceUnder:0,xAxisLabelSpaceAfter:0,xAxisLabelSpaceBefore:0,legendBordersSpaceBefore:0,legendBordersSpaceAfter:0,footNoteSpaceBefore:0,footNoteSpaceAfter:0,startAngle:0,dynamicDisplay:!0,animation:!1,scaleGridLineColor:"rgba(0,0,0,0.7)",bezierCurve:!1},CAXViewer.XYPlotColor=[[0,0,255],[255,0,0],[0,255,0],[0,255,255],[255,255,0],[255,0,255],[0,0,128],[128,128,0],[128,0,0],[0,128,0]],CAXViewer.ClipEdgeColor=[[1,1,0],[0,1,1],[1,0,1],[1,0,0],[0,1,0],[0,0,1],[.7,.7,0],[0,.7,.7],[.7,0,.7],[.7,0,0]],CAXViewer.legendLeft={startPosition:[.9,.12],width:2.5,height:70,precisionValue:3,textAlign:"Left",segmentHeight:4,visible:!0,scientifeNumericFormat:!1,fontSizeIndex:1,fontSize:10,fontName:"Open Sans",fontColor:"#000000",colorArray:[],discreteMode:!1,rangeMax:0,rangeMin:0,textArray:[],isBGColorVisible:!1,BGColor:"#FFFFFF",isNoResultColorVisible:!1,NoResultColor:[1,1,1],isDynamicRangeEnabled:!1,DynamicRangeArray:[],bDistinctLegend:!1,bDistinctResult:!1,sUnit:"",DistinctRangeArray:[]},CAXViewer.legendRight={startPosition:[.03,.12],width:2.5,height:70,precisionValue:3,textAlign:"Right",segmentHeight:4,visible:!0,scientifeNumericFormat:!1,fontSizeIndex:1,fontSize:10,fontName:"Open Sans",fontColor:"#000000",colorArray:[],discreteMode:!1,rangeMax:0,rangeMin:0,textArray:[],isBGColorVisible:!1,BGColor:"#FFFFFF",isNoResultColorVisible:!1,NoResultColor:[1,1,1],isDynamicRangeEnabled:!1,DynamicRangeArray:[],bDistinctLegend:!1,bDistinctResult:!1,sUnit:"",DistinctRangeArray:[]},CAXViewer.legendTop={startPosition:[.2,.12],width:90,height:2.5,precisionValue:3,textAlign:"Top",segmentWidth:4,visible:!0,scientifeNumericFormat:!1,fontSizeIndex:1,fontSize:10,fontName:"Open Sans",fontColor:"#000000",colorArray:[],discreteMode:!1,rangeMax:0,rangeMin:0,textArray:[],isBGColorVisible:!1,BGColor:"#FFFFFF",isNoResultColorVisible:!1,NoResultColor:[1,1,1],isDynamicRangeEnabled:!1,DynamicRangeArray:[],bDistinctLegend:!1,bDistinctResult:!1,sUnit:"",DistinctRangeArray:[]},CAXViewer.legendBottom={startPosition:[.2,.9],width:90,height:2.5,precisionValue:3,textAlign:"Bottom",segmentWidth:4,visible:!0,scientifeNumericFormat:!1,fontSizeIndex:1,fontSize:10,fontName:"Open Sans",fontColor:"#000000",colorArray:[],discreteMode:!1,rangeMax:0,rangeMin:0,textArray:[],isBGColorVisible:!1,BGColor:"#FFFFFF",isNoResultColorVisible:!1,NoResultColor:[1,1,1],isDynamicRangeEnabled:!1,DynamicRangeArray:[],bDistinctLegend:!1,bDistinctResult:!1,sUnit:"",DistinctRangeArray:[]},CAXViewer.CAEAnimationType={LINEAR:0,TRANSIENT:1,RESULTS:2,EIGEN_VECTOR:3,DATA_SET:4,EIGEN_VECTOR_COMPLEX:5},CAXViewer.iSymbolPlotVectorType={SYMBOL_VECTORS:0,SYMBOL_TENSORS:1,SYMBOL_SPC:2,SYMBOL_PRESSURE:3},CAXViewer.iSymbolPlotDrawType={ST_ARROW:0,ST_TENSILE_ARROW:1,ST_COMPRESSIVE_ARROW:2,ST_CONSTRAINT:3,ST_PRESSURE:4},CAXViewer.iSymbolPlotShapeType={SD_3D:0,SD_2D:1},CAXViewer.iSymbolPlotViewMode={VIEW_MODE_AUTO:0,VIEW_MODE_FROM_POINT:1,VIEW_MODE_TO_POINT:2,VIEW_MODE_RESULTANT:3},CAXViewer.iUndformedMeshMode={UNDEFORMED_WIREFRAME:0,UNDEFORMED_TRANSPARENT:1,UNDEFORMED_FEATUREEDGE:2,UNDEFORMED_TRANSPARENTEDGE:3},CAXViewer.log=function(){1==CAXViewer.DEBUG&&console.log.apply(console,arguments)},CAXViewer.warn=function(){1==CAXViewer.DEBUG&&console.warn.apply(console,arguments)},CAXViewer.error=function(){1==CAXViewer.DEBUG&&console.error.apply(console,arguments)},CAXViewer.CompressionFunctions=function(){this.decompression_Zlib=function(a){CAXViewer.log("---------------ZLIB Decompression---------------");var b=new Uint8Array(a),c=Date.now(),d=pako.inflate(b),e=Date.now();return CAXViewer.log("Size of data received is : "+a.byteLength),CAXViewer.log("Size of Original data (After Decompression) is : "+d.byteLength),CAXViewer.log("Decompression time is "+(e-c)+" ms"),a=null,CAXViewer.log("---------------ZLIB Decompression END---------------"),d.buffer},this.compression_Zlib=function(a){CAXViewer.log("---------------ZLIB Compression---------------");var b=new Uint8Array(a),c=Date.now(),d=pako.deflate(b),e=Date.now();return CAXViewer.log("Size of Original data is : "+a.byteLength),CAXViewer.log("Size of compression) data is : "+d.byteLength),CAXViewer.log("Compression time is "+(e-c)+" ms"),received_msg=null,CAXViewer.log("---------------ZLIB Compression END---------------"),d.buffer},this.Decompression_LZ4=function(a){CAXViewer.log("---------------LZ4 Decompression---------------");var b=(require("buffer").Buffer,require("lz4"));a instanceof ArrayBuffer&&(a=new Uint8Array(a));var c=a.slice(0,4),d=new DataView(c.buffer),e=d.getUint32(0,!0),f=a.slice(4,a.byteLength),g=new Uint8Array(f),h=new Uint8Array(e),i=Date.now(),j=b.decodeBlock(g,h),k=Date.now();return CAXViewer.log("Size of data received is : "+a.byteLength),CAXViewer.log("Size of Original data (After Decompression) is : "+j),CAXViewer.log("Decompression time is "+(k-i)+" ms"),a=null,CAXViewer.log("---------------LZ4 Decompression END---------------"),h.buffer}},CAXViewer.UtilityFunctions=function(a){function b(a){$.alert({title:CAXViewer.AppName,type:"dark",content:"Image Saved in "+a})}var c="",d=this,e=Date.now();this.setStartTimer=function(){e=Date.now()},this.getElapsedTime=function(){var a=Date.now();return a-e},this.logElapsedTime=function(){var a=Date.now();CAXViewer.log("Elapsed Time "+(a-e)+" ms")};var f=0,g=function(a,b){if("js"==b){var c=document.createElement("script");c.setAttribute("type","text/javascript"),c.setAttribute("src",a)}else if("css"==b){var c=document.createElement("link");c.setAttribute("rel","stylesheet"),c.setAttribute("type","text/css"),c.setAttribute("href",a)}"undefined"!=typeof c&&document.getElementsByTagName("head")[0].appendChild(c)};this.checkloadjscssfile=function(a,b){c.indexOf("["+a+"]")==-1?(g(a,b),c+="["+a+"]"):CAXViewer.log(a+" file already added!")},this.getElementInsideContainer=function(a,b){for(var c=null,d=document.getElementById(a).getElementsByTagName("*"),e=0;e<d.length;e++)if(d[e].id===b){c=d[e];break}return c},this.convertArrayBuffertoString=function(a){for(var b=new Uint8Array(a),c="",d=0;d<b.byteLength;d++)c+=String.fromCharCode(b[d]);return c},this.sleep=function(a){for(var b=(new Date).getTime(),c=0;c<1e7&&!((new Date).getTime()-b>a);c++);},this.degToRad=function(a){return.01745329251*a},this.getDataFromArray=function(a,b,c,d,e){for(var f=0;f<a.length;f++){var g=a[f];if(g[b]==c){if("undefined"==typeof d)return g;if(g[d]==e)return g}}return null},this.saveToDisk=function(a,b,c,d){var e=window.navigator.userAgent,f=e.indexOf("MSIE "),g=e.indexOf("Edge");if(c||(c="image/png"),f>0||g>0||"msExitFullscreen"in document)if(null==d){for(var h="data:"+c+";base64,",i=atob(a.substring(h.length)),j=new Uint8Array(i.length),k=0,l=i.length;k<l;++k)j[k]=i.charCodeAt(k);var m=new Blob([j.buffer],{type:c});window.navigator.msSaveBlob(m,b)}else window.navigator.msSaveBlob(d,b);else{var n=document.createElement("a");n.href=a,n.target="_blank",n.download=b||a;var o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(o),(window.URL||window.webkitURL).revokeObjectURL(n.href)}},this.saveToDiskNWJS=function(a,c,d){var e=$("<input>");e.attr("nwsaveas",c),e.attr("type","file"),e.on("change",function(){var c="data:"+d+";base64,",e=a.substring(c.length);fs?fs.writeFile(this.value,e,"base64",b(this.value)):CAXViewer.error("Invalid operation!")}),e.click()},this.rgbToHex=function(a,b,c){return"#"+((1<<24)+(a<<16)+(b<<8)+c).toString(16).slice(1)},this.rgbToHex2=function(a){var b=parseInt(255*a[0]),c=parseInt(255*a[1]),d=parseInt(255*a[2]);return"#"+((1<<24)+(b<<16)+(c<<8)+d).toString(16).slice(1)},this.hexToRgb=function(a){var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(b,function(a,b,c,d){return b+b+c+c+d+d});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return c?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null},this.getBrowser=function(){return navigator?navigator.userAgent.toLowerCase():"other"},this.isFullScreenEnable=function(){var b=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;if(null==b)return 1==a.iphoneViewerMaximized;var c=a.getContainer();return b.id==c.id},this.addVector=function(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2]]},this.subtractVector=function(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]},this.multiplyVector=function(a,b){return[b*a[0],b*a[1],b*a[2]]},this.divideVector=function(a,b){return 0!=b?[a[0]/b,a[1]/b,a[2]/b]:a},this.findPerpendicularVector=function(a){var b=0,c=[1,0,0],e=d.CrossProduct(a,c),f=d.DotProduct(e,e);if(f<b){var g=[0,1,0];e=d.CrossProduct(a,g)}return e=d.Normalize(e)},this.CrossProduct=function(a,b){var c=a[1]*b[2]-a[2]*b[1],d=a[2]*b[0]-a[0]*b[2],e=a[0]*b[1]-a[1]*b[0];return[c,d,e]},this.Normalize=function(a){var b=Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2));if(b>0){var c=a[0]/b,d=a[1]/b,e=a[2]/b;return[c,d,e]}return a},this.DotProduct=function(a,b){var c=a[0]*b[0]+a[1]*b[1]+a[2]*b[2];return c},this.findDistance=function(a,b){var c=Math.sqrt((a[0]-b[0])*(a[0]-b[0])+(a[1]-b[1])*(a[1]-b[1])+(a[2]-b[2])*(a[2]-b[2]));return c},this.findAngle=function(a,b){var c=d.DotProduct(a,b),e=Math.sqrt(d.DotProduct(a,a)),f=Math.sqrt(d.DotProduct(b,b)),g=Math.acos(c/(e*f));return g},this.unproject2=function(b,c){var d=a.get3DCanvas(),e=a.getWebgl(),f=mat4.create();c?mat4.multiply(e.getpMatrix(),c,f):mat4.multiply(e.getpMatrix(),e.getmvMatrix(),f);var g=[0,0,d.width,d.height],h=[];GLU.unProject(b[0],d.height-b[1],b[2],e.getmvMatrix(),e.getpMatrix(),g,h);return h},this.unproject=function(b,c){var d=a.get3DCanvas(),e=a.getWebgl(),f=[0,0,d.width,d.height],g=new Float32Array([0,0,0,0]),h=new Float32Array([0,0,0,0]),i=mat4.create();mat4.identity(i),b[1]=d.height-b[1],g[0]=(b[0]-f[0])/f[2],g[1]=(b[1]-f[1])/f[3],g[2]=b[2],g[0]=2*g[0]-1,g[1]=2*g[1]-1,g[2]=2*g[2]-1,g[3]=1;var j=e.getCameraMatrix2();return c?mat4.multiply(j,c,i):mat4.multiply(j,e.getmvMatrix1(),i),mat4.inverse(i)?(mat4.multiplyVec4(i,g,h),0==h[3]&&(h[3]=1e-24),h[0]=h[0]/h[3],h[1]=h[1]/h[3],h[2]=h[2]/h[3],[h[0],h[1],h[2]]):null},this.project=function(b,c){var d=a.get3DCanvas(),e=a.getWebgl(),f=new Float32Array([0,0,0,0]),g=new Float32Array([0,0,0,0]),h=mat4.create();mat4.identity(h);var i=[0,0,d.width,d.height];g[0]=b[0],g[1]=b[1],g[2]=b[2],g[3]=1;var j=e.getCameraMatrix2();return c?mat4.multiply(j,c,h):mat4.multiply(j,e.getmvMatrix1(),h),mat4.multiplyVec4(h,g,f),f[0]=f[0]/f[3],f[1]=f[1]/f[3],f[2]=f[2]/f[3],f[0]=(f[0]+1)/2,f[1]=(f[1]+1)/2,f[0]=Math.round(f[0]*i[2]+i[0]),f[1]=Math.round(d.height-(f[1]*i[3]+i[1])),[f[0],f[1],f[2]]},this.findNearestPointinTriangle=function(a,b,c,d,e,f){var g=[];g[0]=b[0]-a[0],g[1]=b[1]-a[1],g[2]=b[2]-a[2];var h=vec3.create(g),j=vec3.create();if(vec3.normalize(h,j),f){var k=model.getTransformMatrixForNode(f);k&&(mat4.multiplyVec4(k,c,c),mat4.multiplyVec4(k,d,d),mat4.multiplyVec4(k,e,e))}var l=[c,d,e],m=5,n=0,o=[],n=0;for(i=0;i<l.length;i++){var p=l[i],g=[];g[0]=p[0]-a[0],g[1]=p[1]-a[1],g[2]=p[2]-a[2];var h=vec3.create(g),q=vec3.create();vec3.normalize(h,q);var r=Math.sqrt(Math.pow(j[0]-q[0],2)+Math.pow(j[1]-q[1],2)+Math.pow(j[2]-q[2],2));r<m&&(m=r,n=i,o[0]=p[0],o[1]=p[1],o[2]=p[2],o[3]=1)}var s={};return s.point=o,s.index=n,s},this.intersectTriangle=function(a,b,c,d){var e=1e-6;if(IsDeformApplied)var f=c.geometry.Deform_point;else var f=c.geometry.point;var g=[a[0],a[1],a[2]],h=[b[0]-a[0],b[1]-a[1],b[2]-a[2]],j=model.getTransformMatrixForNode(c);if(j)for(i=0;i<f.length;i+=9){var k=[f[i],f[i+1],f[i+2],1],l=[f[i+3],f[i+4],f[i+5],1],m=[f[i+6],f[i+7],f[i+8],1],n=i;mat4.multiplyVec4(j,k,k),mat4.multiplyVec4(j,l,l),mat4.multiplyVec4(j,m,m);var o=subtractVector(l,k),p=subtractVector(m,k),q=CrossProduct(h,p),r=DotProduct(o,q);if(!(r<e)){var s=subtractVector(g,k),t=DotProduct(s,q);if(!(t<0||t>r)){var u=CrossProduct(s,o),v=DotProduct(h,u);if(!(v<0||t+v>r)){var w=[],x=DotProduct(p,u)/r;if(w[0]=g[0]+x*h[0],w[1]=g[1]+x*h[1],w[2]=g[2]+x*h[2],w[3]=1,d){if(!mat4.inverse(j))return null;mat4.multiplyVec4(j,w,w),mat4.multiplyVec4(j,k,k),mat4.multiplyVec4(j,l,l),mat4.multiplyVec4(j,m,m)}var y={};return y.point=w,y.pointIndex=n,y.triangle1=k,y.triangle2=l,y.triangle3=m,y}}}}},this.intersectTriangle2=function(a,b,c,d){var e=c.geometry.point,f=null,g=[a[0],a[1],a[2]],h=[b[0],b[1],b[2]],j=model.getTransformMatrixForNode(c);if(j)for(i=0;i<e.length;i+=9){var k=[e[i],e[i+1],e[i+2],1],l=[e[i+3],e[i+4],e[i+5],1],m=[e[i+6],e[i+7],e[i+8],1],n=i;mat4.multiplyVec4(j,k,k),mat4.multiplyVec4(j,l,l),mat4.multiplyVec4(j,m,m);var o=subtractVector(l,k),p=subtractVector(m,k),q=CrossProduct(o,p);q=Normalize(q);var r=subtractVector(g,k),s=DotProduct(r,q),t=subtractVector(h,k),u=DotProduct(t,q);if(!(s*u>=0)&&s!=u){var v,w=-s/(u-s),x=multiplyVector(subtractVector(h,g),w),y=addVector(g,x);if(v=CrossProduct(q,subtractVector(l,k)),!(DotProduct(v,subtractVector(y,k))<0||(v=CrossProduct(q,subtractVector(m,l)),DotProduct(v,subtractVector(y,l))<0||(v=CrossProduct(q,subtractVector(k,m)),DotProduct(v,subtractVector(y,k))<0)))){if(f=y,f[3]=1,d){if(!mat4.inverse(j))return null;mat4.multiplyVec4(j,f,f),mat4.multiplyVec4(j,k,k),mat4.multiplyVec4(j,l,l),mat4.multiplyVec4(j,m,m)}var z={};return z.point=f,z.pointIndex=n,z.triangle1=k,z.triangle2=l,z.triangle3=m,z}}}},this.CheckPlane=function(a,b,c){var d=c.geometry.point,e=[a[0],a[1],a[2]],f=[b[0],b[1],b[2]];for(i=0;i<d.length;i+=9){var g=[d[i],d[i+1],d[i+2]],h=[d[i+3],d[i+4],d[i+5]],j=[d[i+6],d[i+7],d[i+8]],k=subtractVector(h,g),l=subtractVector(j,g),m=CrossProduct(k,l);if(vRotRay1=[DotProduct(k,subtractVector(e,g)),DotProduct(l,subtractVector(e,g)),DotProduct(m,subtractVector(e,g))],vRotRay2=[DotProduct(k,subtractVector(f,g)),DotProduct(l,subtractVector(f,g)),DotProduct(m,subtractVector(f,g))],vRotRay1[2]!=vRotRay2[2]){var n=vRotRay1[2]/(vRotRay2[2]-vRotRay1[2]),o=multiplyVector(subtractVector(e,f),n),p=addVector(e,o);CAXViewer.log(p)}}},this.findNearestIntersectionPoint=function(a,b,c){var d=[];d[0]=b[0]-a[0],d[1]=b[1]-a[1],d[2]=b[2]-a[2];var e=vec3.create(d),f=vec3.create();vec3.normalize(e,f),CAXViewer.log("vClickSlope0 : "+f[0]),CAXViewer.log("vClickSlope1 : "+f[1]),CAXViewer.log("vClickSlope2 : "+f[2]);var g=c.geometry.point,h=5,j=0,k=[],l=model.getTransformMatrixForNode(c);if(l){for(i=0;i<g.length;i+=3){var m=[g[i],g[i+1],g[i+2],1],n=[0,0,0,0];mat4.multiplyVec4(l,m,n);var d=[];d[0]=n[i]-a[0],d[1]=n[i+1]-a[1],d[2]=n[i+2]-a[2];var e=vec3.create(d),o=vec3.create();vec3.normalize(e,o);var p=Math.sqrt(Math.pow(f[0]-o[0],2)+Math.pow(f[1]-o[1],2)+Math.pow(f[2]-o[2],2));p<h&&(h=p,j=i,k[0]=n[i],k[1]=n[i+1],k[2]=n[i+2])}return k}},this.getRelativePosition=function(a,b,c){var d=c.width,e=c.offsetHeight,f=a-c.style.left.replace("px",""),g=b-c.style.top.replace("px",""),h=f/d,i=g/e;return[h,i]},this.getAbsolutePosition=function(a,b,c){var d=c.width,e=c.offsetHeight,f=a*d,g=b*e,h=c.style.left.replace("px","")+f,i=c.style.top.replace("px","")+g;return[h,i]},this.getRelativePositionv2=function(b,c,d,e){var f=a.get3DCanvas(),g=b-f.style.left.replace("px",""),h=c-f.style.top.replace("px",""),i=g/d,j=h/e;return[i,j]},this.getAbsolutePositionv2=function(b,c,d,e){var f=a.get3DCanvas(),g=b*d,h=c*e,i=f.style.left.replace("px","")+g,j=f.style.top.replace("px","")+h;return[i,j]},this.encode_utf8=function(a){return unescape(encodeURIComponent(a))},this.decode_utf8=function(a){return decodeURIComponent(escape(a))},this.Utf8ArrayToStr=function(a){var b,c,d,e,f,g;for(b="",d=a.length,c=0;c<d;)switch(e=a[c++],e>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=String.fromCharCode(e);break;case 12:case 13:f=a[c++],b+=String.fromCharCode((31&e)<<6|63&f);break;case 14:f=a[c++],g=a[c++],b+=String.fromCharCode((15&e)<<12|(63&f)<<6|(63&g)<<0)}return b},this.findTransformMatrix=function(a,b,c){null!=a&&void 0!=a||(a=[0,0,0]),null!=b&&void 0!=b||(b=[0,0,0,1]),null!=c&&void 0!=c||(c=[1,1,1]);var d=mat4.create();mat4.identity(d),mat4.scale(d,c);var e=mat4.create();mat4.identity(e),mat4.rotate(e,b[3],[b[0],b[1],b[2]]);var f=mat4.create();mat4.identity(f),mat4.translate(f,[a[0],a[1],a[2]]);var g=mat4.create();return mat4.identity(g),mat4.multiply(g,f,g),mat4.multiply(g,e,g),mat4.multiply(g,d,g),g},this.getMatrixComponent=function(a){var b=[0,1,0],c=[1,0,0],d=[0,0,1],c=[a[0],a[1],a[2]],b=[a[4],a[5],a[6]],d=[a[8],a[9],a[10]],e={};return e.up=b,e.right=c,e.dir=d,e},this.getUpVector=function(a){return[a[4],a[5],a[6]]},this.getRightVector=function(a){return[a[0],a[1],a[2]]},this.getDirVector=function(a){return[a[8],a[9],a[10]]},this.getPositionVector=function(a){return[a[12],a[13],a[14]]},this.clone=function(a){var b;if(null==a||"object"!=typeof a)return a;if(a instanceof Date)return b=new Date,b.setTime(a.getTime()),b;if(a instanceof Array){b=[];for(var c=0,e=a.length;c<e;c++)b[c]=d.clone(a[c]);return b}if(a instanceof Object){b={};for(var f in a)a.hasOwnProperty(f)&&(b[f]=d.clone(a[f]));return b}throw new Error("Unable to copy obj! Its type isn't supported.")},this.encryptDecrypt=function(a){for(var b=["V","C","T","W","C","A","X"],c=[],d=0;d<a.length;d++){var e=a.charCodeAt(d)^b[d%b.length].charCodeAt(0);c.push(String.fromCharCode(e))}return c.join("")},this.is_touch_device=function(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0},this.extractDomain=function(a){var b;return b=a.indexOf("://")>-1?a.split("/")[2]:a.split("/")[0],b=b.split(":")[0]},this.clear=function(){f=0},this.isInsideIframe=function(){try{return window.self!==window.top}catch(a){return!0}},this.getColorFromIndex=function(){var a=16777216;f>=a&&(f=0);var b=[parseInt(f/256/256)%256,parseInt(f/256)%256,f%256];return f++,b}},CAXViewer.Shader=function(){function a(a,b){var d=Y(a,c.VERTEX_SHADER,"VERTEX"),e=Y(b,c.FRAGMENT_SHADER,"FRAGMENT");if(d==-1987||e==-1987)return CAXViewer.log("makeShader compilation error"),-1987;var f=c.createProgram();return c.attachShader(f,d),c.attachShader(f,e),c.linkProgram(f),f}function b(a){q=c.getUniformLocation(a,"pMatrixUniform"),r=c.getUniformLocation(a,"mvMatrixUniform"),s=c.getUniformLocation(a,"objectColor"),t=c.getUniformLocation(a,"vLightDir"),u=c.getUniformLocation(a,"mNormalMatrixUniform"),M=c.getUniformLocation(a,"mLightProjectionMatrix"),N=c.getUniformLocation(a,"mLightModelViewMatrix"),f=c.getAttribLocation(a,"color"),h=c.getAttribLocation(a,"position"),i=c.getAttribLocation(a,"normal"),g=c.getAttribLocation(a,"uv"),Q=c.getAttribLocation(a,"targetFrame"),R=c.getAttribLocation(a,"NormaltargetFrame"),S=c.getAttribLocation(a,"UVtargetFrame"),U=c.getAttribLocation(a,"realResult"),V=c.getAttribLocation(a,"imaginaryResult"),W=c.getUniformLocation(a,"scaleFactor"),w=c.getUniformLocation(a,"ambientColor"),x=c.getUniformLocation(a,"diffuseColor"),y=c.getUniformLocation(a,"specularColor"),z=c.getUniformLocation(a,"emissiveColor"),I=c.getUniformLocation(a,"shininess"),J=c.getUniformLocation(a,"transparency"),K=c.getUniformLocation(a,"ambientIntensity"),p=c.getUniformLocation(a,"shadowTexture"),L=c.getUniformLocation(a,"tex"),o=c.getUniformLocation(a,"pickColor"),v=c.getUniformLocation(a,"caeTexture"),j=c.getUniformLocation(a,"usetexture"),k=c.getUniformLocation(a,"uselighting"),l=c.getUniformLocation(a,"isSelected"),m=c.getUniformLocation(a,"usetransparency"),n=c.getUniformLocation(a,"usecolor"),A=c.getUniformLocation(a,"userColor"),B=c.getUniformLocation(a,"ClipPlane1"),C=c.getUniformLocation(a,"ClipPlane1_State"),D=c.getUniformLocation(a,"ClipPlane2"),E=c.getUniformLocation(a,"ClipPlane2_State"),F=c.getUniformLocation(a,"mInverseMVMatrix"),G=c.getUniformLocation(a,"sectionEdgeThickness"),H=c.getUniformLocation(a,"ClipEdgeColor"),O=c.getUniformLocation(a,"IsAnimationOn"),P=c.getUniformLocation(a,"frameFactor"),T=c.getUniformLocation(a,"UVminoffset"),
X=c.getUniformLocation(a,"transientPivotVector")}var c=null,d=null,e=null;this.program=null;var f=null,g=null,h=null,i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=null,q=null,r=null,s=null,t=null,u=null,v=null,w=null,x=null,y=null,z=null,A=null,B=null,C=null,D=null,E=null,F=null,G=null,H=null,I=null,J=null,K=null,L=null,M=null,N=null,O=null,P=null,Q=null,R=null,S=null,T=null,U=null,V=null,W=null,X=null,Y=function(a,b,d){var e=c.createShader(b);return c.shaderSource(e,a),c.compileShader(e),c.getShaderParameter(e,c.COMPILE_STATUS)?e:(CAXViewer.log(a,"ERROR IN "+d+" SHADER : "+c.getShaderInfoLog(e),a),-1987)};this.setUniformModelviewMatrix=function(a){r&&c.uniformMatrix4fv(r,!1,a)},this.setUniformProjectionMatrix=function(a){q&&c.uniformMatrix4fv(q,!1,a)},this.setUniformLightModelviewMatrix=function(a){N&&c.uniformMatrix4fv(N,!1,a)},this.setUniformLightProjectionMatrix=function(a){M&&c.uniformMatrix4fv(M,!1,a)},this.setUniformNormalMatrix=function(a){u&&c.uniformMatrix4fv(u,!1,a)},this.setPositionAttrib=function(a){h>=0&&c.vertexAttribPointer(h,3,c.FLOAT,!1,0,0)},this.setUVAttrib=function(){g>=0&&c.vertexAttribPointer(g,2,c.FLOAT,!1,0,0)},this.setNormalAttrib=function(a){i>=0&&c.vertexAttribPointer(i,3,c.FLOAT,!1,0,0)},this.setUseTexture=function(a){j&&c.uniform1f(j,a)},this.setUseTransparency=function(a){m&&c.uniform1f(m,a)},this.setUsecolor=function(a){n&&c.uniform1f(n,a)},this.setUseLighting=function(a){k&&c.uniform1f(k,a)},this.setIsSelected=function(a){l&&c.uniform1f(l,a)},this.setLightDir=function(a){t&&c.uniform3fv(t,a)},this.setDiffuseColor=function(a){x&&c.uniform3fv(x,a)},this.setAmbientColor=function(a){w&&c.uniform3fv(w,a)},this.setSpecularColor=function(a){y&&c.uniform3fv(y,a)},this.setEmissiveColor=function(a){z&&c.uniform3fv(z,a)},this.setUserColor=function(a){A&&c.uniform3fv(A,a)},this.setCaeTexture=function(a){v&&c.uniform1i(v,a)},this.setShininess=function(a){I&&c.uniform1f(I,a)},this.setTransparency=function(a){J&&c.uniform1f(J,a)},this.setPickColor=function(a){o&&c.uniform3fv(o,a)},this.setAmbientIntensity=function(a){K&&c.uniform1f(K,a)},this.setTexTexture=function(a){L=c.getUniformLocation(this.program,"tex"),c.uniform1i(L,a)},this.setShadowTexture=function(a){c.uniform1i(p,a)},this.enablePosition=function(){c.enableVertexAttribArray(h)},this.disablePosition=function(){c.disableVertexAttribArray(h)},this.enableNormal=function(){i>=0&&c.enableVertexAttribArray(i)},this.disableNormal=function(){i>=0&&c.disableVertexAttribArray(i)},this.enableUV=function(){g>=0&&c.enableVertexAttribArray(g)},this.disableUV=function(){g>=0&&c.disableVertexAttribArray(g)},this.setColor=function(){f>=0&&c.vertexAttribPointer(f,3,c.FLOAT,!1,0,0)},this.enableColor=function(){f>=0&&c.enableVertexAttribArray(f)},this.disableColor=function(){f>=0&&c.disableVertexAttribArray(f)},this.setclipPlane1=function(a){B&&c.uniform4fv(B,a)},this.set_clipPlane1_State=function(a){C&&c.uniform1i(C,a)},this.setclipPlane2=function(a){D&&c.uniform4fv(D,a)},this.set_clipPlane2_State=function(a){E&&c.uniform1i(E,a)},this.setInverseMVMatrix=function(a){F&&c.uniformMatrix4fv(F,!1,a)},this.setSectionEdgeThickness=function(a){G&&c.uniform1f(G,a)},this.setClipEdgeColor=function(a){H&&c.uniform3fv(H,a)},this.set_IsAnimationOn=function(a){O&&c.uniform1i(O,a)},this.set_frameFactor=function(a){P&&c.uniform1f(P,a)},this.set_UVminoffset=function(a){T&&c.uniform1f(T,a)},this.set_targetFrame=function(){Q>=0&&c.vertexAttribPointer(Q,3,c.FLOAT,!1,0,0)},this.enableTargetFrame=function(){Q>=0&&c.enableVertexAttribArray(Q)},this.disableTargetFrame=function(){Q>=0&&c.disableVertexAttribArray(Q)},this.set_NormaltargetFrame=function(){R>=0&&c.vertexAttribPointer(R,3,c.FLOAT,!1,0,0)},this.enableNormalTargetFrame=function(){R>=0&&c.enableVertexAttribArray(R)},this.disableNormalTargetFrame=function(){R>=0&&c.disableVertexAttribArray(R)},this.setUVtargetFrame=function(){S>=0&&c.vertexAttribPointer(S,2,c.FLOAT,!1,0,0)},this.enableUVtargetFrame=function(){S>=0&&c.enableVertexAttribArray(S)},this.disableUVtargetFrame=function(){S>=0&&c.disableVertexAttribArray(S)},this.setScaleFactor=function(a){W&&c.uniform3fv(W,a)},this.set_RealResult=function(){U>=0&&c.vertexAttribPointer(U,3,c.FLOAT,!1,0,0)},this.enableRealResult=function(){U>=0&&c.enableVertexAttribArray(U)},this.disableRealResult=function(){U>=0&&c.disableVertexAttribArray(U)},this.set_ImaginaryResult=function(){V>=0&&c.vertexAttribPointer(V,3,c.FLOAT,!1,0,0)},this.enableImaginaryResult=function(){V>=0&&c.enableVertexAttribArray(V)},this.disableImaginaryResult=function(){V>=0&&c.disableVertexAttribArray(V)},this.setTransientPivotVector=function(a){X&&c.uniform3fv(X,a)},this.bind=function(){c.useProgram(this.program)},this.loadShader=function(f,g,h){return c=h,d=f,e=g,this.program=a(d,e),b(this.program),this.program},this.clear=function(){c.useProgram(this.program);var a=c.getAttachedShaders(this.program),b=0;for(b=0;b<a.length;b++)c.detachShader(this.program,a[b]),c.deleteShader(a[b]);c.deleteProgram(this.program)}},CAXViewer.MCAXLoader=function(a){function b(b){if(b.lengthComputable){var c=b.loaded/b.total;c*=100,a.updateStatus("Data transferred "+c.toFixed(2)+"%")}else a.updateStatus("Data transferring...")}function c(b){var c=document.location.hostname;c!=q?(a.updateStatus("Cross-Origin Request Blocked (Reason: CORS header Access-Control-Allow-Origin missing)."),CAXViewer.log("Cross-Origin Request Blocked (Reason: CORS header Access-Control-Allow-Origin missing).")):(a.updateStatus("An error occurred while transferring the file."),CAXViewer.log("An error occurred while transferring the file."))}function d(b){a.updateStatus("The transfer has been cancelled by the user."),CAXViewer.log("The transfer has been cancelled by the user.")}function e(b){a.disableBottomCtrl();var c=b,d=new Uint8Array(b,0,4);if(d=String.fromCharCode.apply(null,d),"WCAX"!=d)return CAXViewer.log(d+" is invalid file format"),a.updateStatus("Invalid file format!!!"),void $.alert({title:CAXViewer.AppName,type:"dark",content:"Invalid file format!!!"});var e=!0,f=new DataView(b,0,48),g=f.getUint16(6,e);1e3!=g&&(e=!1);var h=f.getUint16(4,e),l=f.getUint16(35,e);if(p=12336!=l&&h>=3?parseFloat(h+"."+l):parseFloat(h+".0"),CAXViewer.log("File Version :"+p),p>3)return void $.alert({title:CAXViewer.AppName,type:"dark",content:"This version of file is not supported in this viewer.<br/> Please update the viewer."});p>2&&a.updateShaderProgram();var o=f.getUint32(8,e),q=f.getUint32(12,e),r=f.getUint32(16,e),s=f.getUint32(20,e);j=f.getUint16(24,e);try{var u=f.getUint32(26,e),x=f.getUint32(30,e),y=String.fromCharCode(f.getUint8(34,e)),z=new Uint8Array(b,u,x);z=i(z);var A=JSON.parse(z);CAXViewer.log(A)}catch(a){CAXViewer.error(a)}var B=new Uint8Array(b,o,q);try{B=new Uint8Array(m.decompression_Zlib(B))}catch(a){CAXViewer.error(a)}var C=i(B);C=JSON.parse(C),t=C;var D=t.models,E=0;for(E=0;E<D.length;E++)n.push(D[E].Name);var F=c.slice(r,r+s);try{var G=r+s,H=u-(r+s),I=new Uint8Array(b,G,H);I=i(I),I=k.encryptDecrypt(I),"1"==y||I.indexOf("PWD1")>-1?v(F,I,z,0):w(F)}catch(a){return void CAXViewer.error(a)}F=null,c=null}function f(a){for(var b=0,b=0;b<n.length;b++)if(n[b]==a)return b;return-1}function g(a,b){for(var c=0;c<b.length;c++)if(b[c].Name==a)return c;return-1}function h(a){for(var b=unescape(encodeURIComponent(a)),c=new Uint8Array(b.length),d=0;d<b.length;d++)c[d]=b.charCodeAt(d);return c}function i(a){var b,c,d,e,f,g;for(b="",d=a.length,c=0;c<d;)switch(e=a[c++],e>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=String.fromCharCode(e);break;case 12:case 13:f=a[c++],b+=String.fromCharCode((31&e)<<6|63&f);break;case 14:f=a[c++],g=a[c++],b+=String.fromCharCode((15&e)<<12|(63&f)<<6|(63&g)<<0)}return b}var j,k=a.getUtility(),l=a.getModelManager(),m=a.getCompression(),n=[],o=null,p=0,q=null,r=[],s=null,t=null,u={NOTHING:0,ZLIB:1,LZ4:3};this.getFileVersion=function(){return p},this.loadFile=function(c){var d=new FileReader;d.addEventListener("progress",b),d.onload=function(b){a.clearStatus();var c=d.result;e(c)},d.readAsArrayBuffer(c)},this.loadURL=function(f){if(CAXViewer.log(f),q=k.extractDomain(f),null!=f){var g=new XMLHttpRequest;g.addEventListener("progress",b),g.addEventListener("error",c),g.addEventListener("abort",d),g.open("GET",f,!0),g.responseType="arraybuffer",g.onload=function(b){a.clearStatus();var c=g.response;200==g.status?e(c):(CAXViewer.error("Invalid Request!!!"),CAXViewer.error("Response Status Code :"+g.status))},g.send()}},this.loadBufferData=function(a){e(a)};var v=function(a,b,c,d){d<3&&$.confirm({content:'<b>Enter Password : <input id="inpPWD" type="password" style="border: 1px solid #0003;border-radius: 2px;box-sizing: border-box;" /></b>',type:"dark",buttons:{ok:{text:"ok",keys:["enter"],action:function(){var e=document.getElementById("inpPWD").value,f="PWD1"+e+c;b==f?(w(a),a=null):2==d?$.alert({content:"Incorrect Password!!!",type:"dark",buttons:{Close:{text:"Close",action:function(){}}}}):$.alert({content:"Incorrect Password!!!",type:"dark",buttons:{Retry:function(){v(a,b,c,d+1)},Close:{text:"Close",action:function(){}}}})}},Close:{text:"Close",action:function(){}}}})},w=function(a){x(a),l&&l.freeAllModel();var b=0;for(b=0;b<r.length;b++)l.createModel(r[b].SceneGraph);a=null},x=function(a){try{var b=0,c=t.models,d=t.views;for(b=0;b<c.length;b++){r[b]={};var e=a.slice(c[b].sceneGraph.OffsetPosition,parseInt(c[b].sceneGraph.OffsetPosition)+parseInt(c[b].sceneGraph.contentLength));e=A(e);var f=new Uint8Array(e);r[b].SceneGraph=i(f);var g=c[b].parts;if(void 0!=g&&null!=g){var h=c[b].parts.originalGeometry;if(r[b].originalMesh=y(a,h),c[b].instances){var j=c[b].instances,k=Object.keys(j);r[b].instances={};for(var l=0;l<k.length;l++){r[b].instances[k[l]]={};var m=c[b].instances[k[l]].parts;r[b].instances[k[l]].instanceMesh=y(a,m)}}if(c[b].UndeformedInstances){var n=c[b].UndeformedInstances,o=Object.keys(n);r[b].UndeformedInstances={};for(var l=0;l<o.length;l++){r[b].UndeformedInstances[o[l]]={};var p=c[b].UndeformedInstances[o[l]].parts;r[b].UndeformedInstances[o[l]].instanceMesh=y(a,p)}}}else CAXViewer.error("Model has no part to show")}if(d){s={};var q=d.viewPathList;if(q){var u=parseInt(q.OffsetPosition),v=parseInt(q.contentLength);s.viewPathList=A(a.slice(u,u+v))}var w=d.viewPaths;if(w){var x=Object.keys(w);s.viewPaths={};for(var l=0;l<x.length;l++){s.viewPaths[x[l]]={},s.viewPaths[x[l]].viewPathName=d.viewPaths[x[l]].viewPathName;var u=parseInt(d.viewPaths[x[l]].viewPointList.OffsetPosition),v=parseInt(d.viewPaths[x[l]].viewPointList.contentLength);s.viewPaths[x[l]].viewPointList=A(a.slice(u,u+v))}}var B=d.viewPoints;if(B){var x=Object.keys(B);s.viewPoints={};for(var l=0;l<x.length;l++){if(s.viewPoints[x[l]]={},s.viewPoints[x[l]].viewPathName=d.viewPoints[x[l]].viewPathName,s.viewPoints[x[l]].viewPointName=d.viewPoints[x[l]].viewPointName,d.viewPoints[x[l]].viewPointImage){var u=parseInt(d.viewPoints[x[l]].viewPointImage.OffsetPosition),v=parseInt(d.viewPoints[x[l]].viewPointImage.contentLength);s.viewPoints[x[l]].viewPointImage=A(a.slice(u,u+v))}if(u=parseInt(d.viewPoints[x[l]].ViewPointData.OffsetPosition),v=parseInt(d.viewPoints[x[l]].ViewPointData.contentLength),s.viewPoints[x[l]].ViewPointData=A(a.slice(u,u+v)),d.viewPoints[x[l]].ViewPointBackgroundImage&&(u=parseInt(d.viewPoints[x[l]].ViewPointBackgroundImage.OffsetPosition),v=parseInt(d.viewPoints[x[l]].ViewPointBackgroundImage.contentLength),s.viewPoints[x[l]].ViewPointBackgroundImage=A(a.slice(u,u+v))),d.viewPoints[x[l]].models){s.viewPoints[x[l]].models=[];for(var C=0;C<d.viewPoints[x[l]].models.length;C++){var D={};if(D.modelName=d.viewPoints[x[l]].models[C].Name,d.viewPoints[x[l]].models[C].parts){var E=d.viewPoints[x[l]].models[C].parts;D.parts=y(a,E)}if(d.viewPoints[x[l]].models[C].result){var F=d.viewPoints[x[l]].models[C].result;D.result=z(a,F)}if(d.viewPoints[x[l]].models[C].CAEInstanceList&&(u=parseInt(d.viewPoints[x[l]].models[C].CAEInstanceList.OffsetPosition),v=parseInt(d.viewPoints[x[l]].models[C].CAEInstanceList.contentLength),D.CAEInstanceList=A(a.slice(u,u+v))),d.viewPoints[x[l]].models[C].instances){D.instances={};for(var G=d.viewPoints[x[l]].models[C].instances,H=Object.keys(G),I=0;I<H.length;I++)if(D.instances[H[I]]={},d.viewPoints[x[l]].models[C].instances[H[I]].AnimationCAEInfo&&(u=parseInt(d.viewPoints[x[l]].models[C].instances[H[I]].AnimationCAEInfo.OffsetPosition),v=parseInt(d.viewPoints[x[l]].models[C].instances[H[I]].AnimationCAEInfo.contentLength),D.instances[H[I]].AnimationCAEInfo=A(a.slice(u,u+v))),d.viewPoints[x[l]].models[C].instances[H[I]].AnimationLables&&(u=parseInt(d.viewPoints[x[l]].models[C].instances[H[I]].AnimationLables.OffsetPosition),v=parseInt(d.viewPoints[x[l]].models[C].instances[H[I]].AnimationLables.contentLength),D.instances[H[I]].AnimationLables=A(a.slice(u,u+v))),d.viewPoints[x[l]].models[C].instances[H[I]].AnimationSymbolPlots&&(u=parseInt(d.viewPoints[x[l]].models[C].instances[H[I]].AnimationSymbolPlots.OffsetPosition),v=parseInt(d.viewPoints[x[l]].models[C].instances[H[I]].AnimationSymbolPlots.contentLength),D.instances[H[I]].AnimationSymbolPlots=A(a.slice(u,u+v))),d.viewPoints[x[l]].models[C].instances[H[I]].parts){var J=d.viewPoints[x[l]].models[C].instances[H[I]].parts;D.instances[H[I]].instanceMesh=y(a,J)}}s.viewPoints[x[l]].models.push(D)}}if(d.viewPoints[x[l]].CAEInfo&&(u=parseInt(d.viewPoints[x[l]].CAEInfo.OffsetPosition),v=parseInt(d.viewPoints[x[l]].CAEInfo.contentLength),s.viewPoints[x[l]].CAEInfo=A(a.slice(u,u+v))),d.viewPoints[x[l]].parts){var K=d.viewPoints[x[l]].parts;s.viewPoints[x[l]].VPMesh=y(a,K)}if(d.viewPoints[x[l]].result){var F=d.viewPoints[x[l]].result;s.viewPoints[x[l]].result=z(a,F)}if(d.viewPoints[x[l]].CAEInstanceList&&(u=parseInt(d.viewPoints[x[l]].CAEInstanceList.OffsetPosition),v=parseInt(d.viewPoints[x[l]].CAEInstanceList.contentLength),s.viewPoints[x[l]].CAEInstanceList=A(a.slice(u,u+v))),d.viewPoints[x[l]].instances){s.viewPoints[x[l]].instances={};for(var G=d.viewPoints[x[l]].instances,H=Object.keys(G),I=0;I<H.length;I++)if(s.viewPoints[x[l]].instances[H[I]]={},d.viewPoints[x[l]].instances[H[I]].AnimationCAEInfo&&(u=parseInt(d.viewPoints[x[l]].instances[H[I]].AnimationCAEInfo.OffsetPosition),v=parseInt(d.viewPoints[x[l]].instances[H[I]].AnimationCAEInfo.contentLength),s.viewPoints[x[l]].instances[H[I]].AnimationCAEInfo=A(a.slice(u,u+v))),d.viewPoints[x[l]].instances[H[I]].AnimationLables&&(u=parseInt(d.viewPoints[x[l]].instances[H[I]].AnimationLables.OffsetPosition),v=parseInt(d.viewPoints[x[l]].instances[H[I]].AnimationLables.contentLength),s.viewPoints[x[l]].instances[H[I]].AnimationLables=A(a.slice(u,u+v))),d.viewPoints[x[l]].instances[H[I]].parts){var J=d.viewPoints[x[l]].instances[H[I]].parts;s.viewPoints[x[l]].instances[H[I]].instanceMesh=y(a,J)}}}}}}catch(a){CAXViewer.error(a)}},y=function(a,b){var c={},d=a.slice(b.meshInfo.OffsetPosition,parseInt(b.meshInfo.OffsetPosition)+parseInt(b.meshInfo.contentLength));return j==u.NOTHING?(void 0!=b.meshInfo.boundingBoxMinMax&&null!=b.meshInfo.boundingBoxMinMax&&(c.boundingBoxMinMax=d.slice(b.meshInfo.boundingBoxMinMax.OffsetPosition,parseInt(b.meshInfo.boundingBoxMinMax.OffsetPosition)+parseInt(b.meshInfo.boundingBoxMinMax.contentLength))),void 0!=b.meshInfo.vertices&&null!=b.meshInfo.vertices&&(c.vertices=d.slice(b.meshInfo.vertices.OffsetPosition,parseInt(b.meshInfo.vertices.OffsetPosition)+parseInt(b.meshInfo.vertices.contentLength))),void 0!=b.meshInfo.normals&&null!=b.meshInfo.normals&&(c.normals=d.slice(b.meshInfo.normals.OffsetPosition,parseInt(b.meshInfo.normals.OffsetPosition)+parseInt(b.meshInfo.normals.contentLength))),void 0!=b.meshInfo.meshIndex&&null!=b.meshInfo.meshIndex&&(c.meshIndex=d.slice(b.meshInfo.meshIndex.OffsetPosition,parseInt(b.meshInfo.meshIndex.OffsetPosition)+parseInt(b.meshInfo.meshIndex.contentLength))),void 0!=b.meshInfo.PolygonIndex&&null!=b.meshInfo.PolygonIndex&&(c.polygonIndex=d.slice(b.meshInfo.PolygonIndex.OffsetPosition,parseInt(b.meshInfo.PolygonIndex.OffsetPosition)+parseInt(b.meshInfo.PolygonIndex.contentLength))),void 0!=b.meshInfo.textures&&null!=b.meshInfo.textures&&(c.textures=d.slice(b.meshInfo.textures.OffsetPosition,parseInt(b.meshInfo.textures.OffsetPosition)+parseInt(b.meshInfo.textures.contentLength))),void 0!=b.meshInfo.displacementMinMax&&null!=b.meshInfo.displacementMinMax&&(c.displacementMinMax=d.slice(b.meshInfo.displacementMinMax.OffsetPosition,parseInt(b.meshInfo.displacementMinMax.OffsetPosition)+parseInt(b.meshInfo.displacementMinMax.contentLength))),void 0!=b.meshInfo.displacementValue&&null!=b.meshInfo.displacementValue&&(c.displacementValue=d.slice(b.meshInfo.displacementValue.OffsetPosition,parseInt(b.meshInfo.displacementValue.OffsetPosition)+parseInt(b.meshInfo.displacementValue.contentLength)))):(void 0!=b.meshInfo.boundingBoxMinMax&&null!=b.meshInfo.boundingBoxMinMax&&(c.boundingBoxMinMax=A(d.slice(b.meshInfo.boundingBoxMinMax.OffsetPosition,parseInt(b.meshInfo.boundingBoxMinMax.OffsetPosition)+parseInt(b.meshInfo.boundingBoxMinMax.contentLength)))),void 0!=b.meshInfo.vertices&&null!=b.meshInfo.vertices&&(c.vertices=A(d.slice(b.meshInfo.vertices.OffsetPosition,parseInt(b.meshInfo.vertices.OffsetPosition)+parseInt(b.meshInfo.vertices.contentLength)))),void 0!=b.meshInfo.normals&&null!=b.meshInfo.normals&&(c.normals=A(d.slice(b.meshInfo.normals.OffsetPosition,parseInt(b.meshInfo.normals.OffsetPosition)+parseInt(b.meshInfo.normals.contentLength)))),void 0!=b.meshInfo.meshIndex&&null!=b.meshInfo.meshIndex&&(c.meshIndex=A(d.slice(b.meshInfo.meshIndex.OffsetPosition,parseInt(b.meshInfo.meshIndex.OffsetPosition)+parseInt(b.meshInfo.meshIndex.contentLength)))),void 0!=b.meshInfo.PolygonIndex&&null!=b.meshInfo.PolygonIndex&&(c.polygonIndex=A(d.slice(b.meshInfo.PolygonIndex.OffsetPosition,parseInt(b.meshInfo.PolygonIndex.OffsetPosition)+parseInt(b.meshInfo.PolygonIndex.contentLength)))),void 0!=b.meshInfo.textures&&null!=b.meshInfo.textures&&(c.textures=A(d.slice(b.meshInfo.textures.OffsetPosition,parseInt(b.meshInfo.textures.OffsetPosition)+parseInt(b.meshInfo.textures.contentLength)))),void 0!=b.meshInfo.displacementMinMax&&null!=b.meshInfo.displacementMinMax&&(c.displacementMinMax=A(d.slice(b.meshInfo.displacementMinMax.OffsetPosition,parseInt(b.meshInfo.displacementMinMax.OffsetPosition)+parseInt(b.meshInfo.displacementMinMax.contentLength)))),void 0!=b.meshInfo.displacementValues&&null!=b.meshInfo.displacementValues&&(c.displacementValues=A(d.slice(b.meshInfo.displacementValues.OffsetPosition,parseInt(b.meshInfo.displacementValues.OffsetPosition)+parseInt(b.meshInfo.displacementValues.contentLength))))),c},z=function(a,b){var c={},d=a.slice(b.resultInfo.OffsetPosition,parseInt(b.resultInfo.OffsetPosition)+parseInt(b.resultInfo.contentLength));return j==u.NOTHING?(void 0!=b.resultInfo.realResult&&null!=b.resultInfo.realResult&&(c.realResult=d.slice(b.resultInfo.realResult.OffsetPosition,parseInt(b.resultInfo.realResult.OffsetPosition)+parseInt(b.resultInfo.realResult.contentLength))),void 0!=b.resultInfo.imaginaryResult&&null!=b.resultInfo.imaginaryResult&&(c.imaginaryResult=d.slice(b.resultInfo.imaginaryResult.OffsetPosition,parseInt(b.resultInfo.imaginaryResult.OffsetPosition)+parseInt(b.resultInfo.imaginaryResult.contentLength))),void 0!=b.resultInfo.metaResult&&null!=b.resultInfo.metaResult&&(c.metaResult=d.slice(b.resultInfo.metaResult.OffsetPosition,parseInt(b.resultInfo.metaResult.OffsetPosition)+parseInt(b.resultInfo.metaResult.contentLength)))):(void 0!=b.resultInfo.realResult&&null!=b.resultInfo.realResult&&(c.realResult=A(d.slice(b.resultInfo.realResult.OffsetPosition,parseInt(b.resultInfo.realResult.OffsetPosition)+parseInt(b.resultInfo.realResult.contentLength)))),void 0!=b.resultInfo.imaginaryResult&&null!=b.resultInfo.imaginaryResult&&(c.imaginaryResult=A(d.slice(b.resultInfo.imaginaryResult.OffsetPosition,parseInt(b.resultInfo.imaginaryResult.OffsetPosition)+parseInt(b.resultInfo.imaginaryResult.contentLength)))),void 0!=b.resultInfo.metaResult&&null!=b.resultInfo.metaResult&&(c.metaResult=A(d.slice(b.resultInfo.metaResult.OffsetPosition,parseInt(b.resultInfo.metaResult.OffsetPosition)+parseInt(b.resultInfo.metaResult.contentLength))))),c},A=function(a){var b=null;return b=j==u.ZLIB?m.decompression_Zlib(a):j==u.LZ4?m.Decompression_LZ4(a):a};this.getPartVertices=function(a,b){var c=0,d=l.getModelByName(b);if(null==d||void 0==d)return void CAXViewer.log("Invalid Model");var e=!1;e=d.getIsCAEModeCase();var g=!1;g=d.getIsCAEMovingMesh();var i=(a.name,a.key),j=a.IsCAETransientResult,k=a.IsDeformApplied,m=a.CAEInstanceName,n=d.getcurrentCAEInstance(),o=m?m:n;if(null!=k&&"undefined"!=k||(k=!1),b&&(c=f(b)),c==-1)return void CAXViewer.log("Invalid Model");var p=null;try{if(1==j)if(t.models[c].instances&&1==k){var q=t.models[c].instances[o].parts;p=r[c].instances[o].instanceMesh}else if(t.models[c].UndeformedInstances&&1==g){var q=t.models[c].UndeformedInstances[o].parts;p=r[c].UndeformedInstances[o].instanceMesh}else{var q=t.models[c].parts.originalGeometry;p=r[c].originalMesh}else if(1==k&&1==e){var q=t.models[c].instances[n].parts;p=r[c].instances[n].instanceMesh}else if(1==k){var q=t.models[c].instances[n].parts;p=r[c].instances[n].instanceMesh}else{var q=t.models[c].parts.originalGeometry;p=r[c].originalMesh}q=q[i];var s=parseInt(q.vertices.offsetPosition),u=parseInt(q.vertices.contentLength);p=p.vertices;var v=p.slice(s,s+u);return v}catch(a){return h("Error")}},this.getUndeformPartVertices=function(a,b){var c=0,d=l.getModelByName(b);if(null==d||void 0==d)return void CAXViewer.log("Invalid Model");var e=!1;e=d.getIsCAEModeCase();var g=!1;g=d.getIsCAEMovingMesh();var i=(a.name,a.key),j=(a.IsCAETransientResult,a.IsDeformApplied),k=a.CAEInstanceName,m=d.getcurrentCAEInstance(),n=k?k:m;if(null!=j&&"undefined"!=j||(j=!1),b&&(c=f(b)),c==-1)return void CAXViewer.log("Invalid Model");var o=null;try{if(g&&t.models[c].UndeformedInstances){var p=t.models[c].UndeformedInstances[n].parts;o=r[c].UndeformedInstances[n].instanceMesh}else{var p=t.models[c].parts.originalGeometry;o=r[c].originalMesh}p=p[i];var q=parseInt(p.vertices.offsetPosition),s=parseInt(p.vertices.contentLength);o=o.vertices;var u=o.slice(q,q+s);return u}catch(a){return h("Error")}},this.getPartNormal=function(a,b){var c=0,d=l.getModelByName(b);if(null==d||void 0==d)return void CAXViewer.log("Invalid Model");var e=!1;e=d.getIsCAEModeCase();var g=!1;g=d.getIsCAEMovingMesh();var i=(a.name,a.key),j=a.IsCAETransientResult,k=a.IsDeformApplied,m=a.CAEInstanceName,n=d.getcurrentCAEInstance(),o=m?m:n;if(null!=k&&"undefined"!=k||(k=!1),b&&(c=f(b)),c==-1)return void CAXViewer.log("Invalid Model");var p=null;try{if(1==j)if(t.models[c].instances&&1==k){var q=t.models[c].instances[o].parts;p=r[c].instances[o].instanceMesh}else if(t.models[c].UndeformedInstances&&1==g){var q=t.models[c].UndeformedInstances[o].parts;p=r[c].UndeformedInstances[o].instanceMesh}else{var q=t.models[c].parts.originalGeometry;p=r[c].originalMesh}else if(1==k&&1==e){var q=t.models[c].instances[n].parts;p=r[c].instances[n].instanceMesh}else if(1==k){var q=t.models[c].instances[n].parts;p=r[c].instances[n].instanceMesh}else{var q=t.models[c].parts.originalGeometry;p=r[c].originalMesh}q=q[i];var s=parseInt(q.normals.offsetPosition),u=parseInt(q.normals.contentLength);p=p.normals;var v=p.slice(s,s+u);return v}catch(a){return h("Error")}},this.getUndeformPartNormal=function(a,b){var c=0,d=l.getModelByName(b);if(null==d||void 0==d)return void CAXViewer.log("Invalid Model");var e=!1;e=d.getIsCAEModeCase();var g=!1;g=d.getIsCAEMovingMesh();var i=(a.name,a.key),j=(a.IsCAETransientResult,a.IsDeformApplied),k=a.CAEInstanceName,m=d.getcurrentCAEInstance(),n=k?k:m;if(null!=j&&"undefined"!=j||(j=!1),b&&(c=f(b)),c==-1)return void CAXViewer.log("Invalid Model");var o=null;try{if(g&&t.models[c].UndeformedInstances){var p=t.models[c].UndeformedInstances[n].parts;o=r[c].UndeformedInstances[n].instanceMesh}else{var p=t.models[c].parts.originalGeometry;o=r[c].originalMesh}p=p[i];var q=parseInt(p.normals.offsetPosition),s=parseInt(p.normals.contentLength);o=o.normals;var u=o.slice(q,q+s);return u}catch(a){return h("Error")}},this.getBoundingBoxMinMaX=function(a,b){var c=0,d=l.getModelByName(b);if(null==d||void 0==d)return void CAXViewer.log("Invalid Model");var e=(a.name,a.key),g=a.IsCAETransientResult,i=a.IsDeformApplied,j=a.CAEInstanceName,k=!1;k=d.getIsCAEModeCase();var m=!1;m=d.getIsCAEMovingMesh();var n=d.getcurrentCAEInstance(),o=j?j:n;if(null!=i&&"undefined"!=i||(i=!1),b&&(c=f(b)),c==-1)return void CAXViewer.log("Invalid Model");var p=null;try{if(1==g)if(t.models[c].instances&&1==i){var q=t.models[c].instances[o].parts;p=r[c].instances[o].instanceMesh}else if(t.models[c].UndeformedInstances&&1==m){var q=t.models[c].UndeformedInstances[o].parts;p=r[c].UndeformedInstances[o].instanceMesh}else{var q=t.models[c].parts.originalGeometry;p=r[c].originalMesh}else if(1==i&&1==k){var q=t.models[c].instances[n].parts;p=r[c].instances[n].instanceMesh}else if(1==i){var q=t.models[c].instances[n].parts;p=r[c].instances[n].instanceMesh}else{var q=t.models[c].parts.originalGeometry;p=r[c].originalMesh}q=q[e];var s=parseInt(q.BoundinMinMax.offsetPosition),u=parseInt(q.BoundinMinMax.contentLength);p=p.boundingBoxMinMax;var v=p.slice(s,s+u),w=new Uint8Array(v);w=String.fromCharCode.apply(null,w);var x=JSON.parse(w);return x}catch(a){return h("Error")}},this.getUndeformBoundingBoxMinMax=function(a,b){var c=0,d=l.getModelByName(b);if(null==d||void 0==d)return void CAXViewer.log("Invalid Model");var e=(a.name,a.key),g=(a.IsCAETransientResult,a.IsDeformApplied),i=a.CAEInstanceName,j=!1;j=d.getIsCAEModeCase();var k=!1;k=d.getIsCAEMovingMesh();var m=d.getcurrentCAEInstance(),n=i?i:m;if(null!=g&&"undefined"!=g||(g=!1),b&&(c=f(b)),c==-1)return void CAXViewer.log("Invalid Model");var o=null;try{if(k&&t.models[c].UndeformedInstances){var p=t.models[c].UndeformedInstances[n].parts;o=r[c].UndeformedInstances[n].instanceMesh}else{var p=t.models[c].parts.originalGeometry;o=r[c].originalMesh}p=p[e];var q=parseInt(p.BoundinMinMax.offsetPosition),s=parseInt(p.BoundinMinMax.contentLength);o=o.boundingBoxMinMax;var u=o.slice(q,q+s),v=new Uint8Array(u);v=String.fromCharCode.apply(null,v);var w=JSON.parse(v);return w}catch(a){return h("Error")}},this.getPartTexture=function(a,b){var c=0,d=l.getModelByName(b);if(null==d||void 0==d)return void CAXViewer.log("Invalid Model");var e=(a.name,a.key),i=a.IsCAETransientResult,j=(a.IsDeformApplied,a.CAEInstanceName);if(b&&(c=f(b)),c==-1)return void CAXViewer.log("Invalid Model");var k=null;try{if(1==i)if(null==j||"undefined"==j){if(c=g(b,t.views.viewPoints[o].models),c==-1)return;var m=t.views.viewPoints[o].models[c].parts;k=s.viewPoints[o].models[c].parts}else{if(c=g(b,t.views.viewPoints[o].models),c==-1)return;var m=t.views.viewPoints[o].models[c].instances[j].parts;k=s.viewPoints[o].models[c].instances[j].instanceMesh}else{var m=t.models[c].parts.originalGeometry;k=r[c].originalMesh}m=m[e];var n=parseInt(m.texture.offsetPosition),p=parseInt(m.texture.contentLength);k=k.textures;var q=k.slice(n,n+p);return q}catch(a){return h("Error")}},this.getMeshIndex=function(a,b){var c=(a.name,a.key),d=0;if(b&&(d=f(b)),d==-1)return void CAXViewer.log("Invalid Model");var e=null,g=t.models[d].parts.originalGeometry;e=r[d].originalMesh,g=g[c];var h=parseInt(g.meshIndex.offsetPosition),i=parseInt(g.meshIndex.contentLength);e=e.meshIndex;var j=e.slice(h,h+i);return j},this.getPartPolygonWireFrameIndex=function(a,b){var c=0,d=(a.name,a.key);if(b&&(c=f(b)),c==-1)return void console.log("Invalid Model");var e=null,g=t.models[c].parts.originalGeometry;e=r[c].originalMesh,g=g[d];var h=parseInt(g.polyMeshIndex.offsetPosition),i=parseInt(g.polyMeshIndex.contentLength);e=e.polygonIndex;var j=e.slice(h,h+i);return j},this.getUndeformPartPolygonWireFrameIndex=function(a,b){var c=0,d=l.getModelByName(b);if(null==d||void 0==d)return void CAXViewer.log("Invalid Model");var e=(a.name,a.key),g=(a.IsCAETransientResult,a.IsDeformApplied),i=a.CAEInstanceName,j=!1;j=d.getIsCAEModeCase();var k=!1;k=d.getIsCAEMovingMesh();var m=d.getcurrentCAEInstance(),n=i?i:m;if(null!=g&&"undefined"!=g||(g=!1),b&&(c=f(b)),c==-1)return void CAXViewer.log("Invalid Model");var o=null;try{if(k&&t.models[c].UndeformedInstances){var p=t.models[c].UndeformedInstances[n].parts;o=r[c].UndeformedInstances[n].instanceMesh}else{var p=t.models[c].parts.originalGeometry;o=r[c].originalMesh}p=p[e];var q=parseInt(p.polyMeshIndex.offsetPosition),s=parseInt(p.polyMeshIndex.contentLength);o=o.polygonIndex;var u=o.slice(q,q+s);return u}catch(a){return h("Error")}},this.getDisplacementMinMaX=function(a,b){var c=0,d=l.getModelByName(b);if(null==d||void 0==d)return void CAXViewer.log("Invalid Model");var e=(a.name,a.key),g=(a.IsCAETransientResult,a.IsDeformApplied),i=a.CAEInstanceName,j=!1;j=d.getIsCAEModeCase();var k=!1;k=d.getIsCAEMovingMesh();var m=d.getcurrentCAEInstance(),n=i?i:m;if(null!=g&&"undefined"!=g||(g=!1),b&&(c=f(b)),c==-1)return void CAXViewer.log("Invalid Model");var o=null;try{var p=t.models[c].instances[n].parts;o=r[c].instances[n].instanceMesh,p=p[e];var q=parseInt(p.displacementMinMax.offsetPosition),s=parseInt(p.displacementMinMax.contentLength);o=o.displacementMinMax;var u=o.slice(q,q+s),v=new Uint8Array(u);v=String.fromCharCode.apply(null,v);var w=JSON.parse(v);return w}catch(a){return h("Error")}},this.getDisplacementValues=function(a,b){var c=0,d=l.getModelByName(b);if(null==d||void 0==d)return void CAXViewer.log("Invalid Model");var e=!1;e=d.getIsCAEModeCase();var g=!1;g=d.getIsCAEMovingMesh();var i=(a.name,a.key),j=(a.IsCAETransientResult,a.IsDeformApplied),k=a.CAEInstanceName,m=d.getcurrentCAEInstance(),n=k?k:m;if(null!=j&&"undefined"!=j||(j=!1),b&&(c=f(b)),c==-1)return void CAXViewer.log("Invalid Model");var o=null;try{var p=t.models[c].instances[n].parts;o=r[c].instances[n].instanceMesh,p=p[i];var q=parseInt(p.displacementValues.offsetPosition),s=parseInt(p.displacementValues.contentLength);o=o.displacementValues;var u=o.slice(q,q+s);return u}catch(a){return h("Error")}},this.getViewPathList=function(a){var b=0;if(a&&(b=f(a)),b==-1)return void CAXViewer.log("Invalid Model");try{var c=null;if(s&&(c=s.viewPathList),c){var d=new Uint8Array(c);return d=String.fromCharCode.apply(null,d)}return null}catch(a){return h("Error")}},this.getViewPointList=function(a,b){var c=0;if(b&&(c=f(b)),c==-1)return void CAXViewer.log("Invalid Model");try{var d=a.key,e=s.viewPaths[d].viewPointList,g=new Uint8Array(e);return g=String.fromCharCode.apply(null,g)}catch(a){return h("Error")}},this.getViewPointImage=function(a,b){var c=0;if(b&&(c=f(b)),c==-1)return void CAXViewer.log("Invalid Model");try{var d=a.key;if(s.viewPoints[d].viewPointImage){var e=s.viewPoints[d].viewPointImage;return e}return null}catch(a){return h("Error")}},this.getViewPointData=function(a,b){var c=0;if(b&&(c=f(b)),c==-1)return void CAXViewer.log("Invalid Model");try{var d=a.viewPointKey;o=a.viewPointKey;var e=s.viewPoints[d].ViewPointData;return e}catch(a){return h("Error")}},this.getViewPointBGImage=function(a,b){var c=0;if(b&&(c=f(b)),c==-1)return void CAXViewer.log("Invalid Model");try{var d=a.viewPointKey,e=s.viewPoints[d].ViewPointBackgroundImage;return e}catch(a){return h("Error")}},this.getCAEInfo_not_used=function(a){var b=0;if(a&&(b=f(a)),b==-1)return void CAXViewer.log("Invalid Model");try{var c=o,d=s.viewPoints[c].CAEInfo;return d}catch(a){return h("Error")}},this.getEigenComplexRealDataForNode=function(a,b){var c=0,d=(a.partName,a.key);if(b&&(c=f(b)),c==-1)return void CAXViewer.log("Invalid Model");try{var e=o;if(c=g(b,t.views.viewPoints[o].models),c==-1)return;var i=t.views.viewPoints[e].models[c].result,j=i[d],k=j.Use_Part_Result;if(null==k||"undefined"==k){var l=j.RealResult,m=l.OffsetPosition,n=l.contentLength,p=s.viewPoints[e].models[c].result.realResult,q=p.slice(m,m+n);return q}return h(k)}catch(a){return h("Error")}},this.getEigenComplexImaginaryDataForNode=function(a,b){var c=0,d=(a.partName,
a.key);if(b&&(c=f(b)),c==-1)return void CAXViewer.log("Invalid Model");try{var e=o;if(c=g(b,t.views.viewPoints[o].models),c==-1)return;var i=t.views.viewPoints[e].models[c].result,j=i[d],k=j.Use_Part_Result;if(null==k||"undefined"==k){var l=j.ImaginaryResult,m=l.OffsetPosition,n=l.contentLength,p=s.viewPoints[e].models[c].result.imaginaryResult,q=p.slice(m,m+n);return q}return h(k)}catch(a){return h("Error")}},this.getEigenComplexMetaDataForNode=function(a,b){var c=0,c=0,d=(a.partName,a.key);if(b&&(c=f(b)),c==-1)return void CAXViewer.log("Invalid Model");try{var e=o;if(c=g(b,t.views.viewPoints[o].models),c==-1)return;var i=t.views.viewPoints[e].models[c].result,j=i[d],k=j.Use_Part_Result;if(s.viewPoints[e].models[c].result.metaResult){var l=j.MetaResult,m=l.OffsetPosition,n=l.contentLength,p=s.viewPoints[e].models[c].result.metaResult,q=p.slice(m,m+n);return q}return h(k)}catch(a){return h("Error")}},this.getAnimationCAEInfo=function(a,b){var c=0;if(b&&(c=f(b)),c==-1)return void CAXViewer.log("Invalid Model");try{if(c=g(b,t.views.viewPoints[o].models),c==-1)return;var d=s.viewPoints[o].models[c].instances[a].AnimationCAEInfo;return d}catch(a){return h("Error")}},this.getAnimationLabels=function(a,b){var c=0;if(b&&(c=f(b)),c==-1)return void CAXViewer.log("Invalid Model");try{if(c=g(b,t.views.viewPoints[o].models),c==-1)return;var d=s.viewPoints[o].models[c].instances[a].AnimationLables;return d}catch(a){return h("Error")}},this.getAnimationSymbolPlots=function(a,b){var c=0;if(b&&(c=f(b)),c==-1)return void CAXViewer.log("Invalid Model");try{if(c=g(b,t.views.viewPoints[o].models),c==-1)return;var d=s.viewPoints[o].models[c].instances[a].AnimationSymbolPlots;return null==d||void 0==d?h("{}"):d}catch(a){return h("Error")}},this.getCAEInstanceList=function(a){var b=0;if(a&&(b=f(a)),b==-1)return void CAXViewer.log("Invalid Model");try{var c=o;if(b=g(a,t.views.viewPoints[o].models),b==-1)return;var d=s.viewPoints[c].models[b].CAEInstanceList;return null!=d&void 0!=d?(d=new Uint8Array(d),i(d)):"Error"}catch(a){return"Error"}},this.clear=function(){t=null,r=null}},CAXViewer.ModelManager=function(a){var b=this,c=[],d=[],e=(a.getWebgl(),!1),f=!1,g=!1;this.getIsRendering=function(){return g},this.createModel=function(b){var e=new CAXViewer.Model(a);d.push(e),e.loadFromJSON(b),c.push(e.getModelName()),"Loading Model..."==a.getTitleName()&&a.setTitleName(e.getModelName()),e.loadAllParts()},this.deleteModel=function(a){alert("unLoadSelectedParts")},this.getModelCount=function(){return d.length},this.getAllModelNames=function(){return c},this.freeAllModel=function(){for(var a=0;a<d.length;a++)d[a].freeCurrentModel()},this.renderALLModel=function(a,b,c){g=!0;var e=0;CAXViewer.ClipEdgeColor[0];e=1;for(var f=0;f<d.length;f++)d[f].render(a,b,c,e);e=0;for(var f=0;f<d.length;f++)f<10&&d[f].setClipEdgeColor(CAXViewer.ClipEdgeColor[f]),d[f].render(a,b,c,e);g=!1},this.getModelByName=function(a){for(var b=0;b<c.length&&a!=c[b];b++);return b<d.length?d[b]:null},this.getOverAllBoundindBox=function(){for(var a=[1e6,1e6,1e6],b=[-1e6,-1e6,-1e6],c=0;c<d.length;c++){var e=d[c].getModelMinMax();b[0]<e.max[0]&&(b[0]=e.max[0]),b[1]<e.max[1]&&(b[1]=e.max[1]),b[2]<e.max[2]&&(b[2]=e.max[2]),a[0]>e.min[0]&&(a[0]=e.min[0]),a[1]>e.min[1]&&(a[1]=e.min[1]),a[2]>e.min[2]&&(a[2]=e.min[2])}var f={};return f.min=a,f.max=b,f},this.getOverAllBound=function(){var a=b.getOverAllBoundindBox(),c=[a.max[0]-a.min[0],a.max[1]-a.min[1],a.max[2]-a.min[2]];return c},this.getVisiblePartBoundingBox=function(){for(var a=[1e6,1e6,1e6],b=[-1e6,-1e6,-1e6],c=0;c<d.length;c++){var e=d[c].getVisiblePartBoundingBox();b[0]<e.max[0]&&(b[0]=e.max[0]),b[1]<e.max[1]&&(b[1]=e.max[1]),b[2]<e.max[2]&&(b[2]=e.max[2]),a[0]>e.min[0]&&(a[0]=e.min[0]),a[1]>e.min[1]&&(a[1]=e.min[1]),a[2]>e.min[2]&&(a[2]=e.min[2])}var f={};return f.min=a,f.max=b,f},this.getTempBoundingBox=function(){for(var a=[1e6,1e6,1e6],b=[-1e6,-1e6,-1e6],c=0;c<d.length;c++){var e=d[c].getTempBoundingBox();b[0]<e.max[0]&&(b[0]=e.max[0]),b[1]<e.max[1]&&(b[1]=e.max[1]),b[2]<e.max[2]&&(b[2]=e.max[2]),a[0]>e.min[0]&&(a[0]=e.min[0]),a[1]>e.min[1]&&(a[1]=e.min[1]),a[2]>e.min[2]&&(a[2]=e.min[2])}var f={};return f.min=a,f.max=b,f},this.updateBoundingBox=function(a){if(null==a||void 0==a)for(var c=0;c<d.length;c++)d[c].updateBoundingBox();else{var e=b.getModelByName(a);null!=e&&void 0!=e&&e.updateBoundingBox()}},this.getModifiedModelCenter=function(){for(var a=[0,0,0],b=null,c=null,e=0;e<d.length;e++){var f=d[e].getModifiedModelCenter();null==b?(b=[],b[0]=f[0],b[1]=f[1],b[2]=f[2]):(f[0]<b[0]&&(b[0]=f[0]),f[1]<b[1]&&(b[1]=f[1]),f[2]<b[2]&&(b[2]=f[2])),null==c?(c=[],c[0]=f[0],c[1]=f[1],c[2]=f[2]):(f[0]>c[0]&&(c[0]=f[0]),f[1]>c[1]&&(c[1]=f[1]),f[2]>c[2]&&(c[2]=f[2]))}return a[0]=(b[0]+c[0])/2,a[1]=(b[1]+c[1])/2,a[2]=(b[2]+c[2])/2,a},this.getModelOriginalCenter=function(){for(var a=[0,0,0],b=null,c=null,e=0;e<d.length;e++){var f=d[e].getVisiblePartCenter();null!=f&&(null==b?(b=[],b[0]=f[0],b[1]=f[1],b[2]=f[2]):(f[0]<b[0]&&(b[0]=f[0]),f[1]<b[1]&&(b[1]=f[1]),f[2]<b[2]&&(b[2]=f[2])),null==c?(c=[],c[0]=f[0],c[1]=f[1],c[2]=f[2]):(f[0]>c[0]&&(c[0]=f[0]),f[1]>c[1]&&(c[1]=f[1]),f[2]>c[2]&&(c[2]=f[2])))}return null!=b&&null!=c&&(a[0]=(b[0]+c[0])/2,a[1]=(b[1]+c[1])/2,a[2]=(b[2]+c[2])/2),a},this.pickNode=function(a){for(var b,c=0;c<d.length;c++)if(b=d[c].pickNode([a[0],a[1],a[2]]),null!=b)return b;return null},this.deselectAll=function(){for(var a=0;a<d.length;a++)d[a].deselectAll()},this.loadAllParts=function(a){if(null==a||void 0==a)for(var c=0;c<d.length;c++)d[c].loadAllParts();else{var e=b.getModelByName(a);null!=e&&void 0!=e&&e.loadAllParts()}},this.loadSelectedParts=function(a){if(null==a||void 0==a)for(var c=0;c<d.length;c++)d[c].loadSelectedParts();else{var e=b.getModelByName(a);null!=e&&void 0!=e&&e.loadSelectedParts()}},this.unLoadAllParts=function(a){if(null==a||void 0==a)for(var c=0;c<d.length;c++)d[c].unLoadAllParts();else{var e=b.getModelByName(a);null!=e&&void 0!=e&&e.unLoadAllParts()}},this.unLoadSelectedParts=function(a){if(null==a||void 0==a)for(var c=0;c<d.length;c++)d[c].unLoadSelectedParts();else{var e=b.getModelByName(a);null!=e&&void 0!=e&&e.unLoadSelectedParts()}},this.setPartVisible=function(a,c,e){if(null==a||void 0==a)for(var f=0;f<d.length;f++)d[f].setPartVisible(c,e);else{var g=b.getModelByName(a);null!=g&&void 0!=g&&g.setPartVisible(c,e)}},this.getAllPartNames=function(a){var c=[];if(null==a||void 0==a){for(var e=0;e<d.length;e++)c.push(d[e].getAllPartNames());return c}var f=b.getModelByName(a);if(null!=f&&void 0!=f)return f.getAllPartNames()},this.selectedPartsCount=function(a){var c=0;if(null==a||void 0==a){for(var e=0;e<d.length;e++)c+=d[e].selectedPartsCount();return c}var f=b.getModelByName(a);if(null!=f&&void 0!=f)return f.selectedPartsCount()},this.setTexture=function(a,c){if(null==c||void 0==c)for(var e=0;e<d.length;e++)d[e].setTexture(a);else{var f=b.getModelByName(c);null!=f&&void 0!=f&&f.setTexture(a)}},this.setReverseTexture=function(a,c){if(null==c||void 0==c)for(var e=0;e<d.length;e++)d[e].setReverseTexture(a);else{var f=b.getModelByName(c);null!=f&&void 0!=f&&f.setReverseTexture(a)}},this.getTreeData=function(a){alert("getTreeData")},this.resetSupplementalTransformations=function(a){if(null==a||void 0==a)for(var c=0;c<d.length;c++)d[c].resetSupplementalTransformations();else{var e=b.getModelByName(a);null!=e&&void 0!=e&&e.resetSupplementalTransformations()}},this.setDisplayMode=function(a,c){if(null==c||void 0==c)for(var e=0;e<d.length;e++)d[e].setDisplayMode(a);else{var f=b.getModelByName(c);null!=f&&void 0!=f&&f.setDisplayMode(a)}},this.setDeformation=function(a,c,e){var f=!!e&&e;if(null==c||void 0==c)for(var g=0;g<d.length;g++)d[g].setDeformation(a),f&&d[g].updateBoundingBox();else{var h=b.getModelByName(c);null!=h&&void 0!=h&&(h.setDeformation(a),f&&h.updateBoundingBox())}},this.enableUnDeformedMesh=function(a){if(null==a||void 0==a)for(var c=0;c<d.length;c++)d[c].enableUnDeformedMesh();else{var e=b.getModelByName(a);null!=e&&void 0!=e&&e.enableUnDeformedMesh()}},this.disableUnDeformedMesh=function(a){if(null==a||void 0==a)for(var c=0;c<d.length;c++)d[c].disableUnDeformedMesh();else{var e=b.getModelByName(a);null!=e&&void 0!=e&&e.disableUnDeformedMesh()}},this.updateUndeformedMesh=function(a){if(null==a||void 0==a)for(var c=0;c<d.length;c++)d[c].updateUndeformedMesh();else{var e=b.getModelByName(a);null!=e&&void 0!=e&&e.updateUndeformedMesh()}};var h=function(a){setTimeout(function(){a.startAnimation()},500)};this.clearSymbolPlot=function(a){if(null==a||void 0==a)for(var c=0;c<d.length;c++)d[c].clearSymbolPlot();else{var e=b.getModelByName(a);null!=e&&void 0!=e&&e.clearSymbolPlot()}},this.startAnimation=function(a){if(e=!0,f=!1,null==a||void 0==a)for(var c=0;c<d.length;c++)h(d[c]);else{var g=b.getModelByName(a);null!=g&&void 0!=g&&g.startAnimation()}},this.stopAnimation=function(a,c){e=!1,f=!1;var g=!!c&&c;if(null==a||void 0==a)for(var h=0;h<d.length;h++)d[h].stopAnimation(g);else{var i=b.getModelByName(a);null!=i&&void 0!=i&&i.stopAnimation(g)}},this.pauseAnimation=function(a){if(f=!0,null==a||void 0==a)for(var c=0;c<d.length;c++)d[c].pauseAnimation();else{var e=b.getModelByName(a);null!=e&&void 0!=e&&e.pauseAnimation()}},this.forwardAnimation=function(a){if(f=!0,null==a||void 0==a)for(var c=0;c<d.length;c++)d[c].forwardAnimation();else{var e=b.getModelByName(a);null!=e&&void 0!=e&&e.forwardAnimation()}},this.backwardAnimation=function(a){if(f=!0,null==a||void 0==a)for(var c=0;c<d.length;c++)d[c].backwardAnimation();else{var e=b.getModelByName(a);null!=e&&void 0!=e&&e.backwardAnimation()}},this.setFrameDelay=function(a,c){if(null==c||void 0==c)for(var e=0;e<d.length;e++)d[e].setFrameDelay(a);else{var f=b.getModelByName(c);null!=f&&void 0!=f&&f.setFrameDelay(a)}},this.setNormalizeFactor=function(a,c){if(null==c||void 0==c)for(var e=0;e<d.length;e++)d[e].setNormalizeFactor(a);else{var f=b.getModelByName(c);null!=f&&void 0!=f&&f.setNormalizeFactor(a)}},this.setComplexAngle=function(a,c){if(null==c||void 0==c)for(var e=0;e<d.length;e++)d[e].setComplexAngle(a);else{var f=b.getModelByName(c);null!=f&&void 0!=f&&f.setComplexAngle(a)}},this.getIsAnimationON=function(){return e},this.getIsAnimationPaused=function(){return f},this.resetAnimation=function(a){if(null==a||void 0==a)for(var c=0;c<d.length;c++)d[c].resetAnimation();else{var e=b.getModelByName(a);null!=e&&void 0!=e&&e.resetAnimation()}},this.clear=function(){for(var a=0;a<d.length;a++)d[a].model=null,d[a].freeModel(),d[a]=null;d=[],c=[]},this.setViewPartData=function(a,c,e){if(null==a||void 0==a)for(var f=0;f<d.length;f++)d[f].setViewPartData(c,e);else{var g=b.getModelByName(a);null!=g&&void 0!=g&&g.setViewPartData(c,e)}},this.getPartForPartNameAndKey=function(a,c,e){var f=null;if(null==a||void 0==a)for(var g=0;g<d.length&&!(f=d[g].getPartForPartNameAndKey(c,e));g++);else{var h=b.getModelByName(a);null!=h&&void 0!=h&&(f=h.getPartForPartNameAndKey(c,e))}return f},this.applyTranslationToPart=function(a,c,e){if(null==a||void 0==a)for(var f=0;f<d.length;f++)d[f].applyTranslationToPart(c,e);else{var g=b.getModelByName(a);null!=g&&void 0!=g&&g.applyTranslationToPart(c,e)}},this.applyRotationToPart=function(a,c,e,f){if(null==a||void 0==a)for(var g=0;g<d.length;g++)d[g].applyRotationToPart(c,e,f);else{var h=b.getModelByName(a);null!=h&&void 0!=h&&h.applyRotationToPart(c,e,f)}},this.getNodeforNodeName=function(a,c){var e=null;if(null==a||void 0==a)for(var f=0;f<d.length;f++)e=d[f].getNodeforNodeName(c);else{var g=b.getModelByName(a);null!=g&&void 0!=g&&(e=g.getNodeforNodeName(c))}return e},this.applyNodeTransform=function(a,c){if(null==a||void 0==a)for(var e=0;e<d.length;e++)d[e].applyNodeTransform(c);else{var f=b.getModelByName(a);null!=f&&void 0!=f&&f.applyNodeTransform(c)}},this.addTempNode=function(a,c,e){if(null==a||void 0==a)for(var f=0;f<d.length;f++)d[f].addTempNode(c,e);else{var g=b.getModelByName(a);null!=g&&void 0!=g&&g.addTempNode(c,e)}},this.removeAllTempNode=function(a){if(null==a||void 0==a)for(var c=0;c<d.length;c++)d[c].removeAllTempNode();else{var e=b.getModelByName(a);null!=e&&void 0!=e&&e.removeAllTempNode()}},this.applyCAEResultInfo=function(a,c,e,f,g,h){var i=!!h&&h;if(null==a||void 0==a)for(var j=0;j<d.length;j++)d[j].applyCAEResultInfo(c,e,f,g),i&&d[j].updateBoundingBox();else{var k=b.getModelByName(a);null!=k&&void 0!=k&&(k.applyCAEResultInfo(c,e,f,g),i&&k.updateBoundingBox())}},this.setViewPointResultInfo=function(a,c,e,f,g){if(null==a||void 0==a)for(var h=0;h<d.length;h++)d[h].setViewPointResultInfo(c,e,f,g);else{var i=b.getModelByName(a);null!=i&&void 0!=i&&i.setViewPointResultInfo(c,e,f,g)}},this.applyLegendstate=function(a,c,e){if(null==a||void 0==a)for(var f=0;f<d.length;f++)d[f].applyLegendstate(c,e);else{var g=b.getModelByName(a);null!=g&&void 0!=g&&g.applyLegendstate(c,e)}},this.hideLegend=function(a){if(null==a||void 0==a)for(var c=0;c<d.length;c++)d[c].hideLegend();else{var e=b.getModelByName(a);null!=e&&void 0!=e&&e.hideLegend()}},this.setViewPointResultName=function(a,c){if(null==a||void 0==a)for(var e=0;e<d.length;e++)d[e].setViewPointResultName(c);else{var f=b.getModelByName(a);null!=f&&void 0!=f&&f.setViewPointResultName(c)}},this.setViewPointInstanceName=function(a,c){if(null==a||void 0==a)for(var e=0;e<d.length;e++)d[e].setViewPointInstanceName(c);else{var f=b.getModelByName(a);null!=f&&void 0!=f&&f.setViewPointInstanceName(c)}},this.setViewPointDerivedName=function(a,c){if(null==a||void 0==a)for(var e=0;e<d.length;e++)d[e].setViewPointDerivedName(c);else{var f=b.getModelByName(a);null!=f&&void 0!=f&&f.setViewPointDerivedName(c)}},this.setAnimationType=function(a,c){if(null==a||void 0==a)for(var e=0;e<d.length;e++)d[e].setAnimationType(c);else{var f=b.getModelByName(a);null!=f&&void 0!=f&&f.setAnimationType(c)}},this.setFrames=function(a,c){if(null==a||void 0==a)for(var e=0;e<d.length;e++)d[e].setFrames(c);else{var f=b.getModelByName(a);null!=f&&void 0!=f&&f.setFrames(c)}},this.setScaleFactor=function(a,c,e){var f=!!e&&e;if(null==a||void 0==a)for(var g=0;g<d.length;g++)d[g].setScaleFactor(c),f&&d[g].updateBoundingBox();else{var h=b.getModelByName(a);null!=h&&void 0!=h&&(h.setScaleFactor(c),f&&h.updateBoundingBox())}},this.getDeformResultName=function(a){var c=null,d=b.getModelByName(a);return null!=d&&void 0!=d&&(c=d.getDeformResultName()),c},this.setDeformResultName=function(a,c){var d=b.getModelByName(a);null!=d&&void 0!=d&&d.setDeformResultName(c)},this.setIsDeformResultNameChanged=function(a,c){if(null==a||void 0==a)for(var e=0;e<d.length;e++)d[e].setIsDeformResultNameChanged(c);else{var f=b.getModelByName(a);null!=f&&void 0!=f&&f.setIsDeformResultNameChanged(c)}},this.changeTexture=function(a,c,e){if(null==a||void 0==a)for(var f=0;f<d.length;f++)d[f].changeTexture(c,e);else{var g=b.getModelByName(a);null!=g&&void 0!=g&&g.changeTexture(c,e)}},this.setIsCAETransientResult=function(a,b){if(""!=a&&null!=a&&void 0!=a)for(var c=0;c<d.length;c++)d[c].setIsCAETransientResult(b)},this.setUndeformedMeshColor=function(a,c){if(null==a||void 0==a)for(var e=0;e<d.length;e++)d[e].setUndeformedMeshColor(c);else{var f=b.getModelByName(a);null!=f&&void 0!=f&&f.setUndeformedMeshColor(c)}},this.setUndeformedMeshType=function(a,c){if(null==a||void 0==a)for(var e=0;e<d.length;e++)d[e].setUndeformedMeshType(c);else{var f=b.getModelByName(a);null!=f&&void 0!=f&&f.setUndeformedMeshType(c)}},this.setShadedMeshColor=function(a,c){if(null==a||void 0==a)for(var e=0;e<d.length;e++)d[e].setShadedMeshColor(c);else{var f=b.getModelByName(a);null!=f&&void 0!=f&&f.setShadedMeshColor(c)}},this.setFeatureEdge=function(a,c,e,f,g,h){if(null==a||void 0==a)for(var i=0;i<d.length;i++)d[i].setFeatureEdge(c,e,f,g,h);else{var j=b.getModelByName(a);null!=j&&void 0!=j&&j.setFeatureEdge(c,e,f,g,h)}},this.getFrameInfo=function(a){var c=[];if(null==a||void 0==a)for(var e=0;e<d.length;e++){var f={};f.modelName=d[e].getModelName(),f.textArray=d[e].getFrameInfoArray(),c.push(f)}else{var g=b.getModelByName(a);if(null!=g&&void 0!=g){var f={};c.modelName=g.getModelName(),c.textArray=g.getFrameInfoArray(),c.push(f)}}return c},this.setAnimationReversePlay=function(a,c){if(null==a||void 0==a)for(var e=0;e<d.length;e++)d[e].setAnimationReversePlay(c);else{var f=b.getModelByName(a);null!=f&&void 0!=f&&f.setAnimationReversePlay(c)}},this.setAnimationSwing=function(a,c){if(null==a||void 0==a)for(var e=0;e<d.length;e++)d[e].setAnimationSwing(c);else{var f=b.getModelByName(a);null!=f&&void 0!=f&&f.setAnimationSwing(c)}},this.setAnimationHarmonic=function(a,c){if(null==a||void 0==a)for(var e=0;e<d.length;e++)d[e].setAnimationHarmonic(c);else{var f=b.getModelByName(a);null!=f&&void 0!=f&&f.setAnimationHarmonic(c)}},this.setTransientPivotAnimation=function(a,c){if(null==a||void 0==a)for(var e=0;e<d.length;e++)d[e].setTransientPivotAnimation(c);else{var f=b.getModelByName(a);null!=f&&void 0!=f&&f.setTransientPivotAnimation(c)}},this.getVisiblePartCount=function(a){var c=0;if(null==a||void 0==a)for(var e=0;e<d.length;e++)c+=d[e].getVisiblePartCount();else{var f=b.getModelByName(a);null!=f&&void 0!=f&&(c=f.getVisiblePartCount())}return c},this.getCAEModelCount=function(){for(var a=0,b=0;b<d.length;b++)a+=d[b].getIsCAEModel()?1:0;return a},this.updateBoundingBox=function(a){if(null==a||void 0==a)for(var c=0;c<d.length;c++)d[c].updateBoundingBox();else{var e=b.getModelByName(a);null!=e&&void 0!=e&&e.updateBoundingBox()}},this.getModels=function(){for(var a=[],b=0;b<d.length;b++)a.push(d[b].getModel());return a}},CAXViewer.Model=function(a){function b(a,c){if(a){var d=[],e=c;null==e||"undefined"==e?(e=mat4.create(),mat4.identity(e)):e=new Float32Array(c),"Transform"==a.Type&&a.transformMatrix&&mat4.multiply(e,a.transformMatrix,e);var f={};if(f.node=a,f.transform=e,d[d.length]=f,a.children)for(var g=0;g<a.children.length;g++)d=d.concat(b(a.children[g],e));return d}}function c(a){for(var c=[1e6,1e6,1e6],d=[-1e6,-1e6,-1e6],e=b(a),f=0;f<e.length;f++){var g=e[f].node,h=g.Type,i=e[f].transform;if("Shape"==h){var j=g.localMinBounding,k=g.localMaxBounding;if(i){var l=vec3.create(j),m=vec3.create(k);mat4.multiplyVec3(i,l,l),mat4.multiplyVec3(i,m,m),j=l,k=m}k[0]>d[0]&&(d[0]=k[0]),k[1]>d[1]&&(d[1]=k[1]),k[2]>d[2]&&(d[2]=k[2]),j[0]<c[0]&&(c[0]=j[0]),j[1]<c[1]&&(c[1]=j[1]),j[2]<c[2]&&(c[2]=j[2])}}var n=([d[0]-c[0],d[1]-c[1],d[2]-c[2]],[(d[0]+c[0])/2,(d[1]+c[1])/2,(d[2]+c[2])/2]);ka.center=n}function d(a){a.Header,a.CAE_Info;e(a),h(a)}function e(a){Xa=[1e6,1e6,1e6],Ya=[-1e6,-1e6,-1e6];for(var c=b(a.Scene_Root),d=0;d<c.length;d++){var e=c[d].node,h=e.Type;e.PartNumber=ya++;var i=mat4.create();if(mat4.identity(i),e.transformMatrix)for(var j=0;j<e.transformMatrix.length;j++)i[j]=e.transformMatrix[j];if(e.transformMatrix=i,"Shape"==h){f(e);var k=v(d);e.pickingColor=k,g(e)}}}function f(a){var b=a.localMinBounding,c=a.localMaxBounding;a.localCenter=[(b[0]+c[0])/2,(b[1]+c[1])/2,(b[2]+c[2])/2];var d=[b[0],b[1],b[2],c[0],b[1],b[2],c[0],c[1],b[2],b[0],c[1],b[2],b[0],b[1],c[2],c[0],b[1],c[2],c[0],c[1],c[2],b[0],c[1],c[2]];c[0]>Ya[0]&&(Ya[0]=c[0]),c[1]>Ya[1]&&(Ya[1]=c[1]),c[2]>Ya[2]&&(Ya[2]=c[2]),b[0]<Xa[0]&&(Xa[0]=b[0]),b[1]<Xa[1]&&(Xa[1]=b[1]),b[2]<Xa[2]&&(Xa[2]=b[2]);var e=[0,1,1,2,2,3,0,3,4,5,5,6,6,7,4,7,0,4,1,5,3,7,2,6],f=[];f.length=3*e.length;for(var g=0,h=0;h<e.length;h++){var i=e[h],j=d[3*i+0],k=d[3*i+1],l=d[3*i+2];f[g]=j,g++,f[g]=k,g++,f[g]=l,g++}var m=ma.createBuffer();ma.bindBuffer(ma.ARRAY_BUFFER,m),ma.bufferData(ma.ARRAY_BUFFER,new Float32Array(f),ma.STATIC_DRAW),a["bounding-box-geom"]=m;for(var n=[],h=0;h<f.length/3;h++)n[2*h+0]=.06,n[2*h+1]=.5;if(n&&n.length>0){var o=ma.createBuffer();ma.bindBuffer(ma.ARRAY_BUFFER,o),ma.bufferData(ma.ARRAY_BUFFER,new Float32Array(n),ma.STATIC_DRAW),a["bounding-box-Texcoords"]=o}var p=[0,1,2,2,3,0,0,3,4,3,7,4,0,4,5,0,5,1,1,6,5,1,2,6,7,4,5,7,5,6,7,3,6,3,6,2],q=[];q.length=3*p.length,g=0;for(var h=0;h<p.length;h++){var i=p[h],j=d[3*i+0],k=d[3*i+1],l=d[3*i+2];q[g]=j,g++,q[g]=k,g++,q[g]=l,g++}var r=ma.createBuffer();ma.bindBuffer(ma.ARRAY_BUFFER,r),ma.bufferData(ma.ARRAY_BUFFER,new Float32Array(q),ma.STATIC_DRAW),a["bounding-box-geom-triangles"]=r}function g(a){a.displaymode=0,a.usetexture=a.Appearance.UseTexture,a.visible=1;var b=a.Appearance.Material,c=new Array(1,1,1),d=new Array(.2,.2,.2),e=new Array(.5,.5,.5),f=new Array(0,0,0),g=128,h=.5,i=.5;b.diffuseColor&&(c=new Array(b.diffuseColor[0],b.diffuseColor[1],b.diffuseColor[2])),b.specularColor&&(d=new Array(b.specularColor[0],b.specularColor[1],b.specularColor[2])),b.ambientColor&&(e=new Array(b.ambientColor[0],b.ambientColor[1],b.ambientColor[2])),b.emissiveColor&&(f=new Array(b.emissiveColor[0],b.emissiveColor[1],b.emissiveColor[2])),b.shininess&&(g=b.shininess),b.transparency&&(h=b.transparency),b.ambientIntensity&&(i=b.ambientIntensity),e=f,b.diffuseColor=c,b.specularColor=d,b.ambientColor=e,b.emissiveColor=f,b.shininess=g,b.transparency=h,b.ambientIntensity=i}function h(a){var b=a.CAE_Info;if(null!=b&&void 0!=b){Ta=b.Result_Name,Ua=b.Instance,Va=b.Derived,bb=b.PixelTextureHeight;var c=b.PixelTextureWidth,d=b.PixelTexture;if(null!=d&&0!=d.length){for(var e=j(c,bb,3,d.slice(0)),f=[],g=b.PixelTexture.length-1;g>=0;g-=3)f=f.concat(b.PixelTexture[g-2]),f=f.concat(b.PixelTexture[g-1]),f=f.concat(b.PixelTexture[g]);var h=j(c,bb,3,f.slice(0));b.texture=e,b.orginaltexture=e,b.reversetexture=h}b.AttribList&&i(b.AttribList);for(var k=b.Colour_Array,l=[],g=0;g<k.length/3;g++){var m=[k[3*g+0],k[3*g+1],k[3*g+2]];l[g]=m}b.Colour_Array=l;var n=b.Colour_Array,o=b.Discrete_Color,p=b.Range_Min,q=b.Range_Max,r=3,s=ua.getLegendPosition();s.colorArray=n,s.rangeMax=q,s.rangeMin=p,s.precisionValue=r,s.discreteMode=o,s.textArray[0]=na,s.textArray[1]=Ta+" : "+Va,s.textArray[2]=Ua,""!=Ta&&(ua.addLegend(na,s),ua.drawLegend())}}function i(a){gb=a}function j(a,b,c,d){var e=ma.RGBA;3==c&&(e=ma.RGB);var f=new Array;f.length=d.length;for(var g=0;g<d.length;g++)d[g]=255*d[g];var h=ma.createTexture();return ma.bindTexture(ma.TEXTURE_2D,h),ma.texImage2D(ma.TEXTURE_2D,0,e,a,b,0,e,ma.UNSIGNED_BYTE,new Uint8Array(d)),ma.texParameteri(ma.TEXTURE_2D,ma.TEXTURE_MAG_FILTER,ma.NEAREST),ma.texParameteri(ma.TEXTURE_2D,ma.TEXTURE_MIN_FILTER,ma.NEAREST),ma.texParameteri(ma.TEXTURE_2D,ma.TEXTURE_WRAP_S,ma.CLAMP_TO_EDGE),ma.texParameteri(ma.TEXTURE_2D,ma.TEXTURE_WRAP_T,ma.CLAMP_TO_EDGE),ma.bindTexture(ma.TEXTURE_2D,null),h}function k(b){if(0!=b.hasOwnProperty("key")&&null!=b.key){if(ra){var c={};c.name=b.Name,c.key=b.key,c.compressionRequired=xa;var d={Operation:CAXViewer.serverOperations.getVerticesAsUShort,Data:JSON.stringify(c)};result=ra.send(JSON.stringify(d),function(a){l(a,b)}),d={Operation:CAXViewer.serverOperations.getNormalAsByte,Data:JSON.stringify(c)},result=ra.send(JSON.stringify(d),function(a){o(a,b)}),d={Operation:CAXViewer.serverOperations.getTextureAsByte,Data:JSON.stringify(c)},result=ra.send(JSON.stringify(d),function(a){p(a,b)})}if(null==ta&&(ta=a.getMCAXloader()),0==a.getUseStreaming()){var c={};c.name=b.Name,c.key=b.key;var e=ta.getBoundingBoxMinMaX(c,na),f=ta.getPartVertices(c,na);l(f,b,e),f=null,f=ta.getPartNormal(c,na),o(f,b),f=ta.getPartTexture(c,na),p(f,b)}}}function l(b,c,d){var e="";if(5==b.byteLength&&(e=sa.convertArrayBuffertoString(b)),"Error"!=e){if(1==xa)var f=va.decompression_Zlib(b),g=new Uint16Array(f);else var g=new Uint16Array(b);var h=1,i=1,j=1;if(null==d||"undefined"==d)var k=parseFloat(c.localMaxBounding[0]),l=parseFloat(c.localMinBounding[0]),m=parseFloat(c.localMaxBounding[1]),o=parseFloat(c.localMinBounding[1]),p=parseFloat(c.localMaxBounding[2]),q=parseFloat(c.localMinBounding[2]);else{var k=parseFloat(d.MaxBounding[0]),l=parseFloat(d.MinBounding[0]),m=parseFloat(d.MaxBounding[1]),o=parseFloat(d.MinBounding[1]),p=parseFloat(d.MaxBounding[2]),q=parseFloat(d.MinBounding[2]);c.TempMaxBounding=[],c.TempMinBounding=[],c.TempMaxBounding[0]=k,c.TempMinBounding[0]=l,c.TempMaxBounding[1]=m,c.TempMinBounding[1]=o,c.TempMaxBounding[2]=p,c.TempMinBounding[2]=q}k-l!=0?h=65535/parseFloat(k-l):0!=k&&(h=65535/k),m-o!=0?i=65535/parseFloat(m-o):0!=m&&(i=65535/m),p-q!=0?j=65535/parseFloat(p-q):0!=p&&(j=65535/p);for(var r=new Float32Array(g.length),s=0;s<g.length;s+=3)r[s]=g[s]/h+l,r[s+1]=g[s+1]/i+o,r[s+2]=g[s+2]/j+q;g=null,c.geometry||(c.geometry={});var t=c.geometry;if(t.point&&u(c,t.point,r),t.point=r,r&&r.length>0){if(null==t.triangle_buffer||"undefined"==t.triangle_buffer)var v=ma.createBuffer();else var v=t.triangle_buffer;t.vertexCount=r.length/3,ma.bindBuffer(ma.ARRAY_BUFFER,v),ma.bufferData(ma.ARRAY_BUFFER,r,ma.STATIC_DRAW),t.triangle_buffer=v}if(Ba[0]=Ba[0]+b.byteLength,c.HasValidMainIndexData){var w="UInt";if(r.length<=65535)var w="UShort";var x={};if(x.name=c.Name,x.key=c.key,x.type=w,ra&&(Data={Operation:CAXViewer.serverOperations.getMeshIndex,Data:JSON.stringify(x)},result=ra.send(JSON.stringify(Data),function(a){n(a,c,w)})),0==a.getUseStreaming()){w="UInt";var b=ta.getMeshIndex(x,na);n(b,c,w),b=null}}r=null}else{c.geometry||(c.geometry={});var t=c.geometry;t.vertexCount=0,t.triangle_buffer&&ma.deleteBuffer(t.triangle_buffer),t.triangle_buffer=null}e=null}function m(a,b,c,d){var e="";if(5==c.byteLength&&(e=sa.convertArrayBuffertoString(c)),"Error"!=e){if(1==xa)var f=va.decompression_Zlib(c),g=new Uint16Array(f);else var g=new Uint16Array(c);var h=1,i=1,j=1;a.TempMaxBounding=[],a.TempMinBounding=[],a.TempMaxBounding[0]=parseFloat(d.MaxBounding[0])-parseFloat(a.localMaxBounding[0]),a.TempMinBounding[0]=parseFloat(d.MinBounding[0])-parseFloat(a.localMinBounding[0]),a.TempMaxBounding[1]=parseFloat(d.MaxBounding[1])-parseFloat(a.localMaxBounding[1]),a.TempMinBounding[1]=parseFloat(d.MinBounding[1])-parseFloat(a.localMinBounding[1]),a.TempMaxBounding[2]=parseFloat(d.MaxBounding[2])-parseFloat(a.localMaxBounding[2]),a.TempMinBounding[2]=parseFloat(d.MinBounding[2])-parseFloat(a.localMinBounding[2]);var k=parseFloat(b.MaxBounding[0]),l=parseFloat(b.MinBounding[0]),m=parseFloat(b.MaxBounding[1]),n=parseFloat(b.MinBounding[1]),o=parseFloat(b.MaxBounding[2]),p=parseFloat(b.MinBounding[2]);k-l!=0?h=65535/parseFloat(k-l):0!=k&&(h=65535/k),m-n!=0?i=65535/parseFloat(m-n):0!=m&&(i=65535/m),o-p!=0?j=65535/parseFloat(o-p):0!=o&&(j=65535/o);for(var q=new Float32Array(g.length),r=0;r<g.length;r+=3)q[r]=g[r]/h+l,q[r+1]=g[r+1]/i+n,q[r+2]=g[r+2]/j+p;g=null,a.geometry||(a.geometry={});var s=a.geometry;if(s.point&&u(a,s.point,q),q&&q.length>0){if(null==s.triangle_buffer||"undefined"==s.triangle_buffer)var t=ma.createBuffer();else var t=s.triangle_buffer;s.vertexCount=q.length/3,ma.bindBuffer(ma.ARRAY_BUFFER,t),ma.bufferData(ma.ARRAY_BUFFER,q,ma.STATIC_DRAW),s.triangle_buffer=t}q=null}else{a.geometry||(a.geometry={});var s=a.geometry;s.triangle_buffer&&ma.deleteBuffer(s.triangle_buffer),s.triangle_buffer=null;var q=new Float32Array;if(s.point)var q=new Float32Array(s.point.length);s.point&&u(a,s.point,q),g=null,q=null}e=null}function n(a,b,c){"undefined"!=c&&null!=c||(c="UInt");var d="";if(5==a.byteLength&&(d=sa.convertArrayBuffertoString(a)),"Error"!=d){if("UShort"==c)var e=new Uint16Array(a);else var e=new Uint32Array(a);a=null;var f=b.geometry,g=ma.getExtension("OES_element_index_uint");if("UShort"==c||g||(alert("Extension OES_element_index_uint not exist"),CAXViewer.log("Extension OES_element_index_uint not exist")),f.MESH_INDEX=e,f.MESH_INDEX_COUNT=e.length,f.point&&u(b,f.point,null),e){if(null==f.MESH_INDEX_BUFFER||"undefined"==f.MESH_INDEX_BUFFER)var h=ma.createBuffer();else var h=f.MESH_INDEX_BUFFER;ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,h),g?ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint32Array(e),ma.STATIC_DRAW):ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),ma.STATIC_DRAW),f.MESH_INDEX_BUFFER=h}h=null,e=null,s(b)}d=null}function o(a,b){var c="";if(5==a.byteLength&&(c=sa.convertArrayBuffertoString(a)),"Error"!=c){if(1==xa)var d=va.decompression_Zlib(a),e=new Int8Array(d);else var e=new Int8Array(a);for(var f=new Float32Array(e.length),g=0;g<e.length;g++)f[g]=e[g]/127;b.geometry||(b.geometry={});var h=b.geometry;if(h.Normal=f,f&&f.length>0){if(null==h.normal_buffer||"undefined"==h.normal_buffer)var i=ma.createBuffer();else var i=h.normal_buffer;ma.bindBuffer(ma.ARRAY_BUFFER,i),ma.bufferData(ma.ARRAY_BUFFER,f,ma.STATIC_DRAW),h.normal_buffer=i}f=null,Ba[1]=Ba[1]+a.byteLength}}function p(b,c,d){var e="";if(5==b.byteLength&&(e=sa.convertArrayBuffertoString(b)),"Error"!=e){if(1==xa)var f=va.decompression_Zlib(b),g=new Uint8Array(f);else var g=new Uint8Array(b);c.geometry||(c.geometry={});var h=c.geometry,i=new Float32Array(2*g.length);if(g&&1==bb){for(var j=0;j<g.length;j++)i[2*j+0]=g[j]/255,i[2*j+1]=.5;h.TexCoord=i}if(i&&i.length>0){if(null==h.texcoords_buffer||"undefined"==h.texcoords_buffer)var k=ma.createBuffer();else var k=h.texcoords_buffer;ma.bindBuffer(ma.ARRAY_BUFFER,k),ma.bufferData(ma.ARRAY_BUFFER,i,ma.STATIC_DRAW),h.texcoords_buffer=k}if(i=null,1==d)return}if("Error"!=e||"undefined"!=la.CAE_Info){if(c.geometry||(c.geometry={}),null!=c.geometry.line_count&&"undefined"!=c.geometry.line_count||("1"!=c.GeometryType&&"2"!=c.GeometryType&&"3"!=c.GeometryType||s(c),"4"==c.GeometryType&&q(c),t(c)),1==d)return;if(Aa+=1,Ba[2]=Ba[2]+b.byteLength,qa=Date.now(),CAXViewer.log(c.Name+" download time is "+(qa-pa)+" ms"),Aa<za){var l=Aa/za*100;a.updateStatus(l.toFixed(2)+"% completed.")}else{a.clearStatus(),CAXViewer.log("Total Number of parts : "+Aa),CAXViewer.log("Vertices Size : "+Ba[0]+" Bytes"),CAXViewer.log("Normals Size : "+Ba[1]+" Bytes"),CAXViewer.log("Texture coods Size : "+Ba[2]+" Bytes");var m=(Ba[0]+Ba[1]+Ba[2])/1024;CAXViewer.log("Total Size : "+m.toFixed(2)+" KB"),CAXViewer.log("Total Time to Load is : "+(qa-pa)+" ms")}}}function q(b){var c="UInt";if(b.geometry.point.length<=65535)var c="UShort";var d={};if(d.name=b.Name,d.key=b.key,d.type=c,ra&&(Data={Operation:CAXViewer.serverOperations.getPolygonWireFrameIndex,Data:JSON.stringify(d)},result=ra.send(JSON.stringify(Data),function(a){r(a,b,c)})),0==a.getUseStreaming()){var e=ta.getPartPolygonWireFrameIndex(d,na);c="UInt",r(e,b,c)}}function r(a,b,c){if("undefined"!=c&&null!=c||(c="UInt"),"UShort"==c)var d=new Uint16Array(a);else var d=new Uint32Array(a);var e="";if(5==a.byteLength&&(e=sa.convertArrayBuffertoString(a)),"Error"!=e){var f=b.geometry,g=f.point,h=f.Normal;if(f.line_count=d.length/2,(null==f.UNDEFORMED_MESHBUFFER||"undefined"==f.UNDEFORMED_MESHBUFFER)&&g){if(f.UNDEFORMED_MESH_COUNT=d.length/2,null==f.UNDEFORMED_MESHBUFFER||"undefined"==f.UNDEFORMED_MESHBUFFER)var i=ma.createBuffer();else var i=f.UNDEFORMED_MESHBUFFER;ma.bindBuffer(ma.ARRAY_BUFFER,i),ma.bufferData(ma.ARRAY_BUFFER,g,ma.STATIC_DRAW),f.UNDEFORMED_MESHBUFFER=i}if((null==f.UNDEFORMED_NORMALBUFFER||"undefined"==f.UNDEFORMED_NORMALBUFFER)&&h){if(null==f.UNDEFORMED_NORMALBUFFER||"undefined"==f.UNDEFORMED_NORMALBUFFER)var i=ma.createBuffer();else var i=f.UNDEFORMED_NORMALBUFFER;ma.bindBuffer(ma.ARRAY_BUFFER,i),ma.bufferData(ma.ARRAY_BUFFER,h,ma.STATIC_DRAW),f.UNDEFORMED_NORMALBUFFER=i}var j=ma.getExtension("OES_element_index_uint");if("UShort"==c||j||(alert("Extension OES_element_index_uint not exist"),CAXViewer.log("Extension OES_element_index_uint not exist")),d){if(null==f.line_connectivity_buffer||"undefined"==f.line_connectivity_buffer)var k=ma.createBuffer();else var k=f.line_connectivity_buffer;if(ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,k),j?ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,d,ma.STATIC_DRAW):ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,d,ma.STATIC_DRAW),f.line_connectivity_buffer=k,null==f.UNDEFORM_MESH_INDEX_BUFFER||"undefined"==f.UNDEFORM_MESH_INDEX_BUFFER){var l=ma.createBuffer();ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,l),j?ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,d,ma.STATIC_DRAW):ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,d,ma.STATIC_DRAW),f.UNDEFORM_MESH_INDEX_BUFFER=l}}}}function s(a){if(1==a.HasValidMainIndexData){var b=a.geometry,c=b.point,d=b.vertexCount,e=b.Normal,f=b.MESH_INDEX,g=b.MESH_INDEX_COUNT;if("undefined"==f||null==f||"undefined"==g||null==g)return;var h=0,i=g/3,j=new Array(6*i);for(h=0;h<i;h++){var k=3*h,l=6*h;j[l+0]=f[k+0],j[l+1]=f[k+1],j[l+2]=f[k+1],j[l+3]=f[k+2],
j[l+4]=f[k+2],j[l+5]=f[k+0]}if(b.line_count=3*i,(null==b.UNDEFORMED_MESHBUFFER||"undefined"==b.UNDEFORMED_MESHBUFFER)&&c){if(b.UNDEFORMED_MESH_COUNT=d,null==b.UNDEFORMED_MESHBUFFER||"undefined"==b.UNDEFORMED_MESHBUFFER)var m=ma.createBuffer();else var m=b.UNDEFORMED_MESHBUFFER;ma.bindBuffer(ma.ARRAY_BUFFER,m),ma.bufferData(ma.ARRAY_BUFFER,c,ma.STATIC_DRAW),b.UNDEFORMED_MESHBUFFER=m,m=null}if((null==b.UNDEFORMED_NORMALBUFFER||"undefined"==b.UNDEFORMED_NORMALBUFFER)&&e){if(null==b.UNDEFORMED_NORMALBUFFER||"undefined"==b.UNDEFORMED_NORMALBUFFER)var m=ma.createBuffer();else var m=b.UNDEFORMED_NORMALBUFFER;ma.bindBuffer(ma.ARRAY_BUFFER,m),ma.bufferData(ma.ARRAY_BUFFER,e,ma.STATIC_DRAW),b.UNDEFORMED_NORMALBUFFER=m,m=null}var n=ma.getExtension("OES_element_index_uint");if(d>65535&&!n&&(alert("Extension OES_element_index_uint not exist"),CAXViewer.log("Extension OES_element_index_uint not exist")),j){if(null==b.line_connectivity_buffer||"undefined"==b.line_connectivity_buffer)var o=ma.createBuffer();else var o=b.line_connectivity_buffer;if(ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,o),n?ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint32Array(j),ma.STATIC_DRAW):ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint16Array(j),ma.STATIC_DRAW),b.line_connectivity_buffer=o,o=null,null==b.UNDEFORM_MESH_INDEX_BUFFER||"undefined"==b.UNDEFORM_MESH_INDEX_BUFFER){var p=ma.createBuffer();ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,p),n?ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint32Array(j),ma.STATIC_DRAW):ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint16Array(j),ma.STATIC_DRAW),b.UNDEFORM_MESH_INDEX_BUFFER=p,p=null}}c=null,d=null,e=null,f=null,g=null,j=null}else{var b=a.geometry,c=b.point,d=b.vertexCount,e=b.Normal,h=0,i=d/3,j=new Array(6*i);for(h=0;h<i;h++){var k=3*h,l=6*h;j[l+0]=k+0,j[l+1]=k+1,j[l+2]=k+1,j[l+3]=k+2,j[l+4]=k+2,j[l+5]=k+0}if(b.line_count=d,(null==b.UNDEFORMED_MESHBUFFER||"undefined"==b.UNDEFORMED_MESHBUFFER)&&c){if(b.UNDEFORMED_MESH_COUNT=d,null==b.UNDEFORMED_MESHBUFFER||"undefined"==b.UNDEFORMED_MESHBUFFER)var m=ma.createBuffer();else var m=b.UNDEFORMED_MESHBUFFER;ma.bindBuffer(ma.ARRAY_BUFFER,m),ma.bufferData(ma.ARRAY_BUFFER,c,ma.STATIC_DRAW),b.UNDEFORMED_MESHBUFFER=m}if((null==b.UNDEFORMED_NORMALBUFFER||"undefined"==b.UNDEFORMED_NORMALBUFFER)&&e){if(null==b.UNDEFORMED_NORMALBUFFER||"undefined"==b.UNDEFORMED_NORMALBUFFER)var m=ma.createBuffer();else var m=b.UNDEFORMED_NORMALBUFFER;ma.bindBuffer(ma.ARRAY_BUFFER,m),ma.bufferData(ma.ARRAY_BUFFER,e,ma.STATIC_DRAW),b.UNDEFORMED_NORMALBUFFER=m}var n=ma.getExtension("OES_element_index_uint");if(d>65535&&!n&&(alert("Extension OES_element_index_uint not exist"),CAXViewer.log("Extension OES_element_index_uint not exist")),j){if(null==b.line_connectivity_buffer||"undefined"==b.line_connectivity_buffer)var o=ma.createBuffer();else var o=b.line_connectivity_buffer;if(ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,o),n?ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint32Array(j),ma.STATIC_DRAW):ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint16Array(j),ma.STATIC_DRAW),b.line_connectivity_buffer=o,null==b.UNDEFORM_MESH_INDEX_BUFFER||"undefined"==b.UNDEFORM_MESH_INDEX_BUFFER){var p=ma.createBuffer();ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,p),n?ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint32Array(j),ma.STATIC_DRAW):ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint16Array(j),ma.STATIC_DRAW),b.UNDEFORM_MESH_INDEX_BUFFER=p}}c=null,d=null,e=null,j=null}}function t(a){var b=a.geometry,c=b.point;if(null!=c&&void 0!=c&&"1"!=a.GeometryType&&"2"!=a.GeometryType){var d=F(a.Name,hb,c,c.length/3/3,ib);if(b.UNDEFORMED_MESH_FEATUREEDGECOUNT=d.length/2,b.UNDEFORMED_MESH_TRANSPARENTCOUNT=c.length/3,d=new Uint32Array(d)){if(null==b.UNDEFORMED_MESH_FEATUREEDGEBUFFER||"undefined"==b.UNDEFORMED_MESH_FEATUREEDGEBUFFER)var e=ma.createBuffer();else var e=b.UNDEFORMED_MESH_FEATUREEDGEBUFFER;ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,e);var f=ma.getExtension("OES_element_index_uint");f?ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint32Array(d),ma.STATIC_DRAW):ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint16Array(d),ma.STATIC_DRAW),b.UNDEFORMED_MESH_FEATUREEDGEBUFFER=e}}}function u(b,c,d){if((1==Ka||!Sa)&&"1"!=b.GeometryType&&"2"!=b.GeometryType){var e=b.geometry,f=[],g=[];if(Sa){if(!e||c.length!=d.length)return;if(f=new Float32Array(c.length),a.getFileVersion()<=2)for(var h=0;h<c.length;h+=3)f[h]=c[h]+(d[h]-c[h])*Fb[0],f[h+1]=c[h+1]+(d[h+1]-c[h+1])*Fb[1],f[h+2]=c[h+2]+(d[h+2]-c[h+2])*Fb[2];else for(var h=0;h<c.length;h+=3)f[h]=c[h]+d[h]*Fb[0],f[h+1]=c[h+1]+d[h+1]*Fb[1],f[h+2]=c[h+2]+d[h+2]*Fb[2];g=F(b.Name,Oa,f,f.length/3/3,ib)}else{var i=e.MESH_INDEX;if(!e||!c||!i)return;f=c,g=G(b.Name,Oa,f,i,ib)}if(e.FEATUREEDGECOUNT=g.length/2,g=new Uint32Array(g)){if(null==e.FEATUREEDGEBUFFER||"undefined"==e.FEATUREEDGEBUFFER)var j=ma.createBuffer();else var j=e.FEATUREEDGEBUFFER;ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,j);var k=ma.getExtension("OES_element_index_uint");k?ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint32Array(g),ma.STATIC_DRAW):ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint16Array(g),ma.STATIC_DRAW),e.FEATUREEDGEBUFFER=j}}}function v(a){return[parseInt(a/256/256)%256,parseInt(a/256)%256,a%256]}function w(b,c,d,e,f,g,h){var i=ka.getupdatedBoundingBox(),j=sa.findDistance(i.min,i.max);c.setSectionEdgeThickness(j/500);for(var k=b.length-1;k>=0;k--){var l=b[k].node;if("Shape"==l.Type&&(1==l.visible||0!=La)){var m=l.displaymode;if(4!=m&&1==h)return;var n="0"==l.usetexture?0:1;null==e&&(n=0),f&&(m=0);var o=l.pickingColor,p=null,q=0;l.Appearance&&(p=l.Appearance.Material),p?(c.setDiffuseColor(p.diffuseColor),c.setAmbientColor(p.ambientColor),c.setSpecularColor(p.specularColor),c.setEmissiveColor(p.emissiveColor),c.setShininess(p.shininess),c.setAmbientIntensity(p.ambientIntensity),q=p.transparency):(c.setDiffuseColor([1,1,1]),c.setAmbientColor([.5,.5,.5]),c.setSpecularColor([.2,.2,.2]),c.setEmissiveColor([0,0,0]),c.setShininess(128),c.setAmbientIntensity(.5)),ma.lineWidth(1);var r=b[k].transform,s=mat4.create(g);mat4.multiply(s,r,s);var t=mat4.create(s);if(t=mat4.inverse(t),t=mat4.transpose(t),c.setInverseMVMatrix(t),l.supplementalTranslation||l.supplementalRotation||l.supplementalRotation_pick){if(l.supplementalTranslation){var u=mat4.create();mat4.identity(u);var v=l.supplementalTranslation;mat4.translate(u,v),s=mat4.create(g),mat4.multiply(s,r,s),mat4.multiply(s,u,s)}if(l.supplementalRotation_pick){var w=mat4.create();mat4.identity(w),w=l.supplementalRotation_pick;var x=mat4.create();mat4.identity(x),mat4.translate(x,[-l.localCenter[0],-l.localCenter[1],-l.localCenter[2]]);var y=mat4.create();mat4.identity(y),mat4.translate(y,[l.localCenter[0],l.localCenter[1],l.localCenter[2]]);var z=mat4.create();mat4.identity(z),mat4.multiply(z,w,z),mat4.multiply(s,z,s)}if(l.supplementalRotation){var w=mat4.create();mat4.identity(w),w=l.supplementalRotation;var x=mat4.create();mat4.identity(x),mat4.translate(x,[-l.localCenter[0],-l.localCenter[1],-l.localCenter[2]]);var y=mat4.create();mat4.identity(y),mat4.translate(y,[l.localCenter[0],l.localCenter[1],l.localCenter[2]]);var z=mat4.create();mat4.identity(z),mat4.multiply(z,y,z),mat4.multiply(z,w,z),mat4.multiply(z,x,z),mat4.multiply(s,z,s)}}var A=l.geometry,B=!1;if("undefined"!=A&&null!=A&&0==jQuery.isEmptyObject(A)){c.disableNormal(),c.disableUV(),c.disableRealResult(),c.disableImaginaryResult(),c.disableTargetFrame(),c.disableNormalTargetFrame(),c.disableUVtargetFrame();var C=A.vertexCount;if(a.getFileVersion()>2&&A.verticesCountV3&&null==A.triangle_buffer&&(C=A.verticesCountV3),C<=0)continue;A.UNDEFORMED_MESHBUFFER?(ma.bindBuffer(ma.ARRAY_BUFFER,A.UNDEFORMED_MESHBUFFER),c.setPositionAttrib()):A.triangle_buffer&&(ma.bindBuffer(ma.ARRAY_BUFFER,A.triangle_buffer),c.setPositionAttrib()),A.UNDEFORMED_NORMALBUFFER?(c.enableNormal(),ma.bindBuffer(ma.ARRAY_BUFFER,A.UNDEFORMED_NORMALBUFFER),c.setNormalAttrib()):A.normal_buffer&&(c.enableNormal(),ma.bindBuffer(ma.ARRAY_BUFFER,A.normal_buffer),c.setNormalAttrib()),A.triangle_buffer&&(c.enableTargetFrame(),ma.bindBuffer(ma.ARRAY_BUFFER,A.triangle_buffer),c.set_targetFrame()),A.normal_buffer&&(c.enableNormalTargetFrame(),ma.bindBuffer(ma.ARRAY_BUFFER,A.normal_buffer),c.set_NormaltargetFrame()),n&&(null!=A.texcoords_buffer&&void 0!=A.texcoords_buffer?(c.enableUV(),ma.bindBuffer(ma.ARRAY_BUFFER,A.texcoords_buffer),c.setUVAttrib()):n=0),e&&(ma.bindTexture(ma.TEXTURE_2D,e),c.setCaeTexture(0));var D=null;A.line_connectivity_buffer&&(D=A.line_connectivity_buffer);var E=0;if(A.line_count&&(E=A.line_count),la.CAE_Info){var F=la.CAE_Info.Colour_Array.length;c.set_UVminoffset(1/(F+2)*(mb+1))}if(1==ob){if(c.set_frameFactor(Bb),A.UNDEFORMED_MESHBUFFER&&(ma.bindBuffer(ma.ARRAY_BUFFER,A.UNDEFORMED_MESHBUFFER),c.setPositionAttrib()),A.UNDEFORMED_NORMALBUFFER&&(c.enableNormal(),ma.bindBuffer(ma.ARRAY_BUFFER,A.UNDEFORMED_NORMALBUFFER),c.setNormalAttrib()),Qb==CAXViewer.CAEAnimationType.LINEAR||Qb==CAXViewer.CAEAnimationType.EIGEN_VECTOR)c.set_IsAnimationOn(1),c.setScaleFactor(Fb),A.targetFrame_buffer&&(c.enableTargetFrame(),ma.bindBuffer(ma.ARRAY_BUFFER,A.targetFrame_buffer),c.set_targetFrame()),A.targetFrameNormal_buffer&&(c.enableNormalTargetFrame(),ma.bindBuffer(ma.ARRAY_BUFFER,A.targetFrameNormal_buffer),c.set_NormaltargetFrame());else if(Qb==CAXViewer.CAEAnimationType.EIGEN_VECTOR_COMPLEX){c.set_IsAnimationOn(2),c.setScaleFactor(Fb),c.disableTargetFrame(),c.disableNormalTargetFrame();var G=l.Result;G&&G.realResult_buffer&&(c.enableRealResult(),ma.bindBuffer(ma.ARRAY_BUFFER,G.realResult_buffer),c.set_RealResult()),G&&G.imaginaryResult_buffer&&(c.enableImaginaryResult(),ma.bindBuffer(ma.ARRAY_BUFFER,G.imaginaryResult_buffer),c.set_ImaginaryResult())}else if(Qb==CAXViewer.CAEAnimationType.TRANSIENT&&(c.set_IsAnimationOn(3),c.setScaleFactor(Fb),db&&c.setTransientPivotVector(eb),l.instances)){if(!l.instances[Ab]){C=0;continue}if(l.instances[Ab].vertexCount&&(C=l.instances[Ab].vertexCount),l.instances[Ab].triangle_buffer){var H=l.instances[Ab].triangle_buffer;c.enableTargetFrame(),ma.bindBuffer(ma.ARRAY_BUFFER,H),c.set_targetFrame()}if(l.instances[Ab].normal_buffer&&(c.enableNormalTargetFrame(),ma.bindBuffer(ma.ARRAY_BUFFER,l.instances[Ab].normal_buffer),c.set_NormaltargetFrame()),l.instances[Ab].texcoords_buffer){var I=l.instances[Ab].texcoords_buffer;c.enableUV(),ma.bindBuffer(ma.ARRAY_BUFFER,I),c.setUVAttrib(),ma.bindTexture(ma.TEXTURE_2D,e),c.setCaeTexture(0)}1==Ea&&(l.instances[Ab].vertexCount||(C=l.undeformInstances[Ab].vertexCount),a.getFileVersion()<=2?(l.instances[Ab].triangle_buffer&&(ma.bindBuffer(ma.ARRAY_BUFFER,l.instances[Ab].triangle_buffer),c.setPositionAttrib()),l.instances[Ab].normal_buffer&&(c.enableNormal(),ma.bindBuffer(ma.ARRAY_BUFFER,l.instances[Ab].normal_buffer),c.setNormalAttrib())):(l.undeformInstances[Ab].triangle_buffer&&(ma.bindBuffer(ma.ARRAY_BUFFER,l.undeformInstances[Ab].triangle_buffer),c.setPositionAttrib()),l.undeformInstances[Ab].normal_buffer&&(c.enableNormal(),ma.bindBuffer(ma.ARRAY_BUFFER,l.undeformInstances[Ab].normal_buffer),c.setNormalAttrib()),l.undeformInstances[Ab].UNDEFORM_MESH_INDEX_BUFFER&&l.undeformInstances[Ab].UNDEFORMED_MESH_COUNT&&(D=l.undeformInstances[Ab].UNDEFORM_MESH_INDEX_BUFFER,E=l.undeformInstances[Ab].UNDEFORMED_MESH_COUNT)))}}else if(c.disableRealResult(),c.disableImaginaryResult(),c.disableUVtargetFrame(),c.set_IsAnimationOn(0),c.set_frameFactor(0),c.setScaleFactor(Fb),0==Ca&&c.set_IsAnimationOn(30),Qb==CAXViewer.CAEAnimationType.EIGEN_VECTOR_COMPLEX){1==Ca?c.setScaleFactor(Fb):c.setScaleFactor([1,1,1]);var J=.01745329252*Hb;c.set_frameFactor(J),c.disableTargetFrame(),c.disableNormalTargetFrame();var G=l.Result;G&&G.realResult_buffer&&(c.enableRealResult(),ma.bindBuffer(ma.ARRAY_BUFFER,G.realResult_buffer),c.set_RealResult()),G&&G.imaginaryResult_buffer&&(c.enableImaginaryResult(),ma.bindBuffer(ma.ARRAY_BUFFER,G.imaginaryResult_buffer),c.set_ImaginaryResult()),G&&G.realResult_buffer&&G.imaginaryResult_buffer?c.set_IsAnimationOn(2):c.set_IsAnimationOn(30)}if(c.setUseLighting(1),c.setUseTexture(n),ma.disable(ma.BLEND),null!=l.transparent&&"undefined"!=l.transparent||1!=q)if(1==l.transparent){var K=.5;c.setUseTransparency(1),c.setTransparency(K),ma.depthMask(!1),ma.enable(ma.BLEND),ma.blendFunc(ma.SRC_ALPHA,ma.ONE_MINUS_SRC_ALPHA)}else 1!=q?(c.setUseTransparency(1),c.setTransparency(q),ma.depthMask(!1),ma.enable(ma.BLEND),ma.blendFunc(ma.SRC_ALPHA,ma.ONE_MINUS_SRC_ALPHA)):(c.setUseTransparency(0),ma.disable(ma.BLEND),ma.depthMask(!0));else c.setUseTransparency(0);null==l.selected?c.setIsSelected(0):c.setIsSelected(l.selected),c.setUniformModelviewMatrix(s);var d=mat4.create(s);if(d=mat4.inverse(d),d=mat4.transpose(d),c.setUniformNormalMatrix(d),c.setPickColor([o[0]/255,o[1]/255,o[2]/255]),1==l.visible||1==l.visible){if(c.setClipEdgeColor(cb),0==l.HasValidMainIndexData)if("1"==l.GeometryType)1!=h&&(c.setUseTransparency(0),c.setTransparency(1),ma.disable(ma.BLEND),ma.depthMask(!0),c.disableNormal(),c.disableNormalTargetFrame(),c.setUseLighting(0),ma.drawArrays(ma.POINTS,0,C));else if("2"==l.GeometryType)1!=h&&(c.setUseTransparency(0),c.setTransparency(1),ma.disable(ma.BLEND),ma.depthMask(!0),c.disableNormal(),c.disableNormalTargetFrame(),c.setUseLighting(0),3==m?ma.drawArrays(ma.POINTS,0,C):ma.drawArrays(ma.LINES,0,C));else{if(0==m&&ma.drawArrays(ma.TRIANGLES,0,C),1==m&&(ma.enable(ma.POLYGON_OFFSET_FILL),ma.polygonOffset(1,1),ma.drawArrays(ma.TRIANGLES,0,C),ma.disable(ma.POLYGON_OFFSET_FILL),c.disableUV(),c.setUseLighting(0),0==Ea||1==Ea&&1==Fa)){if(c.setUsecolor(2),c.setUserColor(Pa),null!=D&&"undefined"!=D&&E>0){ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,D);var L=ma.getExtension("OES_element_index_uint");L?ma.drawElements(ma.LINES,2*E,ma.UNSIGNED_INT,0):ma.drawElements(ma.LINES,2*E,ma.UNSIGNED_SHORT,0)}c.setUsecolor(0)}if(2==m)if(c.setUseLighting(0),0==Ea||1==Ea&&1==Fa){if(null!=D&&"undefined"!=D&&E>0){ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,D);var L=ma.getExtension("OES_element_index_uint");L?ma.drawElements(ma.LINES,2*E,ma.UNSIGNED_INT,0):ma.drawElements(ma.LINES,2*E,ma.UNSIGNED_SHORT,0)}}else ma.drawArrays(ma.POINTS,0,C);if(3==m&&(c.setUseLighting(0),ma.drawArrays(ma.POINTS,0,C)),4==m)if(c.setUseLighting(0),1==h)ma.colorMask(0,0,0,0),ma.enable(ma.POLYGON_OFFSET_FILL),ma.polygonOffset(1,1),ma.drawArrays(ma.TRIANGLES,0,C),ma.disable(ma.POLYGON_OFFSET_FILL),ma.colorMask(1,1,1,1);else if(0==Ea||1==Ea&&1==Fa){if(null!=D&&"undefined"!=D&&E>0){ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,D);var L=ma.getExtension("OES_element_index_uint");L?ma.drawElements(ma.LINES,2*E,ma.UNSIGNED_INT,0):ma.drawElements(ma.LINES,2*E,ma.UNSIGNED_SHORT,0)}}else ma.drawArrays(ma.POINTS,0,C)}if(1==l.HasValidMainIndexData&&A.MESH_INDEX_BUFFER){ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,A.MESH_INDEX_BUFFER);var L=ma.getExtension("OES_element_index_uint");if("1"==l.GeometryType)1!=h&&(c.setUseTransparency(0),c.setTransparency(1),ma.disable(ma.BLEND),ma.depthMask(!0),c.disableNormal(),c.disableNormalTargetFrame(),c.setUseLighting(0),L?ma.drawElements(ma.POINTS,A.MESH_INDEX_COUNT,ma.UNSIGNED_INT,0):ma.drawElements(ma.POINTS,A.MESH_INDEX_COUNT,ma.UNSIGNED_SHORT,0));else if("2"==l.GeometryType)1!=h&&(c.setUseTransparency(0),c.setTransparency(1),ma.disable(ma.BLEND),ma.depthMask(!0),c.disableNormal(),c.disableNormalTargetFrame(),c.setUseLighting(0),3==m?L?ma.drawElements(ma.POINTS,A.MESH_INDEX_COUNT,ma.UNSIGNED_INT,0):ma.drawElements(ma.POINTS,A.MESH_INDEX_COUNT,ma.UNSIGNED_SHORT,0):L?ma.drawElements(ma.LINES,A.MESH_INDEX_COUNT,ma.UNSIGNED_INT,0):ma.drawElements(ma.LINES,A.MESH_INDEX_COUNT,ma.UNSIGNED_SHORT,0));else{if(0==m&&(L?ma.drawElements(ma.TRIANGLES,A.MESH_INDEX_COUNT,ma.UNSIGNED_INT,0):ma.drawElements(ma.TRIANGLES,A.MESH_INDEX_COUNT,ma.UNSIGNED_SHORT,0)),1==m){if(ma.enable(ma.POLYGON_OFFSET_FILL),ma.polygonOffset(1,1),L?ma.drawElements(ma.TRIANGLES,A.MESH_INDEX_COUNT,ma.UNSIGNED_INT,0):ma.drawElements(ma.TRIANGLES,A.MESH_INDEX_COUNT,ma.UNSIGNED_SHORT,0),ma.disable(ma.POLYGON_OFFSET_FILL),c.disableUV(),c.setUseLighting(0),c.setUsecolor(2),c.setUserColor(Pa),null!=A.line_connectivity_buffer&&"undefined"!=A.line_connectivity_buffer&&A.line_count>0){ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,A.line_connectivity_buffer);var L=ma.getExtension("OES_element_index_uint");L?ma.drawElements(ma.LINES,2*A.line_count,ma.UNSIGNED_INT,0):ma.drawElements(ma.LINES,2*A.line_count,ma.UNSIGNED_SHORT,0)}c.setUsecolor(0)}if(2==m&&(c.setUseLighting(0),null!=A.line_connectivity_buffer&&"undefined"!=A.line_connectivity_buffer&&A.line_count>0)){ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,A.line_connectivity_buffer);var L=ma.getExtension("OES_element_index_uint");L?ma.drawElements(ma.LINES,2*A.line_count,ma.UNSIGNED_INT,0):ma.drawElements(ma.LINES,2*A.line_count,ma.UNSIGNED_SHORT,0)}if(3==m&&(c.setUseLighting(0),L?ma.drawElements(ma.POINTS,A.MESH_INDEX_COUNT,ma.UNSIGNED_INT,0):ma.drawElements(ma.POINTS,A.MESH_INDEX_COUNT,ma.UNSIGNED_SHORT,0)),4==m)if(c.setUseLighting(0),1==h)ma.colorMask(0,0,0,0),ma.enable(ma.POLYGON_OFFSET_FILL),ma.polygonOffset(1,1),L?ma.drawElements(ma.TRIANGLES,A.MESH_INDEX_COUNT,ma.UNSIGNED_INT,0):ma.drawElements(ma.TRIANGLES,A.MESH_INDEX_COUNT,ma.UNSIGNED_SHORT,0),ma.disable(ma.POLYGON_OFFSET_FILL),ma.colorMask(1,1,1,1);else if(null!=A.line_connectivity_buffer&&"undefined"!=A.line_connectivity_buffer&&A.line_count>0){ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,A.line_connectivity_buffer);var L=ma.getExtension("OES_element_index_uint");L?ma.drawElements(ma.LINES,2*A.line_count,ma.UNSIGNED_INT,0):ma.drawElements(ma.LINES,2*A.line_count,ma.UNSIGNED_SHORT,0)}}}}if(B=!0,c.setUseTransparency(0),c.setTransparency(1),ma.disable(ma.BLEND),ma.depthMask(!0),1!=h&&null!=A.FEATUREEDGEBUFFER&&"undefined"!=A.FEATUREEDGEBUFFER&&1==Ka){if(c.disableNormal(),c.disableNormalTargetFrame(),c.disableUV(),c.setUseLighting(0),c.disableColor(),ma.lineWidth(Ma),c.setUsecolor(2),c.setUserColor(Na),1==l.visible||1==l.visible)c.setUserColor(Na);else{var M=p.diffuseColor;c.setUserColor(M)}var N=A.FEATUREEDGECOUNT,O=null;if(null!=A.FEATUREEDGEBUFFER&&"undefined"!=A.FEATUREEDGEBUFFER,O=A.FEATUREEDGEBUFFER,ma.depthRange(0,.9999999),"1"==l.GeometryType)ma.drawArrays(ma.POINTS,0,A.FEATUREEDGECOUNT);else if("2"==l.GeometryType)ma.drawArrays(ma.LINES,0,A.FEATUREEDGECOUNT);else if(null!=O&&"undefined"!=O&&N>0){ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,O);var L=ma.getExtension("OES_element_index_uint");L?ma.drawElements(ma.LINES,2*N,ma.UNSIGNED_INT,0):ma.drawElements(ma.LINES,2*N,ma.UNSIGNED_SHORT,0)}ma.depthRange(0,1),c.setUsecolor(0),c.setUserColor([0,0,0])}1==Za&&(c.disableNormal(),c.disableUV(),c.setUseLighting(0),1==$a?(c.setUsecolor(1),c.enableColor(),ma.bindBuffer(ma.ARRAY_BUFFER,A.contourLineColors_Buffer),c.setColor()):(c.setUsecolor(2),c.setUserColor(_a)),ma.bindBuffer(ma.ARRAY_BUFFER,A.contourLineVertices_Buffer),c.setPositionAttrib(),ma.drawArrays(ma.LINES,0,A.contourLineVertices_count),c.setUsecolor(0),c.disableColor()),1==ab&&(c.disableNormal(),c.disableUV(),c.setUseLighting(0),ma.bindBuffer(ma.ARRAY_BUFFER,A.vectorPlotVertices_Buffer),c.setPositionAttrib(),ma.drawArrays(ma.LINES,0,A.vectorPlotVertices_count));var P=[.3*cb[0],.3*cb[1],.3*cb[2]];if(c.setClipEdgeColor(P),1==l.visible||1==l.visible)if(a.getFileVersion()<=2){if(c.set_IsAnimationOn(0),1!=h&&1==Ha&&1==l.bUndeformedMesh&&null!=A.UNDEFORMED_MESHBUFFER&&"undefined"!=A.UNDEFORMED_MESHBUFFER){if(c.disableNormal(),c.disableNormalTargetFrame(),c.disableUV(),c.setUseLighting(0),ma.bindBuffer(ma.ARRAY_BUFFER,A.triangle_buffer),c.setPositionAttrib(),c.setScaleFactor([1,1,1]),c.enableTargetFrame(),ma.bindBuffer(ma.ARRAY_BUFFER,A.UNDEFORMED_MESHBUFFER),c.set_targetFrame(),c.setUsecolor(2),c.setUserColor(Ia),Ja==CAXViewer.iUndformedMeshMode.UNDEFORMED_WIREFRAME){var Q=A.UNDEFORMED_MESH_COUNT,R=null;null!=A.UNDEFORM_MESH_INDEX_BUFFER&&"undefined"!=A.UNDEFORM_MESH_INDEX_BUFFER&&(R=A.UNDEFORM_MESH_INDEX_BUFFER)}else if(Ja==CAXViewer.iUndformedMeshMode.UNDEFORMED_FEATUREEDGE||Ja==CAXViewer.iUndformedMeshMode.UNDEFORMED_TRANSPARENTEDGE){var Q=A.UNDEFORMED_MESH_FEATUREEDGECOUNT,R=null;null!=A.UNDEFORMED_MESH_FEATUREEDGEBUFFER&&"undefined"!=A.UNDEFORMED_MESH_FEATUREEDGEBUFFER&&(R=A.UNDEFORMED_MESH_FEATUREEDGEBUFFER)}if("1"==l.GeometryType)ma.drawArrays(ma.POINTS,0,A.UNDEFORMED_MESH_COUNT);else if("2"==l.GeometryType)ma.drawArrays(ma.LINES,0,A.UNDEFORMED_MESH_COUNT);else if(null!=R&&"undefined"!=R&&Q>0){ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,R);var L=ma.getExtension("OES_element_index_uint");L?ma.drawElements(ma.LINES,2*Q,ma.UNSIGNED_INT,0):ma.drawElements(ma.LINES,2*Q,ma.UNSIGNED_SHORT,0)}if(Ja==CAXViewer.iUndformedMeshMode.UNDEFORMED_TRANSPARENT||Ja==CAXViewer.iUndformedMeshMode.UNDEFORMED_TRANSPARENTEDGE){var C=A.UNDEFORMED_MESH_TRANSPARENTCOUNT;C>0&&(c.setUseTransparency(1),c.setTransparency(.25),ma.enable(ma.BLEND),ma.blendFunc(ma.SRC_ALPHA,ma.ONE_MINUS_SRC_ALPHA),ma.drawArrays(ma.TRIANGLES,0,C),c.setUseTransparency(0),c.setTransparency(1),ma.disable(ma.BLEND),ma.depthMask(!0))}c.setUsecolor(0)}c.set_IsAnimationOn(1)}else{if(c.set_IsAnimationOn(30),1!=h&&1==Ha&&1==l.bUndeformedMesh&&null!=A.UNDEFORMED_MESHBUFFER&&"undefined"!=A.UNDEFORMED_MESHBUFFER){if(c.disableNormal(),c.disableNormalTargetFrame(),c.disableUV(),c.setUseLighting(0),c.setScaleFactor([1,1,1]),c.setUsecolor(2),c.setUserColor(Ia),Ja==CAXViewer.iUndformedMeshMode.UNDEFORMED_WIREFRAME){var Q=A.UNDEFORMED_MESH_COUNT,R=null;null!=A.UNDEFORM_MESH_INDEX_BUFFER&&"undefined"!=A.UNDEFORM_MESH_INDEX_BUFFER&&(R=A.UNDEFORM_MESH_INDEX_BUFFER)}else if(Ja==CAXViewer.iUndformedMeshMode.UNDEFORMED_FEATUREEDGE||Ja==CAXViewer.iUndformedMeshMode.UNDEFORMED_TRANSPARENTEDGE){var Q=A.UNDEFORMED_MESH_FEATUREEDGECOUNT,R=null;null!=A.UNDEFORMED_MESH_FEATUREEDGEBUFFER&&"undefined"!=A.UNDEFORMED_MESH_FEATUREEDGEBUFFER&&(R=A.UNDEFORMED_MESH_FEATUREEDGEBUFFER)}var S=Ab;if(1==ob&&Qb==CAXViewer.CAEAnimationType.TRANSIENT&&1==Ea&&l.undeformInstances[S].UNDEFORM_MESH_INDEX_BUFFER&&l.undeformInstances[S].UNDEFORMED_MESH_COUNT&&(R=l.undeformInstances[S].UNDEFORM_MESH_INDEX_BUFFER,Q=l.undeformInstances[S].UNDEFORMED_MESH_COUNT),"1"==l.GeometryType)ma.drawArrays(ma.POINTS,0,Q);else if("2"==l.GeometryType)ma.drawArrays(ma.LINES,0,Q);else if(null!=R&&"undefined"!=R&&Q>0){ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,R);var L=ma.getExtension("OES_element_index_uint");L?ma.drawElements(ma.LINES,2*Q,ma.UNSIGNED_INT,0):ma.drawElements(ma.LINES,2*Q,ma.UNSIGNED_SHORT,0)}if(Ja==CAXViewer.iUndformedMeshMode.UNDEFORMED_TRANSPARENT||Ja==CAXViewer.iUndformedMeshMode.UNDEFORMED_TRANSPARENTEDGE){var C=A.UNDEFORMED_MESH_TRANSPARENTCOUNT;C>0&&(c.setUseTransparency(1),c.setTransparency(.25),ma.depthMask(!1),ma.enable(ma.BLEND),ma.blendFunc(ma.SRC_ALPHA,ma.ONE_MINUS_SRC_ALPHA),ma.drawArrays(ma.TRIANGLES,0,C),c.setUseTransparency(0),c.setTransparency(1),ma.disable(ma.BLEND),ma.depthMask(!0))}c.setUsecolor(0)}c.set_IsAnimationOn(1)}}if(0==B){l=b[k].node,null==l.selected?c.setIsSelected(0):c.setIsSelected(l.selected);var T=l["bounding-box-geom"];c.setDiffuseColor([.5,.5,.5]),c.setAmbientColor([.5,.5,.5]),c.setSpecularColor([.2,.2,.2]),c.setEmissiveColor([0,0,0]),c.setShininess(128),c.setAmbientIntensity(.5),T&&(c.setUniformModelviewMatrix(s),c.disableNormal(),c.setUseTexture(1),l["bounding-box-Texcoords"]&&e&&(c.enableUV(),ma.bindBuffer(ma.ARRAY_BUFFER,l["bounding-box-Texcoords"]),c.setUVAttrib(),ma.bindTexture(ma.TEXTURE_2D,e),c.setCaeTexture(0)),ma.bindBuffer(ma.ARRAY_BUFFER,T),c.setPositionAttrib(),ma.drawArrays(ma.LINES,0,24));var o=l.pickingColor;if(c.setPickColor([o[0]/255,o[1]/255,o[2]/255]),ma.disable(ma.BLEND),f){var U=l["bounding-box-geom-triangles"];U&&(c.setUniformModelviewMatrix(s),c.disableNormal(),c.disableUV(),c.setUseLighting(0),ma.bindBuffer(ma.ARRAY_BUFFER,U),c.setPositionAttrib(),ma.drawArrays(ma.TRIANGLES,0,36))}c.disableNormal(),c.disableUV()}}}}function x(b){if(0!=b.hasOwnProperty("key")&&null!=b.key&&(null==ta&&(ta=a.getMCAXloader()),0==a.getUseStreaming())){var c={};c.name=b.Name,c.key=b.key;var d=ta.getUndeformBoundingBoxMinMax(c,na),e=ta.getUndeformPartVertices(c,na),f=ta.getUndeformPartNormal(c,na),g=ta.getUndeformPartPolygonWireFrameIndex(c,na);y(b,d,e,f,g),e=null,f=null,g=null}}function y(b,c,d,e,f,g){var h=b.geometry,i=null,j=0,k=null,l=c,m="";if(b.GeometryType&&"4"==b.GeometryType&&5==f.byteLength&&(m=sa.convertArrayBuffertoString(f),"Error"==m))return void CAXViewer.error("Invalid PolygonWireFrameIndexData in updateWireFrame");if(d)if(5==d.byteLength){m=sa.convertArrayBuffertoString(d);var i=null}else{if(1==xa)var n=va.decompression_Zlib(d),o=new Uint16Array(n);else var o=new Uint16Array(d);var p=1,q=1,r=1;if(null==l||"undefined"==l)var s=parseFloat(b.localMaxBounding[0]),u=parseFloat(b.localMinBounding[0]),v=parseFloat(b.localMaxBounding[1]),w=parseFloat(b.localMinBounding[1]),x=parseFloat(b.localMaxBounding[2]),y=parseFloat(b.localMinBounding[2]);else var s=parseFloat(l.MaxBounding[0]),u=parseFloat(l.MinBounding[0]),v=parseFloat(l.MaxBounding[1]),w=parseFloat(l.MinBounding[1]),x=parseFloat(l.MaxBounding[2]),y=parseFloat(l.MinBounding[2]);s-u!=0?p=65535/(s-u):0!=s&&(p=65535/s),v-w!=0?q=65535/(v-w):0!=v&&(q=65535/v),x-y!=0?r=65535/(x-y):0!=x&&(r=65535/x);for(var i=new Float32Array(o.length),z=0;z<o.length;z+=3)i[z]=o[z]/p+u,i[z+1]=o[z+1]/q+w,i[z+2]=o[z+2]/r+y;o=null,j=i.length/3}if(e)if(5==e.byteLength){"3"!=b.GeometryType&&"4"!=b.GeometryType||(m=sa.convertArrayBuffertoString(e));var k=null}else{if(1==xa)var n=va.decompression_Zlib(e),A=new Int8Array(n);else var A=new Int8Array(e);for(var k=new Float32Array(A.length),z=0;z<A.length;z++)k[z]=A[z]/127;A=null}if(m=null,!i||j<=0)return h.UNDEFORMED_MESH_COUNT=j,h.UNDEFORMED_MESHBUFFER&&ma.deleteBuffer(h.UNDEFORMED_MESHBUFFER),h.UNDEFORMED_MESHBUFFER=null,h.UNDEFORMED_NORMALBUFFER&&ma.deleteBuffer(h.UNDEFORMED_NORMALBUFFER),h.UNDEFORMED_NORMALBUFFER=null,h.UNDEFORM_MESH_INDEX_BUFFER&&ma.deleteBuffer(h.UNDEFORM_MESH_INDEX_BUFFER),void(h.UNDEFORM_MESH_INDEX_BUFFER=null);if(a.getFileVersion()>2&&(h.verticesCountV3=j),b.GeometryType&&"4"==b.GeometryType&&f){if("UShort"==g)var B=new Uint16Array(f);else var B=new Uint32Array(f);j=B.length/2}else{var z=0,C=j/3,B=new Array(6*C);for(z=0;z<C;z++){var D=3*z,E=6*z;B[E+0]=D+0,B[E+1]=D+1,B[E+2]=D+1,B[E+3]=D+2,B[E+4]=D+2,B[E+5]=D+0}}if(i){if(h.UNDEFORMED_MESH_COUNT=j,h.line_count=j,null==h.UNDEFORMED_MESHBUFFER||"undefined"==h.UNDEFORMED_MESHBUFFER)var F=ma.createBuffer();else var F=h.UNDEFORMED_MESHBUFFER;ma.bindBuffer(ma.ARRAY_BUFFER,F),ma.bufferData(ma.ARRAY_BUFFER,i,ma.STATIC_DRAW),h.UNDEFORMED_MESHBUFFER=F}if(k){if(null==h.UNDEFORMED_NORMALBUFFER||"undefined"==h.UNDEFORMED_NORMALBUFFER)var F=ma.createBuffer();else var F=h.UNDEFORMED_NORMALBUFFER;ma.bindBuffer(ma.ARRAY_BUFFER,F),ma.bufferData(ma.ARRAY_BUFFER,k,ma.STATIC_DRAW),h.UNDEFORMED_NORMALBUFFER=F}var G=ma.getExtension("OES_element_index_uint");if(j>65535&&!G&&(alert("Extension OES_element_index_uint not exist"),CAXViewer.log("Extension OES_element_index_uint not exist")),B){if(null==h.line_connectivity_buffer||"undefined"==h.line_connectivity_buffer)var H=ma.createBuffer();else var H=h.line_connectivity_buffer;if(ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,H),G?ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint32Array(B),ma.STATIC_DRAW):ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint16Array(B),ma.STATIC_DRAW),h.line_connectivity_buffer=H,null==h.UNDEFORM_MESH_INDEX_BUFFER||"undefined"==h.UNDEFORM_MESH_INDEX_BUFFER)var I=ma.createBuffer();else var I=h.UNDEFORM_MESH_INDEX_BUFFER;ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,I),G?ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint32Array(B),ma.STATIC_DRAW):ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint16Array(B),ma.STATIC_DRAW),h.UNDEFORM_MESH_INDEX_BUFFER=I}Ja!=CAXViewer.iUndformedMeshMode.UNDEFORMED_WIREFRAME&&(h.point=i,t(b)),i=null,j=null,k=null,B=null,Fa=!0}function z(a,b,c,d,e){for(var f=[],g=3*d,h=0;h<d;h++){var i=3*h,j=9*h,k=[];k.push([c[j],c[j+1],c[j+2]]),k.push([c[j+3],c[j+4],c[j+5]]),k.push([c[j+6],c[j+7],c[j+8]]);var l=sa.subtractVector(k[1],k[0]),m=sa.subtractVector(k[2],k[0]),n=sa.CrossProduct(l,m);n=sa.Normalize(n);for(var o=0;o<3;o++){var p=(o+1)%3,q=new jb(k[o],k[p],n,i+o,i+p);f.push(q)}}for(var r=Math.cos(b*Math.PI/180),s=[],h=0;h<g;h++){var t=f[h],o=0,u=new kb;for(o=0;o<s.length&&(u=s[o],!t.compare(u.key));o++);if(o>=s.length){var v=new kb;v.key=t,v.value=1,s.push(v)}else if(u&&1==u.value)if(1==e)s.splice(o,1);else{var w=t.normals[0]*u.key.normals[0]+t.normals[1]*u.key.normals[1]+t.normals[2]*u.key.normals[2];w>1?w=1:w<-1&&(w=-1),w>r?(s[o].value=2,s.splice(o,1)):s[o].value=0}}for(var x=[],h=0;h<s.length;h++)x.push(s[h].key.i1),x.push(s[h].key.i2);return x}function A(a,b,c,d,e){for(var f=Date.now(),g=[],h=d.length/3,i=3*h,j=0;j<h;j++){var k=3*j,l=3*d[k],m=3*d[k+1],n=3*d[k+2],o=[];o.push([c[l],c[l+1],c[l+2]]),o.push([c[m],c[m+1],c[m+2]]),o.push([c[n],c[n+1],c[n+2]]);var p=sa.subtractVector(o[1],o[0]),q=sa.subtractVector(o[2],o[0]),r=sa.CrossProduct(p,q);r=sa.Normalize(r);for(var s=0;s<3;s++){var t=(s+1)%3;if(d[k+s]<=d[k+t])var u=new jb(o[s],o[t],r,d[k+s],d[k+t]);else var u=new jb(o[s],o[t],r,d[k+t],d[k+s]);g.push(u)}}for(var v=Math.cos(b*Math.PI/180),w=[],j=0;j<i;j++){var x=g[j],s=0,y=new kb;for(s=0;s<w.length&&(y=w[s],!x.compare(y.key));s++);if(s>=w.length){var z=new kb;z.key=x,z.value=1,w.push(z)}else if(y&&1==y.value)if(1==e)w.splice(s,1);else{var A=x.normals[0]*y.key.normals[0]+x.normals[1]*y.key.normals[1]+x.normals[2]*y.key.normals[2];A>1?A=1:A<-1&&(A=-1),A>v?(w[s].value=2,w.splice(s,1)):w[s].value=0}}for(var B=[],j=0;j<w.length;j++)B.push(w[j].key.i1),B.push(w[j].key.i2);Date.now()-f;return B}function B(a){var b=a.length*a.BYTES_PER_ELEMENT,c=Module._malloc(b),d=new Uint8Array(Module.HEAPU8.buffer,c,b);return d.set(new Uint8Array(a.buffer)),d}function C(a){Module._free(a.byteOffset)}function D(a,b,c,d,e){for(var f=B(c),g=Module.GetFeatureEdges(35,f.byteOffset,d,0),h=g.size(),i=new Uint32Array(h),j=0;j<h;j++)i[j]=g.get(j);return g.resize(0,0),g.delete(),C(f),i}function E(a,b,c,d,e){for(var f=d.length/3,g=B(c),h=B(d),i=Module.GetFeatureEdges2(35,g.byteOffset,h.byteOffset,f,0),j=i.size(),k=new Uint32Array(j),l=0;l<j;l++)k[l]=i.get(l);return i.resize(0,0),i.delete(),C(g),C(h),k}function F(a,b,c,d,e){var f=null;try{f=D(a,b,c,d,e)}catch(g){CAXViewer.error("ASM.js is not supported in your browser."),CAXViewer.warn("Computing feature edge in javascript takes long time."),f=z(a,b,c,d,e)}return f}function G(a,b,c,d,e){var f=null;try{f=E(a,b,c,d,e)}catch(g){CAXViewer.error("ASM.js is not supported in your browser."),CAXViewer.warn("Computing feature edge in javascript takes long time."),f=A(a,b,c,d,e)}return f}function H(b){if(ra){var c={Operation:CAXViewer.serverOperations.getCAEInfo,Data:""};ra.send(JSON.stringify(c),function(a){var c=sa.convertArrayBuffertoString(a),d=JSON&&JSON.parse(c)||$.parseJSON(c);I(d,b)})}if(0==a.getUseStreaming()){ka.setVisiblePartCount();var d=ta.getCAEInfo(),e=sa.convertArrayBuffertoString(d);try{var f=JSON&&JSON.parse(e)||$.parseJSON(e)}catch(a){return void CAXViewer.warn("Invalid Json")}I(f,b)}}function I(a,c){if(Ta=a.Result_Name,Ua=a.Instance,Va=a.Derived,Wa=a.IsCAETransientResult,null==c||"undefined"==c||1==c){var d=la.CAE_Info;if(d&&a){for(var e=a.Colour_Array,f=[],g=0;g<e.length/3;g++){var h=[e[3*g+0],e[3*g+1],e[3*g+2]];f[g]=h}d.Colour_Array=f;var i={};i.colorArray=f,i.rangeMax=a.Range_Max,i.rangeMin=a.Range_Min,i.discreteMode=a.Discrete_Color,i.textArray={},i.textArray[0]=na,i.textArray[1]=Ta+" : "+Va,i.textArray[2]=Ua,ua.updateLegend(na,i)}}var j=b(la,null);if(j)for(var g=0;g<j.length;g++){var k=j[g].node;"Shape"==k.Type&&k.geometry&&J(k,Wa)}ka.updateBoundingBox()}function J(b,c){if(0!=b.hasOwnProperty("key")&&null!=b.key){if(ra){var d={};if(d.name=b.Name,d.key=b.key,d.compressionRequired=xa,c)var e={Operation:CAXViewer.serverOperations.getTempBoundingBoxMinMax,Data:JSON.stringify(d)},f=ra.send(JSON.stringify(e),function(c){var e=sa.convertArrayBuffertoString(c);if("Error"!=e)var g=JSON&&JSON.parse(e)||$.parseJSON(e);var h={Operation:CAXViewer.serverOperations.getVerticesAsUShort,Data:JSON.stringify(d)};if(f=ra.send(JSON.stringify(h),function(a){
l(a,b,g)}),h={Operation:CAXViewer.serverOperations.getTextureAsByte,Data:JSON.stringify(d)},f=ra.send(JSON.stringify(h),function(a){p(a,b,!0)}),h={Operation:CAXViewer.serverOperations.getNormalAsByte,Data:JSON.stringify(d)},f=ra.send(JSON.stringify(h),function(a){o(a,b)}),lb+=1,lb<Aa){var i=lb/Aa*100;a.updateStatus("Updating result "+i.toFixed(2)+"% completed.")}else a.updateStatus("")});else{var e={Operation:CAXViewer.serverOperations.getTextureAsByte,Data:JSON.stringify(d)};if(f=ra.send(JSON.stringify(e),function(a){p(a,b,!0)}),lb+=1,lb<Aa){var g=lb/Aa*100;a.updateStatus("Updating result "+g.toFixed(2)+"% completed.")}else a.updateStatus("")}}if(0==a.getUseStreaming()){var d={};if(d.name=b.Name,d.key=b.key,d.IsCAETransientResult=!0,d.IsViewPointApplied=Ga,d.IsDeformApplied=ka.getIsDeformed(),c){if(a.getFileVersion()<=2){var h=ta.getBoundingBoxMinMaX(d,na),i=ta.getPartVertices(d,na);l(i,b,h)}else{var h=ta.getBoundingBoxMinMaX(d,na),j=ta.getDisplacementMinMaX(d,na),k=ta.getDisplacementValues(d,na);m(b,j,k,h)}if(i=ta.getPartTexture(d,na),p(i,b,!0),i=ta.getPartNormal(d,na),o(i,b),lb+=1,lb<fb){var g=lb/fb*100;a.updateStatus("Updating result "+g.toFixed(2)+"% completed.")}else a.updateStatus(""),ua.updateNearFarPlane()}else if(i=ta.getPartTexture(d,na),p(i,b,!0),lb+=1,lb<fb){var g=lb/fb*100;a.updateStatus("Updating result "+g.toFixed(2)+"% completed.")}else a.updateStatus(""),ua.updateNearFarPlane()}}}function K(a){var c=b(la,null);if(c)for(var d=0;d<c.length;d++){var e=c[d].node;"Shape"==e.Type&&e.geometry&&L(e,a)}}function L(b,c){if(0!=b.hasOwnProperty("key")&&null!=b.key){if(ra){var d={};d.name=b.Name,d.key=b.key,d.compressionRequired=xa;var e={Operation:CAXViewer.serverOperations.getTempBoundingBoxMinMax,Data:JSON.stringify(d)},f=ra.send(JSON.stringify(e),function(c){var e=sa.convertArrayBuffertoString(c),g=JSON&&JSON.parse(e)||$.parseJSON(e),h={Operation:CAXViewer.serverOperations.getVerticesAsUShort,Data:JSON.stringify(d)};f=ra.send(JSON.stringify(h),function(a){l(a,b,g)}),h={Operation:CAXViewer.serverOperations.getNormalAsByte,Data:JSON.stringify(d)},f=ra.send(JSON.stringify(h),function(c){if(o(c,b),lb+=1,lb<Aa){var d=lb/Aa*100;a.updateStatus("Updating deform mesh "+d.toFixed(2)+"% completed.")}else a.updateStatus("")})})}if(0==a.getUseStreaming()){var d={};if(d.name=b.Name,d.key=b.key,d.IsDeformApplied=c,d.IsCAETransientResult=ka.getIsCAETransientResult(),d.IsViewPointApplied=Ga,d.CAEInstanceName=Ga?sb:Ua,""!=rb&&(CAEData.Results=rb),a.getFileVersion()<=2){var g=ta.getBoundingBoxMinMaX(d,na),h=ta.getPartVertices(d,na);l(h,b,g)}else{var g=ta.getBoundingBoxMinMaX(d,na),i=ta.getDisplacementMinMaX(d,na),j=ta.getDisplacementValues(d,na);m(b,i,j,g)}h=ta.getPartNormal(d,na),o(h,b)}}}function M(){if(0==Ib){if(ob=!1,Jb!=Rb)return;Ib=!0}if(ob=!0,Db=Cb,0==a.getIsRendering())if(Qb==CAXViewer.CAEAnimationType.LINEAR){var b=Lb-1;Bb=Cb/b,Ob?(Pb?Cb++:Cb--,Nb?(Cb<=-b||Cb>=b)&&(Pb=!(Cb>0)):(Cb<=-b||Cb>=b)&&(Cb=Pb?-b:b)):Mb||Sb?(Cb--,(Cb>b||Cb<0)&&(Nb?(Sb=!1,Cb++):Cb=Lb-1)):(Cb++,(Cb>b||Cb<0)&&(Nb?(Sb=!0,Cb--):Cb=0))}else if(Qb==CAXViewer.CAEAnimationType.EIGEN_VECTOR){var c=2*Math.PI/Lb;Bb=Math.sin(Cb*c),Mb?(Cb--,Cb>Lb&&(Cb=Lb)):(Cb++,Cb>Lb&&(Cb=0))}else if(Qb==CAXViewer.CAEAnimationType.EIGEN_VECTOR_COMPLEX){var c=2*Math.PI/Lb;Bb=Cb*c,Mb?(Cb--,Cb>Lb&&(Cb=Lb)):(Cb++,Cb>Lb&&(Cb=0))}else if(Qb==CAXViewer.CAEAnimationType.TRANSIENT){var b=Lb-1;Ab=ub[Cb],Cb<=zb&&(fa(Cb,Ab),ga(Cb,sb),ha(Cb,sb),ia(Cb)),Mb||Sb?(Cb--,(Cb>b||Cb<0)&&(Nb?(Sb=!1,Cb++):Cb=Lb-1)):(Cb++,(Cb>b||Cb<0)&&(Nb?(Sb=!0,Cb--):Cb=0))}}function N(){if(Qb==CAXViewer.CAEAnimationType.LINEAR||Qb==CAXViewer.CAEAnimationType.EIGEN_VECTOR){if(0==Ib){var b=!0;if(ra){var c={Operation:CAXViewer.serverOperations.setCAEDeformMesh,Data:b};ra.send(JSON.stringify(c),function(a){var b=sa.convertArrayBuffertoString(a);"true"==b&&O()})}0==a.getUseStreaming()&&(Jb=null,O())}}else if(Qb==CAXViewer.CAEAnimationType.EIGEN_VECTOR_COMPLEX){if(0==Ib)if(1==qb){var d=S();if(d)return Qb=CAXViewer.CAEAnimationType.LINEAR,Jb=null,void ka.startAnimation()}else Jb=ka.getAllPartNames().length}else if(Qb==CAXViewer.CAEAnimationType.TRANSIENT&&0==Ib){var e=Ta;""!=rb&&(e=rb),a.getCAEInstanceList(na,e,function(a){return ub=a,a.length<=1?(Qb=CAXViewer.CAEAnimationType.LINEAR,Jb=null,void ka.startAnimation()):(Lb=a.length,void(zb<ub.length&&X(ub[zb],!0)))})}}function O(){var a=b(la,null);if(a)for(var c=0;c<a.length;c++){var d=a[c].node;"Shape"==d.Type&&d.geometry&&P(d)}}function P(b){if(0!=b.hasOwnProperty("key")&&null!=b.key){if(ra){var c={};c.name=b.Name,c.key=b.key,c.compressionRequired=xa;var d={Operation:CAXViewer.serverOperations.getTempBoundingBoxMinMax,Data:JSON.stringify(c)},e=ra.send(JSON.stringify(d),function(d){var f=sa.convertArrayBuffertoString(d),g=JSON&&JSON.parse(f)||$.parseJSON(f),h={Operation:CAXViewer.serverOperations.getVerticesAsUShort,Data:JSON.stringify(c)};e=ra.send(JSON.stringify(h),function(c){if(Q(c,b,g),Jb+=1,Jb<Rb){var d=Jb/Rb*100;a.updateStatus(d.toFixed(2)+"% completed.")}else a.updateStatus("")}),h={Operation:CAXViewer.serverOperations.getNormalAsByte,Data:JSON.stringify(c)},e=ra.send(JSON.stringify(h),function(a){R(a,b)})})}if(0==a.getUseStreaming()){var c={};if(c.name=b.Name,c.key=b.key,c.IsDeformApplied=!0,c.IsCAETransientResult=Wa,a.getFileVersion()<=2){var f=ta.getBoundingBoxMinMaX(c,na),g=ta.getPartVertices(c,na);Q(g,b,f)}else{var f=ta.getBoundingBoxMinMaX(c,na),h=ta.getDisplacementMinMaX(c,na),i=ta.getDisplacementValues(c,na);m(b,h,i,f)}if(g=ta.getPartNormal(c,na),R(g,b),Jb+=1,Jb<Rb){var j=Jb/Rb*100;a.updateStatus(j.toFixed(2)+"% completed.")}else a.updateStatus("")}}}function Q(a,b,c){var d="";if(5==a.byteLength&&(d=sa.convertArrayBuffertoString(a)),"Error"!=d){if(1==xa)var e=va.decompression_Zlib(a),f=new Uint16Array(e);else var f=new Uint16Array(a);var g=1,h=1,i=1;if(null==c||"undefined"==c)var j=parseFloat(b.localMaxBounding[0]),k=parseFloat(b.localMinBounding[0]),l=parseFloat(b.localMaxBounding[1]),m=parseFloat(b.localMinBounding[1]),n=parseFloat(b.localMaxBounding[2]),o=parseFloat(b.localMinBounding[2]);else{var j=parseFloat(c.MaxBounding[0]),k=parseFloat(c.MinBounding[0]),l=parseFloat(c.MaxBounding[1]),m=parseFloat(c.MinBounding[1]),n=parseFloat(c.MaxBounding[2]),o=parseFloat(c.MinBounding[2]);b.TempMaxBounding=[],b.TempMinBounding=[],b.TempMaxBounding[0]=j,b.TempMinBounding[0]=k,b.TempMaxBounding[1]=l,b.TempMinBounding[1]=m,b.TempMaxBounding[2]=n,b.TempMinBounding[2]=o}j-k!=0?g=65535/(j-k):0!=j&&(g=65535/j),l-m!=0?h=65535/(l-m):0!=l&&(h=65535/l),n-o!=0?i=65535/(n-o):0!=n&&(i=65535/n);for(var p=[],q=0;q<f.length;q+=3)p[q]=f[q]/g+k,p[q+1]=f[q+1]/h+m,p[q+2]=f[q+2]/i+o;b.geometry||(b.geometry={});var r=b.geometry;if(p&&p.length>0){if(null==r.targetFrame_buffer||"undefined"==r.targetFrame_buffer)var s=ma.createBuffer();else var s=r.targetFrame_buffer;r.vertexCount=p.length/3,ma.bindBuffer(ma.ARRAY_BUFFER,s),ma.bufferData(ma.ARRAY_BUFFER,new Float32Array(p),ma.STATIC_DRAW),r.targetFrame_buffer=s}}}function R(a,b){var c="";if(5==a.byteLength&&(c=sa.convertArrayBuffertoString(a)),"Error"!=c){if(1==xa)var d=va.decompression_Zlib(a),e=new Int8Array(d);else var e=new Int8Array(a);for(var f=[],g=0;g<e.length;g++)f[g]=e[g]/127;b.geometry||(b.geometry={});var h=b.geometry;if(f&&f.length>0){if(null==h.targetFrameNormal_buffer||"undefined"==h.targetFrameNormal_buffer)var i=ma.createBuffer();else var i=h.targetFrameNormal_buffer;ma.bindBuffer(ma.ARRAY_BUFFER,i),ma.bufferData(ma.ARRAY_BUFFER,new Float32Array(f),ma.STATIC_DRAW),h.targetFrameNormal_buffer=i}}}function S(){var a=b(la,null),c=!1;if(a)for(var d=0;d<a.length;d++){var e=a[d].node;if("Shape"==e.Type&&e.geometry){if(null==Kb&&(Kb={},ra)){var f={Operation:CAXViewer.serverOperations.clearResultMap,Data:""};ra.send(JSON.stringify(f),function(a){var b=sa.convertArrayBuffertoString(a);"Error"==b&&CAXViewer.log("Error.....")})}T(e),U(e),V(e),e.Result&&e.visible&&(null!=e.Result.realResult&&0!=e.Result.realResult.length&&null!=e.Result.imaginaryResult&&0!=e.Result.imaginaryResult.length&&null!=e.Result.metaResult&&0!=e.Result.metaResult.length||(c=!0))}}return c}function T(b){if(0!=b.hasOwnProperty("key")&&null!=b.key){var c={};if(c.partName=b.Name,c.key=b.key,c.modelName=na,ra){var d={Operation:CAXViewer.serverOperations.getRealResult,Data:JSON.stringify(c)};ra.send(JSON.stringify(d),function(a){var d=sa.convertArrayBuffertoString(a);if("Error"!=d)try{var e=JSON&&JSON.parse(d)||$.parseJSON(d),f=e.Use_Part_Result;null!=b.Result&&"undefined"!=b.Result||(b.Result={}),b.Result.realResult=Kb[f].realResult}catch(d){var g=new Float32Array(a),h={};h.realResult=g,Kb[c.partName]=h,null!=b.Result&&"undefined"!=b.Result||(b.Result={}),b.Result.realResult=h.realResult}else CAXViewer.log("Error.....")})}if(0==a.getUseStreaming()){var e=ta.getEigenComplexRealDataForNode(c,na),f=sa.convertArrayBuffertoString(e);if("Error"!=f)try{var g=f;null!=b.Result&&"undefined"!=b.Result||(b.Result={}),b.Result.realResult=Kb[g].realResult}catch(a){var h=new Float32Array(e),i={};i.realResult=h,Kb[c.partName]=i,null!=b.Result&&"undefined"!=b.Result||(b.Result={}),b.Result.realResult=i.realResult}else b.Result&&(b.Result.realResult=null),CAXViewer.log("No Eigen Complex Real Data")}}}function U(b){if(0!=b.hasOwnProperty("key")&&null!=b.key){var c={};if(c.partName=b.Name,c.key=b.key,c.modelName=na,ra){var d={Operation:CAXViewer.serverOperations.getImaginaryResult,Data:JSON.stringify(c)};ra.send(JSON.stringify(d),function(a){var d=sa.convertArrayBuffertoString(a);if("Error"!=d)try{var e=JSON&&JSON.parse(d)||$.parseJSON(d),f=e.Use_Part_Result;null!=b.Result&&"undefined"!=b.Result||(b.Result={}),b.Result.imaginaryResult=Kb[f].imaginaryResult}catch(d){var g=new Float32Array(a),h={};h.imaginaryResult=g,null==Kb[c.partName]||"undefined"==Kb[c.partName]?Kb[c.partName]=h:Kb[c.partName].imaginaryResult=g,null!=b.Result&&"undefined"!=b.Result||(b.Result={}),b.Result.imaginaryResult=h.imaginaryResult}else b.Result&&(b.Result.imaginaryResult=null),CAXViewer.log("Error.....")})}if(0==a.getUseStreaming()){var e=ta.getEigenComplexImaginaryDataForNode(c,na),f=sa.convertArrayBuffertoString(e);if("Error"!=f)try{var g=f;null!=b.Result&&"undefined"!=b.Result||(b.Result={}),b.Result.imaginaryResult=Kb[g].imaginaryResult}catch(a){var h=new Float32Array(e),i={};i.imaginaryResult=h,null==Kb[c.partName]||"undefined"==Kb[c.partName]?Kb[c.partName]=i:Kb[c.partName].imaginaryResult=h,null!=b.Result&&"undefined"!=b.Result||(b.Result={}),b.Result.imaginaryResult=i.imaginaryResult}else b.Result&&(b.Result.imaginaryResult=null),CAXViewer.log("Eigen Complex Imaginary Data")}}}function V(b){if(0!=b.hasOwnProperty("key")&&null!=b.key){var c={};if(c.partName=b.Name,c.key=b.key,c.modelName=na,ra){var d={Operation:CAXViewer.serverOperations.getMetaResult,Data:JSON.stringify(c)};ra.send(JSON.stringify(d),function(d){var e=sa.convertArrayBuffertoString(d);if("Error"!=e){try{var f=JSON&&JSON.parse(e)||$.parseJSON(e),g=f.Use_Part_Result;null!=b.Result&&"undefined"!=b.Result||(b.Result={}),b.Result.metaResult=Kb[g].metaResult}catch(a){var h=new Uint32Array(d),i={};i.metaResult=h,null==Kb[c.partName]||"undefined"==Kb[c.partName]?Kb[c.partName]=i:Kb[c.partName].metaResult=h,null!=b.Result&&"undefined"!=b.Result||(b.Result={}),b.Result.metaResult=i.metaResult}if(W(b),Jb+=1,Jb<Rb){var j=Jb/Rb*100;a.updateStatus(j.toFixed(2)+"% completed.")}else a.updateStatus("")}else CAXViewer.log("Error.....")})}if(0==a.getUseStreaming()){var e=ta.getEigenComplexMetaDataForNode(c,na),f=sa.convertArrayBuffertoString(e);if("Error"!=f){try{var g=f;null!=b.Result&&"undefined"!=b.Result||(b.Result={}),b.Result.metaResult=Kb[g].metaResult}catch(a){var h=new Uint32Array(e),i={};i.metaResult=h,null==Kb[c.partName]||"undefined"==Kb[c.partName]?Kb[c.partName]=i:Kb[c.partName].metaResult=h,null!=b.Result&&"undefined"!=b.Result||(b.Result={}),b.Result.metaResult=i.metaResult}W(b)}else b.Result&&(b.Result.metaResult=null),CAXViewer.log("Eigen Complex Meta Data");if(0!=Rb)if(Jb+=1,Jb<Rb){var j=Jb/Rb*100;a.updateStatus(j.toFixed(2)+"% completed.")}else a.updateStatus("")}}}function W(a){var b=a.Result,c=[],d=[],e=b.metaResult,f=b.realResult,g=b.imaginaryResult,h=0;if(f&&g)for(h=0;h<e.length;h++){var i=3*e[h];c.push(f[i]),c.push(f[i+1]),c.push(f[i+2]),d.push(g[i]),d.push(g[i+1]),d.push(g[i+2])}if(b.realResult=c,b.imaginaryResult=d,c&&c.length>0){if(null==b.realResult_buffer||"undefined"==b.realResult_buffer)var j=ma.createBuffer();else var j=b.realResult_buffer;b.realCount=c.length/3,ma.bindBuffer(ma.ARRAY_BUFFER,j),ma.bufferData(ma.ARRAY_BUFFER,new Float32Array(c),ma.STATIC_DRAW),b.realResult_buffer=j}else b.realCount=0,b.realResult_buffer&&ma.deleteBuffer(b.realResult_buffer),b.realResult_buffer=null;if(d&&d.length>0){if(null==b.imaginaryResult_buffer||"undefined"==b.imaginaryResult_buffer)var j=ma.createBuffer();else var j=b.imaginaryResult_buffer;b.imaginaryCount=d.length/3,ma.bindBuffer(ma.ARRAY_BUFFER,j),ma.bufferData(ma.ARRAY_BUFFER,new Float32Array(d),ma.STATIC_DRAW),b.imaginaryResult_buffer=j}else b.imaginaryCount=0,b.imaginaryResult_buffer&&ma.deleteBuffer(b.imaginaryResult_buffer),b.imaginaryResult_buffer=null}function X(c,d){var e={};if(e.Instance=c,e.Results=Ta,e.DerivedResults=Va,""!=rb&&(e.Results=rb),""!=tb&&(e.DerivedResults=tb),ka.setCAEDeformationOnServer(!0),ra){var f={Operation:CAXViewer.serverOperations.setCAEResult,Data:JSON.stringify(e)};ra.send(JSON.stringify(f),function(a){var e=sa.convertArrayBuffertoString(a);if("true"==e)if(1==d){var f=b(la,null);if(f)for(var g=0;g<f.length;g++){var h=f[g].node;"Shape"==h.Type&&0!=h.hasOwnProperty("key")&&null!=h.key&&Y(h,c)}}else Jb=Rb})}if(0==a.getUseStreaming())if(1==d){var g=b(la,null);if(g)for(var h=0;h<g.length;h++){var i=g[h].node;"Shape"==i.Type&&0!=i.hasOwnProperty("key")&&null!=i.key&&Y(i,c)}}else Jb=Rb}function Y(b,c){var d={};if(d.name=b.Name,d.key=b.key,d.compressionRequired=xa,ra)var e={Operation:CAXViewer.serverOperations.getTempBoundingBoxMinMax,Data:JSON.stringify(d)},f=ra.send(JSON.stringify(e),function(a){var e=sa.convertArrayBuffertoString(a),g=null;"Error"!=e&&(g=JSON&&JSON.parse(e)||$.parseJSON(e));var h={Operation:CAXViewer.serverOperations.getVerticesAsUShort,Data:JSON.stringify(d)};f=ra.send(JSON.stringify(h),function(a){Z(a,b,g,c)}),h={Operation:CAXViewer.serverOperations.getNormalAsByte,Data:JSON.stringify(d)},f=ra.send(JSON.stringify(h),function(a){da(a,b,c)}),h={Operation:CAXViewer.serverOperations.getTextureAsByte,Data:JSON.stringify(d)},f=ra.send(JSON.stringify(h),function(a){ea(a,b,c)})});if(0==a.getUseStreaming()){d.IsCAETransientResult=!0,d.CAEInstanceName=c,d.IsViewPointApplied=!0,d.IsDeformApplied=!0;var g=null;if(a.getFileVersion()<=2){var h=ta.getBoundingBoxMinMaX(d,na);g=ta.getPartVertices(d,na),Z(g,b,h,c)}else{var i=ta.getBoundingBoxMinMaX(d,na),j=ta.getDisplacementMinMaX(d,na),k=ta.getDisplacementValues(d,na);if(_(j,k,b,i,c),Ea){var l=ta.getUndeformBoundingBoxMinMax(d,na),m=ta.getUndeformPartVertices(d,na);aa(m,b,l,c);var n=ta.getUndeformPartNormal(d,na);ca(n,b,c);var o=ta.getUndeformPartPolygonWireFrameIndex(d,na);ba(o,b,c)}}g=ta.getPartNormal(d,na),da(g,b,c),g=ta.getPartTexture(d,na),ea(g,b,c)}}function Z(a,b,c,d){var e="";if(5==a.byteLength&&(e=sa.convertArrayBuffertoString(a)),"Error"!=e){if(1==xa)var f=va.decompression_Zlib(a),g=new Uint16Array(f);else var g=new Uint16Array(a);var h=1,i=1,j=1;if(null==c||"undefined"==c)var k=parseFloat(b.localMaxBounding[0]),l=parseFloat(b.localMinBounding[0]),m=parseFloat(b.localMaxBounding[1]),n=parseFloat(b.localMinBounding[1]),o=parseFloat(b.localMaxBounding[2]),p=parseFloat(b.localMinBounding[2]);else{var k=parseFloat(c.MaxBounding[0]),l=parseFloat(c.MinBounding[0]),m=parseFloat(c.MaxBounding[1]),n=parseFloat(c.MinBounding[1]),o=parseFloat(c.MaxBounding[2]),p=parseFloat(c.MinBounding[2]);b.TempMaxBounding=[],b.TempMinBounding=[],b.TempMaxBounding[0]=k,b.TempMinBounding[0]=l,b.TempMaxBounding[1]=m,b.TempMinBounding[1]=n,b.TempMaxBounding[2]=o,b.TempMinBounding[2]=p}k-l!=0?h=65535/(k-l):0!=k&&(h=65535/k),m-n!=0?i=65535/(m-n):0!=m&&(i=65535/m),o-p!=0?j=65535/(o-p):0!=o&&(j=65535/o);for(var q=new Float32Array(g.length),r=0;r<g.length;r+=3)q[r]=g[r]/h+l,q[r+1]=g[r+1]/i+n,q[r+2]=g[r+2]/j+p;b.instances||(b.instances={});var s=b.instances;if(s[d]={},q&&q.length>0){if(null==s[d].triangle_buffer||"undefined"==s[d].triangle_buffer)var t=ma.createBuffer();else var t=s[d].triangle_buffer;if(s[d].vertexCount=q.length/3,ma.bindBuffer(ma.ARRAY_BUFFER,t),ma.bufferData(ma.ARRAY_BUFFER,q,ma.STATIC_DRAW),s[d].triangle_buffer=t,sb==d){var u=b.geometry.triangle_buffer;ma.bindBuffer(ma.ARRAY_BUFFER,u),ma.bufferData(ma.ARRAY_BUFFER,q,ma.STATIC_DRAW)}}q=null}}function _(a,b,c,d,e){var f="";if(5==b.byteLength&&(f=sa.convertArrayBuffertoString(b)),"Error"!=f){if(1==xa)var g=va.decompression_Zlib(b),h=new Uint16Array(g);else var h=new Uint16Array(b);var i=1,j=1,k=1;c.TempMaxBounding=[],c.TempMinBounding=[],null==d||"undefined"==d?(c.TempMaxBounding[0]=parseFloat(c.localMaxBounding[0]),c.TempMinBounding[0]=parseFloat(c.localMinBounding[0]),c.TempMaxBounding[1]=parseFloat(c.localMaxBounding[1]),c.TempMinBounding[1]=parseFloat(c.localMinBounding[1]),c.TempMaxBounding[2]=parseFloat(c.localMaxBounding[2]),c.TempMinBounding[2]=parseFloat(c.localMinBounding[2])):(c.TempMaxBounding[0]=parseFloat(d.MaxBounding[0])-parseFloat(c.localMaxBounding[0]),c.TempMinBounding[0]=parseFloat(d.MinBounding[0])-parseFloat(c.localMinBounding[0]),c.TempMaxBounding[1]=parseFloat(d.MaxBounding[1])-parseFloat(c.localMaxBounding[1]),c.TempMinBounding[1]=parseFloat(d.MinBounding[1])-parseFloat(c.localMinBounding[1]),c.TempMaxBounding[2]=parseFloat(d.MaxBounding[2])-parseFloat(c.localMaxBounding[2]),c.TempMinBounding[2]=parseFloat(d.MinBounding[2])-parseFloat(c.localMinBounding[2]));var l=parseFloat(a.MaxBounding[0]),m=parseFloat(a.MinBounding[0]),n=parseFloat(a.MaxBounding[1]),o=parseFloat(a.MinBounding[1]),p=parseFloat(a.MaxBounding[2]),q=parseFloat(a.MinBounding[2]);l-m!=0?i=65535/(l-m):0!=l&&(i=65535/l),n-o!=0?j=65535/(n-o):0!=n&&(j=65535/n),p-q!=0?k=65535/(p-q):0!=p&&(k=65535/p);for(var r=new Float32Array(h.length),s=0;s<h.length;s+=3)r[s]=h[s]/i+m,r[s+1]=h[s+1]/j+o,r[s+2]=h[s+2]/k+q;c.instances||(c.instances={});var t=c.instances;if(t[e]={},r&&r.length>0){if(null==t[e].triangle_buffer||"undefined"==t[e].triangle_buffer)var u=ma.createBuffer();else var u=t[e].triangle_buffer;if(t[e].vertexCount=r.length/3,ma.bindBuffer(ma.ARRAY_BUFFER,u),ma.bufferData(ma.ARRAY_BUFFER,r,ma.STATIC_DRAW),t[e].triangle_buffer=u,sb==e){var v=c.geometry.triangle_buffer;ma.bindBuffer(ma.ARRAY_BUFFER,v),ma.bufferData(ma.ARRAY_BUFFER,r,ma.STATIC_DRAW)}}r=null}}function aa(a,b,c,d){var e="";if(5==a.byteLength&&(e=sa.convertArrayBuffertoString(a)),"Error"!=e){if(1==xa)var f=va.decompression_Zlib(a),g=new Uint16Array(f);else var g=new Uint16Array(a);var h=1,i=1,j=1;if(null==c||"undefined"==c)var k=parseFloat(b.localMaxBounding[0]),l=parseFloat(b.localMinBounding[0]),m=parseFloat(b.localMaxBounding[1]),n=parseFloat(b.localMinBounding[1]),o=parseFloat(b.localMaxBounding[2]),p=parseFloat(b.localMinBounding[2]);else var k=parseFloat(c.MaxBounding[0]),l=parseFloat(c.MinBounding[0]),m=parseFloat(c.MaxBounding[1]),n=parseFloat(c.MinBounding[1]),o=parseFloat(c.MaxBounding[2]),p=parseFloat(c.MinBounding[2]);k-l!=0?h=65535/(k-l):0!=k&&(h=65535/k),m-n!=0?i=65535/(m-n):0!=m&&(i=65535/m),o-p!=0?j=65535/(o-p):0!=o&&(j=65535/o);for(var q=new Float32Array(g.length),r=0;r<g.length;r+=3)q[r]=g[r]/h+l,q[r+1]=g[r+1]/i+n,q[r+2]=g[r+2]/j+p;b.undeformInstances||(b.undeformInstances={});var s=b.undeformInstances;if(s[d]={},q&&q.length>0){if(null==s[d].triangle_buffer||"undefined"==s[d].triangle_buffer)var t=ma.createBuffer();else var t=s[d].triangle_buffer;if(s[d].vertexCount=q.length/3,ma.bindBuffer(ma.ARRAY_BUFFER,t),ma.bufferData(ma.ARRAY_BUFFER,q,ma.STATIC_DRAW),s[d].triangle_buffer=t,sb==d){var u=b.geometry.UNDEFORMED_MESHBUFFER;ma.bindBuffer(ma.ARRAY_BUFFER,u),ma.bufferData(ma.ARRAY_BUFFER,q,ma.STATIC_DRAW)}}q=null}}function ba(a,b,c){var d="";5==a.byteLength&&(d=sa.convertArrayBuffertoString(a));var e="UInt";if("Error"!=d){var f=b.undeformInstances;if(f[c]&&f[c].vertexCount>0){var g=b.geometry,h=f[c].vertexCount;if(b.GeometryType&&"4"==b.GeometryType&&a){if("UShort"==e)var i=new Uint16Array(a);else var i=new Uint32Array(a);h=i.length/2}else{var j=0,k=h/3,i=new Array(6*k);for(j=0;j<k;j++){var l=3*j,m=6*j;i[m+0]=l+0,i[m+1]=l+1,i[m+2]=l+1,i[m+3]=l+2,i[m+4]=l+2,i[m+5]=l+0}}var n=ma.getExtension("OES_element_index_uint");if(h>65535&&!n&&(alert("Extension OES_element_index_uint not exist"),CAXViewer.log("Extension OES_element_index_uint not exist")),i){if(null==f[c].UNDEFORM_MESH_INDEX_BUFFER||"undefined"==f[c].UNDEFORM_MESH_INDEX_BUFFER)var o=ma.createBuffer();else var o=f[c].UNDEFORM_MESH_INDEX_BUFFER;ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,o),n?ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint32Array(i),ma.STATIC_DRAW):ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint16Array(i),ma.STATIC_DRAW),f[c].UNDEFORM_MESH_INDEX_BUFFER=o,f[c].UNDEFORMED_MESH_COUNT=h}if(sb==c){if(g.UNDEFORMED_MESH_COUNT=h,g.line_count=h,null==g.line_connectivity_buffer||"undefined"==g.line_connectivity_buffer)var p=ma.createBuffer();else var p=g.line_connectivity_buffer;if(ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,p),n?ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint32Array(i),ma.STATIC_DRAW):ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint16Array(i),ma.STATIC_DRAW),g.line_connectivity_buffer=p,null==g.UNDEFORM_MESH_INDEX_BUFFER||"undefined"==g.UNDEFORM_MESH_INDEX_BUFFER)var o=ma.createBuffer();else var o=g.UNDEFORM_MESH_INDEX_BUFFER;ma.bindBuffer(ma.ELEMENT_ARRAY_BUFFER,o),n?ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint32Array(i),ma.STATIC_DRAW):ma.bufferData(ma.ELEMENT_ARRAY_BUFFER,new Uint16Array(i),ma.STATIC_DRAW),g.UNDEFORM_MESH_INDEX_BUFFER=o}}}}function ca(a,b,c){var d="";if(5==a.byteLength&&(d=sa.convertArrayBuffertoString(a)),"Error"!=d){if(1==xa)var e=va.decompression_Zlib(a),f=new Int8Array(e);else var f=new Int8Array(a);for(var g=new Float32Array(f.length),h=0;h<f.length;h++)g[h]=f[h]/127;var i=b.undeformInstances;if(g&&g.length>0){if(null==i[c].normal_buffer||"undefined"==i[c].normal_buffer)var j=ma.createBuffer();else var j=i[c].normal_buffer;if(ma.bindBuffer(ma.ARRAY_BUFFER,j),ma.bufferData(ma.ARRAY_BUFFER,g,ma.STATIC_DRAW),i[c].normal_buffer=j,sb==c){var k=b.geometry.UNDEFORMED_NORMALBUFFER;ma.bindBuffer(ma.ARRAY_BUFFER,k),ma.bufferData(ma.ARRAY_BUFFER,g,ma.STATIC_DRAW)}}g=null}}function da(a,b,c){var d="";if(5==a.byteLength&&(d=sa.convertArrayBuffertoString(a)),"Error"!=d){if(1==xa)var e=va.decompression_Zlib(a),f=new Int8Array(e);else var f=new Int8Array(a);for(var g=new Float32Array(f.length),h=0;h<f.length;h++)g[h]=f[h]/127;b.instances||(b.instances={});var i=b.instances;if(i[c]||(i[c]={}),g&&i&&g.length>0){if(null==i[c].normal_buffer||"undefined"==i[c].normal_buffer)var j=ma.createBuffer();else var j=i[c].normal_buffer;if(ma.bindBuffer(ma.ARRAY_BUFFER,j),ma.bufferData(ma.ARRAY_BUFFER,g,ma.STATIC_DRAW),i[c].normal_buffer=j,sb==c){var k=b.geometry.normal_buffer;ma.bindBuffer(ma.ARRAY_BUFFER,k),ma.bufferData(ma.ARRAY_BUFFER,g,ma.STATIC_DRAW)}}g=null}}function ea(b,c,d){var e=new Uint8Array(b),f="";if(5==b.byteLength&&(f=sa.convertArrayBuffertoString(b)),"Error"!=f){if(1==xa)var g=va.decompression_Zlib(b),e=new Uint8Array(g);else var e=new Uint8Array(b);c.instances||(c.instances={});var h=c.instances;h[d]||(h[d]={});var i=new Float32Array(2*e.length);if(e&&1==bb)for(var j=0;j<e.length;j++)i[2*j+0]=e[j]/255,i[2*j+1]=.5;if(i&&h&&i.length>0){if(null==h[d].texcoords_buffer||"undefined"==h[d].texcoords_buffer)var k=ma.createBuffer();else var k=h[d].texcoords_buffer;if(ma.bindBuffer(ma.ARRAY_BUFFER,k),ma.bufferData(ma.ARRAY_BUFFER,i,ma.STATIC_DRAW),h[d].texcoords_buffer=k,sb==d){null!=c.geometry.texcoords_buffer&&"undefined"!=c.geometry.texcoords_buffer||(c.geometry.texcoords_buffer=ma.createBuffer());var l=c.geometry.texcoords_buffer;ma.bindBuffer(ma.ARRAY_BUFFER,l),ma.bufferData(ma.ARRAY_BUFFER,i,ma.STATIC_DRAW)}}i=null}if(Tb+=1,Tb==Rb){Jb=Rb,Tb=0,zb++;var m="Loading frame "+zb+" of "+ub.length;if(a.updateStatus(m),ra){var n={Operation:CAXViewer.serverOperations.getAnimationCAEInfo,Data:""};ra.send(JSON.stringify(n),function(a){var b=sa.convertArrayBuffertoString(a),c=JSON&&JSON.parse(b)||$.parseJSON(b);vb.push(c)})}if(ra){var n={Operation:CAXViewer.serverOperations.getAnimationLabels,Data:""};ra.send(JSON.stringify(n),function(a){var b=sa.convertArrayBuffertoString(a),c=JSON&&JSON.parse(b)||$.parseJSON(b);wb.push(c)})}if(0==a.getUseStreaming()){var o=ta.getAnimationCAEInfo(d,na),p=sa.convertArrayBuffertoString(o),q=JSON&&JSON.parse(p)||$.parseJSON(p);vb.push(q);var o=ta.getAnimationLabels(d,na),p=new Uint8Array(o),r=sa.Utf8ArrayToStr(p),q=JSON&&JSON.parse(r)||$.parseJSON(r);wb.push(q);var o=ta.getAnimationSymbolPlots(d,na),p=sa.convertArrayBuffertoString(o),q=JSON&&JSON.parse(p)||$.parseJSON(p);xb.push(q)}zb<ub.length?X(ub[zb],!0):(a.updateStatus(""),X(sb,!1))}}function fa(a,b){if(null!=la&&"undefined"!=la){var c=Ua;if(""!=b&&(c=b),la.CAE_Info&&(la.CAE_Info.Instance=c),a<vb.length&&a>=0){var d=vb[a];d.AttribList&&i(d.AttribList);var e={};e.rangeMax=d.Range_Max,e.rangeMin=d.Range_Min,e.textArray=[],e.textArray[0]=na,e.textArray[1]=Ta,""!=Va&&(e.textArray[1]=e.textArray[1]+" : "+Va),d.sUnit&&(e.sUnit=d.sUnit,e.textArray[1]=e.textArray[1]+" (in "+d.sUnit+")"),e.textArray[2]=c,d.Instance&&(e.textArray[2]=d.Instance);ua.updateLegend(na,e);d.PivotDeformationValue?(ka.setTransientPivotAnimation(!0),ka.setTransientPivotVector(d.PivotDeformationValue)):(ka.setTransientPivotAnimation(!1),ka.setTransientPivotVector([0,0,0]))}}}function ga(b,c){var d=a.getLabelManager();if(null!=d&&"undefined"!=d&&b<wb.length&&b>=0){var e=wb[b],f=d.labelArray,g=[];g.push.apply(g,e["3DLabels"]),g.push.apply(g,e["3DMINMAXLabels"]),g.push.apply(g,e.ProbeTable),g.push.apply(g,e.ProbeXYPlot);var h=0;for(h=0;h<g.length;h++){if(""==g[h].ModelName){var i=sa.getDataFromArray(f,"ID",g[h].ID);i&&i.setVisibility(!1)}if(g[h].ModelName==na){var j=g[h],k=0;for(k=0;k<f.length;k++){var i=f[k];if(i.getLabelType()==d.type[1]&&(i.getLabelSubType()==d.subTypeFor3DLabel[0]||i.getLabelSubType()==d.subTypeFor3DLabel[1]||i.getLabelSubType()==d.subTypeFor3DLabel[2])&&j.ID==i.ID&&i.modelName==na)if(i.customData.AnimationPoint3D=!0,i.customData.AnimationLabelUndeformedPosition=j.LabelUndeformedPosition,i.customData.AnimationLabeldeformedPosition=j.LabeldeformedPosition,i.setVisibility(j.isVisible),i.getLabelSubType()==d.subTypeFor3DLabel[0]||i.getLabelSubType()==d.subTypeFor3DLabel[1])i.setMesssage(sa.decode_utf8(j.Text));else if(j.PlotData){var l=j.PlotData;i.customData.chartObject.config.endDrawScaleFunction=drawShapes;var m=i.customData.chartObject.data.labels.length-1,n=i.customData.chartObject.data.labels[0],o=i.customData.chartObject.data.labels[m],p=m,q=l.curveDataArray[0].x[b],r=p*((q-n)/(o-n));i.customData.chartObject.data.shapesInChart=[{position:"INCHART",shape:"Square",sideCount:4,strokeColor:"red",fillColor:"blue",radius:5,animate:!0,x1:r,y1:l.curveDataArray[0].y[b],iter:"ALL"}],updateChart(i.customData.chartObject.ctx,i.customData.chartObject.data,i.customData.chartObject.config,!1,!1)}else i.setMesssage(sa.decode_utf8(j.Message))}}}for(h=0;h<e.ProbeTable.length;h++){for(var s=e.ProbeTable[h],t=s.multiPartTableInfo,u=null,k=0;k<f.length;k++){var i=f[k];if(s.ID==i.ID){u=f[k];break}}if(null!=u&&t)for(var k=0;k<t.length;k++)t[k].ModelName==na&&1==s.bIsMultiPartTable&&(u.customData.AnimationLabelMultiPartTableInfo=s.multiPartTableInfo)}}}function ha(b,c){if(1==a.isAnimationOn()&&1==a.isAnimationPaused()){if(null==ka.symbolPlotManager||"undefined"==ka.symbolPlotManager)return;if(b<xb.length&&b>=0){var d=xb[b].SymbolPlotMgrState;if(ka.symbolPlotManager&&d){ka.symbolPlotManager.clearAll(),ka.symbolPlotManager.iVersion=d.iVersion,ka.symbolPlotManager.sCurPlotName=d.sCurPlotName;for(var e=0;e<d.SymbolPlotArray.length;e++){var f=d.SymbolPlotArray[e],g=new CAXViewer.symbolPlot(a);g.iVersion=f.iVersion,g.SymbolPlotName=f.SymbolPlotName,g.bDraw=f.bDraw,g.iSymbolVectorType=f.iSymbolVectorType,g.iShapeType=f.iShapeType,g.iViewMode=f.iViewMode,g.sResult=f.sResult,g.sDerived=f.sDerived,g.sInstance=f.sInstance,g.sComplexComp=f.sComplexComp,g.fComplexAngle=f.fComplexAngle,g.fLengthSF=f.fLengthSF,g.fWidthSF=f.fWidthSF,g.colorArray=f.colorArray,g.SymbolPlotNodeStateArray=[];for(var h=0;h<f.SymbolPlotNodeStateArray.length;h++)for(var i=f.SymbolPlotNodeStateArray[h],j=i.SymbolPlotNodeName,k=0;k<i.SymbolPlotNodeState.length;k++){var l=i.SymbolPlotNodeState[k],m=new CAXViewer.SymbolPlotNodeState;m.SymbolPlotNodeStateGrpName=j,m.DirVector=l.DirVector,l.vertexNormal&&(m.vertexNormal=l.vertexNormal),m.UndeformedPosition=l.UndeformedPosition,l.deformedPosition?m.deformedPosition=l.deformedPosition:m.deformedPosition=l.UndeformedPosition,l.RealResult&&(m.RealResult=l.RealResult),l.ImaginaryResult&&(m.ImaginaryResult=l.ImaginaryResult),m.sPartName=l.sPartName,m.iVersion=l.iVersion,m.sModelName=l.sModelName,m.iSymbolPlotDrawType=l.iSymbolDrawType,g.SymbolPlotNodeStateArray.push(m)}g.createBuffers(),ka.symbolPlotManager.symbolPlotArray.push(g)}}}}}function ia(a){wa.animateDataPointForTransient(a)}function ja(a){var c=b(la,null);if(c)for(var d=0;d<c.length;d++){var e=c[d].node;if("Shape"==e.Type&&0!=e.hasOwnProperty("key")&&null!=e.key){var f=e.instances;if(f)for(var g in f)f[g].triangle_buffer&&(ma.deleteBuffer(f[g].triangle_buffer),f[g].triangle_buffer=null),f[g].normal_buffer&&(ma.deleteBuffer(f[g].normal_buffer),f[g].normal_buffer=null),f[g].texcoords_buffer&&(ma.deleteBuffer(f[g].texcoords_buffer),f[g].texcoords_buffer=null),f[g].vertexCount=null;var h=e.undeformInstances;if(h)for(var i in h)h[i].triangle_buffer&&(ma.deleteBuffer(h[i].triangle_buffer),h[i].triangle_buffer=null),h[i].normal_buffer&&(ma.deleteBuffer(h[i].normal_buffer),h[i].normal_buffer=null),h[i].UNDEFORM_MESH_INDEX_BUFFER&&(ma.deleteBuffer(h[i].UNDEFORM_MESH_INDEX_BUFFER),h[i].UNDEFORM_MESH_INDEX_BUFFER=null),h[i].vertexCount=null,h[i].UNDEFORMED_MESH_COUNT=null}}}var ka=this,la=null,ma=null;this.bounds,this.center,this.originalCenter,this.normalizedScale=1;var na="";this.getModelName=function(){return na};var oa={};oa.min=[1e6,1e6,1e6],oa.max=[-1e6,-1e6,-1e6];var pa,qa,ra=a.getWebSocket(),sa=a.getUtility(),ta=(a.getLoader(),a.getMCAXloader()),ua=a.getWebgl(),va=a.getCompression(),wa=a.getXYPlotManager(),xa=!1,ya=0,za=0,Aa=0,Ba=[0,0,0];this.getModelLength=function(){return za},this.getLoadedPart=function(){return Aa};var Ca=!1;this.getIsDeformed=function(){return Ca},this.setIsDeformed=function(a){Ca=a};var Da=!1;this.getIsCAEModeCase=function(){return Da},this.setIsCAEModeCase=function(a){Da=a};var Ea=!1;this.getIsCAEMovingMesh=function(){return Ea},this.setIsCAEMovingMesh=function(a){Ea=a};var Fa=!1;this.getIsUndeformMovingMeshAvailable=function(){return Fa};var Ga=!1,Ha=!1;this.getIsUnDeformed=function(){return Ha};var Ia=[.5,.5,.5];this.setUndeformedMeshColor=function(a){Ia=a};var Ja=CAXViewer.iUndformedMeshMode.UNDEFORMED_WIREFRAME;this.setUndeformedMeshType=function(a){Ja=a};var Ka=!1,La=!1,Ma=1,Na=[0,0,0],Oa=35;this.setFeatureEdge=function(a,b,c,d,e){Ka=a,La=1==Ka&&b,Ma=c,Na=d,Oa=e};var Pa=[0,0,0];this.setShadedMeshColor=function(a){Pa=a};var Qa=!1,Ra=[1,1,1];this.enableNoResult=function(){Qa=!0},this.disableNoResult=function(){Qa=!1},this.setNoResultColor=function(a){Ra=a};var Sa=!1,Ta="",Ua="",Va="",Wa=!1;this.getcurrentCAEResult=function(){return Ta},this.getcurrentCAEInstance=function(){return Ua},this.getcurrentDerivedType=function(){return Va},this.getIsCAETransientResult=function(){return Wa},this.setIsCAETransientResult=function(a){Wa=a},this.getIsCAEModel=function(){return Sa},this.symbolPlotManager=null,this.updateSymbolPlotManager=function(){ka.symbolPlotManager&&ka.symbolPlotManager.updateBuffers()},this.clearSymbolPlot=function(){ka.symbolPlotManager&&ka.symbolPlotManager.clearAll();
};var Xa,Ya,Za=!1,$a=!0,_a=[1,1,0],ab=!1;this.getModelMinMax=function(){var a={};return a.min=Xa,a.max=Ya,a};var bb=0,cb=CAXViewer.ClipEdgeColor[0];this.setClipEdgeColor=function(a){cb=a};var db=!1,eb=[0,0,0];this.setTransientPivotAnimation=function(a){db=a},this.setTransientPivotVector=function(a){eb=a};var fb=0;this.getVisiblePartCount=function(){var a=0,c=b(la,null);if(c)for(var d=0;d<c.length;d++){var e=c[d].node,f=e.Type;c[d].transform;"Shape"==f&&1==e.visible&&a++}return a},this.setVisiblePartCount=function(){fb=ka.getVisiblePartCount()},this.freeModel=function(){if(null!=la){var a=la.CAE_Info;if(a){var c=a.texture,d=a.orginaltexture,e=a.reversetexture;c&&ma.deleteTexture(c),d&&ma.deleteTexture(d),e&&ma.deleteTexture(e)}for(var f=b(la,null),g=0;g<f.length;g++){var h=f[g].node;if("Transform"!=h.Type&&"Shape"==h.Type){var i=h.geometry;if(i){var j=i.triangle_buffer,k=i.normal_buffer,l=i.MESH_INDEX_BUFFER,m=i.texcoords_buffer,n=i.ResultTexCoord,o=i.line_buffer,p=i.line_normal_buffer,q=i.line_texcoords_buffer,r=i.line_connectivity_buffer,s=i.UNDEFORMED_MESHBUFFER,t=i.UNDEFORMED_NORMALBUFFER,u=i.UNDEFORM_MESH_INDEX_BUFFER,v=i.UNDEFORMED_MESH_FEATUREEDGEBUFFER,w=i.FEATUREEDGEBUFFER,x=i.realResult_buffer,y=i.imaginaryResult_buffer,z=i.targetFrame_buffer,A=i.targetFrameNormal_buffer,B=i.targetFrameTexcoords_buffer,C=i.contourLineVertices_Buffer,D=i.contourLineColors_Buffer,E=i.vectorPlotVertices_Buffer;ma.deleteBuffer(j),ma.deleteBuffer(k),l&&ma.deleteBuffer(l),ma.deleteBuffer(m),n&&ma.deleteBuffer(n),ma.deleteBuffer(o),ma.deleteBuffer(p),ma.deleteBuffer(q),ma.deleteBuffer(r),ma.deleteBuffer(s),ma.deleteBuffer(t),ma.deleteBuffer(u),ma.deleteBuffer(v),w&&ma.deleteBuffer(w),ma.deleteBuffer(x),ma.deleteBuffer(y),ma.deleteBuffer(z),ma.deleteBuffer(A),ma.deleteBuffer(B),ma.deleteBuffer(C),ma.deleteBuffer(D),ma.deleteBuffer(E)}var F=h["bounding-box-geom"],G=h["bounding-box-geom-triangles"],H=h["bounding-box-Texcoords"];ma.deleteBuffer(G),ma.deleteBuffer(F),ma.deleteBuffer(H)}}ka.clearSymbolPlot(),ka.stopAnimation(!1),la=null}},this.getModel=function(){return la},this.getPartForPartName=function(a){for(var c=b(la,null),d=0;d<c.length;d++){var e=c[d].node;if("Transform"!=e.Type&&null!=e.geometry&&e.Name==a)return e}return null},this.getPartForPartKey=function(a){for(var c=b(la,null),d=0;d<c.length;d++){var e=c[d].node;if("Transform"!=e.Type&&null!=e.geometry&&e.key==a)return e}return null},this.getPartForPartNameAndKey=function(a,c){for(var d=b(la,null),e=0;e<d.length;e++){var f=d[e].node;if("Transform"!=f.Type&&null!=f.geometry&&f.Name==a&&f.key==c)return f}return null},this.addTempNode=function(a,b){var c={};c.Name=a.Name+"_temp",c.PartNumber=ya++,c.Type="Transform",c.key="temp_"+b.key;var d=mat4.create();mat4.identity(d),c.transformMatrix=d;var e=b.translation,f=b.rotation,g=b.scale;c.transformMatrix=sa.findTransformMatrix(e,f,g),c.children=a.children,a.children=[c]},this.applyNodeTransform=function(a){for(var c=b(la,null),d=0;d<c.length;d++){var e=c[d].node;if("Transform"==e.Type&&e.Name==a.Name&&e.key==a.key){var f=a.translation,g=a.rotation,h=a.scale,i=sa.findTransformMatrix(f,g,h);e.transformMatrix=i}}},this.removeAllTempNode=function(){for(var a=b(la,null),c=0;c<a.length;c++){var d=a[c].node;if("Transform"==d.Type&&d.Name.indexOf("_temp")>-1&&d.key.indexOf("temp_")>-1){var e=d.Name.replace("_temp",""),f=ka.getNodeforNodeName(e);f&&(f.children=d.children)}}},this.getNodeforNodeName=function(a){for(var c=b(la,null),d=0;d<c.length;d++){var e=c[d].node;if(e.Name==a)return e}return null},this.loadFromJSON=function(b){ma=ua.getGL(),Ya=[0,0,0],Xa=[0,0,0],this.freeModel();try{var e=JSON&&JSON.parse(b)||$.parseJSON(b)}catch(a){return void CAXViewer.warn("Invalid Json")}Ga=e.isUserViewPointApplied,Ca=e.isDeformApplied,null!==e.isCAEMovingMesh&&void 0!==e.isCAEMovingMesh&&(Ea=e.isCAEMovingMesh),e.isCAEModeCase&&(Da=e.isCAEModeCase);var f=e.CAEAnimationType;if(f==-1?(a.enableCAEAnimationIcon(!1),a.DisableLegendIcon(!0),a.enableFrameInfoIcon(!1),Sa=!1):(a.enableCAEAnimationIcon(!0),a.DisableLegendIcon(!1),a.enableFrameInfoIcon(!0),Sa=!0),null!=e.Scene_Root){e.Scene_Root instanceof Array&&(e.Scene_Root=e.Scene_Root[0]),e.Scene_Root&&(na=e.ModelName),d(e),this.bounds=[Ya[0]-Xa[0],Ya[1]-Xa[1],Ya[2]-Xa[2]],this.center=[(Ya[0]+Xa[0])/2,(Ya[1]+Xa[1])/2,(Ya[2]+Xa[2])/2],CAXViewer.log("after.bounds = ",this.bounds),CAXViewer.log("after.center = ",this.center);var g={};switch(g.Name=na+"_ModelContainer",g.children=new Array(e.Scene_Root),g.CAE_Info=e.CAE_Info,la=g,CAXViewer.log(la),c(la),this.originalCenter=[this.center[0],this.center[1],this.center[2]],this.center=[0,0,0],ua.updateSensitivity(),ka.updateBoundingBox(),CAXViewer.log("CAEAnimationType : "+f),f){case 0:Qb=CAXViewer.CAEAnimationType.LINEAR;break;case 1:Qb=CAXViewer.CAEAnimationType.TRANSIENT;break;case 3:Qb=CAXViewer.CAEAnimationType.EIGEN_VECTOR;break;case 5:Qb=CAXViewer.CAEAnimationType.EIGEN_VECTOR_COMPLEX}""==Ta&&(a.DisableLegendIcon(!0),a.enableCAEAnimationIcon(!1))}};var gb=[];this.getFrameInfoArray=function(){return gb},this.loadAllParts=function(){var a=b(la,null);if(null!=a&&"undefined"!=a&&(za=ka.getAllPartNames().length,Aa=0,Ba=[0,0,0],pa=Date.now(),a))for(var c=0;c<a.length;c++){var d=a[c].node;"Shape"==d.Type&&(d.geometry||k(d))}},this.unLoadAllParts=function(){for(var a=b(la,null),c=0;c<a.length;c++){var d=a[c].node;"Shape"==d.Type&&null!=d.geometry&&UnloadPart(d)}},this.loadSelectedParts=function(){for(var a=b(la,null),c=0;c<a.length;c++){var d=a[c].node;d.geometry||1==d.selected&&k(d)}},this.unLoadSelectedParts=function(){CAXViewer.log("UnloadSelected");for(var a=b(la,null),c=0;c<a.length;c++){var d=a[c].node;1==d.selected&&(d=a[c].node,UnloadPart(d),d.selected=0)}};var hb=35,ib=!1;this.getAllPartNames=function(){var a=[],c=b(la,null);if(null!=c&&"undefined"!=c){for(var d=0;d<c.length;d++){var e=c[d].node;"Shape"==e.Type&&a.push({name:e.Name,key:e.key})}return a}},this.setPartVisible=function(a,c){for(var d=b(la,null),e=0;e<d.length;e++){var f=d[e].node;if(f.Name==a){f.visible=c;break}}},this.getPartVisible=function(a){for(var c=b(la,null),d=0;d<c.length;d++){var e=c[d].node;if(e.Name==a)return e.visible}return!1},this.setViewPartData=function(a,c){var d=b(la,null),e=c.Visible,f=c.DisplayMode,g=c.ColorPlot,h=!1;if(null!=c.bUndeformedMesh&&void 0!=c.bUndeformedMesh&&(h=c.bUndeformedMesh,1==h&&(Ha=!0)),c.ExplodeTranslation)var i=c.ExplodeTranslation;if(c.diffuseColor)var j=[c.diffuseColor[0],c.diffuseColor[1],c.diffuseColor[2]];for(var k=0;k<d.length;k++){var l=d[k].node;if("Transform"!=l.Type&&l.Name==a){switch(l.visible=e,l.transparent=0,f){case"1":case 1:f=CAXViewer.displayModes.shaded;break;case"2":case 2:f=CAXViewer.displayModes.shadedMesh;break;case"3":case 3:f=CAXViewer.displayModes.wire;break;case"4":case 4:f=CAXViewer.displayModes.hiddenLine;break;case"5":case 5:f=CAXViewer.displayModes.point;break;case"6":case 6:f=CAXViewer.displayModes.shaded,l.transparent=1;break;default:f=CAXViewer.displayModes.shaded}l.displaymode=f,l.usetexture=g,l.bUndeformedMesh=h,i&&ka.applyTranslationToPart(l,[i[0],i[1],i[2]]),j&&(l.Appearance.Material.diffuseColor=j);break}}},this.setTexture=function(a){for(var c=b(la,null),d=0,e=0;e<c.length;e++){var f=c[e].node;null==f.usetexture&&(f.usetexture=0),1==f.selected&&(f.usetexture=a,d++)}if(0==d)for(var e=0;e<c.length;e++){var f=c[e].node;null==f.usetexture&&(f.usetexture=0),f.usetexture=a}},this.setDisplayMode=function(a){ka.makeSelectedTransparent(0),a==CAXViewer.displayModes.transparent&&(a=0,ka.makeSelectedTransparent(1));for(var c=b(la,null),d=0,e=0;e<c.length;e++){var f=c[e].node;1==f.selected&&(a!=CAXViewer.displayModes.shadedMesh&&a!=CAXViewer.displayModes.wire&&a!=CAXViewer.displayModes.hiddenLine||f.geometry&&(null!=f.geometry.line_count&&"undefined"!=f.geometry.line_count||("3"==f.GeometryType&&s(f),"4"==f.GeometryType&&q(f))),f.displaymode=a,d++)}if(0==d)for(var e=0;e<c.length;e++){var f=c[e].node;a!=CAXViewer.displayModes.shadedMesh&&a!=CAXViewer.displayModes.wire&&a!=CAXViewer.displayModes.hiddenLine||f.geometry&&(null!=f.geometry.line_count&&"undefined"!=f.geometry.line_count||("3"==f.GeometryType&&s(f),"4"==f.GeometryType&&q(f))),f.displaymode=a}},this.getTransformMatrixForNode=function(c){for(var d=b(la,null),e=0;e<d.length;e++){var f=d[e].node;if("Shape"==f.Type&&0!=f.visible&&c.Name==d[e].node.Name&&c.key==d[e].node.key){var g=d[e].transform,h=mat4.create();if(mat4.identity(h),mat4.translate(h,[-ka.originalCenter[0],-ka.originalCenter[1],-ka.originalCenter[2]],h),mat4.multiply(h,g,h),f.supplementalTranslation||f.supplementalRotation||f.supplementalRotation_pick){if(f.supplementalTranslation){var i=mat4.create();mat4.identity(i);var j=f.supplementalTranslation;mat4.translate(i,j),mat4.identity(h),mat4.multiply(h,i,h);var k=a.getModelOriginalCenter();mat4.translate(h,[-k[0],-k[1],-k[2]],h),mat4.multiply(h,g,h)}if(f.supplementalRotation_pick){var l=mat4.create();mat4.identity(l),l=f.supplementalRotation_pick;var m=mat4.create();mat4.identity(m),mat4.translate(m,[-f.localCenter[0],-f.localCenter[1],-f.localCenter[2]]);var n=mat4.create();mat4.identity(n),mat4.translate(n,[f.localCenter[0],f.localCenter[1],f.localCenter[2]]);var o=mat4.create();mat4.identity(o),mat4.multiply(o,l,o),mat4.multiply(h,o,h)}if(f.supplementalRotation){var l=mat4.create();mat4.identity(l),l=f.supplementalRotation;var m=mat4.create();mat4.identity(m),mat4.translate(m,[-f.localCenter[0],-f.localCenter[1],-f.localCenter[2]]);var n=mat4.create();mat4.identity(n),mat4.translate(n,[f.localCenter[0],f.localCenter[1],f.localCenter[2]]);var o=mat4.create();mat4.identity(o),mat4.multiply(o,n,o),mat4.multiply(o,l,o),mat4.multiply(o,m,o),mat4.multiply(h,o,h)}}return h}}return null},this.getTransformMatrixMatrixForNode=function(a,c){for(var d=b(la,null),e=0;e<d.length;e++){var f=d[e].node;if("Transform"!=f.Type&&0!=f.visible&&null!=f.geometry&&a==d[e].node.Name&&c==d[e].node.key){var g=d[e].transform,h=mat4.create();if(mat4.identity(h),mat4.translate(h,[-ka.originalCenter[0],-ka.originalCenter[1],-ka.originalCenter[2]],h),mat4.multiply(h,g,h),f.supplementalTranslation||f.supplementalRotation||f.supplementalRotation_pick){if(f.supplementalTranslation){var i=mat4.create();mat4.identity(i);var j=f.supplementalTranslation;mat4.translate(i,j),mat4.identity(h),mat4.multiply(h,i,h),mat4.translate(h,[-ka.originalCenter[0],-ka.originalCenter[1],-ka.originalCenter[2]],h),mat4.multiply(h,g,h)}if(f.supplementalRotation_pick){var k=mat4.create();mat4.identity(k),k=f.supplementalRotation_pick;var l=mat4.create();mat4.identity(l),mat4.translate(l,[-f.localCenter[0],-f.localCenter[1],-f.localCenter[2]]);var m=mat4.create();mat4.identity(m),mat4.translate(m,[f.localCenter[0],f.localCenter[1],f.localCenter[2]]);var n=mat4.create();mat4.identity(n),mat4.multiply(n,k,n),mat4.multiply(h,n,h)}if(f.supplementalRotation){var k=mat4.create();mat4.identity(k),k=f.supplementalRotation;var l=mat4.create();mat4.identity(l),mat4.translate(l,[-f.localCenter[0],-f.localCenter[1],-f.localCenter[2]]);var m=mat4.create();mat4.identity(m),mat4.translate(m,[f.localCenter[0],f.localCenter[1],f.localCenter[2]]);var n=mat4.create();mat4.identity(n),mat4.multiply(n,m,n),mat4.multiply(n,k,n),mat4.multiply(n,l,n),mat4.multiply(h,n,h)}}return h}}return null},this.getTransformMatrixMatrixAndDeformVertex=function(a,c){var d=b(la,null);if(null==d||"undefined"==d)return null;for(var e=0;e<d.length;e++){var f=d[e].node;if("Transform"!=f.Type&&0!=f.visible&&null!=f.geometry&&"undefined"!=f.geometry&&a==d[e].node.Name&&c==d[e].node.key){var g=d[e].transform,h=mat4.create();if(mat4.identity(h),mat4.multiply(h,g,h),f.supplementalTranslation||f.supplementalRotation||f.supplementalRotation_pick){if(f.supplementalTranslation){var i=mat4.create();mat4.identity(i);var j=f.supplementalTranslation;mat4.translate(i,j),mat4.identity(h),mat4.multiply(h,i,h),mat4.multiply(h,g,h)}if(f.supplementalRotation_pick){var k=mat4.create();mat4.identity(k),k=f.supplementalRotation_pick;var l=mat4.create();mat4.identity(l),mat4.translate(l,[-f.localCenter[0],-f.localCenter[1],-f.localCenter[2]]);var m=mat4.create();mat4.identity(m),mat4.translate(m,[f.localCenter[0],f.localCenter[1],f.localCenter[2]]);var n=mat4.create();mat4.identity(n),mat4.multiply(n,k,n),mat4.multiply(h,n,h)}if(f.supplementalRotation){var k=mat4.create();mat4.identity(k),k=f.supplementalRotation;var l=mat4.create();mat4.identity(l),mat4.translate(l,[-f.localCenter[0],-f.localCenter[1],-f.localCenter[2]]);var m=mat4.create();mat4.identity(m),mat4.translate(m,[f.localCenter[0],f.localCenter[1],f.localCenter[2]]);var n=mat4.create();mat4.identity(n),mat4.multiply(n,m,n),mat4.multiply(n,k,n),mat4.multiply(n,l,n),mat4.multiply(h,n,h)}}var o=f.geometry.point;return[h,o]}}return null},this.applyRotationToSelectedParts=function(a,c,d){for(var e=b(la,null),f=0;f<e.length;f++){var g=e[f].node;if(1==g.selected){null!=g.supplementalRotation&&"undefined"!=g.supplementalRotation||(g.supplementalRotation=mat4.create(),mat4.identity(g.supplementalRotation));var h=g.transformMatrix,i=mat4.create(d);mat4.multiply(i,h,i);var j=mat4.create(i);mat4.inverse(j);var k=j[12],l=j[13],m=j[14];j[12]=j[3],j[13]=j[7],j[14]=j[11],j[3]=k,j[7]=l,j[11]=m;var n=vec3.create();mat4.multiplyVec3(j,a,n);var o=mat4.create();mat4.identity(o),CAXViewer.log(n),mat4.rotate(o,c,n),mat4.multiply(g.supplementalRotation,o,g.supplementalRotation)}}},this.applyRotationToPart=function(a,b,c){if(a&&c){a.transformMatrix;null!=a.supplementalRotation_pick&&"undefined"!=a.supplementalRotation_pick||(a.supplementalRotation_pick=mat4.create(),mat4.identity(a.supplementalRotation_pick));var d=mat4.create();mat4.identity(d),mat4.rotate(d,b,c),mat4.multiply(a.supplementalRotation_pick,d,a.supplementalRotation_pick)}},this.applyTranslationToSelectedParts=function(a,c){for(var d=b(la,null),e=0;e<d.length;e++){var f=d[e].node;if("Shape"==f.Type&&1==f.selected){f.transformMatrix;null!=f.supplementalTranslation&&"undefined"!=f.supplementalTranslation||(f.supplementalTranslation=[0,0,0]);var g=([a[0],a[1],a[2]],mat4.create(c));g=mat4.inverse(g);var h=vec3.create([a[0],a[1],a[2]]),i=vec3.create(h);mat4.multiplyVec3(g,i,h);var j=[h[0],h[1],h[2]];f.supplementalTranslation[0]+=j[0],f.supplementalTranslation[1]+=j[1],f.supplementalTranslation[2]+=j[2]}}},this.applyTranslationToPart=function(a,b){a&&b&&(null!=a.supplementalTranslation&&"undefined"!=a.supplementalTranslation||(a.supplementalTranslation=[0,0,0]),a.supplementalTranslation[0]=a.supplementalTranslation[0]+b[0],a.supplementalTranslation[1]=a.supplementalTranslation[1]+b[1],a.supplementalTranslation[2]=a.supplementalTranslation[2]+b[2])},this.makeSelectedTransparent=function(a){for(var c=b(la,null),d=0,e=0;e<c.length;e++){var f=c[e].node;"Shape"==f.Type&&(null==f.transparent&&(f.transparent=0),1==f.selected&&(f.transparent=a,d++))}if(0==d)for(var e=0;e<c.length;e++){var f=c[e].node;"Shape"==f.Type&&(null==f.transparent&&(f.transparent=0),f.transparent=a)}},this.selectedPartsCount=function(){var a=0;if(null==la)return a;for(var c=b(la,null),d=0;d<c.length;d++){var e=c[d].node;"Shape"==e.Type&&1==e.selected&&a++}return a},this.deselectAll=function(){for(var a=b(la,null),c=0;c<a.length;c++){var d=a[c].node;"Shape"==d.Type&&(d.selected=0)}},this.resetSupplementalTransformations=function(){for(var a=b(la,null),c=0;c<a.length;c++){var d=a[c].node;"Shape"==d.Type&&(d.selected=0,d.supplementalTranslation=null,d.supplementalRotation=null,d.supplementalRotation_pick=null)}},this.pickNode=function(a){var c=b(la,null),d=0;for(d=0;d<c.length;d++){var e=c[d].node;if("Shape"==e.Type){var f=e.pickingColor;if(null!=f&&f[0]==a[0]&&f[1]==a[1]&&f[2]==a[2])return e}}return null},this.getPickedNode=function(a,b){if(!a||!b)return null;webGL.renderNormalScene(!0);var c=new Uint8Array(new Array(0,0,0,0));ma.readPixels(a,b,1,1,ma.RGBA,ma.UNSIGNED_BYTE,c);var d=ka.pickNode([c[0],c[1],c[2]]);return d},this.setReverseTexture=function(a){var b=la.CAE_Info;b&&(1==a?b.texture=b.reversetexture:b.texture=b.orginaltexture,ua.changeLegendColorOrder(na,a))},this.updateCEAInfo=function(a,b,c){var d=la.CAE_Info;if(d&&a){for(var e=a.Colour_Array,f=[],g=0;g<e.length/3;g++){var h=[e[3*g+0],e[3*g+1],e[3*g+2]];f[g]=h}d.Colour_Array=f;var i={};i.colorArray=f,i.rangeMax=a.Range_Max,i.rangeMin=a.Range_Min,i.discreteMode=a.Discrete_Color,i.isReversed=!1;ua.updateLegend(na,i)}if(d&&b){d.texture;ma.deleteTexture(d.texture),d.texture=null;d.orginaltexture;ma.deleteTexture(d.orginaltexture),d.orginaltexture=null;var k=d.reversetexture;ma.deleteTexture(d.reversetexture),d.reversetexture=null,bb=b.PixelTextureHeight,d.PixelTextureWidth=b.PixelTextureWidth,d.PixelTextureHeight=b.PixelTextureHeight,d.PixelTexture=b.PixelTexture;var l=d.PixelTexture;if(null==l||0==l.length)return;var m=j(d.PixelTextureWidth,d.PixelTextureHeight,3,l.slice(0));d.texture=m;for(var n=[],g=d.PixelTexture.length-1;g>=0;g-=3)n=n.concat(d.PixelTexture[g-2]),n=n.concat(d.PixelTexture[g-1]),n=n.concat(d.PixelTexture[g]);var k=j(d.PixelTextureWidth,d.PixelTextureHeight,3,n.slice(0));c?(d.reversetexture=m,d.orginaltexture=k):(d.reversetexture=k,d.orginaltexture=m)}},this.getupdatedBoundingBox=function(){var a={};a.min=[1e6,1e6,1e6],a.max=[-1e6,-1e6,-1e6];var c=b(la,null);if(c)for(var d=0;d<c.length;d++){var e=c[d].node,f=e.Type;if("Shape"==f){var g=[];g[0]=e.localMinBounding[0],g[1]=e.localMinBounding[1],g[2]=e.localMinBounding[2];var h=[];h[0]=e.localMaxBounding[0],h[1]=e.localMaxBounding[1],h[2]=e.localMaxBounding[2];var i=mat4.create();if(mat4.identity(i),e.supplementalTranslation||e.supplementalRotation||e.supplementalRotation_pick){if(e.supplementalTranslation){var j=e.supplementalTranslation;mat4.translate(i,j,i)}if(e.supplementalRotation_pick){var k=mat4.create();mat4.identity(k),k=e.supplementalRotation_pick;var l=mat4.create();mat4.identity(l),mat4.translate(l,[-e.localCenter[0],-e.localCenter[1],-e.localCenter[2]]);var m=mat4.create();mat4.identity(m),mat4.translate(m,[e.localCenter[0],e.localCenter[1],e.localCenter[2]]);var n=mat4.create();mat4.identity(n),mat4.multiply(n,k,n),mat4.multiply(i,n,i)}if(e.supplementalRotation){var k=mat4.create();mat4.identity(k),k=e.supplementalRotation;var l=mat4.create();mat4.identity(l),mat4.translate(l,[-e.localCenter[0],-e.localCenter[1],-e.localCenter[2]]);var m=mat4.create();mat4.identity(m),mat4.translate(m,[e.localCenter[0],e.localCenter[1],e.localCenter[2]]);var n=mat4.create();mat4.identity(n),mat4.multiply(n,m,n),mat4.multiply(n,k,n),mat4.multiply(n,l,n),mat4.multiply(i,n,i)}}mat4.multiplyVec3(i,h,h),mat4.multiplyVec3(i,g,g),h[0]>a.max[0]&&(a.max[0]=h[0]),h[1]>a.max[1]&&(a.max[1]=h[1]),h[2]>a.max[2]&&(a.max[2]=h[2]),g[0]<a.min[0]&&(a.min[0]=g[0]),g[1]<a.min[1]&&(a.min[1]=g[1]),g[2]<a.min[2]&&(a.min[2]=g[2])}}return a},this.getVisiblePartBoundingBox=function(){var a={};a.min=[1e6,1e6,1e6],a.max=[-1e6,-1e6,-1e6];var c=b(la,null);if(c)for(var d=0;d<c.length;d++){var e=c[d].node,f=e.Type,g=c[d].transform;if("Shape"==f){if(1!=e.visible)continue;var h=[];h[0]=e.localMinBounding[0],h[1]=e.localMinBounding[1],h[2]=e.localMinBounding[2];var i=[];if(i[0]=e.localMaxBounding[0],i[1]=e.localMaxBounding[1],i[2]=e.localMaxBounding[2],g){var j=vec3.create(h),k=vec3.create(i);mat4.multiplyVec3(g,j,j),mat4.multiplyVec3(g,k,k),h=j,i=k}var l=mat4.create();if(mat4.identity(l),e.supplementalTranslation||e.supplementalRotation||e.supplementalRotation_pick){if(e.supplementalTranslation){var m=e.supplementalTranslation;mat4.translate(l,m,l)}if(e.supplementalRotation_pick){var n=mat4.create();mat4.identity(n),n=e.supplementalRotation_pick;var o=mat4.create();mat4.identity(o),mat4.translate(o,[-e.localCenter[0],-e.localCenter[1],-e.localCenter[2]]);var p=mat4.create();mat4.identity(p),mat4.translate(p,[e.localCenter[0],e.localCenter[1],e.localCenter[2]]);var q=mat4.create();mat4.identity(q),mat4.multiply(q,n,q),mat4.multiply(l,q,l)}if(e.supplementalRotation){var n=mat4.create();mat4.identity(n),n=e.supplementalRotation;var o=mat4.create();mat4.identity(o),mat4.translate(o,[-e.localCenter[0],-e.localCenter[1],-e.localCenter[2]]);var p=mat4.create();mat4.identity(p),mat4.translate(p,[e.localCenter[0],e.localCenter[1],e.localCenter[2]]);var q=mat4.create();mat4.identity(q),mat4.multiply(q,p,q),mat4.multiply(q,n,q),mat4.multiply(q,o,q),mat4.multiply(l,q,l)}}mat4.multiplyVec3(l,i,i),mat4.multiplyVec3(l,h,h),i[0]>a.max[0]&&(a.max[0]=i[0]),i[1]>a.max[1]&&(a.max[1]=i[1]),i[2]>a.max[2]&&(a.max[2]=i[2]),h[0]<a.min[0]&&(a.min[0]=h[0]),h[1]<a.min[1]&&(a.min[1]=h[1]),h[2]<a.min[2]&&(a.min[2]=h[2])}}return a},this.getTempBoundingBox=function(){return oa},this.updateBoundingBox=function(){oa.min=[1e6,1e6,1e6],oa.max=[-1e6,-1e6,-1e6];var c=b(la,null);if(c)for(var d=0;d<c.length;d++){var e=c[d].node,f=e.Type,g=c[d].transform;if("Shape"==f){if(1!=e.visible&&0==La)continue;var h={};h.name=e.Name,h.key=e.key,h.IsDeformApplied=!1,h.IsCAETransientResult=ka.getIsCAETransientResult(),h.IsViewPointApplied=Ga,h.CAEInstanceName=Ga?sb:Ua,""!=Ab&&1==ob&&(h.CAEInstanceName=Ab);var i=ta.getBoundingBoxMinMaX(h,na),j=ta.getPartVertices(h,na),k="";5==j.byteLength&&(k=sa.convertArrayBuffertoString(j));var l=null;if("Error"!=k){if(1==xa)var m=va.decompression_Zlib(j),n=new Uint16Array(m);else var n=new Uint16Array(j);var o=1,p=1,q=1,r=parseFloat(i.MaxBounding[0]),s=parseFloat(i.MinBounding[0]),t=parseFloat(i.MaxBounding[1]),u=parseFloat(i.MinBounding[1]),v=parseFloat(i.MaxBounding[2]),w=parseFloat(i.MinBounding[2]);r-s!=0?o=65535/parseFloat(r-s):0!=r&&(o=65535/r),t-u!=0?p=65535/parseFloat(t-u):0!=t&&(p=65535/t),v-w!=0?q=65535/parseFloat(v-w):0!=v&&(q=65535/v),l=new Float32Array(n.length);for(var x=0;x<n.length;x+=3)l[x]=n[x]/o+s,l[x+1]=n[x+1]/p+u,l[x+2]=n[x+2]/q+w;n=null}var y=null;if(1==Ca){if(h.IsDeformApplied=Ca,a.getFileVersion()>=3)var z=ta.getDisplacementMinMaX(h,na),A=ta.getDisplacementValues(h,na);else var z=ta.getBoundingBoxMinMaX(h,na),A=ta.getPartVertices(h,na);var k="";if(5==A.byteLength&&(k=sa.convertArrayBuffertoString(A)),"Error"!=k){if(1==xa)var m=va.decompression_Zlib(A),n=new Uint16Array(m);else var n=new Uint16Array(A);var o=1,p=1,q=1,r=parseFloat(z.MaxBounding[0]),s=parseFloat(z.MinBounding[0]),t=parseFloat(z.MaxBounding[1]),u=parseFloat(z.MinBounding[1]),v=parseFloat(z.MaxBounding[2]),w=parseFloat(z.MinBounding[2]);r-s!=0?o=65535/parseFloat(r-s):0!=r&&(o=65535/r),t-u!=0?p=65535/parseFloat(t-u):0!=t&&(p=65535/t),v-w!=0?q=65535/parseFloat(v-w):0!=v&&(q=65535/v),y=new Float32Array(n.length);for(var x=0;x<n.length;x+=3)y[x]=n[x]/o+s,y[x+1]=n[x+1]/p+u,y[x+2]=n[x+2]/q+w;n=null}}var B=!1;1==Ca&&null!=y&&l.length==y.length&&(B=!0);var C=1;1==ob&&null==nb&&(C=Qb==CAXViewer.CAEAnimationType.TRANSIENT?1:Bb);var D=Math.cos(Bb),E=Math.sin(Bb),F=mat4.create();if(mat4.identity(F),e.supplementalTranslation||e.supplementalRotation||e.supplementalRotation_pick){if(e.supplementalTranslation){var G=e.supplementalTranslation;mat4.translate(F,G,F)}if(e.supplementalRotation_pick){var H=mat4.create();mat4.identity(H),H=e.supplementalRotation_pick;var I=mat4.create();mat4.identity(I),mat4.translate(I,[-e.localCenter[0],-e.localCenter[1],-e.localCenter[2]]);var J=mat4.create();mat4.identity(J),mat4.translate(J,[e.localCenter[0],e.localCenter[1],e.localCenter[2]]);var K=mat4.create();mat4.identity(K),mat4.multiply(K,H,K),mat4.multiply(F,K,F)}if(e.supplementalRotation){var H=mat4.create();mat4.identity(H),H=e.supplementalRotation;var I=mat4.create();mat4.identity(I),mat4.translate(I,[-e.localCenter[0],-e.localCenter[1],-e.localCenter[2]]);var J=mat4.create();mat4.identity(J),mat4.translate(J,[e.localCenter[0],e.localCenter[1],e.localCenter[2]]);var K=mat4.create();mat4.identity(K),mat4.multiply(K,J,K),mat4.multiply(K,H,K),mat4.multiply(K,I,K),mat4.multiply(F,K,F)}}if(l)for(var L=0;L<l.length;L+=3){var M=[l[L],l[L+1],l[L+2]];B&&(a.getFileVersion()>=3?(M[0]+=y[L]*Fb[0]*C,M[1]+=y[L+1]*Fb[1]*C,M[2]+=y[L+2]*Fb[2]*C):(M[0]+=(y[L]-M[0])*Fb[0]*C,M[1]+=(y[L+1]-M[1])*Fb[1]*C,M[2]+=(y[L+2]-M[2])*Fb[2]*C)),Qb==CAXViewer.CAEAnimationType.EIGEN_VECTOR_COMPLEX&&e.Result&&e.Result.realResult&&e.Result.imaginaryResult&&(M[0]=l[L]+(e.Result.realResult[L]*D-e.Result.imaginaryResult[L]*E)*Fb[0],M[1]=l[L+1]+(e.Result.realResult[L+1]*D-e.Result.imaginaryResult[L+1]*E)*Fb[1],M[2]=l[L+2]+(e.Result.realResult[L+2]*D-e.Result.imaginaryResult[L+2]*E)*Fb[2]);var N=vec3.create(M);g&&mat4.multiplyVec3(g,N,N),mat4.multiplyVec3(F,N,N),N[0]>oa.max[0]&&(oa.max[0]=N[0]),N[1]>oa.max[1]&&(oa.max[1]=N[1]),N[2]>oa.max[2]&&(oa.max[2]=N[2]),N[0]<oa.min[0]&&(oa.min[0]=N[0]),N[1]<oa.min[1]&&(oa.min[1]=N[1]),N[2]<oa.min[2]&&(oa.min[2]=N[2])}}}},this.getModifiedModelCenter=function(){var a=ua.getmvMatrix(),b=[0,0,0];return mat4.multiplyVec3(a,b,b),b},this.getModelNewCenter=function(){console.log("getModelNewCenter is used");var a=ka.getVisiblePartBoundingBox(),b=[(a.max[0]+a.min[0])/2,(a.max[1]+a.min[1])/2,(a.max[2]+a.min[2])/2];return b},this.getVisiblePartCenter=function(){var a={};a.min=[1e6,1e6,1e6],a.max=[-1e6,-1e6,-1e6];var c=!1,d=b(la,null);if(d)for(var e=0;e<d.length;e++){var f=d[e].node,g=f.Type,h=d[e].transform;if("Shape"==g){c=!0;var i=[];i[0]=f.localMinBounding[0],i[1]=f.localMinBounding[1],i[2]=f.localMinBounding[2];var j=[];if(j[0]=f.localMaxBounding[0],j[1]=f.localMaxBounding[1],j[2]=f.localMaxBounding[2],h){var k=vec3.create(i),l=vec3.create(j);mat4.multiplyVec3(h,k,k),mat4.multiplyVec3(h,l,l),i=k,j=l}var m=mat4.create();if(mat4.identity(m),f.supplementalTranslation||f.supplementalRotation||f.supplementalRotation_pick){if(f.supplementalTranslation){var n=f.supplementalTranslation;mat4.translate(m,n,m)}if(f.supplementalRotation_pick){var o=mat4.create();mat4.identity(o),o=f.supplementalRotation_pick;var p=mat4.create();mat4.identity(p),mat4.translate(p,[-f.localCenter[0],-f.localCenter[1],-f.localCenter[2]]);var q=mat4.create();mat4.identity(q),mat4.translate(q,[f.localCenter[0],f.localCenter[1],f.localCenter[2]]);var r=mat4.create();mat4.identity(r),mat4.multiply(r,o,r),mat4.multiply(m,r,m)}if(f.supplementalRotation){var o=mat4.create();mat4.identity(o),o=f.supplementalRotation;var p=mat4.create();mat4.identity(p),mat4.translate(p,[-f.localCenter[0],-f.localCenter[1],-f.localCenter[2]]);var q=mat4.create();mat4.identity(q),mat4.translate(q,[f.localCenter[0],f.localCenter[1],f.localCenter[2]]);var r=mat4.create();mat4.identity(r),mat4.multiply(r,q,r),mat4.multiply(r,o,r),mat4.multiply(r,p,r),mat4.multiply(m,r,m)}}mat4.multiplyVec3(m,j,j),mat4.multiplyVec3(m,i,i),j[0]>a.max[0]&&(a.max[0]=j[0]),j[1]>a.max[1]&&(a.max[1]=j[1]),j[2]>a.max[2]&&(a.max[2]=j[2]),i[0]<a.min[0]&&(a.min[0]=i[0]),i[1]<a.min[1]&&(a.min[1]=i[1]),i[2]<a.min[2]&&(a.min[2]=i[2])}}if(c){var s=[(a.max[0]+a.min[0])/2,(a.max[1]+a.min[1])/2,(a.max[2]+a.min[2])/2];return s}return null},this.render=function(c,d,e,f){if(null!=la){var g=null,h=0;la.CAE_Info&&(g=la.CAE_Info.texture,h=la.CAE_Info.PixelTextureHeight),d.bind(),d.enablePosition(),d.disableNormal(),d.disableUV();var i=mat4.create(c);i=mat4.inverse(i),i=mat4.transpose(i),d.setUniformNormalMatrix(i);var j=b(la,null);w(j,d,i,g,e,c,f),ka.symbolPlotManager&&(0==a.isAnimationOn()||1==a.isAnimationOn()&&1==a.isAnimationPaused())&&ka.symbolPlotManager.renderAll(d),ma.disable(ma.BLEND)}},this.enableUnDeformedMesh=function(){Ha=!0;for(var a=b(la,null),c=0;c<a.length;c++){var d=a[c].node,e=d.Type;"Shape"==e&&(d.bUndeformedMesh=!0)}},this.disableUnDeformedMesh=function(){Ha=!1;for(var a=b(la,null),c=0;c<a.length;c++){var d=a[c].node,e=d.Type;"Shape"==e&&(d.bUndeformedMesh=!1)}},this.updateUndeformedMesh=function(a){if(Fa=!1,0!=Ea){var c=b(la,null);if(null!=c&&"undefined"!=c)for(var d=0;d<c.length;d++){var e=c[d].node;"Shape"==e.Type&&x(e)}}};var jb=function(){function a(a,b,c,d,e){this.c=new Float32Array(6),this.normals=new Float32Array(3),a instanceof Array&&3==a.length&&(this.c[0]=a[0],this.c[1]=a[1],this.c[2]=a[2]),b instanceof Array&&3==b.length&&(this.c[3]=b[0],this.c[4]=b[1],this.c[5]=b[2]),c instanceof Array&&3==c.length&&(this.normals[0]=c[0],this.normals[1]=c[1],this.normals[2]=c[2]),"number"==typeof d&&(this.i1=d),"number"==typeof e&&(this.i2=e)}return a.prototype.compare=function(a){return this.c[0]==a.c[0]&&this.c[1]==a.c[1]&&this.c[2]==a.c[2]&&this.c[3]==a.c[3]&&this.c[4]==a.c[4]&&this.c[5]==a.c[5]||this.c[0]==a.c[3]&&this.c[1]==a.c[4]&&this.c[2]==a.c[5]&&this.c[3]==a.c[0]&&this.c[4]==a.c[1]&&this.c[5]==a.c[2]},a}(),kb=function(){function a(){}return a}();this.setViewPointResultInfo=function(a,b,c,d){Ta=a,Ua=b,Va=c,Wa=d};var lb=0;this.setCAEResult=function(b,c,d,e){var f={};if(f.Results=b,f.Instance=c,f.DerivedResults=d,lb=0,ra){var g={Operation:CAXViewer.serverOperations.setCAEResult,Data:JSON.stringify(f)};ra.send(JSON.stringify(g),function(a){var b=sa.convertArrayBuffertoString(a);"true"==b&&H(e)})}0==a.getUseStreaming()&&H(e)},this.applyCAEResultInfo=function(a,c,d,e){Ta=a,Ua=c,Va=d,Wa=e;var f=b(la,null);if(f)for(var g=0;g<f.length;g++){var h=f[g].node;"Shape"==h.Type&&h.geometry&&J(h,e)}},this.changeTexture=function(a,b){if(a){var c=la.CAE_Info;c.texture;ma.deleteTexture(c.texture),c.texture=null;c.orginaltexture;ma.deleteTexture(c.orginaltexture),c.orginaltexture=null;var d=c.reversetexture;ma.deleteTexture(c.reversetexture),c.reversetexture=null,c.PixelTexture=a;var e=c.PixelTexture;if(null==e||0==e.length)return;var f=j(c.PixelTextureWidth,c.PixelTextureHeight,3,e.slice(0));c.texture=f;for(var g=[],h=c.PixelTexture.length-1;h>=0;h-=3)g=g.concat(c.PixelTexture[h-2]),g=g.concat(c.PixelTexture[h-1]),g=g.concat(c.PixelTexture[h]);var d=j(c.PixelTextureWidth,c.PixelTextureHeight,3,g.slice(0));b?(c.reversetexture=f,c.orginaltexture=d):(c.reversetexture=d,c.orginaltexture=f)}};var mb=0;this.applyLegendstate=function(b,c){if(b){b.AttribList&&i(b.AttribList);var d={};switch(b.iPlacement){case 0:d=sa.clone(CAXViewer.legendRight);break;case 1:d=sa.clone(CAXViewer.legendLeft);break;case 3:d=sa.clone(CAXViewer.legendBottom);break;case 2:d=sa.clone(CAXViewer.legendTop);break;default:d=sa.clone(CAXViewer.legendRight)}for(var e=b.legendColors,f=[],g=0;g<e.length/3;g++){var h=[e[3*g+0],e[3*g+1],e[3*g+2]];f[g]=h}la.CAE_Info.Colour_Array=f,c&&f.reverse(),d.colorArray=f,d.precisionValue=b.iNumericPrecision,d.discreteMode=b.bDiscrete,d.rangeMax=b.fUserMax,d.rangeMin=b.fUserMin,d.scientifeNumericFormat=b.bScientifeNumericFormat,d.fontSizeIndex=b.iFontSizeIndex,d.isBGColorVisible=b.bLegendBackground,d.BGColor=b.LegendBGColor,d.isNoResultColorVisible=b.bNoResultColor,d.NoResultColor=b.noResultColor,d.isDynamicRangeEnabled=b.bDynamicRange,d.DynamicRangeArray=b.DynamicRangeArray,d.fXPosition=b.fXPosition+.005;var j=0;d.startPosition=[b.fPlacementX,1-b.fPlacementY+j],d.visible=b.bVisible,1==b.bVisible&&(a.updateLegendSelectionIcon(!0),a.setLegendVisibility(!0,na)),d.sUnit="",d.textArray[0]=na,d.textArray[1]=Ta,""!=Va&&(d.textArray[1]=d.textArray[1]+" : "+Va),b.sUnit&&(d.sUnit=b.sUnit,d.textArray[1]=d.textArray[1]+" (in "+b.sUnit+")"),b.sInstanceHeader?d.textArray[2]=b.sInstanceHeader:d.textArray[2]=Ua,b.bDistinctLegend&&(d.bDistinctLegend=b.bDistinctLegend),b.bDistinctResult&&(d.bDistinctResult=b.bDistinctResult),b.DistinctRangeArray&&(d.DistinctRangeArray=b.DistinctRangeArray);var k=ua.isLegendObjExist(na);0==k?ua.addLegend(na,d):ua.updateLegend(na,d);var l=b.fUserMax-b.fUserMin,m=l/f.length;0!=m&&(b.fUserMin<0&&(mb=-b.fUserMin/m),mb<0&&(mb=m))}},this.hideLegend=function(){ua.hideLegend(na)},this.setCAEDeformationOnServer=function(b){if(Ca!=b){if(Ca=b,ra){var c={Operation:CAXViewer.serverOperations.setCAEDeformMesh,Data:b};ra.send(JSON.stringify(c),function(a){var b=sa.convertArrayBuffertoString(a);"true"==b&&CAXViewer.log("Deformation :"+Ca)})}0==a.getUseStreaming()}},this.setDeformation=function(b){if(Ca=b,lb=0,ra){var c={Operation:CAXViewer.serverOperations.setCAEDeformMesh,Data:b};ra.send(JSON.stringify(c),function(a){var b=sa.convertArrayBuffertoString(a);"true"==b&&K()})}0==a.getUseStreaming()&&K(b)};var nb=null,ob=!1;this.getIsAnimationON=function(){return ob;
};var pb=null;this.setDeformResultName=function(a){pb=a},this.getDeformResultName=function(){return pb};var qb=!0;this.setIsDeformResultNameChanged=function(a){qb=a};var rb="",sb="",tb="",ub=[],vb=[],wb=[],xb=[],yb=[];this.getCAEInstanceImageArray=function(){return yb};var zb=0,Ab="";this.setViewPointResultName=function(a){rb=a},this.setViewPointInstanceName=function(a){sb=a},this.setViewPointDerivedName=function(a){tb=a};var Bb=0,Cb=0,Db=0,Eb=1;this.getFrameFactor=function(){return Bb},this.setFrameDelay=function(a){Eb=a,null!=nb&&(clearInterval(nb),nb=setInterval(M,Eb))};var Fb=[1,1,1];this.setScaleFactor=function(a){Fb=a,ka.updateSymbolPlotManager()},this.getScaleFactor=function(){return Fb};var Gb=1;this.setNormalizeFactor=function(a){Gb=a},this.getNormalizeFactor=function(){return Gb};var Hb=0;this.setComplexAngle=function(a){Hb=a},this.getComplexAngle=function(){return Hb};var Ib=!1;this.setIsAnimationDataAvailable=function(a){Ib=a};var Jb=null;this.setAnimationPartCount=function(a){Jb=a};var Kb=null;this.resetAnimation=function(){Ib=!1,Jb=null,Lb=30,Qb=CAXViewer.CAEAnimationType.LINEAR,Kb=null,Fb=[1,1,1],ub=[],vb=[],wb=[],xb=[],yb=[],zb=0,Ab="",Rb=0};var Lb=30,Mb=!0;this.setAnimationReversePlay=function(a){Mb=a};var Nb=!1;this.setAnimationSwing=function(a){Nb=a};var Ob=!1;this.setAnimationHarmonic=function(a){Ob=a};var Pb=!0,Qb=CAXViewer.CAEAnimationType.LINEAR,Rb=0;this.setFrames=function(a){Lb=a},this.setAnimationType=function(b){if(Qb=b,Qb==CAXViewer.CAEAnimationType.EIGEN_VECTOR_COMPLEX){Rb=0;var c=S();c&&(Qb=CAXViewer.CAEAnimationType.LINEAR,a.updateCAEAnimationType(Qb),Jb=null)}},this.getAnimationType=function(){return Qb},this.startAnimation=function(){la.CAE_Info&&(CAXViewer.log("Animation Type : "+Qb),a.updateCAEAnimationType(Qb),Rb=ka.getAllPartNames().length,Ca=!0,0==ob&&ka.updateBoundingBox(),Nb&&(Mb=!1),Ob?Mb?(Cb=Lb-1,Pb=!1):(Cb=-(Lb-1),Pb=!0):Cb=Mb?Lb-1:0,N(),null==nb&&(nb=setInterval(M,Eb)))},this.stopAnimation=function(a){if(Bb=0,Cb=0,ob=!1,clearInterval(nb),nb=null,Qb==CAXViewer.CAEAnimationType.TRANSIENT){var b;for(b=0;b<ub.length&&sb!=ub[b];b++);fa(b,sb),ga(b,sb),ja(sb),zb=0,Ib=!1}ka.updateSymbolPlotManager(),a&&ka.updateBoundingBox()},this.pauseAnimation=function(){clearInterval(nb),nb=null,Qb==CAXViewer.CAEAnimationType.TRANSIENT?ha(Cb-1,sb):ka.updateSymbolPlotManager(),ka.updateBoundingBox()},this.forwardAnimation=function(){ka.startAnimation(),clearInterval(nb),nb=null,ob=!0,Cb=Db<Lb-1?Db+1:0,M(),ka.updateSymbolPlotManager(),ka.updateBoundingBox()},this.backwardAnimation=function(){ka.startAnimation(),clearInterval(nb),nb=null,ob=!0,Db-1<0&&(Db=Lb),Cb=Db-1,M(),ka.updateSymbolPlotManager(),ka.updateBoundingBox()};var Sb=!1,Tb=0},CAXViewer.WEBGL=function(a,b){function c(a,b,c){try{var d=m.getRightVector(a),e=m.getUpVector(a),f=m.getDirVector(a),g=[];g.push([c.min[0],c.min[1],c.min[2]]),g.push([c.max[0],c.min[1],c.min[2]]),g.push([c.max[0],c.max[1],c.min[2]]),g.push([c.min[0],c.max[1],c.min[2]]),g.push([c.min[0],c.min[1],c.max[2]]),g.push([c.max[0],c.min[1],c.max[2]]),g.push([c.max[0],c.max[1],c.max[2]]),g.push([c.min[0],c.max[1],c.max[2]]);for(var h=1e11,i=1e11,j=1e11,k=-1e11,l=-1e11,n=-1e11,o=0;o<8;o++){var p=g[o];p[0]=p[0]-b[0],p[1]=p[1]-b[1],p[2]=p[2]-b[2];var q=m.DotProduct(d,p),r=m.DotProduct(e,p),s=m.DotProduct(f,p);h>q&&(h=q),i>r&&(i=r),j>s&&(j=s),k<q&&(k=q),l<r&&(l=r),n<s&&(n=s)}var t=[];return t.x=k-h,t.y=l-i,t.z=n-j,t}catch(a){return null}}function d(a,b){var c=M.width,d=M.height,e=vec3.create();e[0]=1*a/c*2-1,e[1]=1*b/d*2-1,e[2]=0,e[1]=-e[1];var f=e[0]*e[0]+e[1]*e[1];return f<=1?e[2]=Math.sqrt(1-f):e=vec3.normalize(e),e}function e(){var a=k.getCameraMatrix();mat4.inverse(a),na=m.getDirVector(a)}function f(a){var b=a.clientWidth,c=a.clientHeight;a.width==b&&a.height==c||(ha=b/c,a.width=b,a.height=c)}function g(a,b,c,d){var e=mat4.create();mat4.identity(e);var f=Math.PI/180;if(b>1)var g=1/Math.tan(f*a/2),h=g/b;else var g=b/Math.tan(f*a/2),h=g/b;for(var i=c-d,j=[h,0,0,0,0,g,0,0,0,0,(d+c)/i,-1,0,0,2*d*c/i,0],k=0;k<j.length;k++)e[k]=j[k];return e}function h(a){var b=[0,0,0],c=[100,0,0],d=[0,100,0],e=[0,0,100],f=[1,0,0],g=[0,1,0],h=[0,0,1],i=[];i.push.apply(i,b),i.push.apply(i,c),i.push.apply(i,b),i.push.apply(i,d),i.push.apply(i,b),i.push.apply(i,e),null==Ca&&(Ca=N.createBuffer(),N.bindBuffer(N.ARRAY_BUFFER,Ca),N.bufferData(N.ARRAY_BUFFER,new Float32Array(i),N.STATIC_DRAW));var j=[];j.push.apply(j,f),j.push.apply(j,f),j.push.apply(j,g),j.push.apply(j,g),j.push.apply(j,h),j.push.apply(j,h),null==Da&&(Da=N.createBuffer(),N.bindBuffer(N.ARRAY_BUFFER,Da),N.bufferData(N.ARRAY_BUFFER,new Float32Array(j),N.STATIC_DRAW)),a.enablePosition(),a.enableColor(),N.bindBuffer(N.ARRAY_BUFFER,Da),a.setColor(),a.setUsecolor(0),N.bindBuffer(N.ARRAY_BUFFER,Ca),a.setPositionAttrib(),N.drawArrays(N.LINES,0,6),a.disableColor(),a.disablePosition()}function i(a){var b=3;if(null==Ea){var c=[0,0,0],d=[.75,0,0],e=[0,.75,0],f=[0,0,.75],g=[];g.push.apply(g,c),g.push.apply(g,d),g.push.apply(g,c),g.push.apply(g,e),g.push.apply(g,c),g.push.apply(g,f);for(var h=0;h<b;h++){var i=.06,j=.6,k=i*Math.cos(h/b*Math.PI*2),l=i*Math.sin(h/b*Math.PI*2);g.push.apply(g,d),g.push.apply(g,[j,k,l]),g.push.apply(g,e),g.push.apply(g,[l,j,k]),g.push.apply(g,f),g.push.apply(g,[k,l,j])}Ea=N.createBuffer(),N.bindBuffer(N.ARRAY_BUFFER,Ea),N.bufferData(N.ARRAY_BUFFER,new Float32Array(g),N.STATIC_DRAW)}if(null==Fa){var m=[1,0,0],n=[0,1,0],o=[0,0,1],p=[];p.push.apply(p,m),p.push.apply(p,m),p.push.apply(p,n),p.push.apply(p,n),p.push.apply(p,o),p.push.apply(p,o);for(var h=0;h<b;h++)p.push.apply(p,m),p.push.apply(p,m),p.push.apply(p,n),p.push.apply(p,n),p.push.apply(p,o),p.push.apply(p,o);Fa=N.createBuffer(),N.bindBuffer(N.ARRAY_BUFFER,Fa),N.bufferData(N.ARRAY_BUFFER,new Float32Array(p),N.STATIC_DRAW)}a.enablePosition(),a.enableColor(),N.bindBuffer(N.ARRAY_BUFFER,Fa),a.setColor(),a.setUsecolor(0),N.bindBuffer(N.ARRAY_BUFFER,Ea),a.setPositionAttrib();var q=6+2*b*3;N.drawArrays(N.LINES,0,q),a.disableColor(),a.disablePosition()}function j(a){var b=n.getTempBoundingBox(),c=Math.sqrt(Math.pow(b.max[0]-b.min[0],2)+Math.pow(b.max[1]-b.min[1],2)+Math.pow(b.max[2]-b.min[2],2));if(3464101.6151377545!=c){var d=[b.min[0],b.min[1],b.min[2]],e=[b.min[0],b.max[1],b.min[2]],f=[b.max[0],b.max[1],b.min[2]],g=[b.max[0],b.min[1],b.min[2]],h=[b.min[0],b.min[1],b.max[2]],i=[b.min[0],b.max[1],b.max[2]],j=[b.max[0],b.max[1],b.max[2]],k=[b.max[0],b.min[1],b.max[2]],l=[];l.push.apply(l,d),l.push.apply(l,e),l.push.apply(l,f),l.push.apply(l,g),l.push.apply(l,h),l.push.apply(l,i),l.push.apply(l,j),l.push.apply(l,k);var m=[0,1,2,3,0],o=[4,5,6,7,4],p=[0,3,7,4,0],q=[1,2,6,5,1],r=[];r.push.apply(r,m),r.push.apply(r,o),r.push.apply(r,p),r.push.apply(r,q),null==Ga&&(Ga=N.createBuffer()),null==Ha&&(Ha=N.createBuffer()),N.bindBuffer(N.ARRAY_BUFFER,Ga),N.bufferData(N.ARRAY_BUFFER,new Float32Array(l),N.STATIC_DRAW),N.bindBuffer(N.ELEMENT_ARRAY_BUFFER,Ha),N.bufferData(N.ELEMENT_ARRAY_BUFFER,new Uint16Array(r),N.STATIC_DRAW),a.enablePosition(),a.setUsecolor(2),a.setUserColor([0,0,0]),a.setPositionAttrib(),N.drawElements(N.LINE_LOOP,r.length,N.UNSIGNED_SHORT,0),a.disablePosition()}}var k=this;this.container=a,this.getContainerBox=function(){var a=[],b=container.getBoundingClientRect();return a[0]=b.top,a[1]=b.left,a[2]=b.bottom,a[3]=b.right,a};var l=b,m=l.getUtility(),n=l.getModelManager(),o=l.getSectionManager(),p=l.getLabelManager();if(p)var q=p.labelArray;var r=!1,s=!0,t=!1;this.setDrawAxis=function(a){s=a};var u=!1;this.setViewPointApplied=function(a){u=a};var v=!0;this.getLegendVisibility=function(){return v},this.setLegendVisibility=function(a,b){v=a,k.changeLegendVisibility(v,b)},this.toggleLegendVisibility=function(){v=!v,k.changeLegendVisibility(v)},this.performSelection=function(a,b){var c=n.getModelCount();k.renderNormalScene(!0);var d=new Uint8Array(new Array(0,0,0,0));N.readPixels(a,b,1,1,N.RGBA,N.UNSIGNED_BYTE,d);var e=null;c>0&&(e=n.pickNode([d[0],d[1],d[2]])),e?null==e.selected?e.selected=1:e.selected=1-e.selected:c>0&&n.deselectAll()},this.clearCanvas=function(a){if(""==a||void 0==a||null==a)var b=l.get2DCanvas();else var b=document.getElementById(a);var c=b.getBoundingClientRect(),d=c.right-c.left,e=c.bottom-c.top,f=b.getContext("2d");f.clearRect(0,0,d,e)};var w=[0,0,0],x=mat4.create();mat4.identity(x);var y=mat4.create();mat4.identity(y),this.getRotationMatrix=function(){return x},this.getTranslation=function(){return w},this.setTranslation=function(a){w=a},this.resetView=function(){w=[0,0,0],x=mat4.create(),mat4.identity(x),B=1,u=!1,k.updateNearFarPlane(),y=mat4.create(),mat4.identity(y)},this.fitView=function(){var a=n.getTempBoundingBox(),b=Math.sqrt(Math.pow(a.max[0]-a.min[0],2)+Math.pow(a.max[1]-a.min[1],2)+Math.pow(a.max[2]-a.min[2],2)),d=b/2,e=d/Math.tan(ia/2*.01745329251),f=k.getCameraMatrix();mat4.inverse(f);var g=[(a.max[0]+a.min[0])/2,(a.max[1]+a.min[1])/2,(a.max[2]+a.min[2])/2],h=e,i=c(f,g,a);if(i){var j=i.y;i.y<i.x/ha?(j=i.x/ha,h=.5*(j/Math.tan(ia/2*.01745329251)+i.z)):(h=.5*(j/Math.tan(ia/2*.01745329251)+i.z),e<h&&(h=e)),e=h+.1*h}var l=m.subtractVector(g,[f[12],f[13],f[14]]);if(mat4.translate(x,[-l[0],-l[1],-l[2]]),w[2]+=-e,la){B=1;var o=0,p=0;p=h*Math.tan(ia/2*.01745329251),o=p*ha,ja=2*o,ka=ja/ha,k.updateNearFarPlane()}k.resetZoomFactor()};var z=5,A=0;this.setZoomType=function(a){A=a};var B=1;this.resetOrthoProjectionZoomFactor=function(){B=1};var C=1,D=1,E=1,F=375e-6;this.resetZoomFactor=function(){C=1,D=1,E=1,F=375e-6},this.zoomIn=function(a){k.updateSensitivity(),0==A&&(C*=1.1,D=1,E=C),la?B+=0==A?-.12*F*z*E:1==A?-a*F*4*z*1/100:-1e-4/window.devicePixelRatio*a*z:0==A?w[2]=w[2]+12*F*z*E:1==A?w[2]=w[2]+a*F*4*z*1:w[2]=w[2]+.015/window.devicePixelRatio*a*z,k.updateNearFarPlane()},this.pointZoomIn=function(a,b,c){k.updateSensitivity(),C*=1.1,D=1,E=C;var d=12*(4*F)*z*E;if(la){var e=B;B-=d/100;var f=ka/2/Math.tan(ia/2*.01745329251),g=f*Math.tan(ia/2*.01745329251),h=g*ha,i=2*h,j=i*e-i*B;if(i-j>0&&B>1e-5&&B<1e3){var l=M.width,n=M.height,o=a-.5*M.width,p=b-.5*M.height,q=j,r=j/ha,s=o*q/l,t=p*r/n;w[0]=w[0]-s,w[1]=w[1]-t}B<1e-5&&B<1e3&&(B=e)}else{var u=mat4.create();mat4.identity(u);var v=m.unproject([a,b,0],u),y=m.unproject([a,b,1],u);if(null==v||null==y)return void console.log(v,y);var A=m.subtractVector(y,v),G=m.Normalize(A),H=m.multiplyVector(G,d);null!=c&&void 0!=c&&(H=m.multiplyVector(H,c)),mat4.translate(x,[-H[0],-H[1],-H[2]])}k.updateNearFarPlane()},this.zoomOut=function(a){k.updateSensitivity(),0==A&&(C=1,D*=1.1,E=D),la?B+=0==A?.12*F*z*E:1==A?a*F*4*z*1/100:1e-4/window.devicePixelRatio*a*z:0==A?w[2]=w[2]+-12*F*z*E:1==A?w[2]=w[2]+-a*F*4*z*1:w[2]=w[2]+-.015/window.devicePixelRatio*a*z,k.updateNearFarPlane()},this.pointZoomOut=function(a,b,c){k.updateSensitivity(),C=1,D*=1.1,E=D;var d=12*(4*F)*z*E;if(la){var e=B;B+=d/100;var f=ka/2/Math.tan(ia/2*.01745329251),g=f*Math.tan(ia/2*.01745329251),h=g*ha,i=2*h,j=i*e-i*B;if(i-j>0&&B>1e-5&&B<1e3){var l=M.width,n=M.height,o=a-.5*M.width,p=b-.5*M.height,q=j,r=j/ha,s=o*q/l,t=p*r/n;w[0]=w[0]-s,w[1]=w[1]-t}B<1e-5&&B<1e3&&(B=e)}else{var u=mat4.create();mat4.identity(u);var v=m.unproject([a,b,0],u),y=m.unproject([a,b,1],u);if(null==v||null==y)return;var A=m.subtractVector(y,v),G=m.Normalize(A),H=m.multiplyVector(G,d);null!=c&&void 0!=c&&(H=m.multiplyVector(H,c)),mat4.translate(x,[H[0],H[1],H[2]])}k.updateNearFarPlane()},this.updateNearFarPlane=function(){var a=n.getTempBoundingBox(),b=Math.sqrt(Math.pow(a.max[0]-a.min[0],2)+Math.pow(a.max[1]-a.min[1],2)+Math.pow(a.max[2]-a.min[2],2)),c=b/2,d=[(a.max[0]+a.min[0])/2,(a.max[1]+a.min[1])/2,(a.max[2]+a.min[2])/2],e=[0,0,0],f=k.getCameraMatrix();mat4.inverse(f),mat4.multiplyVec3(f,e,e);var g=Math.sqrt(Math.pow(d[0]-e[0],2)+Math.pow(d[1]-e[1],2)+Math.pow(d[2]-e[2],2)),h=.01;g<=c?(h=c/1e3,ga=1.5*(g+c)*1e3):(h=.01*(g-c),ga=g+1.5*c*1e3),k.setNearFarPlain(h,ga)},this.updateSensitivity=function(){var a=n.getTempBoundingBox(),b=[(a.max[0]+a.min[0])/2,(a.max[1]+a.min[1])/2,(a.max[2]+a.min[2])/2],c=[0,0,0],d=k.getCameraMatrix();mat4.inverse(d),mat4.multiplyVec3(d,c,c);var e=m.findDistance(b,c);z=e},this.zoomByValue=function(a){var b=5;a<0&&(b=0-b);var c=a/b,d=a%b,e=0,f=setInterval(function(){e==c?(w[2]+=d,clearInterval(f)):(w[2]+=b,e+=1)},24);a>0?a>max_zoom&&(max_zoom=a):a<min_zoom&&(min_zoom=a)},this.setZoomSensitivity=function(a){z=a};var G=.2,H=0,I=0;this.pan=function(a,b,c){var d=a*G,e=b*G;H+=d,I+=e,c?model&&model.applyTranslationToSelectedParts([d,-e,0],x):(w[0]+=d,w[1]+=e)},this.panByValue=function(a,b,c){null!=a&&null!=b&&(H+=a,I+=b,c?model&&model.applyTranslationToSelectedParts([a,-b,0],x):(w[0]+=a,w[1]+=b))},this.resetPan=function(a){a?model&&model.applyTranslationToSelectedParts([-H,I,0],x):(w[0]+=-H,w[1]+=-I),H=0,I=0,G=.1},this.setPanSensitivity=function(a){G=a};var J=1,K=null;this.setPointOfRotation=function(a){K=a},this.getPointOfRotation=function(){return K},this.resetPointOfRotation=function(){K=[0,0,0]},this.rotateAboutVisiblePart=function(){var a=n.getTempBoundingBox(),b=[(a.max[0]+a.min[0])/2,(a.max[1]+a.min[1])/2,(a.max[2]+a.min[2])/2];K=b},this.mouseRotate=function(a,b,c){var d=n.getModelCount(),e=a*J;if(1==c)model.applyRotationToSelectedParts(b,e,x);else{d>0&&k.rotateAboutVisiblePart();var f=vec3.create(),g=mat4.create();mat4.identity(g),mat4.multiply(g,x,g),mat4.inverse(g);var h=g[12],i=g[13],j=g[14];g[12]=g[3],g[13]=g[7],g[14]=g[11],g[3]=h,g[7]=i,g[11]=j;var m=[0,0,0];m=null!=K?K:l.getModelOriginalCenter(),mat4.multiplyVec3(g,b,f),mat4.translate(x,[m[0],m[1],m[2]]),mat4.rotate(x,e,f),mat4.translate(x,[-m[0],-m[1],-m[2]]),mat4.rotate(y,e,f)}},this.mousePanRotate=function(a,c,d,e,f){if(a!=d||c!=e)if(1==la){var g=parseInt(a-d),h=parseInt(c-e),i=b.get3DCanvas(),j=i.clientWidth,l=i.clientHeight,o=ka/2/Math.tan(ia/2*.01745329251),p=o*Math.tan(ia/2*.01745329251),q=p*ha,r=2*q*B,s=2*q/ha*B;w[0]+=r*g/j,w[1]+=s*h/l}else{var g=parseInt(a-d),h=parseInt(c-e),t=mat4.create();mat4.identity(t);var u=m.unproject([d,e,0],t),v=m.unproject([a,c,0],t);if(null==u||null==v)return;var y=m.unproject([d,e,1],t),z=m.unproject([a,c,1],t);if(null==y||null==z)return;var A=[0,0,0],C=k.getCameraMatrix();mat4.inverse(C),mat4.multiplyVec3(C,A,A);var D=m.subtractVector(u,y),E=m.subtractVector(v,z);vec3.normalize(D),vec3.normalize(E);var F=Math.acos(Math.min(1,vec3.dot(D,E))),G=[0,1,0],H=[1,0,0],H=[C[0],C[1],C[2]],G=[C[4],C[5],C[6]];vec3.normalize(G),vec3.normalize(H);var I=m.multiplyVector(H,h),J=m.multiplyVector(G,g),K=m.addVector(I,J);K=[-K[0],-K[1],-K[2]],vec3.normalize(K);var L=n.getModelOriginalCenter(),M=m.subtractVector([C[12],C[13],C[14]],L),N=m.CrossProduct(H,G);vec3.normalize(M);var O=(vec3.dot(M,N),[0,0,0]);O=A,mat4.translate(x,[O[0],O[1],O[2]]),mat4.rotate(x,F,K),mat4.translate(x,[-O[0],-O[1],-O[2]])}},this.getRotationAngleAndNormalizedCameraCoordAxis=function(a,b,c,e){var f={};if(a!=c||b!=e){var g=d(c,e),h=d(a,b),i=Math.acos(Math.min(1,vec3.dot(g,h))),j=vec3.cross(g,h);vec3.normalize(j),f.angle=i,f.axis_in_camera_coord=j}return f},this.rotate=function(a,b,c,d){var e=a;if(1==c)model.applyRotationToSelectedParts(b,m.degToRad(e),x);else if(1==d){var f=10;e<0&&(f=0-f);var g=e/f,h=e%f,i=0,j=setInterval(function(){i>=g?(mat4.rotate(x,m.degToRad(h),b),clearInterval(j)):(mat4.rotate(x,m.degToRad(f),b),i+=1)},24)}else mat4.rotate(x,m.degToRad(e),b),mat4.rotate(y,m.degToRad(e),b)},this.setRotationSensitivity=function(a){J=a},this.resetRotation=function(a){x=mat4.create(),mat4.identity(x),J=1,y=mat4.create(),mat4.identity(y)};var L={alpha:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!0},M=l.get3DCanvas(),N=null;if(this.getGL=function(){return N},null!=M){var O=["experimental-webgl2","webgl","webkit-3d","moz-webgl","experimental-webgl"];try{for(var P=0;P<O.length&&!(N=M.getContext(O[P],L));P++);if(!N)throw new Error("Your browser is not webgl compatible")}catch(a){return CAXViewer.error("Your browser is not webgl compatible"),alert("Your browser is not webgl compatible"),!1}}M.addEventListener("webglcontextrestored",function(a){console.log(a)},!1),M.addEventListener("webglcontextlost",function(a){a.preventDefault(),null!=N&&null!=N.getExtension("WEBGL_lose_context")&&N.getExtension("WEBGL_lose_context").restoreContext()},!1);var Q=pick_vertex_shader,R=pick_fragment_shader,S=new CAXViewer.Shader;S.loadShader(Q,R,N);var T=light_vertex_shader,U=light_fragment_shader,V=new CAXViewer.Shader;V.loadShader(T,U,N),this.getLightShader=function(){return V};var W=light_vertex_shader_v3,X=light_fragment_shader_v3,Y=new CAXViewer.Shader;Y.loadShader(W,X,N),this.getLightShader_v3=function(){return Y};var Z=label_vertex_shader,$=label_fragment_shader,_=new CAXViewer.Shader;_.loadShader(Z,$,N);var aa=section_vertex_shader,ba=section_fragment_shader,ca=new CAXViewer.Shader;ca.loadShader(aa,ba,N);var da=mat4.create(),ea=mat4.create();this.getmvMatrix=function(){return da},this.getpMatrix=function(){return ea},this.setmvMatrix=function(a){da=a};var fa=1,ga=1e3,ha=M.width/M.height,ia=34;this.setNearFarPlain=function(a,b){fa=a,ga=b,k.setpMatrix(ia,fa,ga,ha)},this.getNearPlain=function(){return fa},this.getFarPlain=function(){return ga},this.getFOV=function(){return ia},this.resetpMatrix=function(){fa=1,ga=1e3,ha=M.width/M.height,ia=34,mat4.identity(ea),ea=g(ia,ha,fa,ga)},this.setpMatrix=function(a,b,c,d){var e=d;null!=d&&"undefined"!=d||(e=M.width/M.height),fa=b,ga=c,ha=e,ia=a,mat4.identity(ea),ea=g(ia,ha,fa,ga)};var ja=1;this.setOrthoWindowWidth=function(a){ja=a},this.getOrthoWindowWidth=function(){return ja};var ka=1;this.setOrthoWindowHeight=function(a){ka=a},this.getOrthoWindowHeight=function(){return ka};var la=!1;this.getIsOrthoCamera=function(){return la},this.setOrthoCamera=function(a){la=a},mat4.identity(ea),ea=g(ia,ha,fa,ga),N.clearColor(.5,.5,.5,0),N.enable(N.DEPTH_TEST),N.depthFunc(N.LESS);var ma=0,na=[0,0,1];this.getCameraMatrix=function(){var a=[];if(mat4.create(a),mat4.identity(a),0==u){var b=l.getModelOriginalCenter();mat4.translate(a,[-b[0],-b[1],-b[2]],a),mat4.translate(a,[0,0,-ma])}return mat4.translate(a,[w[0],-w[1],w[2]]),mat4.multiply(a,x,a),a},this.getCameraMatrix2=function(){var a=[];if(mat4.create(a),mat4.identity(a),1==la){if(mat4.ortho(-(M.width/2),M.width/2,-(M.height/2),M.height/2,fa,ga,a),1==u){var b=ka/2/Math.tan(ia/2*.01745329251),c=b;if(ka<ja/ha){var d=ja/ha;c=d/2/Math.tan(ia/2*.01745329251)}else c=ka/2/Math.tan(ia/2*.01745329251),b<c&&(c=b);var e=c*Math.tan(ia/2*.01745329251),f=e*ha,h=2*f,i=2*f/ha;mat4.identity(a),B<1e-5&&(B=1e-5),mat4.ortho(-(h/2)*B,h/2*B,-(i/2)*B,i/2*B,fa,ga,a)}}else if(k.updateNearFarPlane(),a=g(ia,ha,fa,ga),0==u){var j=l.getModelOriginalCenter();mat4.translate(a,[-j[0],-j[1],-j[2]],a),mat4.translate(a,[0,0,-ma])}return mat4.translate(a,[w[0],-w[1],w[2]]),mat4.multiply(a,x,a),a};var oa=function(a){var b=V;l.getFileVersion()>2&&(b=Y);var c=a?S:b;n||(n=l.getModelManager());var d=n.getModelCount();if(d>0&&0==u){var f=n.getTempBoundingBox(),g=Math.sqrt(Math.pow(f.max[0]-f.min[0],2)+Math.pow(f.max[1]-f.min[1],2)+Math.pow(f.max[2]-f.min[2],2)),m=g/2;ma=m/Math.tan(ia/2*.01745329251)}else ma=0;mat4.identity(da);var w=da,x=ea;if(d>0&&(w=da,c.bind(),c.setUniformProjectionMatrix(x),e(),c.setLightDir(na),0==a&&1==v?k.drawLegend():k.clearCanvas(),n.renderALLModel(w,c,a)),d>0&&(ca.bind(),null==o?(o=l.getSectionManager(),o&&o.render(ca,N)):o&&o.render(ca,N),c.bind()),q.length>0){_.bind();var z=k.getpMatrix(),A=k.getmvMatrix();_.setUniformProjectionMatrix(z),_.setUniformModelviewMatrix(A),p.render(_,N),c.bind()}if(1==s){_.bind();var A=[];mat4.create(A),mat4.identity(A);var z=[];mat4.create(z),mat4.identity(z),mat4.multiply(z,y,z);var B=80,C=80,D=M.width-B,E=M.height-C;N.viewport(D,E,B,C),N.disable(N.DEPTH_TEST),_.setUniformProjectionMatrix(z),_.setUniformModelviewMatrix(A),i(_),c.bind(),N.viewport(0,0,M.width,M.height),N.enable(N.DEPTH_TEST);for(var F=[.75,0,0,1,0,.75,0,1,0,0,.75,1],G=["X","Y","Z"],H=0;H<F.length;H+=4){var I=[F[H],F[H+1],F[H+2],F[H+3]];mat4.multiplyVec4(z,I,I);var J=(.5*I[0]+.5)*B,K=(I[1]*-.5+.5)*C,L=l.get2DCanvas(),O=L.getContext("2d");O.font="10pt Arial bold";var P=H/4,Q=G[P];O.fillStyle="#000000",J=M.width-B+J,K=K,O.fillText(Q,J,K)}}if(1==r){_.bind();var z=k.getCameraMatrix2(),A=k.getmvMatrix();_.setUniformProjectionMatrix(z),_.setUniformModelviewMatrix(A),h(_),c.bind()}if(1==t){_.bind();var z=k.getCameraMatrix2(),A=k.getmvMatrix();_.setUniformProjectionMatrix(z),_.setUniformModelviewMatrix(A),j(_),c.bind()}},pa=0,qa=0;this.setOrthoZoomOffsetX=function(a){pa=a},this.setOrthoZoomOffsetY=function(a){qa=a},this.renderNormalScene=function(a){if(k.clearCanvas(),N.clearColor(0,0,0,0),N.clear(N.DEPTH_BUFFER_BIT|N.COLOR_BUFFER_BIT),N.viewport(0,0,M.width,M.height),mat4.identity(ea),1==la){if(k.updateNearFarPlane(),mat4.ortho(-(M.width/2),M.width/2,-(M.height/2),M.height/2,fa,ga,ea),1==u){var b=ka/2/Math.tan(ia/2*.01745329251),c=b;if(ka<ja/ha){var d=ja/ha;c=d/2/Math.tan(ia/2*.01745329251)}else c=ka/2/Math.tan(ia/2*.01745329251),b<c&&(c=b);var e=c*Math.tan(ia/2*.01745329251),f=e*ha,h=2*f,i=2*f/ha;mat4.identity(ea),B<1e-5&&(B=1e-5),mat4.ortho(-(h/2)*B,h/2*B,-(i/2)*B,i/2*B,fa,ga,ea)}mat4.translate(ea,[w[0],-w[1],w[2]]),mat4.multiply(ea,x,ea)}else{if(k.updateNearFarPlane(),ea=g(ia,ha,fa,ga),0==u){var j=l.getModelOriginalCenter();mat4.translate(ea,[-j[0],-j[1],-j[2]],ea),mat4.translate(ea,[0,0,-ma])}mat4.translate(ea,[w[0],-w[1],w[2]]),mat4.multiply(ea,x,ea)}oa(a)};var ra=null,sa=0,ta=0,ua=0,va=0,wa=0,xa=function(){var a=l.get2DCanvas();f(a),f(M);var b=(new Date).getTime();wa=b-ua,wa/=1e3,wa>.032&&(wa=.016),sa+=b-ua,ua=b,ta++,sa>=1e3&&(va=ta,ta=0,sa%=1e3,1==CAXViewer.DEBUG&&l.updateStatus("Frame Rate : "+va)),k.renderNormalScene(!1),N.flush(),ra=window.requestAnimationFrame(xa)};this.stopAnimationLoop=function(){ra&&(window.cancelAnimationFrame(ra),ra=void 0)},xa(),this.clear=function(){S.clear(),V.clear(),Y.clear(),_.clear(),ca.clear(),n.clear(),Ca&&N.deleteBuffer(Ca),Ca=null,Da&&N.deleteBuffer(Da),Da=null,Ea&&N.deleteBuffer(Ea),Ea=null,Fa&&N.deleteBuffer(Fa),Fa=null,Ga&&N.deleteBuffer(Ga),Ga=null,Ha&&N.deleteBuffer(Ha),Ha=null,N.getExtension("WEBGL_lose_context")&&N.getExtension("WEBGL_lose_context").loseContext()};var ya=[],za=[],Aa=function(a,b){try{if(""==b||void 0==b||null==b)var c=l.get2DCanvas();else var c=document.getElementById(b);var d=c.getBoundingClientRect(),e=d.right-d.left,f=d.bottom-d.top,g=c.getContext("2d"),h=a.startPosition,i=a.width,j=a.height,k=a.colorArray,n=a.rangeMax,o=a.rangeMin,p=a.discreteMode,q=!1;a.bDistinctLegend&&(q=a.bDistinctLegend,p=!0);var r=[];a.DistinctRangeArray&&(r=a.DistinctRangeArray);var s=3;a.precisionValue&&(s=a.precisionValue);var t=!1;a.scientifeNumericFormat&&(t=a.scientifeNumericFormat);var u="Right";a.textAlign&&(u=a.textAlign);var v=!1;a.isDynamicRangeEnabled&&(v=a.isDynamicRangeEnabled);var w=4;a.segmentHeight&&(w=a.segmentHeight),0==a.fontSizeIndex?a.fontSize=8:1==a.fontSizeIndex?a.fontSize=10:2==a.fontSizeIndex&&(a.fontSize=12);var x=a.fontSize+"pt "+a.fontName,y="No Result",z=a.fontColor,A=a.fontColor;if(l.getCanvasBGMode()==CAXViewer.BGMode.PLAIN){var B=m.hexToRgb(l.getBGData().plainColor);B.r<129&&B.b<129&&B.g<129&&(z="#FFFFFF",A="#FFFFFF")}if(l.getCanvasBGMode()==CAXViewer.BGMode.GRADIENT){var B=m.hexToRgb(l.getBGData().gradientcolor1);B.r<129&&B.b<129&&B.g<129&&(z="#FFFFFF",A="#FFFFFF"),B=m.hexToRgb(l.getBGData().gradientcolor2),B.r<129&&B.b<129&&B.g<129&&(z="#FFFFFF",A="#FFFFFF")}if(1==a.isBGColorVisible){var B=a.BGColor;A=B[0]<.49&&B[1]<.49&&B[2]<.49?"#FFFFFF":"#000000"}h=[h[0]*e,h[1]*f],i*=e/100,j*=f/100,i>20&&(i=20),j>.9*f&&(j=.9*f);var C=k.length,D=C;0==p&&(D-=1);var E=w*(f/100);E>20&&(E=20),E*D>j&&(E=j/D);var F=10,G=10;t?(F=o.toExponential(s),G=n.toExponential(s)):(F=n.toFixed(s),G=o.toFixed(s)),E<a.fontSize&&(a.fontSize=E-.15*E);var x=a.fontSize+"pt "+a.fontName;g.font=x;var H=g.measureText(F).width>g.measureText(G).width?g.measureText(F).width:g.measureText(G).width,I=g.measureText(y).width;if(H=H>I?H:I,a.textArray.length>=3){g.font=x,g.fillStyle=z;var J=[0,15];if("Right"==u)g.fillText(a.textArray[0],h[0],h[1]+0*J[1]),g.fillText(a.textArray[1],h[0],h[1]+1*J[1]),g.fillText(a.textArray[2],h[0],h[1]+2*J[1]);else if("Left"==u){h[0]=h[0]+H;var I=g.measureText(a.textArray[0]).width;h[0]-I+i>=0&&g.fillText(a.textArray[0],h[0]-I+i,h[1]+0*J[1]),I=g.measureText(a.textArray[1]).width,h[0]-I+i>=0&&g.fillText(a.textArray[1],h[0]-I+i,h[1]+1*J[1]),I=g.measureText(a.textArray[2]).width,h[0]-I+i>=0&&g.fillText(a.textArray[2],h[0]-I+i,h[1]+2*J[1])}h[1]=h[1]+3*J[1]}var K=0;if(1==a.isNoResultColorVisible&&(K=2),1==a.isBGColorVisible){g.beginPath(),g.fillStyle=m.rgbToHex2(a.BGColor);var L=1.5*i+H;"Right"==u?g.fillRect(h[0]-10,h[1]-10,L+20,E*(D+K)+20):"Left"==u&&g.fillRect(h[0]+i-L-10,h[1]-10,L+20,E*(D+K)+20)}g.lineWidth=1,g.beginPath(),g.strokeStyle=A,g.rect(h[0],h[1],i,E*D);var M=parseInt(g.font),N=0,O=(n-o)/D;for(N=0;N<D;N++){g.strokeStyle=A;var P=1.5;if("Right"==u?(g.moveTo(h[0],h[1]+N*E),g.lineTo(h[0]+i*P,h[1]+N*E)):"Left"==u&&(g.moveTo(h[0]+i,h[1]+N*E),g.lineTo(h[0]+i-i*P,h[1]+N*E)),0==p){var Q=g.createLinearGradient(0,h[1]+N*E,0,h[1]+N*E+E),R=m.rgbToHex2(k[N]),S=m.rgbToHex2(k[N+1]);Q.addColorStop(0,R),Q.addColorStop(1,S),g.fillStyle=Q,g.fillRect(h[0],h[1]+N*E,i,E)}else{var T=m.rgbToHex2(k[N]);g.fillStyle=T,g.fillRect(h[0],h[1]+N*E,i,E)}var U=0;g.fillStyle=A;var V=n-N*O;if(1==v&&(V=a.DynamicRangeArray[N]),1==q&&(V=a.DistinctRangeArray[N],U=E/2),o>n){if(V="NA","Right"==u)g.fillText(V,h[0]+1.5*i+5,h[1]+N*E+M/2+U);else if("Left"==u){var I=g.measureText(V).width;g.fillText(V,h[0]-I-.7*i,h[1]+N*E+M/2+U)}}else if(V=t?V.toExponential(s):V.toFixed(s),"Right"==u)g.fillText(V,h[0]+1.5*i+5,h[1]+N*E+M/2+U);else if("Left"==u){var I=g.measureText(V).width;g.fillText(V,h[0]-I-.7*i,h[1]+N*E+M/2+U)}}if(g.strokeStyle=A,"Right"==u?(g.moveTo(h[0],h[1]+N*E),g.lineTo(h[0]+1.5*i,h[1]+N*E)):"Left"==u&&(g.moveTo(h[0]+i,h[1]+N*E),g.lineTo(h[0]+i-1.5*i,h[1]+N*E)),g.stroke(),0==q){g.fillStyle=A;var V=n-N*O;if(1==v&&(V=a.DynamicRangeArray[N]),o>n){if(V="NA","Right"==u)g.fillText(V,h[0]+1.5*i+5,h[1]+N*E+M/2);else if("Left"==u){var I=g.measureText(V).width;g.fillText(V,h[0]-I-.7*i,h[1]+N*E+M/2)}}else if(V=t?V.toExponential(s):V.toFixed(s),"Right"==u)g.fillText(V,h[0]+1.5*i+5,h[1]+N*E+M/2);else if("Left"==u){var I=g.measureText(V).width;g.fillText(V,h[0]-I-.7*i,h[1]+N*E+M/2)}}if(1==a.isNoResultColorVisible){g.lineWidth=1,g.beginPath(),g.fillStyle=m.rgbToHex2(a.NoResultColor),g.fillRect(h[0],h[1]+E*D+E,i,E),g.strokeStyle=A,g.strokeRect(h[0],h[1]+E*D+E,i,E);var I=g.measureText(y).width,M=g.measureText(y).height,M=parseInt(g.font);g.fillStyle=A,"Right"==u?g.fillText(y,h[0]+1.5*i+5,h[1]+E*D+E+E/2+M/2):"Left"==u&&g.fillText(y,h[0]-I-.7*i,h[1]+E*D+E+E/2+M/2)}g.closePath()}catch(a){console.log(a)}},Ba=function(a,b){try{if(""==b||void 0==b||null==b)var c=l.get2DCanvas();else var c=document.getElementById(b);var d=c.getBoundingClientRect(),e=d.right-d.left,f=d.bottom-d.top,g=c.getContext("2d"),h=a.startPosition,i=a.width,j=a.height,k=a.colorArray,n=a.rangeMax,o=a.rangeMin,p=a.discreteMode,q=!1;a.bDistinctLegend&&(q=a.bDistinctLegend,p=!0);var r=[];a.DistinctRangeArray&&(r=a.DistinctRangeArray);var s=3;a.precisionValue&&(s=a.precisionValue);var t=!1;a.scientifeNumericFormat&&(t=a.scientifeNumericFormat);var u="Top";a.textAlign&&(u=a.textAlign);var v=!1;a.isDynamicRangeEnabled&&(v=a.isDynamicRangeEnabled);var w=4;a.segmentWidth&&(w=a.segmentWidth),0==a.fontSizeIndex?a.fontSize=8:1==a.fontSizeIndex?a.fontSize=10:2==a.fontSizeIndex&&(a.fontSize=12);var x=a.fontSize+"pt "+a.fontName,y="No Result",z=a.fontColor,A=a.fontColor;if(l.getCanvasBGMode()==CAXViewer.BGMode.PLAIN){var B=m.hexToRgb(l.getBGData().plainColor);B.r<129&&B.b<129&&B.g<129&&(z="#FFFFFF",A="#FFFFFF")}if(l.getCanvasBGMode()==CAXViewer.BGMode.GRADIENT){var B=m.hexToRgb(l.getBGData().gradientcolor1);B.r<129&&B.b<129&&B.g<129&&(z="#FFFFFF",A="#FFFFFF"),B=m.hexToRgb(l.getBGData().gradientcolor2),B.r<129&&B.b<129&&B.g<129&&(z="#FFFFFF",A="#FFFFFF")}if(1==a.isBGColorVisible){var B=a.BGColor;A=B[0]<.49&&B[1]<.49&&B[2]<.49?"#FFFFFF":"#000000"}a.fXPosition&&(a.fXPosition>0?h[0]=a.fXPosition:h[0]=.01),h=[h[0]*e,h[1]*f],i*=e/100,j*=f/100,j>20&&(j=20),i>.9*e&&(i=.9*e);var C=k.length,D=C;0==p&&(D-=1);var E=w*(e/100);E*D>i&&(E=i/D);var F=10,G=10;t?(F=o.toExponential(s),G=n.toExponential(s)):(F=n.toFixed(s),G=o.toFixed(s)),E<a.fontSize&&(a.fontSize=E-.15*E);var x=a.fontSize+"pt "+a.fontName;g.font=x;var H=g.measureText(F).width>g.measureText(G).width?g.measureText(F).width:g.measureText(G).width,I=g.measureText(y).width;if(H=H>I?H:I,a.textArray.length>=3){g.font=x,g.fillStyle=z;var J=[0,15];"Top"==u?(g.fillText(a.textArray[0],h[0],h[1]+0*J[1]),g.fillText(a.textArray[1],h[0],h[1]+1*J[1]),g.fillText(a.textArray[2],h[0],h[1]+2*J[1]),h[1]=h[1]+3*J[1]):"Bottom"==u&&(h[1]=h[1]-j-4*J[1],g.fillText(a.textArray[0],h[0],h[1]+j+1*J[1]+10),g.fillText(a.textArray[1],h[0],h[1]+j+2*J[1]+10),g.fillText(a.textArray[2],h[0],h[1]+j+3*J[1]+10))}var K=0;if(1==a.isNoResultColorVisible&&(K=2),1==a.isBGColorVisible){g.beginPath(),g.fillStyle=m.rgbToHex2(a.BGColor);var L=1.5*j+H;"Top"==u?g.fillRect(h[0]-10,h[1]-10,E*(D+K)+20,L+20):"Bottom"==u&&g.fillRect(h[0]-10,h[1]+j-L-10,E*(D+K)+20,L+20)}g.strokeStyle=A,g.lineWidth=1,g.beginPath(),g.rect(h[0],h[1],E*D,j),g.stroke();var M=(n-o)/D,N=0,O=parseInt(g.font);for(N=0;N<D;N++){if(g.strokeStyle=A,"Top"==u?(g.moveTo(h[0]+N*E,h[1]),g.lineTo(h[0]+N*E,h[1]+1.5*j)):"Bottom"==u&&(g.moveTo(h[0]+N*E,h[1]+j),g.lineTo(h[0]+N*E,h[1]+j-1.5*j)),0==p){var P=g.createLinearGradient(h[0]+N*E,0,h[0]+N*E+E,0),Q=m.rgbToHex2(k[N]),R=m.rgbToHex2(k[N+1]);P.addColorStop(0,Q),P.addColorStop(1,R),g.fillStyle=P,g.fillRect(h[0]+N*E,h[1],E,j)}else{var S=m.rgbToHex2(k[N]);g.fillStyle=S,g.fillRect(h[0]+N*E,h[1],E,j)}var T=0;g.fillStyle=A;var U=n-N*M;if(1==v&&(U=a.DynamicRangeArray[N]),1==q&&(U=a.DistinctRangeArray[N],T=E/2),o>n){if(U="NA","Top"==u){g.save();var V=h[0]+N*E-O/2+T,W=h[1]+j+10;g.translate(V,W),g.rotate(Math.PI/2),g.translate(-V,-W),g.fillText(U,V,W),g.restore()}else if("Bottom"==u){var I=g.measureText(U).width;g.save();var V=h[0]+N*E+O/2+T,W=h[1]-10;g.translate(V,W),g.rotate(-Math.PI/2),g.translate(-V,-W),g.fillText(U,V,W),g.restore()}}else if(U=t?U.toExponential(s):U.toFixed(s),"Top"==u){g.save();var V=h[0]+N*E-O/2+T,W=h[1]+j+10;g.translate(V,W),g.rotate(Math.PI/2),g.translate(-V,-W),g.fillText(U,V,W),g.restore()}else if("Bottom"==u){var I=g.measureText(U).width;g.save();var V=h[0]+N*E+O/2+T,W=h[1]-10;g.translate(V,W),g.rotate(-Math.PI/2),g.translate(-V,-W),g.fillText(U,V,W),g.restore()}}if(g.strokeStyle=A,"Top"==u?(g.moveTo(h[0]+N*E,h[1]),g.lineTo(h[0]+N*E,h[1]+1.5*j)):"Bottom"==u&&(g.moveTo(h[0]+N*E,h[1]+j),g.lineTo(h[0]+N*E,h[1]+j-1.5*j)),g.stroke(),0==q){g.fillStyle=A;var U=n-N*M;if(o>n){U="NA";var O=parseInt(g.font);if("Top"==u){g.save();var V=h[0]+N*E-O/2,W=h[1]+j+10;g.translate(V,W),g.rotate(Math.PI/2),g.translate(-V,-W),g.fillText(U,V,W),g.restore()}else if("Bottom"==u){var I=g.measureText(U).width;g.save();var V=h[0]+N*E+O/2,W=h[1]-10;g.translate(V,W),g.rotate(-Math.PI/2),g.translate(-V,-W),g.fillText(U,V,W),g.restore()}}else{U=t?U.toExponential(s):U.toFixed(s);var O=parseInt(g.font);if("Top"==u){g.save();var V=h[0]+N*E-O/2,W=h[1]+j+10;g.translate(V,W),g.rotate(Math.PI/2),g.translate(-V,-W),g.fillText(U,V,W),g.restore()}else if("Bottom"==u){var I=g.measureText(U).width;g.save();var V=h[0]+N*E+O/2,W=h[1]-10;g.translate(V,W),g.rotate(-Math.PI/2),g.translate(-V,-W),g.fillText(U,V,W),g.restore()}}}if(1==a.isNoResultColorVisible){g.lineWidth=1,g.beginPath(),g.fillStyle=m.rgbToHex2(a.NoResultColor),g.fillRect(h[0]+E*D+E,h[1],E,j),g.strokeStyle=A,g.strokeRect(h[0]+E*D+E,h[1],E,j);var X="No Result",I=g.measureText(X).width,O=parseInt(g.font);if(g.fillStyle=A,"Top"==u){g.save();var V=h[0]+N*E-O/2+1.5*E,W=h[1]+j+10;g.translate(V,W),g.rotate(Math.PI/2),g.translate(-V,-W),g.fillText(X,V,W),g.restore()}else if("Bottom"==u){g.save();var V=h[0]+N*E+O/2+1.5*E,W=h[1]-10;g.translate(V,W),g.rotate(-Math.PI/2),g.translate(-V,-W),g.fillText(X,V,W),g.restore()}}g.closePath()}catch(a){console.log(a);
}};this.drawLegend=function(){k.clearCanvas();for(var a=0;a<za.length;a++){var b=za[a];n.getVisiblePartCount(ya[a])<1||("Top"==b.textAlign||"Bottom"==b.textAlign?1==b.visible&&Ba(b):"Left"!=b.textAlign&&"Right"!=b.textAlign||1==b.visible&&Aa(b))}n.getVisiblePartCount()>0&&n.getCAEModelCount()>0?l.DisableLegendIcon(!1):l.DisableLegendIcon(!0)},this.changeLegendVisibility=function(a,b){if(null==b||void 0==b)for(var c=0;c<za.length;c++){var d=za[c];d.visible=a}else{var e=ya.indexOf(b);if(e!=-1){var d=za[e];d.visible=a}}},this.addLegend=function(a,b){""!=a&&void 0!=a&&null!=a&&(ya.push(a),za.push(b))},this.getOriginalMinMax=function(a){if(""!=a&&void 0!=a&&null!=a){var b=ya.indexOf(a);if(b!=-1){var c=za[b],d={};return d.max=c.rangeMax,d.min=c.rangeMin,d}}},this.getMinMax=function(a){if(""!=a&&void 0!=a&&null!=a){var b=ya.indexOf(a);if(b!=-1){var c=za[b],d={};return d.max=c.rangeMax,d.min=c.rangeMin,d}}},this.changeLegendColorOrder=function(a,b){if(""!=a&&void 0!=a&&null!=a){var c=ya.indexOf(a);if(c!=-1){var d=za[c];d&&d.colorArray&&d.isReversed!=b&&(d.isReversed=b,d.colorArray=d.colorArray.reverse())}k.drawLegend()}},this.updateLegend=function(a,b){if(""!=a&&void 0!=a&&null!=a){var c=ya.indexOf(a);if(c!=-1){var d=za[c];if(d&&b)for(var e in b)d[e]=b[e]}k.drawLegend()}},this.getLegendPosition=function(){var a=za.length;switch(a){case 0:return m.clone(CAXViewer.legendRight);case 1:return m.clone(CAXViewer.legendLeft);case 2:return m.clone(CAXViewer.legendTop);case 3:return m.clone(CAXViewer.legendBottom);default:return m.clone(CAXViewer.legendRight)}},this.deleteAllLegend=function(){ya=[];for(var a=0;a<za.length;a++)za[a]=null;za=[]},this.hideAllLegend=function(){k.clearCanvas();for(var a=0;a<za.length;a++)za[a].visible=!1},this.hideLegend=function(a){if(""!=a&&void 0!=a&&null!=a){k.clearCanvas();var b=ya.indexOf(a);if(b!=-1){var c=za[b];c&&(c.visible=!1)}k.drawLegend()}},this.isLegendObjExist=function(a){if(""!=a&&void 0!=a&&null!=a){var b=ya.indexOf(a);if(b!=-1&&za.length>b){var c=za[b];if(void 0!=c&&null!=c)return!0}}return!1};var Ca=null,Da=null,Ea=null,Fa=null,Ga=null,Ha=null},CAXViewer.XYPlotManager=function(a){var b=a;b.getUtility();this.XYPlotArray=[],this.XYPlotCount=0;var c=this;this.deleteAll=function(){var a=0;for(c.XYPlotCount=0,a=0;a<this.XYPlotArray.length;a++){var b=this.XYPlotArray[a];$("#"+b.getCanvasID()).remove()}this.XYPlotArray.splice(0,this.XYPlotArray.length)},this.animateDataPointForTransient=function(a){var b=0;for(b=0;b<c.XYPlotArray.length;b++){var d=c.XYPlotArray[b],e=d.getXYPlot(),f=d.getlineChartDataSet();e.config.endDrawScaleFunction=drawShapes;var g=e.data.labels.length-1,h=e.data.labels[0],i=e.data.labels[g],j=g,k=[],l=0;for(l=0;l<f.datasets.length;l++){var m=f.datasets[l].xPos[a],n=j*((m-h)/(i-h)),o={position:"INCHART",shape:"Square",sideCount:4,strokeColor:f.datasets[l].strokeColor,fillColor:f.datasets[l].fillColor,radius:5,animate:!0,x1:n,y1:f.datasets[l].data[a],iter:"ALL"};({position:"INCHART",shape:"LINE",strokeStyle:"dashSpace",strokeSize:2,strokeColor:f.datasets[l].strokeColor,x1:n,y1:-999,x2:n,y2:f.datasets[l].data[a]}),{position:"INCHART",shape:"LINE",strokeStyle:"dashSpace",strokeSize:2,strokeColor:f.datasets[l].strokeColor,x1:-999,y1:f.datasets[l].data[a],x2:n,y2:f.datasets[l].data[a]};k.push(o)}e.data.shapesInChart=k,updateChart(e.ctx,e.data,e.config,!1,!1)}}},CAXViewer.XYPlot=function(a){function b(){y.style.left=f[0]+"px",y.style.bottom=f[1]+"px",y.style.cursor=j,y.style.width=k+"px",y.style.height=l+"px",y.style.zIndex=m,y.style.opacity=n,y.style.filter=o,y.style.position=p,y.style.visibility=B,y.style.fontFamily=q,y.style.fontSize=r+"px",y.style.color=s,y.style.backgroundColor=t,""!=w?(y.style.borderColor=w,y.style.borderStyle=u,y.style.borderRadius="0px 0px",y.style.borderWidth=v+"px"):(y.style.borderColor="",y.style.borderStyle="",y.style.borderRadius="",y.style.borderWidth=""),y.style.userSelect="none",y.style.MozUserSelect="none",y.style.webkitUserSelect="none",y.setAttribute("unselectable","on"),y.style.whiteSpace="nowrap"}function c(a){return a.preventDefault(),!1}var d=a,e=(d.getUtility(),d.getXYPlotManager()),f=[0,0],g=!1,h=[0,0],i=[0,0],j="default",k=300,l=100,m=20,n=1,o="alpha(opacity="+100*this.opacity+")",p="absolute",q="Arial",r=15,s="",t="",u="solid",v=1,w="",x=null,y=null,z=null,A=null,B=!0,C=null,D=[],E={},F=this;this.getXYPlot=function(){return C},this.getlineChartDataSet=function(){return D},this.setStyle=function(a){a&&(a.position&&(f=a.position),a.borderStyle&&(u=a.borderStyle),a.borderWidth&&(v=a.borderWidth),a.cursor&&(j=a.cursor),a.width&&(k=a.width),a.height&&(l=a.height),a.zIndex&&(m=a.zIndex),a.opacity&&(n=a.opacity),a.filter&&(o=a.filter),a.stylePosition&&(p=a.stylePosition),a.fontFace&&(q=a.fontFace),a.fontSize&&(r=a.fontSize),a.fontColor&&(s=a.fontColor),null!=a.backgroundColor&&(t=a.backgroundColor),null!=a.borderColor&&(w=a.borderColor)),b()},this.create=function(a){y=document.createElement("canvas"),y.id="Xyplot_Canvas_"+e.XYPlotCount,A="Xyplot_Canvas_"+e.XYPlotCount,a&&(y.width=a.width,y.height=a.height,F.setStyle(a)),y.addEventListener("mouseout",function(a){a.toElement&&"divCursor"!=a.toElement.id&&$("#divCursor").hide()},!1),$(document).on("mouseout","#divCursor",function(){$("#divCursor").hide()}),y.oncontextmenu=c,e.XYPlotCount++},this.addTo=function(a){a&&(x=a,x.appendChild(y))},this.initXYPLot=function(){z=y.getContext("2d"),C=new Chart(z).Line(D,E)},this.changePosition=function(a){a&&(f=a,y.style.left=f[0]+"px",y.style.bottom=f[1]+"px")},this.changeSize=function(a){var b=window.devicePixelRatio||1,c=z.webkitBackingStorePixelRatio||z.mozBackingStorePixelRatio||z.msBackingStorePixelRatio||z.oBackingStorePixelRatio||z.backingStorePixelRatio||1,d=b/c;a&&(y.width=a[0]*d,y.height=a[1]*d,updateChart(C.ctx,C.data,C.config,!1,!1))},this.getCanvasID=function(){return A},this.setLineChartDataSet=function(a){D=a},this.getLineChartDataSet=function(){return D},this.setChartJSOptions=function(a){E=a},this.getChartJSOptions=function(){return E},this.setgraphTitle=function(a){E.graphTitle=a},this.setxAxisLabel=function(a){E.xAxisLabel=a},this.setyAxisLabel=function(a){E.graphTitle=a},this.getIsRelativePosition=function(){return g},this.setIsRelativePosition=function(a){g=a},this.getRelativePosition=function(){return h},this.setRelativePosition=function(a){a&&(h=a)},this.getRelativeSize=function(){return i},this.setRelativeSize=function(a){a&&(i=a)}},CAXViewer.SectionManager=function(a){function b(a,b){var c=[a[0],a[1],a[2]],d=a[3],f=[],h=[];c=e.Normalize(c),0!=c[0]||0!=c[1]||1!=c[2]&&c[2]!=-1?(f=e.CrossProduct(c,[0,0,1]),h=e.CrossProduct(c,f),f=e.Normalize(f),h=e.Normalize(h)):(f=[1,0,0],h=[0,1,0]);var i=e.multiplyVector(c,-d),j=i,k=100,l=[0,0,0];if(g){var m=g.getVisiblePartBoundingBox(),k=Math.max(m.max[0]-m.min[0],m.max[1]-m.min[1]);k=Math.max(k,m.max[2]-m.min[2])/1.5;var t=[(m.max[0]+m.min[0])/2,(m.max[1]+m.min[1])/2,(m.max[2]+m.min[2])/2];l=t}var v=e.DotProduct(e.subtractVector(l,i),c),j=e.subtractVector(l,e.multiplyVector(c,v)),w=e.multiplyVector(f,k),x=e.multiplyVector(h,k),y=e.subtractVector(e.subtractVector(j,w),x),z=e.subtractVector(e.addVector(j,w),x),A=e.addVector(e.addVector(j,w),x),B=e.addVector(e.subtractVector(j,w),x),C=[];C.push.apply(C,y),C.push.apply(C,z),C.push.apply(C,A),C.push.apply(C,B);var D=[0,1,2,0,2,3],E=[0,1,1,2,2,3,3,0];1==b?(null!=n&&"undefined"!=n||(n=u.createBuffer(),o=u.createBuffer(),p=u.createBuffer()),u.bindBuffer(u.ARRAY_BUFFER,n),u.bufferData(u.ARRAY_BUFFER,new Float32Array(C),u.STATIC_DRAW),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,o),u.bufferData(u.ELEMENT_ARRAY_BUFFER,new Int16Array(D),u.STATIC_DRAW),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,p),u.bufferData(u.ELEMENT_ARRAY_BUFFER,new Int16Array(E),u.STATIC_DRAW)):2==b&&(null!=q&&"undefined"!=q||(q=u.createBuffer(),r=u.createBuffer(),s=u.createBuffer()),u.bindBuffer(u.ARRAY_BUFFER,q),u.bufferData(u.ARRAY_BUFFER,new Float32Array(C),u.STATIC_DRAW),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,r),u.bufferData(u.ELEMENT_ARRAY_BUFFER,new Int16Array(D),u.STATIC_DRAW),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,s),u.bufferData(u.ELEMENT_ARRAY_BUFFER,new Int16Array(E),u.STATIC_DRAW))}function c(a,c){var d=c;if(1==a){if(!h||null==l)return;if(0==j)return;null!=n&&null!=o||b(l,1),d.setUseTransparency(1),d.setTransparency(.1),u.enable(u.BLEND),u.blendFunc(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA),d.setUsecolor(2),d.setUserColor([1,1,1]),u.bindBuffer(u.ARRAY_BUFFER,n),d.setPositionAttrib(),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,o),u.drawElements(u.TRIANGLES,6,u.UNSIGNED_SHORT,0),u.disable(u.BLEND),d.setUseTransparency(0),d.setUserColor([1,0,0]),u.bindBuffer(u.ARRAY_BUFFER,n),d.setPositionAttrib(),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,p),u.drawElements(u.LINES,8,u.UNSIGNED_SHORT,0),d.setUsecolor(0)}if(2==a){if(!i||null==m)return;if(0==k)return;null!=q&&null!=r||b(m,2),d.setUseTransparency(1),d.setTransparency(.3),u.enable(u.BLEND),u.blendFunc(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA),d.setUsecolor(2),d.setUserColor([0,0,1]),u.bindBuffer(u.ARRAY_BUFFER,q),d.setPositionAttrib(),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,r),u.drawElements(u.TRIANGLES,6,u.UNSIGNED_SHORT,0),u.disable(u.BLEND),d.setUseTransparency(0),d.setUserColor([1,0,0]),u.bindBuffer(u.ARRAY_BUFFER,q),d.setPositionAttrib(),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,s),u.drawElements(u.LINES,8,u.UNSIGNED_SHORT,0),d.setUsecolor(0)}}var d=a,e=d.getUtility(),f=d.getWebgl(),g=d.getModelManager(),h=!1,i=!1;this.getSection1State=function(){return h},this.getSection2State=function(){return i};var j=!1,k=!1;this.setSection1PlaneVisibility=function(a){j=a},this.setSection2PlaneVisibility=function(a){k=a};var l=null,m=null,n=null,o=null,p=null,q=null,r=null,s=null,t=f.getLightShader();this.setShader=function(a){t=a};var u=null;this.enableSectionPlain1=function(){t.set_clipPlane1_State(1),h=!0},this.disableSectionPlain1=function(){t.set_clipPlane1_State(0),h=!1},this.enableSectionPlain2=function(){t.set_clipPlane2_State(1),i=!0},this.disableSectionPlain2=function(){t.set_clipPlane2_State(0),i=!1},this.setSectionPlain1=function(a){t.setclipPlane1(a),l=a,null!=u&&(u.deleteBuffer(n),u.deleteBuffer(o),u.deleteBuffer(p)),n=null,o=null,p=null},this.setSectionPlain2=function(a){t.setclipPlane2(a),m=a,null!=u&&(u.deleteBuffer(q),u.deleteBuffer(r),u.deleteBuffer(s)),q=null,r=null,s=null},this.clearBuffer=function(){null!=u&&(u.deleteBuffer(n),u.deleteBuffer(o),u.deleteBuffer(p),u.deleteBuffer(q),u.deleteBuffer(r),u.deleteBuffer(s))},this.render=function(a,b){u=b;var d=f.getpMatrix(),e=f.getmvMatrix();a.setUniformProjectionMatrix(d),a.setUniformModelviewMatrix(e),c(1,a),c(2,a)}},CAXViewer.Label=function(a){function b(){y.innerHTML=e,y.style.left=f[0]+"px",y.style.top=f[1]+"px",y.style.cursor=i,y.style.zIndex=l,y.style.opacity=m,y.style.filter=n,y.style.position=o,p?y.style.visibility="visible":y.style.visibility="hidden",y.style.fontFamily=q,y.style.fontSize=r+"px",y.style.color=s,1==u&&(y.style.backgroundColor=t),""!=v&&1==w?(y.style.borderColor=v,y.style.borderStyle=g,y.style.borderRadius="0px 0px",y.style.borderWidth=h+"px"):(y.style.borderColor="",y.style.borderStyle="",y.style.borderRadius="",y.style.borderWidth=""),y.style.userSelect="none",y.style.MozUserSelect="none",y.style.webkitUserSelect="none",y.setAttribute("unselectable","on"),y.style.whiteSpace="nowrap"}var c=a,d=(c.getUtility(),c.getLabelManager()),e="";this.setMesssage=function(a){e=a,e=e.replace(/\\n/g,"<br/>"),y.innerHTML=e};var f=[0,0],g="solid",h=1,i="default",j=50,k=20,l=15,m=1,n="alpha(opacity="+100*this.opacity+")",o="absolute",p=!0,q="Arial",r=15,s="#000000",t="#FFFFCC",u=!0,v="#000000",w=!0,x=null,y=null,z=null,A=d.type[0],B=d.subTypeFor3DLabel[0],C=!1,D=!1,E=[0,0],F=!1,G=!1,H=!1,I=0,J=0;this.Point3D=[0,0,0,1],this.PointIndex=[0,0,0],this.partName=null,this.partkey=null,this.version=0,this.customData={};var K=this;this.setLabelSubType=function(a){B=a},this.getLabelSubType=function(){return B},this.setStyle=function(a){a&&(a.message&&(e=a.message,e=e.replace(/\\n/g,"<br/>")),a.position&&(f=a.position),a.borderStyle&&(g=a.borderStyle),a.borderWidth&&(h=a.borderWidth),a.cursor&&(i=a.cursor),a.width&&(j=a.width),a.height&&(k=a.height),a.zIndex&&(l=a.zIndex),a.opacity&&(m=a.opacity),a.filter&&(n=a.filter),a.stylePosition&&(o=a.stylePosition),a.fontFace&&(q=a.fontFace),a.fontSize&&(r=a.fontSize),a.fontColor&&(s=a.fontColor),null!=a.backgroundColor&&(t=a.backgroundColor),null!=a.borderColor&&(v=a.borderColor),null!=a.isBGVisible&&(u=a.isBGVisible),null!=a.isBorderVisible&&(w=a.isBorderVisible),null!=a.isVisible&&(p=a.isVisible)),b()},this.updateStyle=function(a){a&&(a.message&&(e=a.message,e=e.replace(/\\n/g,"<br/>")),a.fontFace&&(q=a.fontFace),a.fontSize&&(r=a.fontSize),a.fontColor&&(s=a.fontColor),null!=a.backgroundColor&&(t=a.backgroundColor),null!=a.borderColor&&(v=a.borderColor),y.innerHTML=e,y.style.fontFamily=q,y.style.fontSize=r+"px",y.style.color=s,y.style.backgroundColor=t,""!=v?(y.style.borderColor=v,y.style.borderStyle=g,y.style.borderRadius="0px 0px",y.style.borderWidth=h+"px"):(y.style.borderColor="",y.style.borderStyle="",y.style.borderRadius="",y.style.borderWidth=""))},this.create=function(a,b,c){y=document.createElement("div"),y.id="div_"+d.lableCount,z="div_"+d.lableCount,A=b,a&&K.setStyle(a),c&&(this.Point3D=c.Point3D,this.partName=c.partName,this.partkey=c.partkey,this.PointIndex=c.PointIndex,this.modelName=c.modelName),d.lableCount++},this.setPartData=function(a){a&&(this.Point3D=a.Point3D,this.partName=a.partName,this.partkey=a.partkey,this.PointIndex=a.PointIndex)},this.addTo=function(a){a&&(x=a,x.appendChild(y))},this.getdeletedFlag=function(){return H},this.setdeletedFlag=function(a){H=a},this.getdivID=function(){return z},this.getLabelType=function(){return A},this.getIsMouseMoving=function(){return C},this.getPosition=function(){var a=[0,0];return a[0]=y.style.left,a[1]=y.style.top,f=a,a},this.getLineDeltaX=function(){return I},this.setLineDeltaX=function(a){I=a},this.getLineDeltaY=function(){return J},this.setLineDeltaY=function(a){J=a},this.getisSnapVertex=function(){return F},this.setisSnapVertex=function(a){F=a},this.getisPartiallyAdded=function(){return D},this.setisPartiallyAdded=function(a){D=a},this.getVisibility=function(){return p},this.setVisibility=function(a){p=a,p?y.style.visibility="visible":y.style.visibility="hidden"},this.invertVisibility=function(){p=!p,p?y.style.visibility="visible":y.style.visibility="hidden"},this.getIsRelativePosition=function(){return G},this.setIsRelativePosition=function(a){G=a},this.getRelativePosition=function(){return E},this.setRelativePosition=function a(a){a&&(E=a)},this.changePosition=function(a){if(a){f=a;var b=($("#"+y.id).width(),$("#"+y.id).height());y.style.left=f[0]+"px",y.style.top=f[1]-b+"px"}},this.hideLabel=function(){y.style.display="none"},this.showLabel=function(){y.style.display="block"}},CAXViewer.LableManager=function(a){function b(a){var b=a,c=u.createBuffer();return u.bindBuffer(u.ARRAY_BUFFER,c),u.bufferData(u.ARRAY_BUFFER,new Float32Array(b),u.STATIC_DRAW),c}function c(a,b){var c=a;u.bindBuffer(u.ARRAY_BUFFER,b),u.bufferData(u.ARRAY_BUFFER,new Float32Array(c),u.STATIC_DRAW)}function d(a,b){var c=[];c.push.apply(c,a),c.push.apply(c,b);var d=u.createBuffer();return u.bindBuffer(u.ARRAY_BUFFER,d),u.bufferData(u.ARRAY_BUFFER,new Float32Array(c),u.STATIC_DRAW),d}function e(a,b,c){var d=[];d.push.apply(d,a),d.push.apply(d,b),u.bindBuffer(u.ARRAY_BUFFER,c),u.bufferData(u.ARRAY_BUFFER,new Float32Array(d),u.STATIC_DRAW)}function f(a,b){var c=[a[0],a[1],a[2],b[0],b[1],b[2]],d=u.createBuffer();return u.bindBuffer(u.ARRAY_BUFFER,d),u.bufferData(u.ARRAY_BUFFER,new Float32Array(c),u.STATIC_DRAW),d}function g(a,b,c){var d=[a[0],a[1],a[2],b[0],b[1],b[2]];u.bindBuffer(u.ARRAY_BUFFER,c),u.bufferData(u.ARRAY_BUFFER,new Float32Array(d),u.STATIC_DRAW)}function h(a){a&&u.deleteBuffer(a),a=null}function j(a){h(a.pointBuffer),h(a.lineBuffer),h(a.colorBuffer),a.DistanceLineBuffer&&h(a.DistanceLineBuffer),a.ArcLineBuffer&&h(a.ArcLineBuffer),a.ArcPointBuffer&&h(a.ArcPointBuffer),a.ArcCenterLineBuffer&&h(a.ArcCenterLineBuffer),a.EdgeLineBuffer&&h(a.EdgeLineBuffer),a.FaceLineBuffer&&h(a.FaceLineBuffer),a.multiPointBuffer&&h(a.multiPointBuffer),a.multiLineBuffer&&h(a.multiLineBuffer)}function k(){var a=0,b=0;for(b=0;b<t.labelArray.length;b++){var c=t.labelArray[b];0==c.getVisibility()&&a++}return a}function l(a){for(i=0;i<this.LableArray.length;i++){var b=this.LableArray[i];if(b.getdivID()==a)return b}return null}function m(a){var b=u.createBuffer();return u.bindBuffer(u.ARRAY_BUFFER,b),u.bufferData(u.ARRAY_BUFFER,new Float32Array(a),u.STATIC_DRAW),b}function n(a,f,g,h){var i=g.customData.multiPartTableInfo;if(null!=i&&void 0!=i&&0!=i.length){for(var j=[],k=0;k<i.length;k++){var l=i[k],m=l.ModelName,n=l.PartName,p=l.Key,s=(l.PositionIndex,l.AttachedPosition),v=l.LabelUndeformedPosition||l.AttachedPosition,w=l.LabeldeformedPosition||l.AttachedPosition,x=(l.LabelRealResult,l.LabelImaginaryResult,s),y=r.getModelByName(m);if(null!=y&&void 0!=y){var z=y.getTransformMatrixMatrixAndDeformVertex(n,p);if(z){var A=z[0];z[1];if(!A)return;var B=y.getScaleFactor();if(1==g.getisSnapVertex())if(1==y.getIsDeformed()){var C=y.getNormalizeFactor();if(g.version>=1&&(C=1),y.getAnimationType()==CAXViewer.CAEAnimationType.EIGEN_VECTOR_COMPLEX&&(C=1),null!=v&&"undefined"!=v&&null!=w&&"undefined"!=w){var D=q.subtractVector(w,v);D[0]=D[0]*B[0]*C,D[1]=D[1]*B[1]*C,D[2]=D[2]*B[2]*C;var E=q.addVector(D,v);x=E,x[3]=1}}else v&&(x=v,x[3]=1);if(1==y.getIsAnimationON())if(y.getAnimationType()==CAXViewer.CAEAnimationType.TRANSIENT){if(g.customData.AnimationLabelMultiPartTableInfo){var F=0;for(F=0;F<g.customData.AnimationLabelMultiPartTableInfo.length&&(g.customData.AnimationLabelMultiPartTableInfo[F].ModelName!=m||g.customData.AnimationLabelMultiPartTableInfo[F].Key!=p);F++);if(F>=g.customData.AnimationLabelMultiPartTableInfo.length)continue;var G=g.customData.AnimationLabelMultiPartTableInfo[F].LabelUndeformedPosition,H=g.customData.AnimationLabelMultiPartTableInfo[F].LabeldeformedPosition,I=x,J=x;null!=G&&"undefined"!=G&&(I=G),null!=H&&"undefined"!=H&&(J=H);var D=q.subtractVector(J,I);D[0]=D[0]*B[0],D[1]=D[1]*B[1],D[2]=D[2]*B[2];var E=q.addVector(D,I);x=E,x[3]=1}else x=g.Point3D;x[3]=1}else{var K=y.getFrameFactor(),B=y.getScaleFactor(),C=y.getNormalizeFactor();if(g.version>=1&&(C=1),y.getAnimationType()==CAXViewer.CAEAnimationType.LINEAR||y.getAnimationType()==CAXViewer.CAEAnimationType.EIGEN_VECTOR){var D=q.subtractVector(w,v);D[0]=D[0]*K*B[0]*C,D[1]=D[1]*K*B[1]*C,D[2]=D[2]*K*B[2]*C;var E=q.addVector(D,v);x=E,x[3]=1}if(y.getAnimationType()==CAXViewer.CAEAnimationType.EIGEN_VECTOR_COMPLEX&&(g.getLabelSubType()==t.subTypeFor3DLabel[1]||g.getLabelSubType()==t.subTypeFor3DLabel[2])){var L=Math.cos(K),M=Math.sin(K),E=[];E[0]=v[0]+(LabelRealResult[0]*L-LabelImaginaryResult[0]*M)*B[0],E[1]=v[1]+(LabelRealResult[1]*L-LabelImaginaryResult[1]*M)*B[1],E[2]=v[2]+(LabelRealResult[2]*L-LabelImaginaryResult[2]*M)*B[2],x=E,x[3]=1}}var N=[];mat4.multiplyVec3(A,x,N),N[3]=1,o(N)&&(j.push(N[0]),j.push(N[1]),j.push(N[2]))}}}for(var O=[],k=0;k<j.length;k+=3)O.push(h[0]),O.push(h[1]),O.push(h[2]),O.push(j[k]),O.push(j[k+1]),O.push(j[k+2]);null==g.multiPointBuffer?g.multiPointBuffer=b(j):c(j,g.multiPointBuffer),null==g.multiLineBuffer?g.multiLineBuffer=d(O,[]):e(O,[],g.multiLineBuffer),a.enablePosition(),a.setUsecolor(2),a.setUserColor([0,0,0]),u.bindBuffer(u.ARRAY_BUFFER,g.multiPointBuffer),a.setPositionAttrib(),u.drawArrays(u.POINTS,0,j.length/3),a.setUserColor([.3,.3,.3]),u.bindBuffer(u.ARRAY_BUFFER,g.multiLineBuffer),a.setPositionAttrib(),u.drawArrays(u.LINES,0,O.length/3),a.disablePosition(),a.setUsecolor(0)}}function o(b){null!=s&&void 0!=s||(s=a.getWebgl());var c=s.getCameraMatrix();mat4.inverse(c);var d=q.getDirVector(c),e=q.getPositionVector(c),f=-(d[0]*e[0]+d[1]*e[1]+d[2]*e[2]),g=d[0]*b[0]+d[1]*b[1]+d[2]*b[2]+f;return g<0}function p(a,b,c,d){var e=unproject([a,b,0]),f=unproject([a,b,1]),g=model.getPickedNode(c.x,c.y);if(g&&g.geometry&&g.geometry.point){var h=intersectTriangle(e,f,g,"originalPoint");if(h||(h=intersectTriangle2(e,f,g,"originalPoint")),h){var i=h.point,j={};if(j.partName=g.Name,j.partkey=g.key,j.Point3D=i,j.PointIndex=[0,0,0],d){var k=h.pointIndex,l=findNearestPointinTriangle(e,f,h.triangle1,h.triangle2,h.triangle3,g);i=l.point;var m=3*l.index;j.Point3D=i,j.PointIndex=[k+m,k+m+1,k+m+2]}return j}}}var q=a.getUtility(),r=a.getModelManager(),s=a.getWebgl(),t=this;this.type=["2DLABEL","3DLABEL"],this.subTypeFor3DLabel=["ANNOTATION","MINMAX","PROBE","DISTANCE","ARC","EDGE","FACE"],this.contextLabelOperation=["ShowAll","HideAll","DeleteAll","DeleteAllHidden","InvertShow"],this.LABEL_OPERATION=["NOTHING","ADDLABEL","ADDLABELPOINT","EDITLABEL"],this.labelArray=[],this.currentLabelOperation=this.LABEL_OPERATION[0],this.LabelAddModelData=null,this.LabelEditObjectID=null,this.lableCount=0;var u=null;this.render=function(h,i){if(u=i,this.labelArray&&h&&(null!=r&&void 0!=r||(r=a.getModelManager()),this.labelArray.length>0)){var j=0;for(j=0;j<this.labelArray.length;j++){var k=this.labelArray[j];if(k.getLabelType()==t.type[1]&&0!=k.getVisibility())if(k.getisPartiallyAdded()){var l=k.getPosition(),m=l[0].replace("px",""),p=l[1].replace("px",""),s=unproject([m,p,0]),v=getdivCanvasContainerOffset();newMouseX=mouseX-v[0],newMouseY=mouseY-v[1];var w=unproject([newMouseX,newMouseY,.001]);null==k.lineBuffer?k.lineBuffer=d(w,s):e(w,s,k.lineBuffer);var x=[1,0,0];if(null==k.colorBuffer?k.colorBuffer=f(x,x):g(x,x,k.colorBuffer),null==k.lineBuffer||null==k.colorBuffer)return;h.enablePosition(),h.enableColor(),u.bindBuffer(u.ARRAY_BUFFER,k.colorBuffer),h.setColor(),u.bindBuffer(u.ARRAY_BUFFER,k.lineBuffer),h.setPositionAttrib(),u.drawArrays(u.LINES,0,2),h.disableColor(),h.disablePosition()}else{var y=k.Point3D;if(y[3]=1,k.getLabelSubType()==t.subTypeFor3DLabel[0]||k.getLabelSubType()==t.subTypeFor3DLabel[1]||k.getLabelSubType()==t.subTypeFor3DLabel[2]){var z=k.modelName,A=k.partName,B=k.partkey,C=(k.PointIndex,r.getModelByName(z));if(null==C||void 0==C)continue;var D=C.getTransformMatrixMatrixAndDeformVertex(A,B);if(!D)continue;var E=D[0];D[1];if(!E)return;if(1==k.getisSnapVertex())if(1==C.getIsDeformed()&&""!=C.getcurrentCAEInstance()){var F=C.getScaleFactor(),G=C.getNormalizeFactor();if(k.version>=1&&(G=1),C.getAnimationType()==CAXViewer.CAEAnimationType.EIGEN_VECTOR_COMPLEX&&(G=1),null!=k.customData.LabelUndeformedPosition&&"undefined"!=k.customData.LabelUndeformedPosition&&null!=k.customData.LabeldeformedPosition&&"undefined"!=k.customData.LabeldeformedPosition){var H=k.customData.LabelUndeformedPosition,I=k.customData.LabeldeformedPosition,J=q.subtractVector(I,H);J[0]=J[0]*F[0]*G,J[1]=J[1]*F[1]*G,J[2]=J[2]*F[2]*G;var K=q.addVector(J,H);y=K}}else k.customData.LabelUndeformedPosition&&(y=k.customData.LabelUndeformedPosition,y[3]=1);if(1==C.getIsAnimationON()&&""!=C.getcurrentCAEInstance())if(C.getAnimationType()==CAXViewer.CAEAnimationType.TRANSIENT){if(k.customData.AnimationPoint3D){var H=y,I=y;null!=k.customData.AnimationLabelUndeformedPosition&&"undefined"!=k.customData.AnimationLabelUndeformedPosition&&(H=k.customData.AnimationLabelUndeformedPosition),null!=k.customData.AnimationLabeldeformedPosition&&"undefined"!=k.customData.AnimationLabeldeformedPosition&&(I=k.customData.AnimationLabeldeformedPosition);var J=q.subtractVector(I,H);J[0]=J[0]*F[0],J[1]=J[1]*F[1],J[2]=J[2]*F[2];var K=q.addVector(J,H);y=K,y[3]=1}else y=k.Point3D;y[3]=1}else{var H=y,I=y,L=null,M=null;null!=k.customData.LabelUndeformedPosition&&"undefined"!=k.customData.LabelUndeformedPosition&&(H=k.customData.LabelUndeformedPosition),null!=k.customData.LabeldeformedPosition&&"undefined"!=k.customData.LabeldeformedPosition&&(I=k.customData.LabeldeformedPosition),null!=k.customData.LabelRealResult&&"undefined"!=k.customData.LabelRealResult&&(L=k.customData.LabelRealResult),null!=k.customData.LabelImaginaryResult&&"undefined"!=k.customData.LabelImaginaryResult&&(M=k.customData.LabelImaginaryResult);var N=C.getFrameFactor(),F=C.getScaleFactor(),G=C.getNormalizeFactor();if(k.version>=1&&(G=1),C.getAnimationType()==CAXViewer.CAEAnimationType.LINEAR||C.getAnimationType()==CAXViewer.CAEAnimationType.EIGEN_VECTOR){var J=q.subtractVector(I,H);J[0]=J[0]*N*F[0]*G,J[1]=J[1]*N*F[1]*G,J[2]=J[2]*N*F[2]*G;var K=q.addVector(J,H);y=K,y[3]=1}if(C.getAnimationType()==CAXViewer.CAEAnimationType.EIGEN_VECTOR_COMPLEX&&L&&M&&(k.getLabelSubType()==t.subTypeFor3DLabel[0]||k.getLabelSubType()==t.subTypeFor3DLabel[1]||k.getLabelSubType()==t.subTypeFor3DLabel[2])){var O=Math.cos(N),P=Math.sin(N),K=[];K[0]=H[0]+(L[0]*O-M[0]*P)*F[0],K[1]=H[1]+(L[1]*O-M[1]*P)*F[1],K[2]=H[2]+(L[2]*O-M[2]*P)*F[2],y=K,y[3]=1}}var w=[];mat4.multiplyVec3(E,y,w),w[3]=1}else{var w=y;w[3]=1,k.getLabelSubType()==t.subTypeFor3DLabel[3]?t.renderDistancePoints(h,k):k.getLabelSubType()==t.subTypeFor3DLabel[4]?t.renderArcPoints(h,k):k.getLabelSubType()==t.subTypeFor3DLabel[5]?t.renderEdgePoints(h,k):k.getLabelSubType()==t.subTypeFor3DLabel[6]&&t.renderFacePoints(h,k)}if(!o(w)){k.hideLabel();continue}k.showLabel();var Q=[];if(1==k.getIsMouseMoving())var l=k.getPosition(),m=l[0].replace("px",""),p=l[1].replace("px","");else{null!=E&&"undefined"!=E?(k.customData.labelPosition[3]=1,mat4.multiplyVec3(E,k.customData.labelPosition,Q)):(Q=k.customData.labelPosition,Q[3]=1);var R=mat4.create();mat4.identity(R);var S=q.project(Q,R),m=S[0],p=S[1];k.changePosition([m,p])}var s=q.unproject([m,p,0],R);1==k.customData.bIsMultiPartTable&&n(h,i,k,s),null==k.pointBuffer?k.pointBuffer=b([w[0],w[1],w[2]]):c([w[0],w[1],w[2]],k.pointBuffer),null==k.lineBuffer?k.lineBuffer=d([w[0],w[1],w[2]],[s[0],s[1],s[2]]):e([w[0],w[1],w[2]],[s[0],s[1],s[2]],k.lineBuffer);var x=[0,0,0];if(null==k.colorBuffer?k.colorBuffer=f(x,x):g(x,x,k.colorBuffer),null==k.pointBuffer||null==k.lineBuffer||null==k.colorBuffer)return;h.enablePosition(),h.enableColor(),u.bindBuffer(u.ARRAY_BUFFER,k.colorBuffer),h.setColor(),k.getLabelSubType()!=t.subTypeFor3DLabel[4]&&(u.bindBuffer(u.ARRAY_BUFFER,k.pointBuffer),h.setPositionAttrib(),u.drawArrays(u.POINTS,0,1)),1==k.customData.bIsMultiPartTable&&(h.setUsecolor(2),h.setUserColor([1,0,0])),u.bindBuffer(u.ARRAY_BUFFER,k.lineBuffer),h.setPositionAttrib(),u.drawArrays(u.LINES,0,2),h.setUserColor([0,0,0]),h.setUsecolor(0),h.disableColor(),h.disablePosition()}}}},this.renderDistancePoints=function(a,b){var c=b.customData["DISTANCE-Points"];c&&(null==b.DistanceLineBuffer&&(b.DistanceLineBuffer=m(c)),a.enablePosition(),a.setUsecolor(2),a.setUserColor([1,0,0]),u.bindBuffer(u.ARRAY_BUFFER,b.DistanceLineBuffer),a.setPositionAttrib(),u.drawArrays(u.POINTS,0,2),a.setUserColor([0,0,0]),u.bindBuffer(u.ARRAY_BUFFER,b.DistanceLineBuffer),a.setPositionAttrib(),u.drawArrays(u.LINES,0,c.length/3),a.disablePosition(),a.setUsecolor(0))},this.renderArcPoints=function(a,b){var c=b.customData,d=c["ARC-ArcPoints"],e=c["ARC-ArcCenter"],f=c["ARC-Points"],g=3*parseInt(parseInt(d.length/3)/2),h=[];h[0]=d[g],h[1]=d[g+1],h[2]=d[g+2];for(var i=[],j=0;j<f.length;j+=3){var k=[f[j],f[j+1],f[j+2]];i.push.apply(i,k)}var k=[e[0],e[1],e[2]];i.push.apply(i,k);var l=[];l.push.apply(l,k),l.push.apply(l,h),null==b.ArcLineBuffer&&(b.ArcLineBuffer=m(d)),null==b.ArcPointBuffer&&(b.ArcPointBuffer=m(i)),null==b.ArcCenterLineBuffer&&(b.ArcCenterLineBuffer=m(l)),a.enablePosition(),a.setUsecolor(2),u.lineWidth(2),a.setUserColor([0,0,0]),u.bindBuffer(u.ARRAY_BUFFER,b.ArcLineBuffer),a.setPositionAttrib(),u.drawArrays(u.LINE_STRIP,0,d.length/3),u.bindBuffer(u.ARRAY_BUFFER,b.ArcCenterLineBuffer),a.setPositionAttrib(),u.drawArrays(u.LINES,0,2),u.lineWidth(1),a.setUserColor([1,0,0]),u.bindBuffer(u.ARRAY_BUFFER,b.ArcPointBuffer),a.setPositionAttrib(),u.drawArrays(u.POINTS,0,i.length/3),a.disablePosition(),a.setUsecolor(0)},this.renderEdgePoints=function(a,b){var c=b.customData["EDGE-Points"];c&&(null==b.EdgeLineBuffer&&(b.EdgeLineBuffer=m(c)),a.enablePosition(),a.setUsecolor(2),a.setUserColor([1,0,0]),u.bindBuffer(u.ARRAY_BUFFER,b.EdgeLineBuffer),a.setPositionAttrib(),u.drawArrays(u.POINTS,0,c.length/3),a.setUserColor([0,0,0]),u.bindBuffer(u.ARRAY_BUFFER,b.EdgeLineBuffer),a.setPositionAttrib(),u.drawArrays(u.LINES,0,2),a.setUserColor([1,1,1]),u.drawArrays(u.LINE_STRIP,1,3),a.disablePosition(),a.setUsecolor(0))},this.renderFacePoints=function(a,b){var c=b.customData["FACE-Points"];c&&(null==b.FaceLineBuffer&&(b.FaceLineBuffer=m(c)),a.enablePosition(),a.setUsecolor(2),a.setUserColor([1,0,0]),u.bindBuffer(u.ARRAY_BUFFER,b.FaceLineBuffer),a.setPositionAttrib(),u.drawArrays(u.POINTS,0,c.length/3),a.setUserColor([1,1,1]),u.bindBuffer(u.ARRAY_BUFFER,b.FaceLineBuffer),a.setPositionAttrib(),u.drawArrays(u.LINE_LOOP,3,3),a.setUserColor([0,0,0]),u.drawArrays(u.LINE_STRIP,0,3),a.disablePosition(),a.setUsecolor(0))},this.showAllLabels=function(){var a=0;for(a=0;a<t.labelArray.length;a++){var b=t.labelArray[a];b.setVisibility(!0)}},this.hideAllLabels=function(){var a=0;for(a=0;a<t.labelArray.length;a++){var b=t.labelArray[a];b.setVisibility(!1)}},this.invertVisibility=function(){if(0!=k()){var a=0;for(a=0;a<t.labelArray.length;a++){var b=t.labelArray[a];b.invertVisibility()}}},this.deleteAllLabels=function(){var a=0;for(a=0;a<this.labelArray.length;a++){var b=this.labelArray[a];b.setdeletedFlag(!0),j(b),$("#"+b.getdivID()).remove()}this.labelArray.splice(0,this.labelArray.length)},this.deleteAllHiddenLabels=function(){var a=0;for(a=this.LableArray.length-1;a>=0;a--){var b=this.LableArray[a];0==b.getVisibility()&&(b.setdeletedFlag(!0),j(b),$("#"+b.getdivID()).remove(),this.LableArray.splice(a,1))}},this.deleteFlaggedLabels=function(){for(i=0;i<this.LableArray.length;i++){var a=this.LableArray[i];1==a.getdeletedFlag()&&(j(a),$("#"+a.getdivID()).remove(),this.LableArray.splice(i,1))}},this.add2DLabel=function(a,b,c){if(null!=LabelAddModelData){var d=a,e=b,f=getCanvasCoord(d,e),g=f.x,h=CANVAS.height-f.y,i=c,j={};if(j.fontFace=LabelAddModelData.fontFace,j.fontSize=LabelAddModelData.fontSize,j.fontColor="#"+LabelAddModelData.fontColor,LabelAddModelData.isBackground?j.backgroundColor="#"+LabelAddModelData.backgroundColor:j.backgroundColor="",LabelAddModelData.isBorder?j.borderColor="#"+LabelAddModelData.borderColor:j.borderColor="",""!=LabelAddModelData.message)if(j.message=LabelAddModelData.message,currentLabelOperation=LABEL_OPERATION[0],0==LabelAddModelData.isAttachedGeometry){j.position=[g,h];var k=new Label;k.create(j,type[0]),k.addTo(i),k.setisSnapVertex(!1),k.setIsRelativePosition(LabelAddModelData.isRelativePosition),LabelAddModelData.isRelativePosition&&k.setRelativePosition(getRelativePosition(g,h,CANVAS)),LableArray.push(k)}else if(singleClickLabel){var l=p(d,e,f,LabelAddModelData.isSnapVertex);if(l){var k=new Label;k.create(j,type[1],l),k.addTo(i),k.setisSnapVertex(LabelAddModelData.isSnapVertex),k.setIsRelativePosition(!1),LableArray.push(k)}}else{j.position=[g,h];var k=new Label;k.create(j,type[1]),k.addTo(i),k.setisSnapVertex(LabelAddModelData.isSnapVertex),k.setIsRelativePosition(!1),k.setisPartiallyAdded(!0),LableArray.push(k),currentLabelOperation=LABEL_OPERATION[2]}}},this.add3DPointLabel=function(a,b){var c=LableArray[LableArray.length-1],d=getdivCanvasContainerOffset(),e=a-d[0],f=b-d[1],g=c.getPosition(),h=g[0].replace("px",""),i=g[1].replace("px",""),k=h-e,l=i-f;c.setLineDeltaX(k),c.setLineDeltaY(l);var m=getCanvasCoord(a-5,b-5),n=p(e,f,m,c.getisSnapVertex());n?(c.setPartData(n),c.setisPartiallyAdded(!1)):(c.setdeletedFlag(!0),j(c),$("#"+c.getdivID()).remove(),LableArray.pop(c)),currentLabelOperation=LABEL_OPERATION[0]},this.updateLabel=function(a){a.fontColor="#"+a.fontColor,a.isBackground?a.backgroundColor="#"+a.backgroundColor:a.backgroundColor="",a.isBorder?a.borderColor="#"+a.borderColor:a.borderColor="";var b=l(LabelEditObjectID);b.updateStyle(a),b=null,LabelEditObjectID=null}},CAXViewer.bottomCtrl=function(a){function b(){g.resetView()}function c(){g.previousViewPoint()}function d(){}function e(){g.nextViewPoint()}function f(){var a=q.className;
a=a.replace("divFullScreenMinimize",""),a=a.replace("divFullScreen",""),h.isFullScreenEnable()?(g.setFullScreenMode(!1),this.className=a+" divFullScreen"):(g.setFullScreenMode(!0),this.className=a+" divFullScreenMinimize")}var g=a,h=g.getUtility(),i=this,j=null,k=null,l=null,m=null,n=null,o=null,p=null,q=null;this.init=function(a){k=g.getContainer();var r=h.getElementInsideContainer(k.id,"divBottomCtrl");r&&k.removeChild(r),j=document.createElement("div"),j.id="divBottomCtrl",j.className="divBottomCtrl",k.appendChild(j),l=document.createElement("div"),l.id="divReset",l.className="divBottomIcon divReset",m=document.createElement("div"),m.id="divMiddle",m.className="divMiddle",j.appendChild(m),n=document.createElement("div"),n.id="divLeft",n.className="divBottomIcon divLeft",m.appendChild(n),o=document.createElement("div"),o.id="divVPPlay",o.className="divBottomIcon divVPPlay",p=document.createElement("div"),p.id="divRight",p.className="divBottomIcon divRight",m.appendChild(p),q=document.createElement("div"),q.id="divFullScreen",q.className="divBottomIcon divFullScreen",l.onclick=b,n.onclick=c,o.onclick=d,p.onclick=e,q.onclick=f,i.updateCtrl()},this.disableEnableLeft=function(a){var b=document.getElementById("divLeft");b&&(a?b.className="divBottomIcon divLeft":b.className="divBottomIcon divLeftDisabled"),r()},this.disableEnableRight=function(a){var b=document.getElementById("divRight");b&&(a?b.className="divBottomIcon divRight":b.className="divBottomIcon divRightDisabled"),r()};var r=function(){var a=document.getElementById("divLeft"),b=document.getElementById("divRight");a.className.indexOf("divLeftDisabled")>-1&&b.className.indexOf("divRightDisabled")>-1?(a.style.display="none",b.style.display="none"):(a.style.display="block",b.style.display="block")};this.showLeftArrow=function(a){var b=document.getElementById("divLeft");b&&(a?b.style.display="block":b.style.display="none")},this.showRightArrow=function(a){var b=document.getElementById("divRight");b&&(a?b.style.display="block":b.style.display="none")},this.clear=function(){g=null,h=null,i=null,j=null,j=null,l=null,m=null,n=null,o=null,p=null,q=null},this.updateCtrl=function(){},this.updateCtrl_old=function(){var a=document.getElementById(k.id),b=q.className;b=b.indexOf("Minimize")>-1?"divFullScreenMinimize":"divFullScreen";var c=window.getComputedStyle(j),d=c.getPropertyValue("width").replace("px","");j.style.left=a.clientWidth/2-d/2+"px"}},CAXViewer.MouseControls=function(){var a=null,b=null,c=this;this.init=function(c,d){a=d,b=void 0!==c?c:document,b.onmousedown=o,b.onmouseup=p,b.onmousemove=q,b.onmouseout=r,b.onmouseenter=s,b.addEventListener?(b.addEventListener("mousewheel",t,!1),b.addEventListener("DOMMouseScroll",t,!1)):b.attachEvent("onmousewheel",t)};var d=function(){var a=[],c=b.getBoundingClientRect();return a[0]=c.top,a[1]=c.left,a[2]=c.bottom,a[3]=c.right,a},e=0,f=0,g=0,h=!1,i=!1,j=0,k=null,l=null,m=null;this.setMenuMouseMoveCallback=function(a){m=a};var n=function(){e=a.isLocalTransformRequired()},o=function(c){c=c||window.event;var e=a.getlabelContainer(),m=c.target.id;if(m==e.id||m.indexOf("Xyplot_Canvas")!=-1||0!=e.contains(c.target)){var n=d();f=n[0],g=n[1],i=!0,h=!1,j=c.keyCode||c.which,k=c.clientX-g,l=c.clientY-f,a.resetZoomFactor(),$(b).css("cursor","crosshair")}},p=function(c){if(c=c||window.event,h===!1){var d=a.getMouseOperation();d==CAXViewer.mouseOpertaionList.LABELADD_TOOL&&console.log("Add Label")}$(b).css("cursor","default"),j=0,i=!1,h=!1},q=function(b){if(!i)return null!==m&&m(b),void(h=!1);h=!0;var c=b.clientX-g,d=b.clientY-f;if(n(),1==j)a.mouseRotation(c,d,k,l,e);else if(3==j)a.mousePanRotation(c,d,k,l,e);else if(2==j){var o=l-d;a.setZoomType(1),o>0&&a.zoomOut(o),o<0&&a.zoomIn(-o)}k=c,l=d},r=function(a){null!==m&&m(a)},s=function(a){1!=a.buttons&&2!=a.buttons&&4!=a.buttons&&(j=0,i=!1,h=!1,$(b).css("cursor","default"))},t=function(c){c=window.event||c;var d=a.getlabelContainer(),e=c.target.id;if(e==d.id||e.indexOf("Xyplot_Canvas")!=-1||0!=d.contains(c.target)){var f=1,g=b.getBoundingClientRect(),h=Math.round((c.clientX-g.left)/(g.right-g.left)*g.width),i=g.height-Math.round((c.clientY-g.top)/(g.bottom-g.top)*g.height);i+=CAXViewer.ViewerTopOffset;var j=Math.max(-1,Math.min(1,c.wheelDelta||-c.detail));a.setZoomType(0),j>0?a.pointZoomIn(h,g.height-i,f):a.pointZoomOut(h,g.height-i,f),c.preventDefault()}};this.clear=function(){b.removeEventListener?(b.removeEventListener("mousewheel",t),b.removeEventListener("DOMMouseScroll",t)):(x.detachEvent("onmousemove",myFunction),b.detachEvent("mousewheel",t),b.detachEvent("DOMMouseScroll",t)),a=null,b=null,c=null}},CAXViewer.TouchControls_old=function(){var a=null,b=null,c=this,d=null,e=0;this.init=function(c,e){a=e;var f=document.getElementById("divLabelRenderer");b=void 0!==f?f:document;var g={};d=new Hammer(b,g);var h=new Hammer.Pan({pointers:0});d.add(h),d.on("panstart",o),d.on("panmove",q),d.on("panend",p);var i=new Hammer.Pinch({pointers:2});d.add(i),d.on("pinchstart",r),d.on("pinchmove",t),d.on("pinchend",s)};var f=function(){var a=[],c=b.getBoundingClientRect();return a[0]=c.top,a[1]=c.left,a[2]=c.bottom,a[3]=c.right,a},g=function(){e=a.isLocalTransformRequired()},h=0,i=0,j=!1,k=!1,l=!1,m=null,n=null,o=function(b){var c=f();h=c[0],i=c[1];var d=a.getlabelContainer(),e=b.target.id;e!=d.id&&e.indexOf("Xyplot_Canvas")==-1||(k=!0,j=!1,m=b.center.x-i,n=b.center.y-h)},p=function(a){k=!1,j=!1},q=function(b){if(!k)return void(j=!1);j=!0;var c=b.center.x-i,d=b.center.y-h;g(),b.pointers.length>2?a.mousePanRotation(c,d,m,n,e):1==b.pointers.length&&a.mouseRotation(c,d,m,n,e),m=c,n=d},r=function(b){var c=a.getlabelContainer(),d=b.target.id;d!=c.id&&d.indexOf("Xyplot_Canvas")==-1||(l=!0,a.setZoomTouchFactor(5e-6))},s=function(b){l=!1,a.setZoomTouchFactor(1)},t=function(b){l&&(b.scale<1?a.zoomOut():b.scale>1&&a.zoomIn())};this.clear=function(){d&&d.destroy(),d=null,a=null,b=null,c=null}},CAXViewer.TouchControls=function(){function a(a){a.preventDefault();var b=a.changedTouches;if(0==l.length)o=b[0].clientX-k,p=b[0].clientY-j,n=m[0];else if(1==l.length){q=null,r=null,n=m[1];var c=l[0].pageX-k,e=l[0].pageY-j,f=b[0].clientX-k,g=b[0].clientY-j;t=Math.sqrt((c-f)*(c-f)+(e-g)*(e-g))}for(var h=0;h<b.length;h++)l.push(d(b[h]))}function b(a){a.preventDefault();var b=a.changedTouches,b=a.touches;if(1==l.length){var c=b[0].clientX-k,d=b[0].clientY-j;v(),o&&p&&n==m[0]&&f.mouseRotation(c,d,o,p,i),o=c,p=d}else if(2==b.length){var e=b[0].clientX-k,g=b[0].clientY-j,h=b[1].clientX-k,t=b[1].clientY-j,u=e-h,w=g-t,x=Math.sqrt(u*u+w*w),y=x-s;if(f.setZoomType(2),y<-2){f.zoomOut(3)}else if(y>2){f.zoomIn(3)}else{var c=(e+h)/2,d=(g+t)/2;v(),q&&r&&f.mousePanRotation(c,d,q,r,i),q=c,r=d}s=x}}function c(a){a.preventDefault();for(var b=a.changedTouches,c=0;c<b.length;c++){var d=e(b[c].identifier);d>=0?l.splice(d,1):console.log("can't figure out which touch to end")}1==l.length&&(o=null,p=null,n=m[0])}function d(a){return{identifier:a.identifier,pageX:a.pageX,pageY:a.pageY}}function e(a){for(var b=0;b<l.length;b++){var c=l[b].identifier;if(c==a)return b}return-1}var f=null,g=null,h=this,i=0,j=0,k=0,l=[],m=["singleTouch","doubleTouch"],n=m[0],o=null,p=null,q=null,r=null,s=null,t=null;this.init=function(d,e){f=e;var h=document.getElementById("divLabelRenderer");g=void 0!==h?h:document;var i=u();j=i[0],k=i[1],g.addEventListener("touchstart",a,!1),g.addEventListener("touchend",c,!1),g.addEventListener("touchmove",b,!1),g.addEventListener("touchenter",a,!1),g.addEventListener("touchleave",c,!1),g.addEventListener("touchcancel",c,!1)};var u=function(){var a=[],b=g.getBoundingClientRect();return a[0]=b.top,a[1]=b.left,a[2]=b.bottom,a[3]=b.right,a},v=function(){i=f.isLocalTransformRequired()};this.clear=function(){f=null,g=null,h=null,l=[],m=[]}},CAXViewer.GUI=function(){function a(){0==y&&($("#divSideBarContainer").mCustomScrollbar({scrollbarPosition:"inside",scrollInertia:0,autoExpandScrollbar:!1,autoHideScrollbar:!0,mouseWheel:{enable:!0,scrollAmount:150,preventDefault:!0}}),$("#divMobilePopMenu").mCustomScrollbar({scrollbarPosition:"inside",scrollInertia:0,autoExpandScrollbar:!1,autoHideScrollbar:!1}),y=!0,b())}function b(){var a=document.getElementById("inpSpeed");a&&($("#inpSpeed").bind("change",function(){var a=$(this).val();e.setFrameDelay(i-a),p=i-a}),$("#inpSpeed").bind("input",function(){var a=$(this).val();e.setFrameDelay(i-a),p=i-a}))}function c(){}var d=this,e=null,f=null,g=null,h=0,i=250,j=null;this.getSelectedViewPathKey=function(){return j},this.setSelectedViewPathKey=function(a){j=a};var k=null;this.getSelectedViewPointKey=function(){return k},this.setSelectedViewPointKey=function(a){k=a,d.updateViewPointSelection()};var l=!1,m=!0,n=!0,o=!1,p=1,q=1,r=!1,s=!1,t=!0,u=!1,v="No animation",w=!0,x={viewpoints:!0,caeanimation:!0,displaymode:!0,capture:!0,fitview:!0,resetviewpoint:!0,legend:!0,frameinfo:!0,fullscreen:!0},y=!1;if(this.init=function(a){e=a,f=e.getUtility(),g=e.getBottomCtrl();var b=document.getElementById("divCaxViewer"),c=document.getElementById("vctGUI");c&&b.removeChild(c);var d=document.createElement("div");d.id="vctGUI",d.className="vctGUI",d.setAttribute("ng-app","vctGUI"),b.appendChild(d);var h="<div ng-include=\"'templates/MenuBarTemplate.html'\"></div>",i="<div ng-include=\"'templates/MenuBarTemplate_lessGUI.html'\"></div>";d.innerHTML=1==CAXViewer.lessGUI?i:h,angular.bootstrap(d,["vctGUI"]),f.isFullScreenEnable()&&(l=!0)},this.updateDisplayModeIndex=function(a){switch(a){case"shaded":h=0;break;case"shadedMesh":h=1;break;case"wire":h=2;break;case"hiddenLine":h=3;break;case"point":h=4;break;case"transparent":h=5;break;default:h=-1}var b=angular.element(document.getElementById("divSideBar")).scope();b&&(b.displayModeSelectedIndex=h)},this.setIsFullScreen=function(a){l=a;var b=angular.element(document.getElementById("divTopMenuBar")).scope();b&&(b.isFullScreen=l,b.$applyAsync())},this.updateViewPointSelection=function(){var a=angular.element(document.getElementById("divSideBar")).scope();a&&(a.viewPointSelectedKey=k,a.$apply())},this.updateFileName=function(a){var b=angular.element(document.getElementById("divTopMenuBar")).scope();b&&(b.Filename=a,b.$apply())},this.updateLegendSelectionIcon=function(a){var b=angular.element(document.getElementById("divTopMenuBar")).scope();b&&(m=a,b.islegendOn=a,b.$applyAsync())},this.updateCAEAnimation=function(a,b,c,d){var e=angular.element(document.getElementById("divSideBar")).scope();if(e){i=b>250?b:250,e.showCAEAnimation===!1?(o=a,p=i-b,q=c,v=d,e.$applyAsync()):(o=a,p=i-b,q=c,v=d,e.CAEAnimation.isAnimationOn=o,e.CAEAnimation.scaleFactor=q,e.CAEAnimation.animationType=v,e.$applyAsync());var f=document.getElementById("inpSpeed");f&&(f.max=i,f.value=p)}},this.updateCAEAnimationType=function(a){var b=angular.element(document.getElementById("divSideBar")).scope();b&&a&&(v=a,b.CAEAnimation&&(b.CAEAnimation.animationType=v),b.$applyAsync())},this.updateCAEAnimationIcon=function(a){var b=angular.element(document.getElementById("divTopMenuBar")).scope();b&&(r=a,b.isCAEAnimationEnabled=r,b.$applyAsync())},this.updateFrameInfoIcon=function(a){var b=angular.element(document.getElementById("divTopMenuBar")).scope();b&&(u=a,b.isFrameInfoEnabled=u,b.$applyAsync())},this.updateVPIcon=function(a){var b=angular.element(document.getElementById("divTopMenuBar")).scope();b&&(t=a,b.isVPExists=r,b.$applyAsync())},this.UpdateLegendIcon=function(a){var b=angular.element(document.getElementById("divTopMenuBar")).scope();b&&(n=a,b.islegendDisabled=n,b.$applyAsync())},this.viewerResized=function(){var a=e.getContainer();a.offsetWidth>720?($("#divMobilePopMenu").hide(),$("#imgTitleBar").attr("src","images/svgs/VCollabLogo01.svg"),$("#imgTitleBar").css("height","16"),$("#imgTitleBar").css("width","120")):($("#imgTitleBar").attr("src","images/svgs/VCollabLogo01.svg"),$("#imgTitleBar").css("height","16"),$("#imgTitleBar").css("width","120")),f.isFullScreenEnable()?d.setIsFullScreen(!0):d.setIsFullScreen(!1),$("#divMobilePopMenu").hide()},this.onMouseDownEvent=function(a){a&&"divHammerIcon"!=a.target.id&&$("#divMobilePopMenu").fadeOut("slow")},this.hideFileOpenBar=function(a){w=a;var b=angular.element(document.getElementById("divTopMenuBar")).scope();b&&(b.hideFileOpenBar=w,b.$applyAsync())},this.updateGUIIcon=function(a){if("object"==typeof a){for(var b in x)x.hasOwnProperty(b)&&(a.hasOwnProperty(b)&&a[b]===!1?x[b]=!1:x[b]=!0);var c=angular.element(document.getElementById("divTopMenuBar")).scope(),d=angular.element(document.getElementById("divMobilePopMenu")).scope();c&&(c.GUIIconVisibility=x,c.$applyAsync()),d&&(d.GUIIconVisibility=x,d.$applyAsync())}},this.clear=function(){d=null;var a=document.getElementById("vctGUI");a&&divCaxViewer.removeChild(a)},CAXViewer.DevOps)var z=angular.module("vctGUI",[]);else var z=angular.module("vctGUI",["templates-main"]);z.factory("SharedData",function(){var a={FirstName:""};return{getFirstName:function(){return a.FirstName},setFirstName:function(b){a.FirstName=b}}}),z.service("DataService",function(){this.getViewPathList=function(){return e.getViewPathList()},this.getViewPointList=function(a){if(a){var b={};return b.itemName=a.itemName,b.key=a.key,e.getViewPointList(null,b)}return[]},this.applyViewPoint=function(a,b){a&&b&&e.getViewPointData(null,b,a.itemvalue,a.key)},this.getViewPointImage=function(a){return a?e.getViewPointImage(null,a):null}});var A=function(b,c){if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))try{for(var d in document.styleSheets){var f=document.styleSheets[d];if(f.rules)for(var g=f.rules.length-1;g>=0;g--)f.rules[g].selectorText&&f.rules[g].selectorText.match(":hover")&&f.deleteRule(g)}}catch(a){}else $('[data-tooltip!=""]').qtip({content:{attr:"data-tooltip"},position:{my:"top right",at:"bottom center",resize:!0,container:$("#divCaxViewer"),adjust:{method:"shift none"}},style:{classes:"qtip-light qtip-rounded"}});b.topMenuIconClick=null,c.isFullScreen=l,c.islegendOn=m,c.islegendDisabled=n,c.Filename="Untitled",c.isCAEAnimationEnabled=r,c.isVPExists=t,c.isFrameInfoEnabled=u,c.hideFileOpenBar=w,c.GUIIconVisibility=x,c.onLegendClick=function(){n||(m=!m,c.islegendOn=m,e.toggleLegendVisibility())},c.onResetViewClick=function(){e.resetViewPoint()},c.onFitViewClick=function(){e.fitView()},c.onFullScreenClick=function(){l=!l,c.isFullScreen=l,e.setFullScreenMode(l)},c.onFrameInfoClick=function(){var a=e.getFrameInfoStrings();u&&$.dialog({backgroundDismiss:!0,title:"Frame Info",type:"dark",content:a})},c.onHelpClick=function(){var a=document.createElement("a");a.href="./others/help.html",a.target="_blank";var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(b)},c.onOpenClick=function(){var a=document.getElementById("VCTFileOpen");a?a.click():$.alert({title:CAXViewer.AppName,type:"dark",content:"This feature is not supported!!!"})},c.topMenuIconClick=function(d){a();var e=document.getElementById(d.target.id);if(!("divCAEPlay"==e.id&&c.isCAEAnimationEnabled===!1||"divVPICon"==e.id&&c.isVPExists===!1)){var f=angular.element(document.getElementById("divSideBar")).scope();if(f.hideAllSidebarItems(),b.topMenuIconClick==d.target.id)if("divVPICon"==d.target.id){var g=angular.element(document.getElementById("divSideBar")).scope();g&&g.updateViewPointGUI()}else if("divCAEPlay"==d.target.id){var g=angular.element(document.getElementById("divSideBar")).scope();g&&g.updateCEAAnimationGUI()}else if("divDISPMode"==d.target.id){var g=angular.element(document.getElementById("divSideBar")).scope();g&&g.updateDisplayModeGUI()}else if("divCapture"==d.target.id){var g=angular.element(document.getElementById("divSideBar")).scope();g&&g.updateCaptureGUI()}b.topMenuIconClick=d.target.id}},c.onLogoClick=function(){var a=CAXViewer.AppName+" "+CAXViewer.VERSION,b="";try{var c=CAXViewer.VERSION.split(".")[2].substring(1),d="",e="";if(4==CAXViewer.VERSION.split(".")[3].length?(e=CAXViewer.VERSION.split(".")[3].substring(2),d=CAXViewer.VERSION.split(".")[3].substring(0,2)):(e=CAXViewer.VERSION.split(".")[3].substring(1),d="0"+CAXViewer.VERSION.split(".")[3].substring(0,1)),e&&d&&c){var b=e+"-"+d+"-"+c;a=a+" ("+b+")"}}catch(a){CAXViewer.error(a)}document.getElementById("divCaxViewer");a+="<br> <br>",""!=CAXViewer.pastVersionLink&&null!=CAXViewer.pastVersionLink&&void 0!=CAXViewer.pastVersionLink&&(a=a+"   <a style='color:Red' href = '"+CAXViewer.pastVersionLink+"' target='_blank'>Past Releases</a>"),""!=CAXViewer.thirdPartyLibrariesLink&&null!=CAXViewer.thirdPartyLibrariesLink&&void 0!=CAXViewer.thirdPartyLibrariesLink&&(a=a+"   <a style='color:Red' href = '"+CAXViewer.thirdPartyLibrariesLink+"' target='_blank'>Open Source Softwares</a>"),$.alert({title:CAXViewer.AppName,type:"dark",content:a})},c.onMenuClick=function(){a(),$("#divMobilePopMenu").show();var b=document.getElementById("divMobilePopMenu");b.scrollTop=0},c.isIconVisible=function(){var a=!1;for(var b in x)x.hasOwnProperty(b)&&x[b]===!0&&(a=!0);return a}};A.$inject=["$rootScope","$scope"],z.controller("vctTopMenuController",A);var B=function(a,b,d,i,l,m){a.$watch("topMenuIconClick",function(a){b.view="templates/RightContainerTemplate.html","divDISPMode"==a?n():"divVPICon"==a?p():"divCAEPlay"==a?t():"divCapture"==a?u():(b.titleName="",b.showDisplayMode=!1,b.showcaptureImg=!1,b.showCAEAnimation=!1,b.showViewPath=!1,b.showViewPoint=!1)}),b.updateViewPointGUI=function(){p()},b.updateCEAAnimationGUI=function(){t()},b.updateDisplayModeGUI=function(){n()},b.updateCaptureGUI=function(){u()},b.hideAllSidebarItems=function(){w()},b.updateIconState=function(a){x(a)},b.ontitleCloseClick=function(){for(var a=document.getElementById("divRightBar").childNodes,b=0;b<a.length;b++)if(a[b].id){var c=document.getElementById(a[b].id);c.className=c.className.replace("divTopMenuBarIconSelected","")}$("#divSideBar").hide(),s=!1};var n=function(){b.titleName="Display Modes",b.titleShowBackIcon=!1,x("divDISPMode"),b.showDisplayMode=!0,b.displayModeSelectedIndex=h;var a=[{showLeftImg:!0,leftImgScr:"images/svgs/DM_Shaded24.svg",itemName:"Shaded",itemvalue:"shaded"},{showLeftImg:!0,leftImgScr:"images/svgs/DM_ShadedMesh24.svg",itemName:"Shaded Mesh",itemvalue:"shadedMesh"},{showLeftImg:!0,leftImgScr:"images/svgs/DM_Wireframe24.svg",itemName:"WireFrame",itemvalue:"wire"},{showLeftImg:!0,leftImgScr:"images/svgs/DM_HiddenLine24.svg",itemName:"Hidden lines",itemvalue:"hiddenLine"},{showLeftImg:!0,leftImgScr:"images/svgs/DM_Point24.svg",itemName:"Points",itemvalue:"point"},{showLeftImg:!0,leftImgScr:"images/svgs/DM_Transparent24.svg",itemName:"Transparent",itemvalue:"transparent"}];b.modelList=a,b.onDisplayModeSelection=function(a,c){b.displayModeSelectedIndex=c,h=c,e.setDisplayMode(a.itemvalue)}},p=function(){if($(".divlistItemSelectedIMG").length>0){var a=$(".divlistItemSelectedIMG")[0].id;setTimeout(function(){$("#divSideBarContainer").mCustomScrollbar("scrollTo",document.getElementById(a),{})},400)}b.titleName="View Paths",b.titleShowBackIcon=!1,x("divVPICon"),b.showViewPath=!0,b.viewPathSelectedKey=j;var c=d.getViewPathList(),e=[];if(c)for(var g=0;g<c.length;g++){var h={};h.itemName=c[g].Name,h.itemvalue=c[g].Name,h.key=c[g].key,h.showRightImg=!0,h.rightImgScr="images/svgs/NextIcon24px.svg";var i=d.getViewPointList(h);i&&i.length>0&&e.push(h)}if(b.viewPathList=e,b.onClickViewPathName=function(a){var b=f.encode_utf8(a.itemvalue),c=a.key,e=d.getViewPointList(a);r(e,b,c)},j&&k){var l=f.getDataFromArray(c,"key",j),h={};h.itemName=l.Name,h.key=j;var i=d.getViewPointList(h);r(i,l.Name,h.key)}},r=function(a,h,i){for(var l=[],m=0;m<a.length;m++){var n={},o=f.encode_utf8(a[m].Name);n.itemName=f.decode_utf8(o),n.itemvalue=f.decode_utf8(o),n.key=a[m].key,n.showLeftImg=!1;var p=d.getViewPointImage(a[m]);p&&(n.showLeftImg=!0,n.leftImgScr=p),l.push(n)}b.viewPointList=l,b.viewPointSelectedKey="",b.viewPointSelectedKey=k,b.titleName=h,b.titleShowBackIcon=!0,b.ontitleBackClick=function(){b.titleShowBackIcon&&(b.titleName="View Paths",b.titleShowBackIcon=!1,b.showViewPath=!0,b.showViewPoint=!1,b.viewPathSelectedKey=j,c())},b.divViewSelection="divView1",l.length>0&&l[0].showLeftImg===!0&&(b.divViewSelection="divView2"),b.showViewPath=!1,b.showViewPoint=!0,b.onViewPointSelection=function(c,f){d.applyViewPoint(c,h),b.viewPointSelectedKey=c.key,k=c.key,j=i,null===g&&(g=e.getBottomCtrl()),0===f?(g.disableEnableLeft(!1),g.disableEnableRight(!0)):f==a.length-1?(g.disableEnableLeft(!0),g.disableEnableRight(!1)):(g.disableEnableLeft(!0),g.disableEnableRight(!0)),l.length<2&&(g.disableEnableLeft(!1),g.disableEnableRight(!1))}},t=function(){b.titleName="CAE Animation",b.titleShowBackIcon=!1,b.showCAEAnimation=!0,x("divCAEPlay"),0==o&&1==s&&(e.startAnimation(),o=!0),b.CAEAnimation={scaleFactor:q,isAnimationOn:o,animationType:v},b.OnPreviousBtnClick=function(){o=!1,b.CAEAnimation.isAnimationOn=o,e.backwardAnimation()},b.OnPlayPauseBtnClick=function(){o?e.pauseAnimation():e.startAnimation(),o=!o,b.CAEAnimation.isAnimationOn=o},b.OnNextBtnClick=function(){o=!1,b.CAEAnimation.isAnimationOn=o,e.forwardAnimation()},b.OnChangeScaleFactor=function(){var a=b.CAEAnimation.scaleFactor;if(a=parseFloat(a),!isNaN(a)){var c=[a,a,a];e.setScaleFactor(c),q=a}}},u=function(){b.titleName="Capture Image",b.titleShowBackIcon=!1,x("divCapture"),b.showcaptureImg=!0,b.selectedImgFormatIndex=0,b.imgFileName="Untitled";var a="PNG";b.selectFileFormat=a;var c=[{itemName:"PNG",itemvalue:"PNG"},{itemName:"JPG",itemvalue:"JPG"},{itemName:"BMP",itemvalue:"BMP"}];b.modelList=c,b.onImgFormatSelection=function(c,d){b.selectedImgFormatIndex=d,a=c.itemvalue,b.selectFileFormat=a},b.btnSaveImageAs=function(b){var c=b+"."+a.toLowerCase();e.saveAsImage(a.toLowerCase(),c)}},w=function(){b.showDisplayMode=!1,b.showcaptureImg=!1,b.showCAEAnimation=!1,b.showViewPath=!1,b.showViewPoint=!1},x=function(a){for(var b=document.getElementById(a),d=b.className,e=document.getElementById("divRightBar"),f=e.childNodes,g=0;g<f.length;g++)if(f[g].id){var h=document.getElementById(f[g].id);h.className=h.className.replace("divTopMenuBarIconSelected","")}var i=b.parentNode.id;"divRightBar"==i&&(d.indexOf("divTopMenuBarIconSelected")>-1?(b.className=d.replace("divTopMenuBarIconSelected",""),$("#divSideBar").hide(),s=!1):(b.className=d+" divTopMenuBarIconSelected",$("#divSideBar").show(),s=!0,c()))}};B.$inject=["$rootScope","$scope","DataService","$element","$interval","$timeout"],z.controller("vctSideBarController",B);var C=function(a,b){var d=[{showLeftImg:!0,leftImgScr:"images/svgs/ViewpointIcon24px.svg",itemName:"View Points",itemvalue:"View Points",showRightImg:!1,rightImgScr:"images/svgs/NextIcon24px.svg"},{showLeftImg:!0,leftImgScr:"images/svgs/CAEAnimIcon24px.svg",itemName:"CAE Animation",itemvalue:"CAE Animation",showRightImg:!1,rightImgScr:"images/svgs/NextIcon24px.svg"},{showLeftImg:!0,leftImgScr:"images/svgs/DM_ShadedMesh24.svg",itemName:"Display Modes",itemvalue:"Display Modes",showRightImg:!1,rightImgScr:"images/svgs/NextIcon24px.svg"},{showLeftImg:!0,leftImgScr:"images/svgs/SaveButton.svg",itemName:"Capture",itemvalue:"Capture",showRightImg:!1,rightImgScr:"images/svgs/NextIcon24px.svg"},{showLeftImg:!0,leftImgScr:"images/svgs/FitviewIcon24.svg",itemName:"Fit View",itemvalue:"Fit View",showRightImg:!1,rightImgScr:"images/svgs/NextIcon24px.svg"},{showLeftImg:!0,leftImgScr:"images/svgs/ResetIcon24px.svg",itemName:"Reset Viewpoint",itemvalue:"Reset Viewpoint",showRightImg:!1,rightImgScr:"images/svgs/NextIcon24px.svg"},{showLeftImg:!0,leftImgScr:"images/svgs/LegendNew.svg",itemName:"Legend",itemvalue:"Legend",showRightImg:!1,rightImgScr:"images/svgs/NextIcon24px.svg"},{showLeftImg:!0,leftImgScr:"images/svgs/info1.svg",itemName:"Frame Info",itemvalue:"Frame Info",showRightImg:!1,rightImgScr:"images/svgs/NextIcon24px.svg"},{showLeftImg:!0,leftImgScr:"images/svgs/helpIcon.svg",itemName:"Help",itemvalue:"Help",showRightImg:!1,rightImgScr:"images/svgs/NextIcon24px.svg"},{showLeftImg:!0,leftImgScr:"images/svgs/FullscreenIcon24px.svg",itemName:"Full Screen",itemvalue:"Full Screen",showRightImg:!1,rightImgScr:"images/svgs/NextIcon24px.svg"}],e=[{showLeftImg:!0,leftImgScr:"images/svgs/FitviewIcon24.svg",itemName:"Fit View",itemvalue:"Fit View",showRightImg:!1,rightImgScr:"images/svgs/NextIcon24px.svg"},{showLeftImg:!0,leftImgScr:"images/svgs/ResetIcon24px.svg",itemName:"Reset Viewpoint",itemvalue:"Reset Viewpoint",showRightImg:!1,rightImgScr:"images/svgs/NextIcon24px.svg"},{showLeftImg:!0,leftImgScr:"images/svgs/FullscreenIcon24px.svg",itemName:"Full Screen",itemvalue:"Full Screen",showRightImg:!1,rightImgScr:"images/svgs/NextIcon24px.svg"}];b.GUIIconVisibility=x,b.MenuItems=1==CAXViewer.lessGUI?e:d,b.OnMenuItemClick=function(a,b){$("#divMobilePopMenu").hide();var d=angular.element(document.getElementById("divTopMenuBar")).scope(),e=angular.element(document.getElementById("divSideBar")).scope(),f=a.itemvalue;switch(f){case"View Points":e.hideAllSidebarItems(),c(),$("#divSideBar").show(),s=!0,e.updateViewPointGUI();break;case"CAE Animation":e.hideAllSidebarItems(),c(),$("#divSideBar").show(),s=!0,e.updateCEAAnimationGUI();break;case"Display Modes":e.hideAllSidebarItems(),c(),$("#divSideBar").show(),s=!0,e.updateDisplayModeGUI();break;case"Capture":e.hideAllSidebarItems(),c(),$("#divSideBar").show(),s=!0,e.updateCaptureGUI();break;case"Fit View":d.onFitViewClick();break;case"Reset Viewpoint":d.onResetViewClick();break;case"Legend":d.onLegendClick();break;case"Frame Info":d.onFrameInfoClick();break;case"Help":d.onHelpClick();break;case"Full Screen":d.onFullScreenClick()}},b.checkforVisibility=function(a,c){return"View Points"==a.itemvalue?!!b.GUIIconVisibility.viewpoints&&t:"CAE Animation"==a.itemvalue?!!b.GUIIconVisibility.caeanimation&&r:"Display Modes"==a.itemvalue?b.GUIIconVisibility.displaymode:"Capture"==a.itemvalue?b.GUIIconVisibility.capture:"Fit View"==a.itemvalue?b.GUIIconVisibility.fitview:"Reset Viewpoint"==a.itemvalue?b.GUIIconVisibility.resetviewpoint:"Legend"==a.itemvalue?!!b.GUIIconVisibility.legend&&!n:"Frame Info"==a.itemvalue?!!b.GUIIconVisibility.frameinfo&&u:"Full Screen"!=a.itemvalue||b.GUIIconVisibility.fullscreen}};C.$inject=["$rootScope","$scope"],z.controller("vctMobilePopMenuController",C)},CAXViewer.symbolPlotManager=function(a){var b=this,c=a;c.getUtility();this.iVersion=0,this.sCurPlotName=null,this.symbolPlotArray=[],this.renderAll=function(a){for(var c=0;c<b.symbolPlotArray.length;c++)1==b.symbolPlotArray[c].bDraw&&b.symbolPlotArray[c].render(a)},this.clearAll=function(){b.clearBuffer();for(var a=0;a<b.symbolPlotArray.length;a++){for(var c=0;c<b.symbolPlotArray[a].SymbolPlotNodeStateArray.length;c++)b.symbolPlotArray[a].SymbolPlotNodeStateArray[c]=null;b.symbolPlotArray[a].SymbolPlotNodeStateArray=[],b.symbolPlotArray[a]=null}b.symbolPlotArray=[]},this.clearBuffer=function(){for(var a=0;a<b.symbolPlotArray.length;a++)b.symbolPlotArray[a].clearBuffer()},this.updateBuffers=function(){for(var a=0;a<b.symbolPlotArray.length;a++)b.symbolPlotArray[a].updateBuffer()}},CAXViewer.symbolPlot=function(a){function b(a,b){if(a.disableColor(),a.setUsecolor(0),a.setUserColor([1,0,0]),null!=b.verticesBuffer&&void 0!=b.verticesBuffer&&(a.enablePosition(),p.bindBuffer(p.ARRAY_BUFFER,b.verticesBuffer),a.setPositionAttrib()),null!=b.normalBuffer&&void 0!=b.normalBuffer&&(a.enableNormal(),p.bindBuffer(p.ARRAY_BUFFER,b.normalBuffer),a.setNormalAttrib()),null!=b.faceBuffer&&void 0!=b.faceBuffer){p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,b.faceBuffer);p.getExtension("OES_element_index_uint");l.iShapeType==CAXViewer.iSymbolPlotShapeType.SD_3D?p.drawElements(p.TRIANGLES,b.totalConnectivityIndex,p.UNSIGNED_INT,0):l.iShapeType==CAXViewer.iSymbolPlotShapeType.SD_2D&&(a.setUsecolor(2),a.setUserColor(l.colorArray),p.drawElements(p.LINES,b.totalConnectivityIndex,p.UNSIGNED_INT,0))}a.disableColor(),a.disablePosition(),a.setUsecolor(0)}function c(a){var b={};return b.verticesBuffer=null,b.normalBuffer=null,b.faceBuffer=null,b.totalConnectivityIndex=0,null!=a.vertices&&void 0!=a.vertices&&(b.verticesBuffer=p.createBuffer(),p.bindBuffer(p.ARRAY_BUFFER,b.verticesBuffer),p.bufferData(p.ARRAY_BUFFER,new Float32Array(a.vertices),p.STATIC_DRAW)),null!=a.normals&&void 0!=a.normals&&a.normals.length>0&&(b.normalBuffer=p.createBuffer(),p.bindBuffer(p.ARRAY_BUFFER,b.normalBuffer),p.bufferData(p.ARRAY_BUFFER,new Float32Array(a.normals),p.STATIC_DRAW)),null!=a.faces&&void 0!=a.faces&&(b.faceBuffer=p.createBuffer(),p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,b.faceBuffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,new Uint32Array(a.faces),p.STATIC_DRAW)),b.totalConnectivityIndex=a.totalConnectivityIndex,b}function d(a,b,c,d,e,f,g,h,i,j){var k=0;b=null!=b?b:1,a=null!=a?a:1,c=null!=c?c:5,d=null!=d?d:25,e=null!=e?e:1,f=null==f||f,g=null==g||g,h=null!=h&&h,i=null!=i?i:0,null!=j&&void 0!=j||(j=!0);for(var l=[],m=[],o=[],p=0;p<=e;p++){var q=d*p,r=0;0==p&&1==j&&(r=c/3);for(var s=0;s<d;s++){var t=a+(b-a)*p/e,u=i+c*p/e,v=t*Math.cos(s/d*Math.PI*2),w=t*Math.sin(s/d*Math.PI*2);if(l.push(v),l.push(u),l.push(w),a==b)var x=[-v,0,-w];else if(a<b)var x=[-v,r,-w];else var x=[-v,-r,-w];if(x=n.Normalize(x),m.push(x[0]),m.push(x[1]),m.push(x[2]),p<e){var y=s+q;if(s+q+1<q+d)var z=s+q+1;else var z=q;if(s+q+d+1<2*d+q)var A=s+q+d+1;else var A=q+d;var B=s+d+q;o.push(y),o.push(z),o.push(A),o.push(y),o.push(A),o.push(B)}}}var C=-1,D=-1;if(f){var E=l.length/3;l.push(0),l.push(i),l.push(0),m.push(0),m.push(C),m.push(0);for(var s=0;s<d;s++){var u=i,v=a*Math.cos(s/d*Math.PI*2),w=a*Math.sin(s/d*Math.PI*2);l.push(v),l.push(u),l.push(w),m.push(0),m.push(C),m.push(0),o.push(E+s+1),E+s+2<E+1+d?o.push(E+s+2):o.push(E+1),o.push(E)}}if(g){var E=l.length/3;l.push(0),l.push(i+c),l.push(0),m.push(0),m.push(D),m.push(0);for(var s=0;s<d;s++){var u=i+c,v=b*Math.cos(s/d*Math.PI*2),w=b*Math.sin(s/d*Math.PI*2);l.push(v),l.push(u),l.push(w),m.push(0),m.push(D),m.push(0),o.push(E+s+1),E+s+2<E+1+d?o.push(E+s+2):o.push(E+1),o.push(E)}}k=e*d*6,f&&(k+=3*d),g&&(k+=3*d);var F={};return F.vertices=l,F.normals=m,F.faces=o,F.totalConnectivityIndex=k,F}function e(a,b,c,d,e){a=null!=a?a:1,b=null!=b?b:5,c=null!=c?c:4,d=null!=d?d:0,e=null!=e&&e;var f=[],g=[],h=d+b,i=d;e&&(h=d,i=d+b);var j=[0,h,0];f.push(j[0]),f.push(j[1]),f.push(j[2]);for(var k=0;k<c;k++){var l=a,m=i,n=l*Math.cos(k/c*Math.PI*2),o=l*Math.sin(k/c*Math.PI*2);f.push(o),f.push(m),f.push(n),g.push(0),g.push(k+1)}var p={};return p.vertices=f,p.faces=g,p.totalConnectivityIndex=g.length,p}function f(a,b,c,e,f){var g=[],h=[],i=[],j=0,k=0;f&&(k=f);var m=[0,0,0];if(m[0]=c[0],m[1]=c[1],m[2]=c[2],m[0]=m[0]*l.fLengthSF,m[1]=m[1]*l.fLengthSF,m[2]=m[2]*l.fLengthSF,e==CAXViewer.iSymbolPlotViewMode.VIEW_MODE_AUTO){var o=n.Normalize(m),p=n.DotProduct(o,a.vertexNormal);if(p<0){b=[b[0]-m[0],b[1]-m[1],b[2]-m[2]]}else{[b[0]-m[0],b[1]-m[1],b[2]-m[2]]}}else if(e==CAXViewer.iSymbolPlotViewMode.VIEW_MODE_TO_POINT){b=[b[0]-m[0],b[1]-m[1],b[2]-m[2]]}else if(e==CAXViewer.iSymbolPlotViewMode.VIEW_MODE_FROM_POINT||e==CAXViewer.iSymbolPlotViewMode.VIEW_MODE_RESULTANT){[b[0]-m[0],b[1]-m[1],b[2]-m[2]]}var q=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),r=q,s=3,t=1,u=s*(t+1)+(s+1),v=.02*r*l.fWidthSF,w=.02*r*l.fWidthSF,x=.8*r,y=d(v,w,x,s,t,!0,!1,!1,0);v=.08*r*l.fWidthSF,w=0*l.fWidthSF,coneHeight=.2*r;var z=d(v,w,coneHeight,s,t,!0,!1,!1,x),A=mat4.create();mat4.identity(A),mat4.translate(A,b);var B=[0,1,0],C=n.findAngle(B,m),D=n.CrossProduct(B,m);180==parseInt(57.2958*C)?mat4.rotate(A,n.degToRad(180),[1,0,0]):mat4.rotate(A,C,D);var E=mat4.create();mat4.identity(E),180==parseInt(57.2958*C)?mat4.rotate(E,n.degToRad(180),[1,0,0]):mat4.rotate(E,C,D);for(var F=0;F<y.vertices.length;F+=3){var G=[];G.push(y.vertices[F]),G.push(y.vertices[F+1]),G.push(y.vertices[F+2]);var H=[];mat4.multiplyVec3(A,G,H),g.push(H[0]),g.push(H[1]),g.push(H[2])}for(var F=0;F<y.normals.length;F+=3){var G=[];G.push(y.normals[F]),G.push(y.normals[F+1]),G.push(y.normals[F+2]);var H=[];mat4.multiplyVec3(E,G,H),h.push(H[0]),h.push(H[1]),h.push(H[2])}for(var I=0;I<y.faces.length;I++)i.push(y.faces[I]+k);j+=y.totalConnectivityIndex;
for(var F=0;F<z.vertices.length;F+=3){var G=[];G.push(z.vertices[F]),G.push(z.vertices[F+1]),G.push(z.vertices[F+2]);var H=[];mat4.multiplyVec3(A,G,H),g.push(H[0]),g.push(H[1]),g.push(H[2])}for(var F=0;F<z.normals.length;F+=3){var G=[];G.push(z.normals[F]),G.push(z.normals[F+1]),G.push(z.normals[F+2]);var H=[];mat4.multiplyVec3(E,G,H),h.push(H[0]),h.push(H[1]),h.push(H[2])}for(var I=0;I<z.faces.length;I++)i.push(z.faces[I]+u+k);j+=z.totalConnectivityIndex;var J={};return J.vertices=g,J.normals=h,J.faces=i,J.totalConnectivityIndex=j,J}function g(a,b,c,d,f){var g=[],h=[],i=0,j=0;f&&(j=f);var k=[0,0,0];k[0]=c[0],k[1]=c[1],k[2]=c[2],k[0]=k[0]*l.fLengthSF,k[1]=k[1]*l.fLengthSF,k[2]=k[2]*l.fLengthSF;var m=[0,0,0];if(d==CAXViewer.iSymbolPlotViewMode.VIEW_MODE_AUTO){var o=n.Normalize(k),p=n.DotProduct(o,a.vertexNormal);p<0?(m=b,b=[b[0]-k[0],b[1]-k[1],b[2]-k[2]]):m=[b[0]-k[0],b[1]-k[1],b[2]-k[2]]}else d==CAXViewer.iSymbolPlotViewMode.VIEW_MODE_TO_POINT?(m=b,b=[b[0]-k[0],b[1]-k[1],b[2]-k[2]]):d!=CAXViewer.iSymbolPlotViewMode.VIEW_MODE_FROM_POINT&&d!=CAXViewer.iSymbolPlotViewMode.VIEW_MODE_RESULTANT||(m=[b[0]-k[0],b[1]-k[1],b[2]-k[2]]);var q=Math.sqrt(k[0]*k[0]+k[1]*k[1]+k[2]*k[2]),r=q,s=3,t=s+1,u=.08*r*l.fWidthSF,v=.2*r,w=.8*r,x=[];x.push.apply(x,[0,0,0]),x.push.apply(x,[0,r,0]);var y=e(u,v,s,w,!1),z=mat4.create();mat4.identity(z),mat4.translate(z,b);var A=[0,1,0],B=n.findAngle(A,k),C=n.CrossProduct(A,k);180==parseInt(57.2958*B)?mat4.rotate(z,n.degToRad(180),[1,0,0]):mat4.rotate(z,B,C);for(var D=0;D<y.vertices.length;D+=3){var E=[];E.push(y.vertices[D]),E.push(y.vertices[D+1]),E.push(y.vertices[D+2]);var F=[];mat4.multiplyVec3(z,E,F),g.push(F[0]),g.push(F[1]),g.push(F[2])}for(var G=0;G<y.faces.length;G++)h.push(y.faces[G]+j);i+=y.totalConnectivityIndex;for(var D=0;D<x.length;D+=3){var E=[];E.push(x[D]),E.push(x[D+1]),E.push(x[D+2]);var F=[];mat4.multiplyVec3(z,E,F),g.push(F[0]),g.push(F[1]),g.push(F[2])}h.push(t+j),h.push(t+1+j),i+=2;var H={};return H.vertices=g,H.faces=h,H.totalConnectivityIndex=i,H}function h(a,b,c,e){var f=[],g=[],h=[],i=0,j=0;e&&(j=e);var k=[0,0,0];k[0]=c[0],k[1]=c[1],k[2]=c[2],k[0]=k[0]*l.fLengthSF,k[1]=k[1]*l.fLengthSF,k[2]=k[2]*l.fLengthSF;var m=[b[0]-k[0],b[1]-k[1],b[2]-k[2]],o=Math.sqrt(k[0]*k[0]+k[1]*k[1]+k[2]*k[2]),p=o,q=3,r=1,s=q*(r+1)+(q+1),t=q*(r+1),u=.01*p*l.fWidthSF,v=.01*p*l.fWidthSF,w=.8*p;coneHeight=.1*p;var x=0*l.fWidthSF,y=.04*p*l.fWidthSF,z=.04*p*l.fWidthSF,A=0*l.fWidthSF,B=0,C=coneHeight+w;if(a.iSymbolPlotDrawType==CAXViewer.iSymbolPlotDrawType.ST_TENSILE_ARROW)var D=d(x,y,coneHeight,q,r,!1,!0,!1,B),E=d(u,v,w,q,r,!1,!1,!1,coneHeight),F=d(z,A,coneHeight,q,r,!0,!1,!1,C);else if(a.iSymbolPlotDrawType==CAXViewer.iSymbolPlotDrawType.ST_COMPRESSIVE_ARROW){var D=d(z,A,coneHeight,q,r,!0,!1,!1,B);w=p;var E=d(u,v,w,q,r,!1,!1,!1,B),F=d(x,y,coneHeight,q,r,!1,!0,!1,C)}var G=[(b[0]+m[0])/2,(b[1]+m[1])/2,(b[2]+m[2])/2],H=mat4.create();mat4.identity(H),mat4.translate(H,G);var I=[0,1,0],J=n.findAngle(I,k),K=n.Normalize(k),L=n.CrossProduct(I,K);180==parseInt(57.2958*J)?mat4.rotate(H,n.degToRad(180),[1,0,0]):mat4.rotate(H,J,L);var M=mat4.create();mat4.identity(M),180==parseInt(57.2958*J)?mat4.rotate(M,n.degToRad(180),[1,0,0]):mat4.rotate(M,J,L);for(var N=0;N<D.vertices.length;N+=3){var O=[];O.push(D.vertices[N]),O.push(D.vertices[N+1]),O.push(D.vertices[N+2]);var P=[];mat4.multiplyVec3(H,O,P),f.push(P[0]),f.push(P[1]),f.push(P[2])}for(var N=0;N<D.normals.length;N+=3){var O=[];O.push(D.normals[N]),O.push(D.normals[N+1]),O.push(D.normals[N+2]);var P=[];mat4.multiplyVec3(M,O,P),g.push(P[0]),g.push(P[1]),g.push(P[2])}for(var Q=0;Q<D.faces.length;Q++)h.push(D.faces[Q]+j);i+=D.totalConnectivityIndex;for(var N=0;N<E.vertices.length;N+=3){var O=[];O.push(E.vertices[N]),O.push(E.vertices[N+1]),O.push(E.vertices[N+2]);var P=[];mat4.multiplyVec3(H,O,P),f.push(P[0]),f.push(P[1]),f.push(P[2])}for(var N=0;N<E.normals.length;N+=3){var O=[];O.push(E.normals[N]),O.push(E.normals[N+1]),O.push(E.normals[N+2]);var P=[];mat4.multiplyVec3(M,O,P),g.push(P[0]),g.push(P[1]),g.push(P[2])}for(var Q=0;Q<E.faces.length;Q++)h.push(E.faces[Q]+s+j);i+=E.totalConnectivityIndex;for(var N=0;N<F.vertices.length;N+=3){var O=[];O.push(F.vertices[N]),O.push(F.vertices[N+1]),O.push(F.vertices[N+2]);var P=[];mat4.multiplyVec3(H,O,P),f.push(P[0]),f.push(P[1]),f.push(P[2])}for(var N=0;N<F.normals.length;N+=3){var O=[];O.push(F.normals[N]),O.push(F.normals[N+1]),O.push(F.normals[N+2]);var P=[];mat4.multiplyVec3(M,O,P),g.push(P[0]),g.push(P[1]),g.push(P[2])}for(var Q=0;Q<F.faces.length;Q++)h.push(F.faces[Q]+s+t+j);i+=F.totalConnectivityIndex;var R={};return R.vertices=f,R.normals=g,R.faces=h,R.totalConnectivityIndex=i,R}function i(a,b,c,d){var f=[],g=[],h=0,i=0;d&&(i=d);var j=[0,0,0];j[0]=c[0],j[1]=c[1],j[2]=c[2],j[0]=j[0]*l.fLengthSF,j[1]=j[1]*l.fLengthSF,j[2]=j[2]*l.fLengthSF;var k=[b[0]-j[0],b[1]-j[1],b[2]-j[2]],m=Math.sqrt(j[0]*j[0]+j[1]*j[1]+j[2]*j[2]),o=m,p=2,q=p+1,r=p+1+2,s=.02*o*l.fWidthSF,t=.1*o,u=0,v=.9*o,w=[];if(a.iSymbolPlotDrawType==CAXViewer.iSymbolPlotDrawType.ST_TENSILE_ARROW){var x=e(s,t,p,u,!0),y=e(s,t,p,v,!1);w.push.apply(w,[0,0,0]),w.push.apply(w,[0,o,0])}else if(a.iSymbolPlotDrawType==CAXViewer.iSymbolPlotDrawType.ST_COMPRESSIVE_ARROW){var x=e(s,t,p,u,!1),y=e(s,t,p,v,!0);w.push.apply(w,[0,t,0]),w.push.apply(w,[0,o-t,0])}var z=[(b[0]+k[0])/2,(b[1]+k[1])/2,(b[2]+k[2])/2],A=mat4.create();mat4.identity(A),mat4.translate(A,z);var B=[0,1,0],C=n.findAngle(B,j),D=n.CrossProduct(B,j);180==parseInt(57.2958*C)?mat4.rotate(A,n.degToRad(180),[1,0,0]):mat4.rotate(A,C,D);for(var E=0;E<x.vertices.length;E+=3){var F=[];F.push(x.vertices[E]),F.push(x.vertices[E+1]),F.push(x.vertices[E+2]);var G=[];mat4.multiplyVec3(A,F,G),f.push(G[0]),f.push(G[1]),f.push(G[2])}for(var H=0;H<x.faces.length;H++)g.push(x.faces[H]+i);h+=x.totalConnectivityIndex;for(var E=0;E<w.length;E+=3){var F=[];F.push(w[E]),F.push(w[E+1]),F.push(w[E+2]);var G=[];mat4.multiplyVec3(A,F,G),f.push(G[0]),f.push(G[1]),f.push(G[2])}g.push(q+i),g.push(q+1+i),h+=2;for(var E=0;E<y.vertices.length;E+=3){var F=[];F.push(y.vertices[E]),F.push(y.vertices[E+1]),F.push(y.vertices[E+2]);var G=[];mat4.multiplyVec3(A,F,G),f.push(G[0]),f.push(G[1]),f.push(G[2])}for(var H=0;H<y.faces.length;H++)g.push(y.faces[H]+r+i);h+=y.totalConnectivityIndex;var I={};return I.vertices=f,I.faces=g,I.totalConnectivityIndex=h,I}function j(a,b,c,e){var f=[],g=[],h=[],i=0,j=0;e&&(j=e);var k=[0,0,0];k[0]=c[0],k[1]=c[1],k[2]=c[2],k[0]=k[0]*l.fLengthSF,k[1]=k[1]*l.fLengthSF,k[2]=k[2]*l.fLengthSF;var m=n.Normalize(k),o=n.DotProduct(m,a.vertexNormal);if(o<0){b=[b[0]-k[0],b[1]-k[1],b[2]-k[2]]}else{[b[0]-k[0],b[1]-k[1],b[2]-k[2]]}var p=Math.sqrt(k[0]*k[0]+k[1]*k[1]+k[2]*k[2]),q=p,r=4,s=1,t=r*(s+1),u=.5*q,v=0*l.fWidthSF,w=u*Math.tan(Math.PI/24)*l.fWidthSF,x=d(v,w,u,r,s,!1,!1,!1,0,!0),y=w,z=2*w,A=y,B=z,C=[-A,u,B],D=[A,u,B],E=[A,u,-B],F=[-A,u,-B],G=[];G.push.apply(G,C),G.push.apply(G,D),G.push.apply(G,E),G.push.apply(G,F);var H=mat4.create();mat4.identity(H),mat4.translate(H,b);var I=[0,1,0],J=n.findAngle(I,k),K=n.Normalize(k),L=n.CrossProduct(I,K);180==parseInt(57.2958*J)?mat4.rotate(H,n.degToRad(180),[1,0,0]):mat4.rotate(H,J,L);var M=mat4.create();mat4.identity(M),180==parseInt(57.2958*J)?mat4.rotate(M,n.degToRad(180),[1,0,0]):mat4.rotate(M,J,L);for(var N=0;N<x.vertices.length;N+=3){var O=[];O.push(x.vertices[N]),O.push(x.vertices[N+1]),O.push(x.vertices[N+2]);var P=[];mat4.multiplyVec3(H,O,P),f.push(P[0]),f.push(P[1]),f.push(P[2])}for(var N=0;N<x.normals.length;N+=3){var O=[];O.push(x.normals[N]),O.push(x.normals[N+1]),O.push(x.normals[N+2]);var P=[];mat4.multiplyVec3(M,O,P),g.push(P[0]),g.push(P[1]),g.push(P[2])}for(var Q=0;Q<x.faces.length;Q++)h.push(x.faces[Q]+j);i+=x.totalConnectivityIndex;for(var N=0;N<G.length;N+=3){var O=[];O.push(G[N]),O.push(G[N+1]),O.push(G[N+2]);var P=[];mat4.multiplyVec3(H,O,P),f.push(P[0]),f.push(P[1]),f.push(P[2]);var O=[];O.push(-G[N]),O.push(1),O.push(-G[N+2]);var P=[];mat4.multiplyVec3(M,O,P),g.push(P[0]),g.push(P[1]),g.push(P[2])}h.push(t+0+j),h.push(t+1+j),h.push(t+2+j),h.push(t+0+j),h.push(t+2+j),h.push(t+3+j),i+=6;var R={};return R.vertices=f,R.normals=g,R.faces=h,R.totalConnectivityIndex=i,R}function k(a,b,c,d){var f=[],g=[],h=0,i=0;d&&(i=d);var j=[0,0,0];j[0]=c[0],j[1]=c[1],j[2]=c[2],j[0]=j[0]*l.fLengthSF,j[1]=j[1]*l.fLengthSF,j[2]=j[2]*l.fLengthSF;var k=n.Normalize(j),m=n.DotProduct(k,a.vertexNormal);if(m<0){b=[b[0]-j[0],b[1]-j[1],b[2]-j[2]]}else{[b[0]-j[0],b[1]-j[1],b[2]-j[2]]}var o=Math.sqrt(j[0]*j[0]+j[1]*j[1]+j[2]*j[2]),p=o,q=2,r=q+1,s=.5*p,t=s*Math.tan(Math.PI/24)*l.fWidthSF,u=0,v=e(t,s,q,u,!0),w=t*Math.sin(0),x=s,y=t*Math.cos(0),z=[-w,x,-y],A=[w,x,y],B=[2*z[0],s,2*z[2]],C=[2*A[0],s,2*A[2]],D=[1.5*z[0],s,1.5*z[2]],E=[0,s,0],F=[1.5*A[0],s,1.5*A[2]];vec=[0,.2*s,.5*-t];var G=n.addVector(D,vec),H=n.addVector(E,vec),I=n.addVector(F,vec),J=[];J.push.apply(J,B),J.push.apply(J,C),J.push.apply(J,D),J.push.apply(J,G),J.push.apply(J,E),J.push.apply(J,H),J.push.apply(J,F),J.push.apply(J,I);var K=mat4.create();mat4.identity(K),mat4.translate(K,b);var L=[0,1,0],M=n.findAngle(L,j),N=n.CrossProduct(L,j);180==parseInt(57.2958*M)?mat4.rotate(K,n.degToRad(180),[1,0,0]):mat4.rotate(K,M,N);for(var O=0;O<v.vertices.length;O+=3){var P=[];P.push(v.vertices[O]),P.push(v.vertices[O+1]),P.push(v.vertices[O+2]);var Q=[];mat4.multiplyVec3(K,P,Q),f.push(Q[0]),f.push(Q[1]),f.push(Q[2])}for(var R=0;R<v.faces.length;R++)g.push(v.faces[R]+i);h+=v.totalConnectivityIndex;for(var O=0;O<J.length;O+=3){var P=[];P.push(J[O]),P.push(J[O+1]),P.push(J[O+2]);var Q=[];mat4.multiplyVec3(K,P,Q),f.push(Q[0]),f.push(Q[1]),f.push(Q[2])}for(var O=0;O<J.length/3;O++)g.push(r+O+i);h+=J.length/3;var S={};return S.vertices=f,S.faces=g,S.totalConnectivityIndex=h,S}var l=this,m=a,n=m.getUtility(),o=m.getWebgl(),p=o.getGL(),q=m.getModelManager();this.iVersion=0,this.SymbolPlotName=null,this.bDraw=!1,this.iSymbolVectorType=CAXViewer.iSymbolPlotVectorType.SYMBOL_VECTORS,this.iShapeType=CAXViewer.iSymbolPlotShapeType.SD_3D,this.iViewMode=CAXViewer.iSymbolPlotViewMode.VIEW_MODE_AUTO,this.sResult=null,this.sDerived=null,this.sInstance=null,this.sComplexComp=null,this.fComplexAngle=0,this.fLengthSF=1,this.fWidthSF=1,this.colorArray=[1,0,0],this.SymbolPlotNodeStateArray=[];var r={};r.vertices=[],r.normals=[],r.faces=[],r.totalConnectivityIndex=0;var s=null;this.clearBuffer=function(){s&&(s.verticesBuffer&&p.deleteBuffer(s.verticesBuffer),s.normalBuffer&&p.deleteBuffer(s.normalBuffer),s.faceBuffer&&p.deleteBuffer(s.faceBuffer)),s.verticesBuffer=null,s.normalBuffer=null,s.faceBuffer=null,s.totalConnectivityIndex=0,s=null,r.vertices=[],r.normals=[],r.faces=[],r.totalConnectivityIndex=0},this.createBuffers=function(){var a=0,b=0;for(null!=q&&void 0!=q||(q=m.getModelManager()),b=0;b<l.SymbolPlotNodeStateArray.length;b++){var d=l.SymbolPlotNodeStateArray[b],e=d.UndeformedPosition,o=q.getModelByName(d.sModelName);if(null!=o&&void 0!=o&&1==o.getPartVisible(d.sPartName)){if(1==o.getIsDeformed()){var p=o.getScaleFactor();if(normalizeFactor=1,null!=d.UndeformedPosition&&"undefined"!=d.UndeformedPosition&&null!=d.deformedPosition&&"undefined"!=d.deformedPosition){var t=d.UndeformedPosition,u=d.deformedPosition,v=n.subtractVector(u,t);v[0]=v[0]*p[0]*normalizeFactor,v[1]=v[1]*p[1]*normalizeFactor,v[2]=v[2]*p[2]*normalizeFactor,e=n.addVector(v,t)}}if(1==o.getIsAnimationON()&&o.getAnimationType()!=CAXViewer.CAEAnimationType.TRANSIENT){var t=d.UndeformedPosition,w=d.deformedPosition,x=null,y=null;null!=d.UndeformedPosition&&"undefined"!=d.UndeformedPosition&&(t=d.UndeformedPosition),null!=d.deformedPosition&&"undefined"!=d.deformedPosition&&(w=d.deformedPosition),null!=d.RealResult&&"undefined"!=d.RealResult&&(x=d.RealResult),null!=d.ImaginaryResult&&"undefined"!=d.ImaginaryResult&&(y=d.ImaginaryResult);var z=o.getFrameFactor(),p=o.getScaleFactor();if(normalizeFactor=1,o.getAnimationType()==CAXViewer.CAEAnimationType.LINEAR||o.getAnimationType()==CAXViewer.CAEAnimationType.EIGEN_VECTOR){var v=n.subtractVector(w,t);v[0]=v[0]*z*p[0]*normalizeFactor,v[1]=v[1]*z*p[1]*normalizeFactor,v[2]=v[2]*z*p[2]*normalizeFactor;var A=n.addVector(v,t);e=A}if(o.getAnimationType()==CAXViewer.CAEAnimationType.EIGEN_VECTOR_COMPLEX){var B=Math.cos(z),C=Math.sin(z),A=[];A[0]=t[0]+(x[0]*B-y[0]*C)*p[0],A[1]=t[1]+(x[1]*B-y[1]*C)*p[1],A[2]=t[2]+(x[2]*B-y[2]*C)*p[2],e=A}}if(l.iSymbolVectorType==CAXViewer.iSymbolPlotVectorType.SYMBOL_VECTORS||l.iSymbolVectorType==CAXViewer.iSymbolPlotVectorType.SYMBOL_PRESSURE){if(l.iShapeType==CAXViewer.iSymbolPlotShapeType.SD_3D){var D=f(d,e,d.DirVector,l.iViewMode,a);r.vertices.push.apply(r.vertices,D.vertices),r.normals.push.apply(r.normals,D.normals),r.faces.push.apply(r.faces,D.faces),r.totalConnectivityIndex=r.totalConnectivityIndex+D.totalConnectivityIndex,a+=D.vertices.length/3}else if(l.iShapeType==CAXViewer.iSymbolPlotShapeType.SD_2D){var D=g(d,e,d.DirVector,l.iViewMode,a);r.vertices.push.apply(r.vertices,D.vertices),r.faces.push.apply(r.faces,D.faces),r.totalConnectivityIndex=r.totalConnectivityIndex+D.totalConnectivityIndex,a+=D.vertices.length/3}}else if(l.iSymbolVectorType==CAXViewer.iSymbolPlotVectorType.SYMBOL_TENSORS){if(l.iShapeType==CAXViewer.iSymbolPlotShapeType.SD_3D){var D=h(d,e,d.DirVector,a);r.vertices.push.apply(r.vertices,D.vertices),r.normals.push.apply(r.normals,D.normals),r.faces.push.apply(r.faces,D.faces),r.totalConnectivityIndex=r.totalConnectivityIndex+D.totalConnectivityIndex,a+=D.vertices.length/3}else if(l.iShapeType==CAXViewer.iSymbolPlotShapeType.SD_2D){var D=i(d,e,d.DirVector,a);r.vertices.push.apply(r.vertices,D.vertices),r.faces.push.apply(r.faces,D.faces),r.totalConnectivityIndex=r.totalConnectivityIndex+D.totalConnectivityIndex,a+=D.vertices.length/3}}else if(l.iSymbolVectorType==CAXViewer.iSymbolPlotVectorType.SYMBOL_SPC)if(l.iShapeType==CAXViewer.iSymbolPlotShapeType.SD_3D){var D=j(d,e,d.DirVector,a);r.vertices.push.apply(r.vertices,D.vertices),r.normals.push.apply(r.normals,D.normals),r.faces.push.apply(r.faces,D.faces),r.totalConnectivityIndex=r.totalConnectivityIndex+D.totalConnectivityIndex,a+=D.vertices.length/3}else if(l.iShapeType==CAXViewer.iSymbolPlotShapeType.SD_2D){var D=k(d,e,d.DirVector,a);r.vertices.push.apply(r.vertices,D.vertices),r.faces.push.apply(r.faces,D.faces),r.totalConnectivityIndex=r.totalConnectivityIndex+D.totalConnectivityIndex,a+=D.vertices.length/3}}}s=c(r)},this.updateBuffer=function(){l.clearBuffer(),l.createBuffers()},this.render=function(a){if(null!=s&&void 0!=s){if(m.getFileVersion()<=2)var a=o.getLightShader();else var a=o.getLightShader_v3();a.bind();var c=o.getpMatrix(),d=o.getmvMatrix();a.setUniformProjectionMatrix(c),a.setUniformModelviewMatrix(d);var e=mat4.create(d);e=mat4.inverse(e),e=mat4.transpose(e),a.setUniformNormalMatrix(e),a.setInverseMVMatrix(e),a.setDiffuseColor(l.colorArray),a.setAmbientColor([.5,.5,.5]),a.setSpecularColor([.2,.2,.2]),a.setEmissiveColor([0,0,0]),a.setShininess(128),a.setAmbientIntensity(.1),a.disableColor(),a.disableNormal(),a.disableUV(),a.disableRealResult(),a.disableImaginaryResult(),a.disableTargetFrame(),a.disableNormalTargetFrame(),a.disableUVtargetFrame(),a.setUseLighting(1),a.setUseTexture(0),a.set_IsAnimationOn(30),a.setSectionEdgeThickness(0),b(a,s)}}},CAXViewer.SymbolPlotNodeState=function(){this.DirVector=[0,0,0],this.vertexNormal=[0,0,0],this.UndeformedPosition=null,this.deformedPosition=null,this.RealResult=null,this.ImaginaryResult=null,this.sPartName="",this.iVersion=0,this.sModelName="",this.iSymbolPlotDrawType=CAXViewer.iSymbolPlotDrawType.ST_ARROW,this.bufferData=null,this.SymbolPlotNodeStateGrpName=""},angular.module("templates-main",["templates/MenuBarTemplate.html","templates/MenuBarTemplate_lessGUI.html","templates/RightContainerTemplate.html"]),angular.module("templates/MenuBarTemplate.html",[]).run(["$templateCache",function(a){a.put("templates/MenuBarTemplate.html",'<div id="divTopMenuBar" class ="divTopMenuBar" ng-controller ="vctTopMenuController">\n        <div id="divTitleBar" class ="divTitleBar" ng-click="onLogoClick()">\n            <!-- <div style="display:flex;align-items:center;height:inherit;background-color:rgba(255, 255, 255, 0.5)" >-->\n                <img src="images/svgs/VCollabLogo01.svg"  class="imgTitleBar" id="imgTitleBar" /> \n            <!--  </div> -->\n\t\t</div>   \n        <div id="divFileBar" ng-class="{\'divFileBarHide\' : hideFileOpenBar==true}" class ="divFileBar"  ng-click="onOpenClick()" data-tooltip="Open File">      \n                <img src="images/svgs/Open Folder.svg" height="24" style="margin-left:8px;margin-right:8px" /> \n                <span id="spnFileName" style="margin-right:8px;overflow: hidden;white-space:nowrap;text-overflow:ellipsis;">{{ Filename }}</span>\n\t    </div>         \n  \n       <div id="divHammerIcon" ng-show="isIconVisible() === true" class="divTopMenuBarIcon divHammerIcon" data-tooltip=""    ng-click="onMenuClick()"> </div>\n        <div id="divMiddleBar" class="divMiddleBar">            \n            <div id="divFullScreenIcon"  ng-show="GUIIconVisibility.fullscreen === true" ng-class="{\'divFullScreenIconExit\' : isFullScreen==true}" class="divTopMenuBarIcon divFullScreenIcon" data-tooltip="FullScreen"    ng-click="onFullScreenClick()"> </div>\n            <div id="divHelpIcon"  class="divTopMenuBarIcon divHelpIcon" data-tooltip="Help"    ng-click="onHelpClick()"> </div>\n            <div id="divFrameIcon"  ng-show="GUIIconVisibility.frameinfo === true"   ng-class="{\'divFrameIconDisable\' : isFrameInfoEnabled==false}"  class="divTopMenuBarIcon divFrameIcon tooltip-bottom" data-tooltip="Frame Info" ng-click="onFrameInfoClick()"> </div> \n            <div id="divLegendIcon"  ng-show="GUIIconVisibility.legend === true"  ng-class="{\'divLegendIconOn\' : islegendOn==true,\'divLegendIconDisabled\' : islegendDisabled==true}" class="divTopMenuBarIcon divLegendIcon tooltip-bottom" data-tooltip="Legend"    ng-click="onLegendClick()"> </div> \n           <div id="divResetIcon"  ng-show="GUIIconVisibility.resetviewpoint === true" class="divTopMenuBarIcon divResetIcon" data-tooltip="Reset ViewPoint" ng-click="onResetViewClick()"> </div>\n            <div id="divFitViewIcon"  ng-show="GUIIconVisibility.fitview === true" class="divTopMenuBarIcon divFitViewIcon" data-tooltip="Fit View" ng-click="onFitViewClick()"> </div>\n           <!-- <div id="divOpenFileIcon" class="divTopMenuBarIcon divOpenFileIcon tooltip-bottom" data-tooltip="Open File"    ng-click="onOpenClick()"> </div>   -->         \n            \n        </div>       \n       <!--<div class="divSeparator"></div>-->             \n        <div id="divRightBar" class="divRightBar">            \n            <div id="divCapture" ng-show="GUIIconVisibility.capture === true" class="divTopMenuBarIcon divCapture" data-tooltip="Capture" ng-click="topMenuIconClick($event)"> </div>\n            <div id="divDISPMode" ng-show="GUIIconVisibility.displaymode === true" class="divTopMenuBarIcon divDISPMode" data-tooltip="Display Mode" ng-click="topMenuIconClick($event)"> </div>\n            <div id="divCAEPlay" ng-show="GUIIconVisibility.caeanimation === true" ng-class="{\'divCAEPlayDisable\' : isCAEAnimationEnabled==false}" class="divTopMenuBarIcon divCAEPlay" data-tooltip="CAE Animation" ng-click="topMenuIconClick($event)"> </div>\n            <div id="divVPICon" ng-show="GUIIconVisibility.viewpoints === true" ng-class="{\'divVPIConDisable\' : isVPExists==false}"  class="divTopMenuBarIcon divVPICon" data-tooltip="View Points" ng-click="topMenuIconClick($event)"> </div>\n        </div>\n </div>\n\n<div id="divSideBar" class="divSideBar" ng-controller ="vctSideBarController">\n   \n    <div  id="divSideBarTitle" class="divSideBarTitle">\n\n            <div  class="divSideBarHeader" ng-class="{\'divSideBarHeaderEx\' : titleShowBackIcon==true}" ng-click="ontitleBackClick()">\n            <div class="divSideBarTitleImg" ng-show="titleShowBackIcon">\n                <img src="images/svgs/PrevIcon24px.svg" style="width:32px;"/>\n            </div>\n            <span id="spnSidebarTitle" style="width:80%;margin-left:16px;overflow: hidden;white-space:nowrap;text-overflow:ellipsis;font-weight:800;">{{ titleName | uppercase }}</span>\n            </div>\n        \n            <div id="divSideBarClose" class="divSideBarClose" ng-click="ontitleCloseClick()">\n                 <img src="images/svgs/close.svg" style="width:16px"/>\n            </div>       \n    </div>    \n    <div id="divSideBarContainer" class="divSideBarContainer">\n        <div ng-include="view"></div>\n    </div>\n</div>\n\n<div id="divMobilePopMenu" class="divMobilePopMenu" ng-controller ="vctMobilePopMenuController">\n    <div id="divViewPath" class="divlistItem" ng-show="checkforVisibility(item,$index) === true" ng-repeat ="item in MenuItems" ng-click="OnMenuItemClick(item,$index)">         \n        <img style="margin-left:8px" ng-src="{{item.leftImgScr}}"/>\n        <span id="spnViewPath"  style ="width:90%;  padding-left:10px;  overflow: hidden;\n        white-space:nowrap;text-overflow:ellipsis;">{{item.itemName}}</span>\n      </div>\n</div> \n\n\n')}]),angular.module("templates/MenuBarTemplate_lessGUI.html",[]).run(["$templateCache",function(a){a.put("templates/MenuBarTemplate_lessGUI.html",'<div id="divTopMenuBar" class ="divTopMenuBar" ng-controller ="vctTopMenuController">\n       <div id="divTitleBar" class ="divTitleBar" ng-click="onLogoClick()">\n                <img src="images/svgs/VCollabLogo01.svg"  class="imgTitleBar" id="imgTitleBar" /> \n\t\t</div>   \n       <div id="divHammerIcon" class="divTopMenuBarIcon divHammerIcon" data-tooltip=""    ng-click="onMenuClick()"> </div>\n       <div id="divMiddleBar" class="divMiddleBar">            \n            <div id="divFullScreenIcon" ng-class="{\'divFullScreenIconExit\' : isFullScreen==true}" class="divTopMenuBarIcon divFullScreenIcon" data-tooltip="FullScreen"    ng-click="onFullScreenClick()"> </div>\n            <div id="divResetIcon" class="divTopMenuBarIcon divResetIcon" data-tooltip="Reset ViewPoint" ng-click="onResetViewClick()"> </div>\n            <div id="divFitViewIcon" class="divTopMenuBarIcon divFitViewIcon" data-tooltip="Fit View" ng-click="onFitViewClick()"> </div>        \n        </div>      \n </div>\n\n<div id="divSideBar" class="divSideBar" ng-controller ="vctSideBarController">\n   \n    <div  id="divSideBarTitle" class="divSideBarTitle">\n\n            <div  class="divSideBarHeader" ng-class="{\'divSideBarHeaderEx\' : titleShowBackIcon==true}" ng-click="ontitleBackClick()">\n            <div class="divSideBarTitleImg" ng-show="titleShowBackIcon">\n                <img src="images/svgs/PrevIcon24px.svg" style="width:32px;"/>\n            </div>\n            <span id="spnSidebarTitle" style="width:80%;margin-left:16px;overflow: hidden;white-space:nowrap;text-overflow:ellipsis;font-weight:800;">{{ titleName | uppercase }}</span>\n            </div>\n        \n            <div id="divSideBarClose" class="divSideBarClose" ng-click="ontitleCloseClick()">\n                 <img src="images/svgs/close.svg" style="width:16px"/>\n            </div>       \n    </div>    \n    <div id="divSideBarContainer" class="divSideBarContainer">\n        <div ng-include="view"></div>\n    </div>\n</div>\n\n<div id="divMobilePopMenu" class="divMobilePopMenu" ng-controller ="vctMobilePopMenuController">\n    <div id="divViewPath" class="divlistItem" ng-show="checkforVisibility(item,$index) === true" ng-repeat ="item in MenuItems" ng-click="OnMenuItemClick(item,$index)">         \n        <img style="margin-left:8px" ng-src="{{item.leftImgScr}}"/>\n        <span id="spnViewPath"  style ="width:90%;  padding-left:10px;  overflow: hidden;\n        white-space:nowrap;text-overflow:ellipsis;">{{item.itemName}}</span>\n      </div>\n</div> \n\n\n')}]),angular.module("templates/RightContainerTemplate.html",[]).run(["$templateCache",function(a){a.put("templates/RightContainerTemplate.html",'<div  id="divShowdispMode" class="divShowdispMode"  ng-show="showDisplayMode">\n<div id="div{{item.itemName}}" ng-class="{\'divlistItemSelected\' : displayModeSelectedIndex==$index}" class="divlistItem" ng-repeat ="item in modelList" ng-click="onDisplayModeSelection(item,$index)">\n    <img ng-src="{{item.leftImgScr}}" style="width:18px;margin-left:8px"  ng-show="{{item.showLeftImg}}"/>\n    <span id="spn{{item.itemName}}"  style ="width:80%;  padding-left:10px;">{{item.itemName}}</span>\n   <!-- <img ng-src="{{item.rightImgScr}}" style="width:5%;" ng-show="{{item.rightImgScr}}"/>-->\n</div>\n</div>\n\n<div  id="divShowcaptureImg" class="divShowcaptureImg"  ng-show="showcaptureImg">\n    <div id="divFileFormatTitle" class="divSubTitle">File Format</div>\n\n    <div id="divListContianer" class="divListContianer">\n    <div id="div1" ng-class="{\'divlistItemSelected\' : selectedImgFormatIndex==$index}" class="divlistItem" ng-repeat ="item in modelList" \n        ng-click="onImgFormatSelection(item, $index)">\n        <span id="Span1"  style ="width:100%;  padding-left:10px;">{{item.itemName}}</span>\n    </div>\n    </div>\n\n    <div id="divFileNameTitle" class="divSubTitle">File Name</div>\n    <input id="inpFileName" class="inpFileName" type="text" placeholder ="Untitled" ng-model="imgFileName"/> .{{selectFileFormat | lowercase }}\n    <!--<div id="divCaptureTitle" class="divTitle divTitleEx">Capture</div>--><br />\n    <input id="btnCapture" class="btnCapture" type="button" value ="Save" ng-click="btnSaveImageAs(imgFileName)" />\n</div>\n\n<div  id="divShowCAEAnimation" class="divShowCAEAnimation"  ng-show="showCAEAnimation">\n     <div id="divAnmCtrlTitle" class="divSubTitle">Animation Control</div>\n\n    <div id="divAnmCtrl" class="divAnmCtrl">\n        <div id="divCAEPreviousIcon" class="divCAEPreviousIcon divCEAANIIcon" ng-click="OnPreviousBtnClick()"></div>\n        <div id="divCAEPlayPauseIcon" ng-class="{\'divCAEStopIcon\' : CAEAnimation.isAnimationOn==true}"\n             class="divCAEPlayPauseIcon divCEAANIIcon" ng-click="OnPlayPauseBtnClick()"></div>\n        <!--<div id="divCAEStopIcon" class="divCAEStopIcon divCEAANIIcon"></div>-->\n       <div id="divCAENextIcon" class="divCAENextIcon divCEAANIIcon" ng-click="OnNextBtnClick()"></div>\n    </div>\n    <div id="divSpdTitle" class="divSubTitle divSubTitleEx">Animation Speed</div>\n<!--    <input id="inpSpeed"  class="inpSpeed"  type="range" min="1" step="2.5" max="250"\n        ng-Model="CAEAnimationSpeed.animationSpeed"   ng-change="onChangeSpeed(CAEAnimationSpeed.animationSpeed)"  />-->\n     <input id="inpSpeed"  class="inpSpeed" type="range" min="1" step="2.5" max="250" value="250" />\n \n     <div id="divScaleFtrTitle" class="divSubTitle divSubTitleEx">Scale Factor</div>\n      <input  id="inpScaleFactor"  autocomplete="off" step="0.1" class="inpScaleFactor" \n          ng-Model="CAEAnimation.scaleFactor" ng-change="OnChangeScaleFactor()" required />\n\n\n     <div id="divAnimationTypeTitle" class="divSubTitle divSubTitleEx">Animation Type</div>\n        <span id="spanAnimType" class="inpAnimType">{{CAEAnimation.animationType}}</span>\n    \n</div>\n\n<div  id="divShowViewPath" class="divShowViewPath"  ng-show="showViewPath">\n<div id="divViewPath" ng-class="{\'divlistItemSelected\' : viewPathSelectedKey==item.key}" class="divlistItem" \n    ng-repeat ="item in viewPathList" ng-click="onClickViewPathName(item)">\n    <span id="spnViewPath"  style ="width:90%;  padding-left:10px;  overflow: hidden;\n    white-space:nowrap;text-overflow:ellipsis;">{{item.itemName}}</span>\n    <img ng-src="{{item.rightImgScr}}" style="width:10%;margin-right:16px;" ng-show="{{item.showRightImg}}"/>\n</div>\n</div>\n\n<div  id="divShowViewPoint" class="divShowViewPoint"  ng-show="showViewPoint">\n    <div id="divView1" ng-show="divViewSelection == \'divView1\'">\n        <div id="divViewPoint" ng-class="{\'divlistItemSelected\' : viewPointSelectedKey==item.key}" class="divlistItem" \n            ng-repeat ="item in viewPointList" ng-click="onViewPointSelection(item,$index)">\n            <img data-ng-src="{{item.leftImgScr}}" style="width:32px;margin-left:8px"  ng-show="{{item.showLeftImg}}"/>\n            <span id="spnViewPoint"  style ="width:80%;  margin-left:8px; overflow: hidden;\n            white-space:nowrap;text-overflow:ellipsis;\n            display:inline-block;">{{item.itemName}}</span>\n        </div>\n    </div>\n\n    <div id="divView2" ng-show="divViewSelection == \'divView2\'" style="margin-top:8%;">\n        <div id="{{\'divViewPointIMG_\' + item.key }}" ng-class="{\'divlistItemSelectedIMG\' : viewPointSelectedKey==item.key}" class="divViewPointIMG" \n            ng-repeat ="item in viewPointList" ng-click="onViewPointSelection(item,$index)">\n            <div>\n            <img data-ng-src="{{item.leftImgScr}}" style="width:80%"  ng-show="{{item.showLeftImg}}"/>\n            <span id="spnViewPointIMG"  style ="width:80%;max-width:200px; overflow: hidden;\n            white-space:nowrap;text-overflow:ellipsis;display:inline-block;font-family: Open Sans;font-weight:300;font-size:12px;">{{item.itemName}}</span>\n            </div>\n        </div>\n    </div>\n</div>\n')}]);